module.exports=[13326,e=>{"use strict";var t=e.i(350958),a=e.i(174936),n=e.i(523626),r=e.i(49523),s=e.i(32934),o=e.i(418597),i=e.i(258664),l=e.i(980477),u=e.i(215264),d=e.i(616247),c=e.i(908280),p=e.i(595829),h=e.i(161311),f=e.i(34740),g=e.i(342797),v=e.i(193695);e.i(506148);var m=e.i(814411),R=e.i(472541),D=e.i(665592),w=e.i(129981),y=e.i(848886);function E(e,t){let a=(0,y.toDate)(e,t?.in).getDay();return 0===a||6===a}var N=e.i(621629),x=e.i(671509);function C(e){let t=(0,y.toDate)(e),a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return a.setUTCFullYear(t.getFullYear()),e-a}var A=e.i(302749),H=e.i(403624);function T(e){return!(!(e instanceof Date||"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e))&&"number"!=typeof e||isNaN(+(0,y.toDate)(e)))}async function O(e){let t=await D.prisma.task.findUnique({where:{id:e},include:{assignees:{select:{id:!0}},dependencies:{include:{dependsOnTask:!0}}}});if(!t)return null;let a=t.estimatedHours>0?t.estimatedHours/8:1;if(t.assignees.length>0){let e=await D.prisma.task.findMany({where:{assignees:{some:{id:{in:t.assignees.map(e=>e.id)}}},status:"completed",completedAt:{not:null}},take:10,orderBy:{completedAt:"desc"},select:{estimatedHours:!0,actualHours:!0,createdAt:!0,completedAt:!0}});if(e.length>0){let n=0,r=0;e.forEach(e=>{e.estimatedHours>0&&e.actualHours>0&&(n+=e.actualHours/e.estimatedHours,r++)});let s=r>0?n/r:1.2;t.estimatedHours>0&&(a=t.estimatedHours*s/8)}}let n=new Date,r=!1;if(t.dependencies.length>0){let e=new Date;for(let a of t.dependencies){let t=a.dependsOnTask;if("completed"!==t.status&&!t.taskStatusId){let a=t.dueDate?new Date(t.dueDate):(0,x.addDays)(new Date,1);a>e&&(e=a),r=!0}}e>n&&(n=e)}let s=function(e,t,a){let n=(0,y.toDate)(e,void 0),r=E(n,void 0);if(isNaN(t))return(0,w.constructFrom)(void 0,NaN);let s=n.getHours(),o=t<0?-1:1,i=Math.trunc(t/5);n.setDate(n.getDate()+7*i);let l=Math.abs(t%5);for(;l>0;)n.setDate(n.getDate()+o),E(n,void 0)||(l-=1);r&&E(n,void 0)&&0!==t&&(6===(0,y.toDate)(n,void 0).getDay()&&n.setDate(n.getDate()+(o<0?2:-1)),0===(0,y.toDate)(n,void 0).getDay()&&n.setDate(n.getDate()+(o<0?1:-2)));return n.setHours(s),n}(n,Math.ceil(a)),o=85,i=[];r&&(o-=15,i.push("Dependent on incomplete tasks")),t.dueDate&&s>t.dueDate&&i.push("Historical velocity suggests delay"),0===t.assignees.length&&(o-=20,i.push("No assignee to gauge velocity"));let l="low";return t.dueDate&&s>t.dueDate&&(l=function(e,t,a){let[n,r]=(0,N.normalizeDates)(void 0,e,t);if(!T(n)||!T(r))return NaN;let s=function(e,t,a){let[n,r]=(0,N.normalizeDates)(void 0,e,t),s=(0,H.startOfDay)(n),o=(0,H.startOfDay)(r);return Math.round((s-C(s)-(o-C(o)))/A.millisecondsInDay)}(n,r),o=s<0?-1:1,i=Math.trunc(s/7),l=5*i,u=(0,x.addDays)(r,7*i);for(;!function(e,t,a){let[n,r]=(0,N.normalizeDates)(void 0,e,t);return+(0,H.startOfDay)(n)==+(0,H.startOfDay)(r)}(n,u);)l+=E(u,void 0)?0:o,u=(0,x.addDays)(u,o);return 0===l?0:l}(s,t.dueDate)>2?"high":"medium"),{taskId:e,predictedDate:s,riskLevel:l,confidence:o,explanation:i.join(", ")||"Based on average team velocity"}}var b=e.i(871887),k=e.i(192774);async function P(e,{params:t}){if(!await (0,b.getServerSession)(k.authOptions))return R.NextResponse.json({error:"Unauthorized"},{status:401});let{id:a}=await t,n=parseInt(a);try{let e=await O(n);if(!e)return R.NextResponse.json({error:"Task not found"},{status:404});return R.NextResponse.json(e)}catch(e){return R.NextResponse.json({error:e.message},{status:500})}}e.s(["GET",()=>P],603780);var S=e.i(603780);let M=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/forecast/task/[id]/route",pathname:"/api/forecast/task/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/nxt/New folder/Project_Management_NXT/src/app/api/forecast/task/[id]/route.ts",nextConfigOutput:"",userland:S}),{workAsyncStorage:_,workUnitAsyncStorage:U,serverHooks:I}=M;function j(){return(0,n.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:U})}async function q(e,t,n){M.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/forecast/task/[id]/route";R=R.replace(/\/index$/,"")||"/";let D=await M.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!D)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:w,params:y,nextConfig:E,parsedUrl:N,isDraftMode:x,prerenderManifest:C,routerServerContext:A,isOnDemandRevalidate:H,revalidateOnlyGenerated:T,resolvedPathname:O,clientReferenceManifest:b,serverActionsManifest:k}=D,P=(0,i.normalizeAppPath)(R),S=!!(C.dynamicRoutes[P]||C.routes[O]),_=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,N,!1):t.end("This page could not be found"),null);if(S&&!x){let e=!!C.routes[O],t=C.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await _();throw new v.NoFallbackError}}let U=null;!S||M.isDev||x||(U="/index"===(U=O)?"/":U);let I=!0===M.isDev||!S,j=S&&!I;k&&b&&(0,o.setManifestsSingleton)({page:R,clientReferenceManifest:b,serverActionsManifest:k});let q=e.method||"GET",F=(0,s.getTracer)(),$=F.getActiveScopeSpan(),K={params:y,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:I,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n,r)=>M.onRequestError(e,t,n,r,A)},sharedContext:{buildId:w}},B=new l.NodeNextRequest(e),z=new l.NodeNextResponse(t),L=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let o=async e=>M.handle(L,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=F.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let t=`${q} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${R}`)}),i=!!(0,r.getRequestMeta)(e,"minimalMode"),l=async r=>{var s,l;let u=async({previousCacheEntry:a})=>{try{if(!i&&H&&T&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(r);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let u=K.renderOpts.collectedTags;if(!S)return await (0,p.sendResponse)(B,z,s,K.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);u&&(t[g.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,n=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==a?void 0:a.isStale)&&await M.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:H})},!1,A),t}},d=await M.handleResponse({req:e,nextConfig:E,cacheKey:U,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:H,revalidateOnlyGenerated:T,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:i});if(!S)return null;if((null==d||null==(s=d.value)?void 0:s.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",H?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let v=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&S||v.delete(g.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||v.get("Cache-Control")||v.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(B,z,new Response(d.value.body,{headers:v,status:d.value.status||200})),null};$?await l($):await F.withPropagatedContext(e.headers,()=>F.trace(d.BaseServerSpan.handleRequest,{spanName:`${q} ${R}`,kind:s.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await M.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:H})},!1,A),S)throw t;return await (0,p.sendResponse)(B,z,new Response(null,{status:500})),null}}e.s(["handler",()=>q,"patchFetch",()=>j,"routeModule",()=>M,"serverHooks",()=>I,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>U],13326)}];

//# sourceMappingURL=6ace2_next_dist_esm_build_templates_app-route_13569886.js.map