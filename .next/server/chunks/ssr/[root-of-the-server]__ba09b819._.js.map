{"version":3,"sources":["turbopack:///[project]/nxt/New folder/Project_Management_NXT/node_modules/openid-client/package.json","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/lib/rbac-helpers.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/lib/rbac.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/lib/activity-logger.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/constants.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/constructFrom.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/toDate.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/startOfDay.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/endOfDay.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/app/actions/teams.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/app/actions/today-tasks-assignment.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/.next-internal/server/app/dashboard/today-tasks-assignment/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["{\"name\":\"openid-client\",\"version\":\"5.7.1\",\"description\":\"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs\",\"keywords\":[\"auth\",\"authentication\",\"basic\",\"certified\",\"client\",\"connect\",\"dynamic\",\"electron\",\"hybrid\",\"identity\",\"implicit\",\"oauth\",\"oauth2\",\"oidc\",\"openid\",\"passport\",\"relying party\",\"strategy\"],\"homepage\":\"https://github.com/panva/openid-client\",\"repository\":\"panva/openid-client\",\"funding\":{\"url\":\"https://github.com/sponsors/panva\"},\"license\":\"MIT\",\"author\":\"Filip Skokan <panva.ip@gmail.com>\",\"exports\":{\"types\":\"./types/index.d.ts\",\"import\":\"./lib/index.mjs\",\"require\":\"./lib/index.js\"},\"main\":\"./lib/index.js\",\"types\":\"./types/index.d.ts\",\"files\":[\"lib\",\"types/index.d.ts\"],\"scripts\":{\"format\":\"npx prettier --loglevel silent --write ./lib ./test ./certification ./types\",\"test\":\"mocha test/**/*.test.js\"},\"dependencies\":{\"jose\":\"^4.15.9\",\"lru-cache\":\"^6.0.0\",\"object-hash\":\"^2.2.0\",\"oidc-token-hash\":\"^5.0.3\"},\"devDependencies\":{\"@types/node\":\"^16.18.106\",\"@types/passport\":\"^1.0.16\",\"base64url\":\"^3.0.1\",\"chai\":\"^4.5.0\",\"mocha\":\"^10.7.3\",\"nock\":\"^13.5.5\",\"prettier\":\"^2.8.8\",\"readable-mock-req\":\"^0.2.2\",\"sinon\":\"^9.2.4\",\"timekeeper\":\"^2.3.1\"},\"standard-version\":{\"scripts\":{\"postchangelog\":\"sed -i '' -e 's/### \\\\[/## [/g' CHANGELOG.md\"},\"types\":[{\"type\":\"feat\",\"section\":\"Features\"},{\"type\":\"fix\",\"section\":\"Fixes\"},{\"type\":\"chore\",\"hidden\":true},{\"type\":\"docs\",\"hidden\":true},{\"type\":\"style\",\"hidden\":true},{\"type\":\"refactor\",\"section\":\"Refactor\",\"hidden\":false},{\"type\":\"perf\",\"section\":\"Performance\",\"hidden\":false},{\"type\":\"test\",\"hidden\":true}]}}","/**\r\n * RBAC Helper Functions - Proper Authorization Without Role Bypasses\r\n * \r\n * These functions ensure that all permission checks go through the RBAC system,\r\n * preventing authorization bypasses from legacy role-based checks.\r\n */\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { hasPermission, clearPermissionCache } from \"@/lib/rbac\"\r\n\r\n/**\r\n * Custom error classes for authorization\r\n */\r\nexport class UnauthorizedError extends Error {\r\n  constructor(message: string, public code: string = \"UNAUTHORIZED\") {\r\n    super(message)\r\n    this.name = \"UnauthorizedError\"\r\n  }\r\n}\r\n\r\nexport class ForbiddenError extends Error {\r\n  constructor(message: string, public code: string = \"FORBIDDEN\") {\r\n    super(message)\r\n    this.name = \"ForbiddenError\"\r\n  }\r\n}\r\n\r\nexport class NotFoundError extends Error {\r\n  constructor(message: string, public code: string = \"NOT_FOUND\") {\r\n    super(message)\r\n    this.name = \"NotFoundError\"\r\n  }\r\n}\r\n\r\n/**\r\n * Require specific permission - throws UnauthorizedError if denied\r\n * This is the ONLY way to check permissions - no role-based bypasses\r\n *\r\n * @param userId - User ID to check\r\n * @param permission - Permission key (e.g., \"project.delete\")\r\n * @param projectId - Optional project ID for resource-scoped permissions\r\n * @throws UnauthorizedError if permission denied\r\n *\r\n * @example\r\n * await requirePermission(userId, \"project.delete\", projectId)\r\n */\r\nexport async function requirePermission(\r\n  userId: number,\r\n  permission: string,\r\n  projectId?: number\r\n): Promise<void> {\r\n  // Check permission through RBAC system ONLY\r\n  // No role checks, no bypasses\r\n  const allowed = await hasPermissionWithoutRoleBypass(userId, permission, projectId)\r\n\r\n  if (!allowed) {\r\n    throw new UnauthorizedError(`Permission denied: ${permission}`, \"PERMISSION_DENIED\")\r\n  }\r\n}\r\n\r\n/**\r\n * Require any of multiple permissions\r\n * Throws error if user has none of them\r\n *\r\n * @param userId - User ID\r\n * @param permissions - Array of permission keys\r\n * @param projectId - Optional project ID\r\n * @throws UnauthorizedError if all permissions denied\r\n */\r\nexport async function requireAnyPermission(\r\n  userId: number,\r\n  permissions: string[],\r\n  projectId?: number\r\n): Promise<void> {\r\n  // Check if user has at least one permission\r\n  for (const permission of permissions) {\r\n    const allowed = await hasPermissionWithoutRoleBypass(userId, permission, projectId)\r\n    if (allowed) return\r\n  }\r\n\r\n  throw new UnauthorizedError(\r\n    `Permission denied: requires one of [${permissions.join(\", \")}]`,\r\n    \"PERMISSION_DENIED\"\r\n  )\r\n}\r\n\r\n/**\r\n * Check permission WITHOUT role-based bypasses\r\n * This is the core RBAC check - pure permission system\r\n *\r\n * @param userId - User ID\r\n * @param permission - Permission key\r\n * @param projectId - Optional project ID\r\n * @returns true if user has the permission\r\n */\r\nexport async function hasPermissionWithoutRoleBypass(\r\n  userId: number,\r\n  permission: string,\r\n  projectId?: number\r\n): Promise<boolean> {\r\n  // Check through RBAC system only\r\n  // The old hasPermission() function had bypasses for admin role\r\n  // We use a pure RBAC check here\r\n\r\n  try {\r\n    // Get user's roles and their permissions\r\n    const userRoles = await prisma.userRole.findMany({\r\n      where: {\r\n        userId,\r\n        OR: [\r\n          { scopeType: null }, // Global roles\r\n          { scopeType: \"global\" },\r\n          ...(projectId ? [{ scopeType: \"project\", scopeId: projectId }] : []),\r\n        ],\r\n      },\r\n      include: {\r\n        role: {\r\n          include: {\r\n            permissions: {\r\n              include: {\r\n                permission: true,\r\n              },\r\n            },\r\n          },\r\n        },\r\n      },\r\n    })\r\n\r\n    // Check if any role has the permission\r\n    for (const userRole of userRoles) {\r\n      for (const rolePermission of userRole.role.permissions) {\r\n        if (rolePermission.permission.key === permission) {\r\n          return true\r\n        }\r\n      }\r\n    }\r\n\r\n    return false\r\n  } catch (error) {\r\n    console.error(`Error checking permission ${permission} for user ${userId}:`, error)\r\n    // Fail secure - deny access on error\r\n    return false\r\n  }\r\n}\r\n\r\n/**\r\n * Verify user can access a project with specific permission\r\n * Throws error if project doesn't exist or user lacks permission\r\n *\r\n * @param userId - User ID\r\n * @param projectId - Project ID\r\n * @param permission - Permission key (e.g., \"project.delete\")\r\n * @throws NotFoundError if project doesn't exist\r\n * @throws UnauthorizedError if permission denied\r\n */\r\nexport async function verifyProjectAccess(\r\n  userId: number,\r\n  projectId: number,\r\n  permission: string\r\n): Promise<void> {\r\n  // 1. Verify project exists\r\n  const project = await prisma.project.findUnique({\r\n    where: { id: projectId },\r\n    select: { id: true },\r\n  })\r\n\r\n  if (!project) {\r\n    throw new NotFoundError(`Project ${projectId} not found`)\r\n  }\r\n\r\n  // 2. Check permission through RBAC (no bypasses)\r\n  const allowed = await hasPermissionWithoutRoleBypass(userId, permission, projectId)\r\n\r\n  if (!allowed) {\r\n    throw new UnauthorizedError(\r\n      `You don't have permission to ${permission} on this project`,\r\n      \"PROJECT_ACCESS_DENIED\"\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * Verify user can access a task with specific permission\r\n * Throws error if task doesn't exist or user lacks permission\r\n *\r\n * @param userId - User ID\r\n * @param taskId - Task ID\r\n * @param permission - Permission key (e.g., \"task.update\")\r\n * @throws NotFoundError if task doesn't exist\r\n * @throws UnauthorizedError if permission denied\r\n */\r\nexport async function verifyTaskAccess(\r\n  userId: number,\r\n  taskId: number,\r\n  permission: string\r\n): Promise<void> {\r\n  // 1. Get task and its project\r\n  const task = await prisma.task.findUnique({\r\n    where: { id: taskId },\r\n    select: {\r\n      id: true,\r\n      projectId: true,\r\n    },\r\n  })\r\n\r\n  if (!task) {\r\n    throw new NotFoundError(`Task ${taskId} not found`)\r\n  }\r\n\r\n  // 2. Check permission on the project\r\n  // Tasks are scoped to projects, so we check project-level permissions\r\n  const allowed = await hasPermissionWithoutRoleBypass(userId, permission, task.projectId)\r\n\r\n  if (!allowed) {\r\n    throw new UnauthorizedError(\r\n      `You don't have permission to ${permission} on this task`,\r\n      \"TASK_ACCESS_DENIED\"\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * Verify user is project owner/creator\r\n * Used for operations that should only be available to the creator\r\n *\r\n * @param userId - User ID\r\n * @param projectId - Project ID\r\n * @throws NotFoundError if project doesn't exist\r\n * @throws UnauthorizedError if not the creator\r\n */\r\nexport async function verifyProjectOwner(userId: number, projectId: number): Promise<void> {\r\n  const project = await prisma.project.findUnique({\r\n    where: { id: projectId },\r\n    select: { id: true, createdById: true },\r\n  })\r\n\r\n  if (!project) {\r\n    throw new NotFoundError(`Project ${projectId} not found`)\r\n  }\r\n\r\n  if (project.createdById !== userId) {\r\n    throw new UnauthorizedError(`You are not the owner of this project`, \"NOT_OWNER\")\r\n  }\r\n}\r\n\r\n/**\r\n * Check if user is admin through RBAC (has admin role in system)\r\n * Does NOT grant automatic permissions - must still check individual permissions\r\n *\r\n * @param userId - User ID\r\n * @returns true if user has the \"admin\" role\r\n * @deprecated - Use specific permission checks instead\r\n */\r\nexport async function isAdminUser(userId: number): Promise<boolean> {\r\n  const adminRole = await prisma.userRole.findFirst({\r\n    where: {\r\n      userId,\r\n      role: {\r\n        name: \"admin\",\r\n      },\r\n    },\r\n  })\r\n\r\n  return !!adminRole\r\n}\r\n\r\n/**\r\n * Clear permission cache when user roles change\r\n * Must be called after updating user permissions/roles\r\n *\r\n * @param userId - User ID whose cache to clear\r\n * @param projectId - Optional project ID for project-scoped changes\r\n */\r\nexport function invalidateUserPermissionCache(userId: number, projectId?: number): void {\r\n  clearPermissionCache(userId, projectId)\r\n}\r\n\r\n/**\r\n * Clear all permission caches (use sparingly)\r\n */\r\nexport function invalidateAllPermissionCaches(): void {\r\n  clearPermissionCache(0, undefined) // This clears all caches\r\n}\r\n\r\n/**\r\n * Handle authorization errors in server actions\r\n *\r\n * @param error - Error thrown during authorization\r\n * @returns Response object with error details\r\n *\r\n * @example\r\n * try {\r\n *   await requirePermission(userId, 'project.delete')\r\n * } catch (error) {\r\n *   return handleAuthorizationError(error)\r\n * }\r\n */\r\nexport function handleAuthorizationError(\r\n  error: unknown\r\n): { error: string; code: string; status: number; success: false } {\r\n  if (error instanceof UnauthorizedError) {\r\n    return { error: error.message, code: error.code, status: 403, success: false }\r\n  }\r\n\r\n  if (error instanceof ForbiddenError) {\r\n    return { error: error.message, code: error.code, status: 403, success: false }\r\n  }\r\n\r\n  if (error instanceof NotFoundError) {\r\n    return { error: error.message, code: error.code, status: 404, success: false }\r\n  }\r\n\r\n  console.error(\"Unknown authorization error:\", error)\r\n  return {\r\n    error: \"Authorization failed\",\r\n    code: \"AUTHORIZATION_ERROR\",\r\n    status: 500,\r\n    success: false\r\n  }\r\n}\r\n","/**\r\n * RBAC Permission Checking Utilities\r\n */\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { PERMISSIONS } from \"./permissions\"\r\n\r\n/**\r\n * Cache for user permissions (in-memory, can be replaced with Redis in production)\r\n */\r\nconst permissionCache = new Map<string, { permissions: string[], expiresAt: number }>()\r\n\r\nconst CACHE_TTL = 5 * 60 * 1000 // 5 minutes\r\n\r\n/**\r\n * Get all permissions for a user (with caching)\r\n */\r\nexport async function getUserPermissions(\r\n  userId: number,\r\n  projectId?: number\r\n): Promise<string[]> {\r\n  const cacheKey = `${userId}:${projectId || \"global\"}`\r\n  const cached = permissionCache.get(cacheKey)\r\n  \r\n  if (cached && cached.expiresAt > Date.now()) {\r\n    return cached.permissions\r\n  }\r\n\r\n  // Get all user roles (global and project-scoped)\r\n  const userRoles = await prisma.userRole.findMany({\r\n    where: {\r\n      userId,\r\n      OR: [\r\n        { scopeType: null }, // Global roles\r\n        { scopeType: \"global\" },\r\n        ...(projectId ? [{ scopeType: \"project\", scopeId: projectId }] : []),\r\n      ],\r\n    },\r\n    include: {\r\n      role: {\r\n        include: {\r\n          permissions: {\r\n            include: {\r\n              permission: true,\r\n            },\r\n          },\r\n        },\r\n      },\r\n    },\r\n  })\r\n\r\n  // Collect all unique permissions\r\n  const permissionSet = new Set<string>()\r\n  \r\n  for (const userRole of userRoles) {\r\n    for (const rolePermission of userRole.role.permissions) {\r\n      permissionSet.add(rolePermission.permission.key)\r\n    }\r\n  }\r\n\r\n  const permissions = Array.from(permissionSet)\r\n\r\n  // Cache the result\r\n  permissionCache.set(cacheKey, {\r\n    permissions,\r\n    expiresAt: Date.now() + CACHE_TTL,\r\n  })\r\n\r\n  return permissions\r\n}\r\n\r\n/**\r\n * Check if user has a specific permission\r\n * ⚠️ DEPRECATED - This function has role-based bypasses\r\n * Use hasPermissionWithoutRoleBypass() from rbac-helpers.ts instead\r\n * \r\n * @deprecated - Use hasPermissionWithoutRoleBypass() for new code\r\n */\r\nexport async function hasPermission(\r\n  userId: number,\r\n  permission: string,\r\n  projectId?: number\r\n): Promise<boolean> {\r\n  // Legacy implementation with bypasses - kept for backward compatibility only\r\n  // DO NOT USE IN NEW CODE - this bypasses RBAC\r\n  const user = await prisma.user.findUnique({\r\n    where: { id: userId },\r\n    select: { role: true },\r\n  })\r\n\r\n  // ⚠️ LEGACY BYPASS - Should not exist in new code\r\n  if (user?.role === \"admin\" || user?.role === \"project_manager\") {\r\n    return true\r\n  }\r\n\r\n  // Check RBAC permissions\r\n  const permissions = await getUserPermissions(userId, projectId)\r\n  return permissions.includes(permission)\r\n}\r\n\r\n/**\r\n * ⛔ DEPRECATED - DO NOT USE\r\n * This function allows legacy role-based bypass of RBAC permissions\r\n * Use hasPermissionWithoutRoleBypass() from rbac-helpers.ts instead\r\n */\r\nexport async function hasPermissionOrRole(\r\n  userId: number,\r\n  permission: string,\r\n  allowedLegacyRoles: string[] = [\"admin\", \"project_manager\"],\r\n  projectId?: number\r\n): Promise<boolean> {\r\n  console.warn(\r\n    \"[RBAC] DEPRECATED: hasPermissionOrRole() called. Use hasPermissionWithoutRoleBypass() instead.\"\r\n  )\r\n  throw new Error(\r\n    \"hasPermissionOrRole is deprecated and must be replaced with hasPermissionWithoutRoleBypass(). \" +\r\n    \"This function bypasses RBAC security controls. See rbac-helpers.ts for proper authorization.\"\r\n  )\r\n}\r\n\r\n/**\r\n * Check if user has any of the specified permissions\r\n */\r\nexport async function hasAnyPermission(\r\n  userId: number,\r\n  permissions: string[],\r\n  projectId?: number\r\n): Promise<boolean> {\r\n  const userPermissions = await getUserPermissions(userId, projectId)\r\n  return permissions.some(perm => userPermissions.includes(perm))\r\n}\r\n\r\n/**\r\n * Check if user has all of the specified permissions\r\n */\r\nexport async function hasAllPermissions(\r\n  userId: number,\r\n  permissions: string[],\r\n  projectId?: number\r\n): Promise<boolean> {\r\n  const userPermissions = await getUserPermissions(userId, projectId)\r\n  return permissions.every(perm => userPermissions.includes(perm))\r\n}\r\n\r\n/**\r\n * Get user roles\r\n */\r\nexport async function getUserRoles(\r\n  userId: number,\r\n  projectId?: number\r\n): Promise<Array<{ role: any, scopeType: string | null, scopeId: number | null }>> {\r\n  const userRoles = await prisma.userRole.findMany({\r\n    where: {\r\n      userId,\r\n      OR: [\r\n        { scopeType: null },\r\n        { scopeType: \"global\" },\r\n        ...(projectId ? [{ scopeType: \"project\", scopeId: projectId }] : []),\r\n      ],\r\n    },\r\n    include: {\r\n      role: true,\r\n    },\r\n  })\r\n\r\n  return userRoles.map(ur => ({\r\n    role: ur.role,\r\n    scopeType: ur.scopeType,\r\n    scopeId: ur.scopeId,\r\n  }))\r\n}\r\n\r\n/**\r\n * Check if user has a specific role\r\n */\r\nexport async function hasRole(\r\n  userId: number,\r\n  roleName: string,\r\n  projectId?: number\r\n): Promise<boolean> {\r\n  const roles = await getUserRoles(userId, projectId)\r\n  return roles.some(r => r.role.name === roleName)\r\n}\r\n\r\n/**\r\n * Clear permission cache for a user\r\n */\r\nexport function clearPermissionCache(userId: number, projectId?: number) {\r\n  const cacheKey = `${userId}:${projectId || \"global\"}`\r\n  permissionCache.delete(cacheKey)\r\n}\r\n\r\n/**\r\n * Clear all permission caches\r\n */\r\nexport function clearAllPermissionCaches() {\r\n  permissionCache.clear()\r\n}\r\n\r\n/**\r\n * Require permission - throws error if user doesn't have permission\r\n */\r\nexport async function requirePermission(\r\n  userId: number,\r\n  permission: string,\r\n  projectId?: number\r\n): Promise<void> {\r\n  const has = await hasPermission(userId, permission, projectId)\r\n  if (!has) {\r\n    throw new Error(`Permission denied: ${permission}`)\r\n  }\r\n}\r\n\r\n/**\r\n * Require any permission - throws error if user doesn't have any of the permissions\r\n */\r\nexport async function requireAnyPermission(\r\n  userId: number,\r\n  permissions: string[],\r\n  projectId?: number\r\n): Promise<void> {\r\n  const has = await hasAnyPermission(userId, permissions, projectId)\r\n  if (!has) {\r\n    throw new Error(`Permission denied: requires one of [${permissions.join(\", \")}]`)\r\n  }\r\n}\r\n\r\n","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { headers } from \"next/headers\"\r\n\r\nexport type ActionCategory =\r\n  | \"auth\"\r\n  | \"project\"\r\n  | \"task\"\r\n  | \"dependency\"\r\n  | \"settings\"\r\n  | \"notification\"\r\n  | \"today_task\"\r\n\r\nexport type ActionType =\r\n  // Auth\r\n  | \"user_login\"\r\n  | \"user_logout\"\r\n  | \"login_failed\"\r\n  | \"role_changed\"\r\n  | \"user_activated\"\r\n  | \"user_suspended\"\r\n  // RBAC\r\n  | \"role_created\"\r\n  | \"role_updated\"\r\n  | \"role_deleted\"\r\n  | \"role_assigned\"\r\n  | \"role_removed\"\r\n  // Project\r\n  | \"project_created\"\r\n  | \"project_updated\"\r\n  | \"project_archived\"\r\n  | \"project_manager_changed\"\r\n  | \"team_member_added\"\r\n  | \"team_member_removed\"\r\n  | \"project_settings_changed\"\r\n  | \"project_marked_urgent\"\r\n  | \"project_urgent_acknowledged\"\r\n  | \"project_urgent_removed\"\r\n  | \"project_assigned_to_team\"\r\n  | \"project_removed_from_team\"\r\n  | \"file_uploaded\"\r\n  | \"file_downloaded\"\r\n  | \"file_deleted\"\r\n  // Team\r\n  | \"team_created\"\r\n  | \"team_updated\"\r\n  | \"team_deleted\"\r\n  // Task\r\n  | \"task_created\"\r\n  | \"task_updated\"\r\n  | \"task_deleted\"\r\n  | \"task_assigned\"\r\n  | \"task_reassigned\"\r\n  | \"task_status_changed\"\r\n  | \"task_status_updated\"\r\n  | \"task_priority_changed\"\r\n  | \"subtask_created\"\r\n  | \"subtask_updated\"\r\n  | \"subtask_completed\"\r\n  // Dependency\r\n  | \"dependency_added\"\r\n  | \"dependency_removed\"\r\n  | \"task_blocked\"\r\n  | \"task_unblocked\"\r\n  // Today's Tasks\r\n  | \"today_task_assigned\"\r\n  | \"today_task_modified\"\r\n  | \"today_task_removed\"\r\n  | \"auto_carryover_executed\"\r\n  // Settings\r\n  | \"global_settings_updated\"\r\n  | \"project_settings_updated\"\r\n  | \"user_settings_updated\"\r\n  | \"project_type_created\"\r\n  | \"project_type_updated\"\r\n  | \"project_type_deleted\"\r\n  | \"project_type_toggled\"\r\n  | \"project_status_created\"\r\n  | \"project_status_updated\"\r\n  | \"project_status_deleted\"\r\n  | \"project_status_toggled\"\r\n  | \"project_statuses_reordered\"\r\n  | \"task_status_created\"\r\n  | \"task_status_updated\"\r\n  | \"task_status_deleted\"\r\n  | \"task_status_toggled\"\r\n  | \"task_statuses_reordered\"\r\n  // Notifications\r\n  | \"notification_settings_changed\"\r\n  | \"admin_override_executed\"\r\n  | \"manual_unblock\"\r\n\r\ninterface LogActivityParams {\r\n  actionType: ActionType\r\n  actionCategory: ActionCategory\r\n  actionSummary: string\r\n  actionDetails?: Record<string, any>\r\n  performedById: number\r\n  affectedUserId?: number\r\n  projectId?: number\r\n  entityType?: string\r\n  entityId?: number\r\n  ipAddress?: string\r\n  userAgent?: string\r\n}\r\n\r\n/**\r\n * Log an activity to the activity log\r\n * This function should be called after any important action\r\n */\r\nexport async function logActivity(params: LogActivityParams): Promise<void> {\r\n  console.log(\"[ActivityLogger] ====== START LOGGING ======\")\r\n  console.log(\"[ActivityLogger] Received params:\", JSON.stringify(params, null, 2))\r\n\r\n  try {\r\n    // Sanitize actionDetails to remove sensitive information\r\n    const sanitizedDetails = sanitizeActionDetails(params.actionDetails || {})\r\n\r\n    console.log(\"[ActivityLogger] Sanitized details:\", JSON.stringify(sanitizedDetails, null, 2))\r\n    console.log(\"[ActivityLogger] Logging activity:\", {\r\n      actionType: params.actionType,\r\n      actionCategory: params.actionCategory,\r\n      actionSummary: params.actionSummary,\r\n      performedById: params.performedById,\r\n    })\r\n\r\n    // Try to create with new schema first\r\n    try {\r\n      const result = await prisma.activityLog.create({\r\n        data: {\r\n          actionType: params.actionType,\r\n          actionCategory: params.actionCategory,\r\n          actionSummary: params.actionSummary,\r\n          actionDetails: Object.keys(sanitizedDetails).length > 0\r\n            ? JSON.stringify(sanitizedDetails)\r\n            : null,\r\n          performedById: params.performedById,\r\n          affectedUserId: params.affectedUserId || null,\r\n          projectId: params.projectId || null,\r\n          entityType: params.entityType || null,\r\n          entityId: params.entityId || null,\r\n          ipAddress: params.ipAddress || await getClientIP(),\r\n          userAgent: params.userAgent || await getUserAgent(),\r\n          // Legacy fields (required by database)\r\n          action: params.actionType, // Map actionType to legacy action field\r\n          description: params.actionSummary, // Map actionSummary to legacy description field\r\n          userId: params.performedById, // Map performedById to legacy userId field\r\n        },\r\n      })\r\n      console.log(\"[ActivityLogger] ✅ Successfully logged activity with ID:\", result.id)\r\n      console.log(\"[ActivityLogger] ====== END LOGGING (SUCCESS) ======\")\r\n      return\r\n    } catch (schemaError: any) {\r\n      console.error(\"[ActivityLogger] ❌ Schema error occurred:\")\r\n      console.error(\"[ActivityLogger] Error message:\", schemaError.message)\r\n      console.error(\"[ActivityLogger] Error code:\", schemaError.code)\r\n      console.error(\"[ActivityLogger] Error meta:\", JSON.stringify(schemaError.meta, null, 2))\r\n      // If new columns don't exist, fall back to old schema\r\n      if (schemaError.message?.includes('no such column') || schemaError.code === 'P2003' || schemaError.code === 'P2011') {\r\n        console.warn(\"[ActivityLogger] New columns not found, using legacy schema. Please run migration.\")\r\n        await prisma.$executeRawUnsafe(`\r\n          INSERT INTO activity_logs (action, description, entity_type, entity_id, ip_address, user_id, created_at)\r\n          VALUES (?, ?, ?, ?, ?, ?, datetime('now'))\r\n        `,\r\n          params.actionType,\r\n          params.actionSummary,\r\n          params.entityType || null,\r\n          params.entityId || null,\r\n          params.ipAddress || await getClientIP() || null,\r\n          params.performedById\r\n        )\r\n        console.log(\"[ActivityLogger] ✅ Logged using legacy schema\")\r\n        console.log(\"[ActivityLogger] ====== END LOGGING (LEGACY) ======\")\r\n        return\r\n      } else {\r\n        console.error(\"[ActivityLogger] ❌ Unknown schema error, rethrowing\")\r\n        throw schemaError\r\n      }\r\n    }\r\n  } catch (error: any) {\r\n    // Log errors but don't throw - activity logging should never break the main flow\r\n    console.error(\"[ActivityLogger] ❌❌❌ CRITICAL ERROR - Failed to log activity ❌❌❌\")\r\n    console.error(\"[ActivityLogger] Error message:\", error?.message || error)\r\n    console.error(\"[ActivityLogger] Error code:\", error?.code)\r\n    console.error(\"[ActivityLogger] Error meta:\", JSON.stringify(error?.meta, null, 2))\r\n    console.error(\"[ActivityLogger] Error stack:\", error?.stack)\r\n    console.error(\"[ActivityLogger] ====== END LOGGING (ERROR) ======\")\r\n  }\r\n}\r\n\r\n/**\r\n * Sanitize action details to remove sensitive information\r\n */\r\nfunction sanitizeActionDetails(details: Record<string, any>): Record<string, any> {\r\n  const sensitiveKeys = [\r\n    'password',\r\n    'passwordHash',\r\n    'password_hash',\r\n    'token',\r\n    'secret',\r\n    'apiKey',\r\n    'api_key',\r\n    'accessToken',\r\n    'refreshToken',\r\n  ]\r\n\r\n  const sanitized = { ...details }\r\n\r\n  for (const key of sensitiveKeys) {\r\n    if (key in sanitized) {\r\n      sanitized[key] = '[REDACTED]'\r\n    }\r\n  }\r\n\r\n  // Recursively sanitize nested objects\r\n  for (const key in sanitized) {\r\n    if (typeof sanitized[key] === 'object' && sanitized[key] !== null && !Array.isArray(sanitized[key])) {\r\n      sanitized[key] = sanitizeActionDetails(sanitized[key])\r\n    }\r\n  }\r\n\r\n  return sanitized\r\n}\r\n\r\n/**\r\n * Get client IP address from headers\r\n */\r\nasync function getClientIP(): Promise<string | null> {\r\n  try {\r\n    const headersList = await headers()\r\n    const forwarded = headersList.get('x-forwarded-for')\r\n    const realIP = headersList.get('x-real-ip')\r\n\r\n    if (forwarded) {\r\n      return forwarded.split(',')[0].trim()\r\n    }\r\n    if (realIP) {\r\n      return realIP\r\n    }\r\n    return null\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Get user agent from headers\r\n */\r\nasync function getUserAgent(): Promise<string | null> {\r\n  try {\r\n    const headersList = await headers()\r\n    return headersList.get('user-agent') || null\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\n","/**\n * @module constants\n * @summary Useful constants\n * @description\n * Collection of useful date constants.\n *\n * The constants could be imported from `date-fns/constants`:\n *\n * ```ts\n * import { maxTime, minTime } from \"./constants/date-fns/constants\";\n *\n * function isAllowedTime(time) {\n *   return time <= maxTime && time >= minTime;\n * }\n * ```\n */\n\n/**\n * @constant\n * @name daysInWeek\n * @summary Days in 1 week.\n */\nexport const daysInWeek = 7;\n\n/**\n * @constant\n * @name daysInYear\n * @summary Days in 1 year.\n *\n * @description\n * How many days in a year.\n *\n * One years equals 365.2425 days according to the formula:\n *\n * > Leap year occurs every 4 years, except for years that are divisible by 100 and not divisible by 400.\n * > 1 mean year = (365+1/4-1/100+1/400) days = 365.2425 days\n */\nexport const daysInYear = 365.2425;\n\n/**\n * @constant\n * @name maxTime\n * @summary Maximum allowed time.\n *\n * @example\n * import { maxTime } from \"./constants/date-fns/constants\";\n *\n * const isValid = 8640000000000001 <= maxTime;\n * //=> false\n *\n * new Date(8640000000000001);\n * //=> Invalid Date\n */\nexport const maxTime = Math.pow(10, 8) * 24 * 60 * 60 * 1000;\n\n/**\n * @constant\n * @name minTime\n * @summary Minimum allowed time.\n *\n * @example\n * import { minTime } from \"./constants/date-fns/constants\";\n *\n * const isValid = -8640000000000001 >= minTime;\n * //=> false\n *\n * new Date(-8640000000000001)\n * //=> Invalid Date\n */\nexport const minTime = -maxTime;\n\n/**\n * @constant\n * @name millisecondsInWeek\n * @summary Milliseconds in 1 week.\n */\nexport const millisecondsInWeek = 604800000;\n\n/**\n * @constant\n * @name millisecondsInDay\n * @summary Milliseconds in 1 day.\n */\nexport const millisecondsInDay = 86400000;\n\n/**\n * @constant\n * @name millisecondsInMinute\n * @summary Milliseconds in 1 minute\n */\nexport const millisecondsInMinute = 60000;\n\n/**\n * @constant\n * @name millisecondsInHour\n * @summary Milliseconds in 1 hour\n */\nexport const millisecondsInHour = 3600000;\n\n/**\n * @constant\n * @name millisecondsInSecond\n * @summary Milliseconds in 1 second\n */\nexport const millisecondsInSecond = 1000;\n\n/**\n * @constant\n * @name minutesInYear\n * @summary Minutes in 1 year.\n */\nexport const minutesInYear = 525600;\n\n/**\n * @constant\n * @name minutesInMonth\n * @summary Minutes in 1 month.\n */\nexport const minutesInMonth = 43200;\n\n/**\n * @constant\n * @name minutesInDay\n * @summary Minutes in 1 day.\n */\nexport const minutesInDay = 1440;\n\n/**\n * @constant\n * @name minutesInHour\n * @summary Minutes in 1 hour.\n */\nexport const minutesInHour = 60;\n\n/**\n * @constant\n * @name monthsInQuarter\n * @summary Months in 1 quarter.\n */\nexport const monthsInQuarter = 3;\n\n/**\n * @constant\n * @name monthsInYear\n * @summary Months in 1 year.\n */\nexport const monthsInYear = 12;\n\n/**\n * @constant\n * @name quartersInYear\n * @summary Quarters in 1 year\n */\nexport const quartersInYear = 4;\n\n/**\n * @constant\n * @name secondsInHour\n * @summary Seconds in 1 hour.\n */\nexport const secondsInHour = 3600;\n\n/**\n * @constant\n * @name secondsInMinute\n * @summary Seconds in 1 minute.\n */\nexport const secondsInMinute = 60;\n\n/**\n * @constant\n * @name secondsInDay\n * @summary Seconds in 1 day.\n */\nexport const secondsInDay = secondsInHour * 24;\n\n/**\n * @constant\n * @name secondsInWeek\n * @summary Seconds in 1 week.\n */\nexport const secondsInWeek = secondsInDay * 7;\n\n/**\n * @constant\n * @name secondsInYear\n * @summary Seconds in 1 year.\n */\nexport const secondsInYear = secondsInDay * daysInYear;\n\n/**\n * @constant\n * @name secondsInMonth\n * @summary Seconds in 1 month\n */\nexport const secondsInMonth = secondsInYear / 12;\n\n/**\n * @constant\n * @name secondsInQuarter\n * @summary Seconds in 1 quarter.\n */\nexport const secondsInQuarter = secondsInMonth * 3;\n\n/**\n * @constant\n * @name constructFromSymbol\n * @summary Symbol enabling Date extensions to inherit properties from the reference date.\n *\n * The symbol is used to enable the `constructFrom` function to construct a date\n * using a reference date and a value. It allows to transfer extra properties\n * from the reference date to the new date. It's useful for extensions like\n * [`TZDate`](https://github.com/date-fns/tz) that accept a time zone as\n * a constructor argument.\n */\nexport const constructFromSymbol = Symbol.for(\"constructDateFrom\");\n","import { constructFromSymbol } from \"./constants.js\";\n\n/**\n * @name constructFrom\n * @category Generic Helpers\n * @summary Constructs a date using the reference date and the value\n *\n * @description\n * The function constructs a new date using the constructor from the reference\n * date and the given value. It helps to build generic functions that accept\n * date extensions.\n *\n * It defaults to `Date` if the passed reference date is a number or a string.\n *\n * Starting from v3.7.0, it allows to construct a date using `[Symbol.for(\"constructDateFrom\")]`\n * enabling to transfer extra properties from the reference date to the new date.\n * It's useful for extensions like [`TZDate`](https://github.com/date-fns/tz)\n * that accept a time zone as a constructor argument.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n *\n * @param date - The reference date to take constructor from\n * @param value - The value to create the date\n *\n * @returns Date initialized using the given date and value\n *\n * @example\n * import { constructFrom } from \"./constructFrom/date-fns\";\n *\n * // A function that clones a date preserving the original type\n * function cloneDate<DateType extends Date>(date: DateType): DateType {\n *   return constructFrom(\n *     date, // Use constructor from the given date\n *     date.getTime() // Use the date value to create a new date\n *   );\n * }\n */\nexport function constructFrom(date, value) {\n  if (typeof date === \"function\") return date(value);\n\n  if (date && typeof date === \"object\" && constructFromSymbol in date)\n    return date[constructFromSymbol](value);\n\n  if (date instanceof Date) return new date.constructor(value);\n\n  return new Date(value);\n}\n\n// Fallback for modularized imports:\nexport default constructFrom;\n","import { constructFrom } from \"./constructFrom.js\";\n\n/**\n * @name toDate\n * @category Common Helpers\n * @summary Convert the given argument to an instance of Date.\n *\n * @description\n * Convert the given argument to an instance of Date.\n *\n * If the argument is an instance of Date, the function returns its clone.\n *\n * If the argument is a number, it is treated as a timestamp.\n *\n * If the argument is none of the above, the function returns Invalid Date.\n *\n * Starting from v3.7.0, it clones a date using `[Symbol.for(\"constructDateFrom\")]`\n * enabling to transfer extra properties from the reference date to the new date.\n * It's useful for extensions like [`TZDate`](https://github.com/date-fns/tz)\n * that accept a time zone as a constructor argument.\n *\n * **Note**: *all* Date arguments passed to any *date-fns* function is processed by `toDate`.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param argument - The value to convert\n *\n * @returns The parsed date in the local time zone\n *\n * @example\n * // Clone the date:\n * const result = toDate(new Date(2014, 1, 11, 11, 30, 30))\n * //=> Tue Feb 11 2014 11:30:30\n *\n * @example\n * // Convert the timestamp to date:\n * const result = toDate(1392098430000)\n * //=> Tue Feb 11 2014 11:30:30\n */\nexport function toDate(argument, context) {\n  // [TODO] Get rid of `toDate` or `constructFrom`?\n  return constructFrom(context || argument, argument);\n}\n\n// Fallback for modularized imports:\nexport default toDate;\n","import { toDate } from \"./toDate.js\";\n\n/**\n * The {@link startOfDay} function options.\n */\n\n/**\n * @name startOfDay\n * @category Day Helpers\n * @summary Return the start of a day for the given date.\n *\n * @description\n * Return the start of a day for the given date.\n * The result will be in the local timezone.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The original date\n * @param options - The options\n *\n * @returns The start of a day\n *\n * @example\n * // The start of a day for 2 September 2014 11:55:00:\n * const result = startOfDay(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Tue Sep 02 2014 00:00:00\n */\nexport function startOfDay(date, options) {\n  const _date = toDate(date, options?.in);\n  _date.setHours(0, 0, 0, 0);\n  return _date;\n}\n\n// Fallback for modularized imports:\nexport default startOfDay;\n","import { toDate } from \"./toDate.js\";\n\n/**\n * The {@link endOfDay} function options.\n */\n\n/**\n * @name endOfDay\n * @category Day Helpers\n * @summary Return the end of a day for the given date.\n *\n * @description\n * Return the end of a day for the given date.\n * The result will be in the local timezone.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The original date\n * @param options - An object with options\n *\n * @returns The end of a day\n *\n * @example\n * // The end of a day for 2 September 2014 11:55:00:\n * const result = endOfDay(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Tue Sep 02 2014 23:59:59.999\n */\nexport function endOfDay(date, options) {\n  const _date = toDate(date, options?.in);\n  _date.setHours(23, 59, 59, 999);\n  return _date;\n}\n\n// Fallback for modularized imports:\nexport default endOfDay;\n","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { getServerSession } from \"next-auth\"\r\nimport { authOptions } from \"@/lib/auth\"\r\nimport { z } from \"zod\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { logActivity } from \"@/lib/activity-logger\"\r\nimport {\r\n    requirePermission,\r\n    handleAuthorizationError,\r\n    ForbiddenError,\r\n} from \"@/lib/rbac-helpers\"\r\n\r\nconst teamSchema = z.object({\r\n    name: z.string().min(1, \"Name is required\"),\r\n    description: z.string().optional(),\r\n    teamLeadId: z.coerce.number().optional(),\r\n    status: z.enum([\"active\", \"inactive\"]).default(\"active\"),\r\n    memberIds: z.array(z.number()).optional(),\r\n})\r\n\r\nexport async function getTeams() {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) throw new Error(\"Unauthorized\")\r\n\r\n    const teams = await prisma.team.findMany({\r\n        include: {\r\n            _count: {\r\n                select: { \r\n                    users: true, \r\n                    tasks: true,\r\n                    members: true,\r\n                    projectTeams: true \r\n                }\r\n            },\r\n            teamLead: {\r\n                select: { id: true, username: true, email: true, avatarUrl: true }\r\n            },\r\n            users: {\r\n                take: 5,\r\n                select: { username: true, email: true, avatarUrl: true }\r\n            },\r\n            members: {\r\n                take: 5,\r\n                include: {\r\n                    user: {\r\n                        select: { id: true, username: true, email: true, avatarUrl: true }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        orderBy: { createdAt: \"desc\" }\r\n    })\r\n\r\n    return teams\r\n}\r\n\r\nexport async function getTeam(id: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) throw new Error(\"Unauthorized\")\r\n\r\n    const team = await prisma.team.findUnique({\r\n        where: { id },\r\n        include: {\r\n            teamLead: {\r\n                select: { id: true, username: true, email: true, avatarUrl: true, role: true }\r\n            },\r\n            members: {\r\n                include: {\r\n                    user: {\r\n                        select: { id: true, username: true, email: true, avatarUrl: true, role: true }\r\n                    }\r\n                },\r\n                orderBy: { joinedAt: \"desc\" }\r\n            },\r\n            projectTeams: {\r\n                include: {\r\n                    project: {\r\n                        select: {\r\n                            id: true,\r\n                            name: true,\r\n                            status: true,\r\n                            startDate: true,\r\n                            endDate: true,\r\n                            projectManager: {\r\n                                select: { id: true, username: true, email: true }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                orderBy: { assignedAt: \"desc\" }\r\n            },\r\n            _count: {\r\n                select: { tasks: true, members: true, projectTeams: true }\r\n            }\r\n        }\r\n    })\r\n\r\n    return team\r\n}\r\n\r\nexport async function getTeamProjects(teamId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) throw new Error(\"Unauthorized\")\r\n\r\n    const projectTeams = await prisma.projectTeam.findMany({\r\n        where: { teamId },\r\n        include: {\r\n            project: {\r\n                select: {\r\n                    id: true,\r\n                    name: true,\r\n                    status: true,\r\n                    startDate: true,\r\n                    endDate: true,\r\n                    projectManager: {\r\n                        select: { id: true, username: true, email: true }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        orderBy: { assignedAt: \"desc\" }\r\n    })\r\n\r\n    return projectTeams.map(pt => pt.project)\r\n}\r\n\r\nexport async function createTeam(formData: FormData) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.create\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    const name = formData.get(\"name\") as string\r\n    const description = formData.get(\"description\") as string\r\n    const teamLeadId = formData.get(\"teamLeadId\")\r\n    const status = formData.get(\"status\") as string || \"active\"\r\n    const memberIdsStr = formData.get(\"memberIds\") as string\r\n\r\n    let memberIds: number[] = []\r\n    if (memberIdsStr) {\r\n        try {\r\n            memberIds = JSON.parse(memberIdsStr)\r\n        } catch {\r\n            // Ignore parse errors\r\n        }\r\n    }\r\n\r\n    const validated = teamSchema.safeParse({ \r\n        name, \r\n        description, \r\n        teamLeadId: teamLeadId ? parseInt(teamLeadId as string) : undefined,\r\n        status: status as \"active\" | \"inactive\",\r\n        memberIds\r\n    })\r\n\r\n    if (!validated.success) {\r\n        return { error: \"Validation failed\" }\r\n    }\r\n\r\n    try {\r\n        const team = await prisma.team.create({\r\n            data: {\r\n                name: validated.data.name,\r\n                description: validated.data.description,\r\n                teamLeadId: validated.data.teamLeadId || null,\r\n                status: validated.data.status,\r\n                members: validated.data.memberIds && validated.data.memberIds.length > 0 ? {\r\n                    create: validated.data.memberIds.map(userId => ({\r\n                        userId,\r\n                        role: userId === validated.data.teamLeadId ? \"lead\" : \"member\"\r\n                    }))\r\n                } : undefined\r\n            },\r\n            include: {\r\n                teamLead: true,\r\n                members: {\r\n                    include: { user: true }\r\n                }\r\n            }\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"team_created\",\r\n            actionCategory: \"project\",\r\n            actionSummary: `Team \"${team.name}\" created`,\r\n            actionDetails: {\r\n                teamId: team.id,\r\n                teamName: team.name,\r\n                status: team.status,\r\n                teamLeadId: team.teamLeadId,\r\n                memberCount: team.members.length,\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            entityType: \"team\",\r\n            entityId: team.id,\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/teams\")\r\n        return { success: true, team }\r\n    } catch (e) {\r\n        console.error(e)\r\n        return { error: \"Failed to create team\" }\r\n    }\r\n}\r\n\r\nexport async function updateTeam(id: number, formData: FormData) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.update\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    const name = formData.get(\"name\") as string\r\n    const description = formData.get(\"description\") as string\r\n    const teamLeadId = formData.get(\"teamLeadId\")\r\n    const status = formData.get(\"status\") as string\r\n\r\n    const validated = teamSchema.partial().safeParse({ \r\n        name, \r\n        description, \r\n        teamLeadId: teamLeadId ? parseInt(teamLeadId as string) : undefined,\r\n        status: status as \"active\" | \"inactive\" | undefined\r\n    })\r\n\r\n    if (!validated.success) {\r\n        return { error: \"Validation failed\" }\r\n    }\r\n\r\n    try {\r\n        const team = await prisma.team.update({\r\n            where: { id },\r\n            data: {\r\n                name: validated.data.name,\r\n                description: validated.data.description,\r\n                teamLeadId: validated.data.teamLeadId !== undefined ? validated.data.teamLeadId : undefined,\r\n                status: validated.data.status,\r\n            }\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"team_updated\",\r\n            actionCategory: \"project\",\r\n            actionSummary: `Team \"${team.name}\" updated`,\r\n            actionDetails: {\r\n                teamId: team.id,\r\n                teamName: team.name,\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            entityType: \"team\",\r\n            entityId: team.id,\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/teams\")\r\n        revalidatePath(`/dashboard/teams/${id}`)\r\n        return { success: true }\r\n    } catch (e) {\r\n        console.error(e)\r\n        return { error: \"Failed to update team\" }\r\n    }\r\n}\r\n\r\nexport async function deleteTeam(id: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.delete\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    try {\r\n        const team = await prisma.team.findUnique({\r\n            where: { id },\r\n            select: { name: true }\r\n        })\r\n\r\n        await prisma.team.delete({\r\n            where: { id }\r\n        })\r\n\r\n        // Log activity\r\n        if (team) {\r\n            await logActivity({\r\n                actionType: \"team_deleted\",\r\n                actionCategory: \"project\",\r\n                actionSummary: `Team \"${team.name}\" deleted`,\r\n                actionDetails: {\r\n                    teamId: id,\r\n                    teamName: team.name,\r\n                },\r\n                performedById: parseInt(session.user.id),\r\n                entityType: \"team\",\r\n                entityId: id,\r\n            })\r\n        }\r\n\r\n        revalidatePath(\"/dashboard/teams\")\r\n        return { success: true }\r\n    } catch (e) {\r\n        return { error: \"Failed to delete team\" }\r\n    }\r\n}\r\n\r\nexport async function addProjectToTeam(teamId: number, projectId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.addProject\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    try {\r\n        // Check if team is active\r\n        const team = await prisma.team.findUnique({\r\n            where: { id: teamId },\r\n            select: { status: true, name: true }\r\n        })\r\n\r\n        if (!team) {\r\n            return { error: \"Team not found\" }\r\n        }\r\n\r\n        if (team.status !== \"active\") {\r\n            return { error: \"Cannot assign projects to inactive teams\" }\r\n        }\r\n\r\n        await prisma.projectTeam.create({\r\n            data: {\r\n                teamId,\r\n                projectId\r\n            }\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_assigned_to_team\",\r\n            actionCategory: \"project\",\r\n            actionSummary: `Project assigned to team \"${team.name}\"`,\r\n            actionDetails: {\r\n                teamId,\r\n                projectId,\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            projectId,\r\n            entityType: \"team\",\r\n            entityId: teamId,\r\n        })\r\n\r\n        revalidatePath(`/dashboard/teams/${teamId}`)\r\n        return { success: true }\r\n    } catch (e: any) {\r\n        if (e.code === \"P2002\") {\r\n            return { error: \"Project is already assigned to this team\" }\r\n        }\r\n        console.error(e)\r\n        return { error: \"Failed to assign project to team\" }\r\n    }\r\n}\r\n\r\nexport async function removeProjectFromTeam(teamId: number, projectId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.removeProject\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    try {\r\n        const team = await prisma.team.findUnique({\r\n            where: { id: teamId },\r\n            select: { name: true }\r\n        })\r\n\r\n        await prisma.projectTeam.delete({\r\n            where: {\r\n                projectId_teamId: {\r\n                    projectId,\r\n                    teamId\r\n                }\r\n            }\r\n        })\r\n\r\n        // Log activity\r\n        if (team) {\r\n            await logActivity({\r\n                actionType: \"project_removed_from_team\",\r\n                actionCategory: \"project\",\r\n                actionSummary: `Project removed from team \"${team.name}\"`,\r\n                actionDetails: {\r\n                    teamId,\r\n                    projectId,\r\n                },\r\n                performedById: parseInt(session.user.id),\r\n                projectId,\r\n                entityType: \"team\",\r\n                entityId: teamId,\r\n            })\r\n        }\r\n\r\n        revalidatePath(`/dashboard/teams/${teamId}`)\r\n        return { success: true }\r\n    } catch (e) {\r\n        console.error(e)\r\n        return { error: \"Failed to remove project from team\" }\r\n    }\r\n}\r\n\r\nexport async function addMemberToTeam(teamId: number, userId: number, role: string = \"member\") {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.addMember\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    try {\r\n        await prisma.teamMember.create({\r\n            data: {\r\n                teamId,\r\n                userId,\r\n                role\r\n            }\r\n        })\r\n\r\n        revalidatePath(`/dashboard/teams/${teamId}`)\r\n        return { success: true }\r\n    } catch (e: any) {\r\n        if (e.code === \"P2002\") {\r\n            return { error: \"User is already a member of this team\" }\r\n        }\r\n        console.error(e)\r\n        return { error: \"Failed to add member to team\" }\r\n    }\r\n}\r\n\r\nexport async function removeMemberFromTeam(teamId: number, userId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.removeMember\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    try {\r\n        await prisma.teamMember.delete({\r\n            where: {\r\n                teamId_userId: {\r\n                    teamId,\r\n                    userId\r\n                }\r\n            }\r\n        })\r\n\r\n        revalidatePath(`/dashboard/teams/${teamId}`)\r\n        return { success: true }\r\n    } catch (e) {\r\n        console.error(e)\r\n        return { error: \"Failed to remove member from team\" }\r\n    }\r\n}\r\n\r\nexport async function getAvailableProjects(teamId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) throw new Error(\"Unauthorized\")\r\n\r\n    // ✅ OPTIMIZED: Single query instead of N+1 pattern\r\n    // Get all projects NOT assigned to this team using relation filter\r\n    const projects = await prisma.project.findMany({\r\n        where: {\r\n            projectTeams: {\r\n                none: { teamId } // No team assignment with this teamId\r\n            }\r\n        },\r\n        select: {\r\n            id: true,\r\n            name: true,\r\n            status: true,\r\n            projectManager: {\r\n                select: { id: true, username: true, email: true }\r\n            }\r\n        },\r\n        orderBy: { name: \"asc\" }\r\n    })\r\n\r\n    return projects\r\n}\r\n","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { getServerSession } from \"next-auth\"\r\nimport { authOptions } from \"@/lib/auth\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { startOfDay, endOfDay } from \"date-fns\"\r\nimport { createProjectNotification } from \"./project-notifications\"\r\nimport { hasPermissionWithoutRoleBypass } from \"@/lib/rbac-helpers\"\r\n\r\n// Check if user has assignment privileges\r\nasync function checkAdminOrManager() {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { authorized: false, session: null }\r\n    \r\n    const hasPermission = await hasPermissionWithoutRoleBypass(\r\n        parseInt(session.user.id),\r\n        \"task.assign\"\r\n    )\r\n    return { authorized: hasPermission, session }\r\n}\r\n\r\n// Get all users with their project counts for the assignment panel\r\nexport async function getUsersForAssignment() {\r\n    const { authorized, session } = await checkAdminOrManager()\r\n    if (!authorized || !session) {\r\n        return { error: \"Unauthorized: Only admins and project managers can access this panel\" }\r\n    }\r\n\r\n    try {\r\n        const users = await prisma.user.findMany({\r\n            where: { isActive: true },\r\n            include: {\r\n                team: {\r\n                    select: { id: true, name: true }\r\n                },\r\n                assignedTasks: {\r\n                    select: { projectId: true },\r\n                    distinct: [\"projectId\"]\r\n                }\r\n            },\r\n            orderBy: { username: \"asc\" }\r\n        })\r\n\r\n        const usersWithProjectCount = users.map(user => ({\r\n            id: user.id,\r\n            username: user.username,\r\n            email: user.email,\r\n            role: user.role,\r\n            avatarUrl: user.avatarUrl,\r\n            team: user.team,\r\n            activeProjectsCount: user.assignedTasks.length\r\n        }))\r\n\r\n        return { success: true, users: usersWithProjectCount }\r\n    } catch (e: any) {\r\n        console.error(\"getUsersForAssignment Error:\", e)\r\n        return { error: \"Failed to fetch users\", details: e.message }\r\n    }\r\n}\r\n\r\n// Get all tasks for a user in a specific project (available for assignment)\r\nexport async function getUserProjectTasks(userId: number, projectId: number, date?: Date) {\r\n    const { authorized, session } = await checkAdminOrManager()\r\n    if (!authorized || !session) {\r\n        return { error: \"Unauthorized\" }\r\n    }\r\n\r\n    try {\r\n        const targetDate = date || new Date()\r\n        const dateStart = startOfDay(targetDate)\r\n        const dateEnd = endOfDay(targetDate)\r\n\r\n        // Get all tasks assigned to user in this project\r\n        const tasks = await prisma.task.findMany({\r\n            where: {\r\n                projectId,\r\n                assignees: { some: { id: userId } },\r\n                status: { not: \"completed\" }\r\n            },\r\n            include: {\r\n                project: { select: { id: true, name: true } },\r\n                dependencies: {\r\n                    include: {\r\n                        dependsOnTask: {\r\n                            select: {\r\n                                id: true,\r\n                                title: true,\r\n                                status: true\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                assignees: {\r\n                    select: { id: true, username: true }\r\n                }\r\n            },\r\n            orderBy: { updatedAt: \"desc\" }\r\n        })\r\n\r\n        // Separate tasks into available and today's tasks\r\n        const availableTasks = tasks.filter(task => {\r\n            if (!task.plannedDate) return true // Tasks without plannedDate are available\r\n            const taskDate = new Date(task.plannedDate)\r\n            const isTodayTask = taskDate >= dateStart && taskDate <= dateEnd\r\n            return !isTodayTask\r\n        })\r\n\r\n        const todayTasks = tasks.filter(task => {\r\n            if (!task.plannedDate) return false // Tasks without plannedDate are not today's tasks\r\n            const taskDate = new Date(task.plannedDate)\r\n            const isTodayTask = taskDate >= dateStart && taskDate <= dateEnd\r\n            return isTodayTask\r\n        })\r\n\r\n        // Check dependencies for each task\r\n        const tasksWithDependencyStatus = tasks.map(task => {\r\n            const incompleteDependencies = task.dependencies.filter(\r\n                dep => dep.dependsOnTask.status !== \"completed\"\r\n            )\r\n            return {\r\n                ...task,\r\n                isBlocked: incompleteDependencies.length > 0,\r\n                blockingDependencies: incompleteDependencies.map(dep => ({\r\n                    id: dep.dependsOnTask.id,\r\n                    title: dep.dependsOnTask.title,\r\n                    status: dep.dependsOnTask.status\r\n                }))\r\n            }\r\n        })\r\n\r\n        return {\r\n            success: true,\r\n            availableTasks: tasksWithDependencyStatus.filter(t => \r\n                availableTasks.some(at => at.id === t.id)\r\n            ),\r\n            todayTasks: tasksWithDependencyStatus.filter(t => \r\n                todayTasks.some(tt => tt.id === t.id)\r\n            )\r\n        }\r\n    } catch (e: any) {\r\n        console.error(\"getUserProjectTasks Error:\", e)\r\n        return { error: \"Failed to fetch tasks\", details: e.message }\r\n    }\r\n}\r\n\r\n// Assign a task to today's focus for a user\r\nexport async function assignTodayTask(userId: number, taskId: number, date?: Date) {\r\n    const { authorized, session } = await checkAdminOrManager()\r\n    if (!authorized || !session) {\r\n        return { error: \"Unauthorized\" }\r\n    }\r\n\r\n    try {\r\n        // Verify task is assigned to the user\r\n        const task = await prisma.task.findFirst({\r\n            where: {\r\n                id: taskId,\r\n                assignees: { some: { id: userId } }\r\n            }\r\n        })\r\n\r\n        if (!task) {\r\n            return { error: \"Task not found or not assigned to this user\" }\r\n        }\r\n\r\n        const targetDate = date || new Date()\r\n        const dateStart = startOfDay(targetDate)\r\n        const dateEnd = endOfDay(targetDate)\r\n\r\n        // Check if task is already in today's tasks for the selected date\r\n        const existingTodayTask = await prisma.task.findFirst({\r\n            where: {\r\n                id: taskId,\r\n                plannedDate: {\r\n                    gte: dateStart,\r\n                    lte: dateEnd\r\n                }\r\n            }\r\n        })\r\n\r\n        if (existingTodayTask) {\r\n            return { error: \"Task is already assigned to this date's focus\" }\r\n        }\r\n\r\n        // Get task with project info\r\n        const taskWithProject = await prisma.task.findUnique({\r\n            where: { id: taskId },\r\n            include: {\r\n                project: {\r\n                    select: { id: true }\r\n                }\r\n            }\r\n        })\r\n\r\n        // Set plannedDate to the selected date\r\n        await prisma.task.update({\r\n            where: { id: taskId },\r\n            data: { plannedDate: targetDate }\r\n        })\r\n\r\n        // Create project notification for Today's Task assignment\r\n        if (taskWithProject) {\r\n            await createProjectNotification(\r\n                taskWithProject.project.id,\r\n                userId,\r\n                {\r\n                    type: \"today_task\",\r\n                    entityType: \"task\",\r\n                    entityId: taskId,\r\n                    title: \"Today's Task Assigned\",\r\n                    message: `Task \"${task.title}\" has been added to your Today's Tasks`,\r\n                    soundRequired: false\r\n                }\r\n            )\r\n        }\r\n\r\n        // Log activity\r\n        try {\r\n            await prisma.activityLog.create({\r\n                data: {\r\n                    userId: parseInt(session.user.id),\r\n                    action: \"assign_today_task\",\r\n                    description: `Assigned task \"${task.title}\" to user ${userId} for today`,\r\n                    entityType: \"task\",\r\n                    entityId: taskId\r\n                }\r\n            })\r\n        } catch (logError) {\r\n            console.error(\"Failed to log activity:\", logError)\r\n            // Don't fail the operation if logging fails\r\n        }\r\n\r\n        revalidatePath(\"/dashboard/today-tasks-assignment\")\r\n        revalidatePath(`/dashboard/focus`)\r\n        return { success: true }\r\n    } catch (e: any) {\r\n        console.error(\"assignTodayTask Error:\", e)\r\n        return { error: \"Failed to assign task\", details: e.message }\r\n    }\r\n}\r\n\r\n// Remove a task from today's focus for a user\r\nexport async function removeTodayTask(userId: number, taskId: number) {\r\n    const { authorized, session } = await checkAdminOrManager()\r\n    if (!authorized || !session) {\r\n        return { error: \"Unauthorized\" }\r\n    }\r\n\r\n    try {\r\n        // Verify task is assigned to the user\r\n        const task = await prisma.task.findFirst({\r\n            where: {\r\n                id: taskId,\r\n                assignees: { some: { id: userId } }\r\n            }\r\n        })\r\n\r\n        if (!task) {\r\n            return { error: \"Task not found or not assigned to this user\" }\r\n        }\r\n\r\n        // Get task with project info\r\n        const taskWithProject = await prisma.task.findUnique({\r\n            where: { id: taskId },\r\n            include: {\r\n                project: {\r\n                    select: { id: true }\r\n                }\r\n            }\r\n        })\r\n\r\n        // Clear plannedDate\r\n        await prisma.task.update({\r\n            where: { id: taskId },\r\n            data: { plannedDate: null }\r\n        })\r\n\r\n        // Create project notification for Today's Task removal\r\n        if (taskWithProject) {\r\n            await createProjectNotification(\r\n                taskWithProject.project.id,\r\n                userId,\r\n                {\r\n                    type: \"today_task\",\r\n                    entityType: \"task\",\r\n                    entityId: taskId,\r\n                    title: \"Today's Task Removed\",\r\n                    message: `Task \"${task.title}\" has been removed from your Today's Tasks`,\r\n                    soundRequired: false\r\n                }\r\n            )\r\n        }\r\n\r\n        // Log activity\r\n        try {\r\n            await prisma.activityLog.create({\r\n                data: {\r\n                    userId: parseInt(session.user.id),\r\n                    action: \"remove_today_task\",\r\n                    description: `Removed task \"${task.title}\" from user ${userId}'s today's focus`,\r\n                    entityType: \"task\",\r\n                    entityId: taskId\r\n                }\r\n            })\r\n        } catch (logError) {\r\n            console.error(\"Failed to log activity:\", logError)\r\n            // Don't fail the operation if logging fails\r\n        }\r\n\r\n        revalidatePath(\"/dashboard/today-tasks-assignment\")\r\n        revalidatePath(`/dashboard/focus`)\r\n        return { success: true }\r\n    } catch (e: any) {\r\n        console.error(\"removeTodayTask Error:\", e)\r\n        return { error: \"Failed to remove task\", details: e.message }\r\n    }\r\n}\r\n\r\n// Get projects for a user (for the project filter)\r\nexport async function getUserProjects(userId: number) {\r\n    const { authorized, session } = await checkAdminOrManager()\r\n    if (!authorized || !session) {\r\n        return { error: \"Unauthorized\" }\r\n    }\r\n\r\n    try {\r\n        const projects = await prisma.project.findMany({\r\n            where: {\r\n                tasks: {\r\n                    some: {\r\n                        assignees: { some: { id: userId } }\r\n                    }\r\n                }\r\n            },\r\n            select: {\r\n                id: true,\r\n                name: true\r\n            },\r\n            orderBy: { name: \"asc\" }\r\n        })\r\n\r\n        return { success: true, projects }\r\n    } catch (e: any) {\r\n        console.error(\"getUserProjects Error:\", e)\r\n        return { error: \"Failed to fetch projects\", details: e.message }\r\n    }\r\n}\r\n\r\n// Get task counts for all users (for the management page)\r\nexport async function getUsersTaskCounts(date?: Date) {\r\n    const { authorized, session } = await checkAdminOrManager()\r\n    if (!authorized || !session) {\r\n        return { error: \"Unauthorized\" }\r\n    }\r\n\r\n    try {\r\n        const targetDate = date || new Date()\r\n        const dateStart = startOfDay(targetDate)\r\n        const dateEnd = endOfDay(targetDate)\r\n\r\n        const users = await prisma.user.findMany({\r\n            where: { isActive: true },\r\n            select: {\r\n                id: true,\r\n                assignedTasks: {\r\n                    select: {\r\n                        id: true,\r\n                        projectId: true,\r\n                        plannedDate: true,\r\n                        status: true\r\n                    }\r\n                }\r\n            }\r\n        })\r\n\r\n        const counts: Record<number, { today: number; total: number }> = {}\r\n\r\n        users.forEach(user => {\r\n            const todayTasks = user.assignedTasks.filter(task => {\r\n                if (!task.plannedDate) return false\r\n                const taskDate = new Date(task.plannedDate)\r\n                return taskDate >= dateStart && taskDate <= dateEnd && task.status !== \"completed\"\r\n            })\r\n\r\n            const totalTasks = user.assignedTasks.filter(task => task.status !== \"completed\")\r\n\r\n            counts[user.id] = {\r\n                today: todayTasks.length,\r\n                total: totalTasks.length\r\n            }\r\n        })\r\n\r\n        return { success: true, counts }\r\n    } catch (e: any) {\r\n        console.error(\"getUsersTaskCounts Error:\", e)\r\n        return { error: \"Failed to fetch task counts\", details: e.message }\r\n    }\r\n}\r\n\r\n// Get projects with tasks assigned to users for a specific date\r\nexport async function getProjectsWithUserTasks(date?: Date) {\r\n    const { authorized, session } = await checkAdminOrManager()\r\n    if (!authorized || !session) {\r\n        return { error: \"Unauthorized\" }\r\n    }\r\n\r\n    try {\r\n        const targetDate = date || new Date()\r\n        const dateStart = startOfDay(targetDate)\r\n        const dateEnd = endOfDay(targetDate)\r\n\r\n        const projects = await prisma.project.findMany({\r\n            where: {\r\n                tasks: {\r\n                    some: {\r\n                        assignees: { some: { id: { not: undefined } } },\r\n                        status: { not: \"completed\" }\r\n                    }\r\n                }\r\n            },\r\n            include: {\r\n                tasks: {\r\n                    where: {\r\n                        assignees: { some: { id: { not: undefined } } },\r\n                        status: { not: \"completed\" }\r\n                    },\r\n                    include: {\r\n                        assignees: {\r\n                            select: {\r\n                                id: true,\r\n                                username: true,\r\n                                email: true\r\n                            }\r\n                        },\r\n                        dependencies: {\r\n                            include: {\r\n                                dependsOnTask: {\r\n                                    select: {\r\n                                        id: true,\r\n                                        title: true,\r\n                                        status: true\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    orderBy: { updatedAt: \"desc\" }\r\n                }\r\n            },\r\n            orderBy: { name: \"asc\" }\r\n        })\r\n\r\n        // Process projects and tasks\r\n        const projectsWithTasks = projects.map(project => {\r\n            const todayTasks = project.tasks.filter(task => {\r\n                if (!task.plannedDate) return false\r\n                const taskDate = new Date(task.plannedDate)\r\n                return taskDate >= dateStart && taskDate <= dateEnd\r\n            })\r\n\r\n            const allTasks = project.tasks.map(task => {\r\n                const incompleteDependencies = task.dependencies.filter(\r\n                    dep => dep.dependsOnTask.status !== \"completed\"\r\n                )\r\n                return {\r\n                    ...task,\r\n                    isBlocked: incompleteDependencies.length > 0,\r\n                    blockingDependencies: incompleteDependencies.map(dep => ({\r\n                        id: dep.dependsOnTask.id,\r\n                        title: dep.dependsOnTask.title,\r\n                        status: dep.dependsOnTask.status\r\n                    }))\r\n                }\r\n            })\r\n\r\n            return {\r\n                id: project.id,\r\n                name: project.name,\r\n                status: project.status,\r\n                todayTasks: todayTasks.map(t => {\r\n                    const taskData = allTasks.find(at => at.id === t.id)\r\n                    return {\r\n                        id: t.id,\r\n                        title: t.title,\r\n                        status: t.status,\r\n                        priority: t.priority,\r\n                        assignees: t.assignees,\r\n                        isBlocked: taskData?.isBlocked || false,\r\n                        blockingDependencies: taskData?.blockingDependencies || []\r\n                    }\r\n                }),\r\n                allTasks: allTasks\r\n            }\r\n        })\r\n\r\n        return { success: true, projects: projectsWithTasks }\r\n    } catch (e: any) {\r\n        console.error(\"getProjectsWithUserTasks Error:\", e)\r\n        return { error: \"Failed to fetch projects\", details: e.message }\r\n    }\r\n}\r\n","export {getPublicSystemSettings as '0033db22356cbf8845a3517099b63dfc38d1147299'} from 'ACTIONS_MODULE0'\nexport {getAllProjectsUnreadNotificationCount as '00686a7231b739e4fe9b8305b757bc0e83827b9865'} from 'ACTIONS_MODULE1'\nexport {getAllProjectsNotifications as '4004a0aae390e2c1aeb900c79065f312ac43d90f8d'} from 'ACTIONS_MODULE1'\nexport {markProjectNotificationAsRead as '60691655a7ad6aec29ab9691d8571a0d380be93da1'} from 'ACTIONS_MODULE1'\nexport {getUsersForAssignment as '000b69dbd513216f97e19a2d13af47b7cbfbb9758a'} from 'ACTIONS_MODULE2'\nexport {getProjectsWithUserTasks as '4006938d4f18f3474a93c54985b4af1bac8a8f1844'} from 'ACTIONS_MODULE2'\nexport {getUsersTaskCounts as '4075a53d559255c305d494b04d1aca412d3b59c1c5'} from 'ACTIONS_MODULE2'\nexport {getUserProjects as '40d34329def7d6aaeeb22920f3debfca1a323f382b'} from 'ACTIONS_MODULE2'\nexport {removeTodayTask as '6002dc22fdb945660d8cebe1b84f80d0e1d43ca74a'} from 'ACTIONS_MODULE2'\nexport {assignTodayTask as '70a25aac68da7562c938431ab2abea0ec1fb5b1b9d'} from 'ACTIONS_MODULE2'\nexport {getUserProjectTasks as '70b1c0d756af3710a21ea6e02af89929be757461b2'} from 'ACTIONS_MODULE2'\nexport {getAllProjectsUnreadNotificationCount as '00686a7231b739e4fe9b8305b757bc0e83827b9865'} from 'ACTIONS_MODULE1'\nexport {getAllProjectsNotifications as '4004a0aae390e2c1aeb900c79065f312ac43d90f8d'} from 'ACTIONS_MODULE1'\nexport {getProjectNotificationPreferences as '4073df5af18efe51e33e158abaa2dd30f11932484d'} from 'ACTIONS_MODULE1'\nexport {markAllProjectNotificationsAsRead as '40c086aae8b4c1ddec14829c213410ee4c5d2ec0b4'} from 'ACTIONS_MODULE1'\nexport {getProjectUnreadNotificationCount as '40c45036bf2dcfbc3a3b624285c3d3d3366fc5ed73'} from 'ACTIONS_MODULE1'\nexport {markProjectNotificationAsRead as '60691655a7ad6aec29ab9691d8571a0d380be93da1'} from 'ACTIONS_MODULE1'\nexport {updateProjectNotificationPreferences as '60d7258dffa20b5ae58a4ac333313c2a6cc4aeb7a7'} from 'ACTIONS_MODULE1'\nexport {getProjectNotifications as '60e11d18f808d2843f4d06a35ea4ad9027dd8b4de1'} from 'ACTIONS_MODULE1'\nexport {createProjectNotification as '705f7777ed9cdc6c32f418ba57dcb7f4b84f8c002a'} from 'ACTIONS_MODULE1'\nexport {getTeams as '000b6b4fc682f5b92871a66c0311a087451073067d'} from 'ACTIONS_MODULE3'\nexport {getAvailableProjects as '40220937dde4293d9f0bf5a425d05335bdc2930814'} from 'ACTIONS_MODULE3'\nexport {createTeam as '404302e6527c8c0424fe4e6a0812dd3f9ee5fad749'} from 'ACTIONS_MODULE3'\nexport {getTeamProjects as '40d262c653cb585b83ff6f03afb8a05a8f61e23a18'} from 'ACTIONS_MODULE3'\nexport {deleteTeam as '40e6475c1d47d2ff245175aefb8d73f5f7df5fad9c'} from 'ACTIONS_MODULE3'\nexport {getTeam as '40f8a92a189582ac7a7fcdf1ff304dbcf4401f1dc5'} from 'ACTIONS_MODULE3'\nexport {updateTeam as '60278acd0ffe289349b3e3387dd2813159632c358e'} from 'ACTIONS_MODULE3'\nexport {removeMemberFromTeam as '60b69acfa49cb854dd3912651668ce9af6d01a1527'} from 'ACTIONS_MODULE3'\nexport {removeProjectFromTeam as '60d6167c34faec1d09835a40e8132b96c1ee7a4ed0'} from 'ACTIONS_MODULE3'\nexport {addProjectToTeam as '60ef84a9ad667e7d49ef9c80bd8d94651b75e6268f'} from 'ACTIONS_MODULE3'\nexport {addMemberToTeam as '70cfe62d32831304d63f72a2766fa81478529867f3'} from 'ACTIONS_MODULE3'\nexport {logActivity as '40daa1d9c7314de4957a7669434db12aaa24630ba4'} from 'ACTIONS_MODULE4'\nexport {getUserProjectTasks as '70b1c0d756af3710a21ea6e02af89929be757461b2'} from 'ACTIONS_MODULE2'\nexport {assignTodayTask as '70a25aac68da7562c938431ab2abea0ec1fb5b1b9d'} from 'ACTIONS_MODULE2'\nexport {removeTodayTask as '6002dc22fdb945660d8cebe1b84f80d0e1d43ca74a'} from 'ACTIONS_MODULE2'\nexport {getUserProjects as '40d34329def7d6aaeeb22920f3debfca1a323f382b'} from 'ACTIONS_MODULE2'\nexport {getUsersTaskCounts as '4075a53d559255c305d494b04d1aca412d3b59c1c5'} from 'ACTIONS_MODULE2'\nexport {getProjectsWithUserTasks as '4006938d4f18f3474a93c54985b4af1bac8a8f1844'} from 'ACTIONS_MODULE2'\nexport {getUsersForAssignment as '000b69dbd513216f97e19a2d13af47b7cbfbb9758a'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":"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","ignoreList":[4,5,6,7,8]}