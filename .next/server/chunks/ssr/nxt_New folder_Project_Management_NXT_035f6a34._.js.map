{"version":3,"sources":["../../../../../../../nxt/New%20folder/Project_Management_NXT/src/app/actions/teams.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/app/actions/rbac.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/.next-internal/server/app/dashboard/users/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { getServerSession } from \"next-auth\"\r\nimport { authOptions } from \"@/lib/auth\"\r\nimport { z } from \"zod\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { logActivity } from \"@/lib/activity-logger\"\r\nimport {\r\n    requirePermission,\r\n    handleAuthorizationError,\r\n    ForbiddenError,\r\n} from \"@/lib/rbac-helpers\"\r\n\r\nconst teamSchema = z.object({\r\n    name: z.string().min(1, \"Name is required\"),\r\n    description: z.string().optional(),\r\n    teamLeadId: z.coerce.number().optional(),\r\n    status: z.enum([\"active\", \"inactive\"]).default(\"active\"),\r\n    memberIds: z.array(z.number()).optional(),\r\n})\r\n\r\nexport async function getTeams() {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) throw new Error(\"Unauthorized\")\r\n\r\n    const teams = await prisma.team.findMany({\r\n        include: {\r\n            _count: {\r\n                select: { \r\n                    users: true, \r\n                    tasks: true,\r\n                    members: true,\r\n                    projectTeams: true \r\n                }\r\n            },\r\n            teamLead: {\r\n                select: { id: true, username: true, email: true, avatarUrl: true }\r\n            },\r\n            users: {\r\n                take: 5,\r\n                select: { username: true, email: true, avatarUrl: true }\r\n            },\r\n            members: {\r\n                take: 5,\r\n                include: {\r\n                    user: {\r\n                        select: { id: true, username: true, email: true, avatarUrl: true }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        orderBy: { createdAt: \"desc\" }\r\n    })\r\n\r\n    return teams\r\n}\r\n\r\nexport async function getTeam(id: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) throw new Error(\"Unauthorized\")\r\n\r\n    const team = await prisma.team.findUnique({\r\n        where: { id },\r\n        include: {\r\n            teamLead: {\r\n                select: { id: true, username: true, email: true, avatarUrl: true, role: true }\r\n            },\r\n            members: {\r\n                include: {\r\n                    user: {\r\n                        select: { id: true, username: true, email: true, avatarUrl: true, role: true }\r\n                    }\r\n                },\r\n                orderBy: { joinedAt: \"desc\" }\r\n            },\r\n            projectTeams: {\r\n                include: {\r\n                    project: {\r\n                        select: {\r\n                            id: true,\r\n                            name: true,\r\n                            status: true,\r\n                            startDate: true,\r\n                            endDate: true,\r\n                            projectManager: {\r\n                                select: { id: true, username: true, email: true }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                orderBy: { assignedAt: \"desc\" }\r\n            },\r\n            _count: {\r\n                select: { tasks: true, members: true, projectTeams: true }\r\n            }\r\n        }\r\n    })\r\n\r\n    return team\r\n}\r\n\r\nexport async function getTeamProjects(teamId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) throw new Error(\"Unauthorized\")\r\n\r\n    const projectTeams = await prisma.projectTeam.findMany({\r\n        where: { teamId },\r\n        include: {\r\n            project: {\r\n                select: {\r\n                    id: true,\r\n                    name: true,\r\n                    status: true,\r\n                    startDate: true,\r\n                    endDate: true,\r\n                    projectManager: {\r\n                        select: { id: true, username: true, email: true }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        orderBy: { assignedAt: \"desc\" }\r\n    })\r\n\r\n    return projectTeams.map(pt => pt.project)\r\n}\r\n\r\nexport async function createTeam(formData: FormData) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.create\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    const name = formData.get(\"name\") as string\r\n    const description = formData.get(\"description\") as string\r\n    const teamLeadId = formData.get(\"teamLeadId\")\r\n    const status = formData.get(\"status\") as string || \"active\"\r\n    const memberIdsStr = formData.get(\"memberIds\") as string\r\n\r\n    let memberIds: number[] = []\r\n    if (memberIdsStr) {\r\n        try {\r\n            memberIds = JSON.parse(memberIdsStr)\r\n        } catch {\r\n            // Ignore parse errors\r\n        }\r\n    }\r\n\r\n    const validated = teamSchema.safeParse({ \r\n        name, \r\n        description, \r\n        teamLeadId: teamLeadId ? parseInt(teamLeadId as string) : undefined,\r\n        status: status as \"active\" | \"inactive\",\r\n        memberIds\r\n    })\r\n\r\n    if (!validated.success) {\r\n        return { error: \"Validation failed\" }\r\n    }\r\n\r\n    try {\r\n        const team = await prisma.team.create({\r\n            data: {\r\n                name: validated.data.name,\r\n                description: validated.data.description,\r\n                teamLeadId: validated.data.teamLeadId || null,\r\n                status: validated.data.status,\r\n                members: validated.data.memberIds && validated.data.memberIds.length > 0 ? {\r\n                    create: validated.data.memberIds.map(userId => ({\r\n                        userId,\r\n                        role: userId === validated.data.teamLeadId ? \"lead\" : \"member\"\r\n                    }))\r\n                } : undefined\r\n            },\r\n            include: {\r\n                teamLead: true,\r\n                members: {\r\n                    include: { user: true }\r\n                }\r\n            }\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"team_created\",\r\n            actionCategory: \"project\",\r\n            actionSummary: `Team \"${team.name}\" created`,\r\n            actionDetails: {\r\n                teamId: team.id,\r\n                teamName: team.name,\r\n                status: team.status,\r\n                teamLeadId: team.teamLeadId,\r\n                memberCount: team.members.length,\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            entityType: \"team\",\r\n            entityId: team.id,\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/teams\")\r\n        return { success: true, team }\r\n    } catch (e) {\r\n        console.error(e)\r\n        return { error: \"Failed to create team\" }\r\n    }\r\n}\r\n\r\nexport async function updateTeam(id: number, formData: FormData) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.update\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    const name = formData.get(\"name\") as string\r\n    const description = formData.get(\"description\") as string\r\n    const teamLeadId = formData.get(\"teamLeadId\")\r\n    const status = formData.get(\"status\") as string\r\n\r\n    const validated = teamSchema.partial().safeParse({ \r\n        name, \r\n        description, \r\n        teamLeadId: teamLeadId ? parseInt(teamLeadId as string) : undefined,\r\n        status: status as \"active\" | \"inactive\" | undefined\r\n    })\r\n\r\n    if (!validated.success) {\r\n        return { error: \"Validation failed\" }\r\n    }\r\n\r\n    try {\r\n        const team = await prisma.team.update({\r\n            where: { id },\r\n            data: {\r\n                name: validated.data.name,\r\n                description: validated.data.description,\r\n                teamLeadId: validated.data.teamLeadId !== undefined ? validated.data.teamLeadId : undefined,\r\n                status: validated.data.status,\r\n            }\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"team_updated\",\r\n            actionCategory: \"project\",\r\n            actionSummary: `Team \"${team.name}\" updated`,\r\n            actionDetails: {\r\n                teamId: team.id,\r\n                teamName: team.name,\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            entityType: \"team\",\r\n            entityId: team.id,\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/teams\")\r\n        revalidatePath(`/dashboard/teams/${id}`)\r\n        return { success: true }\r\n    } catch (e) {\r\n        console.error(e)\r\n        return { error: \"Failed to update team\" }\r\n    }\r\n}\r\n\r\nexport async function deleteTeam(id: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.delete\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    try {\r\n        const team = await prisma.team.findUnique({\r\n            where: { id },\r\n            select: { name: true }\r\n        })\r\n\r\n        await prisma.team.delete({\r\n            where: { id }\r\n        })\r\n\r\n        // Log activity\r\n        if (team) {\r\n            await logActivity({\r\n                actionType: \"team_deleted\",\r\n                actionCategory: \"project\",\r\n                actionSummary: `Team \"${team.name}\" deleted`,\r\n                actionDetails: {\r\n                    teamId: id,\r\n                    teamName: team.name,\r\n                },\r\n                performedById: parseInt(session.user.id),\r\n                entityType: \"team\",\r\n                entityId: id,\r\n            })\r\n        }\r\n\r\n        revalidatePath(\"/dashboard/teams\")\r\n        return { success: true }\r\n    } catch (e) {\r\n        return { error: \"Failed to delete team\" }\r\n    }\r\n}\r\n\r\nexport async function addProjectToTeam(teamId: number, projectId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.addProject\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    try {\r\n        // Check if team is active\r\n        const team = await prisma.team.findUnique({\r\n            where: { id: teamId },\r\n            select: { status: true, name: true }\r\n        })\r\n\r\n        if (!team) {\r\n            return { error: \"Team not found\" }\r\n        }\r\n\r\n        if (team.status !== \"active\") {\r\n            return { error: \"Cannot assign projects to inactive teams\" }\r\n        }\r\n\r\n        await prisma.projectTeam.create({\r\n            data: {\r\n                teamId,\r\n                projectId\r\n            }\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_assigned_to_team\",\r\n            actionCategory: \"project\",\r\n            actionSummary: `Project assigned to team \"${team.name}\"`,\r\n            actionDetails: {\r\n                teamId,\r\n                projectId,\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            projectId,\r\n            entityType: \"team\",\r\n            entityId: teamId,\r\n        })\r\n\r\n        revalidatePath(`/dashboard/teams/${teamId}`)\r\n        return { success: true }\r\n    } catch (e: any) {\r\n        if (e.code === \"P2002\") {\r\n            return { error: \"Project is already assigned to this team\" }\r\n        }\r\n        console.error(e)\r\n        return { error: \"Failed to assign project to team\" }\r\n    }\r\n}\r\n\r\nexport async function removeProjectFromTeam(teamId: number, projectId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.removeProject\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    try {\r\n        const team = await prisma.team.findUnique({\r\n            where: { id: teamId },\r\n            select: { name: true }\r\n        })\r\n\r\n        await prisma.projectTeam.delete({\r\n            where: {\r\n                projectId_teamId: {\r\n                    projectId,\r\n                    teamId\r\n                }\r\n            }\r\n        })\r\n\r\n        // Log activity\r\n        if (team) {\r\n            await logActivity({\r\n                actionType: \"project_removed_from_team\",\r\n                actionCategory: \"project\",\r\n                actionSummary: `Project removed from team \"${team.name}\"`,\r\n                actionDetails: {\r\n                    teamId,\r\n                    projectId,\r\n                },\r\n                performedById: parseInt(session.user.id),\r\n                projectId,\r\n                entityType: \"team\",\r\n                entityId: teamId,\r\n            })\r\n        }\r\n\r\n        revalidatePath(`/dashboard/teams/${teamId}`)\r\n        return { success: true }\r\n    } catch (e) {\r\n        console.error(e)\r\n        return { error: \"Failed to remove project from team\" }\r\n    }\r\n}\r\n\r\nexport async function addMemberToTeam(teamId: number, userId: number, role: string = \"member\") {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.addMember\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    try {\r\n        await prisma.teamMember.create({\r\n            data: {\r\n                teamId,\r\n                userId,\r\n                role\r\n            }\r\n        })\r\n\r\n        revalidatePath(`/dashboard/teams/${teamId}`)\r\n        return { success: true }\r\n    } catch (e: any) {\r\n        if (e.code === \"P2002\") {\r\n            return { error: \"User is already a member of this team\" }\r\n        }\r\n        console.error(e)\r\n        return { error: \"Failed to add member to team\" }\r\n    }\r\n}\r\n\r\nexport async function removeMemberFromTeam(teamId: number, userId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        await requirePermission(parseInt(session.user.id), \"team.removeMember\")\r\n    } catch (error: any) {\r\n        return handleAuthorizationError(error)\r\n    }\r\n\r\n    try {\r\n        await prisma.teamMember.delete({\r\n            where: {\r\n                teamId_userId: {\r\n                    teamId,\r\n                    userId\r\n                }\r\n            }\r\n        })\r\n\r\n        revalidatePath(`/dashboard/teams/${teamId}`)\r\n        return { success: true }\r\n    } catch (e) {\r\n        console.error(e)\r\n        return { error: \"Failed to remove member from team\" }\r\n    }\r\n}\r\n\r\nexport async function getAvailableProjects(teamId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) throw new Error(\"Unauthorized\")\r\n\r\n    // ‚úÖ OPTIMIZED: Single query instead of N+1 pattern\r\n    // Get all projects NOT assigned to this team using relation filter\r\n    const projects = await prisma.project.findMany({\r\n        where: {\r\n            projectTeams: {\r\n                none: { teamId } // No team assignment with this teamId\r\n            }\r\n        },\r\n        select: {\r\n            id: true,\r\n            name: true,\r\n            status: true,\r\n            projectManager: {\r\n                select: { id: true, username: true, email: true }\r\n            }\r\n        },\r\n        orderBy: { name: \"asc\" }\r\n    })\r\n\r\n    return projects\r\n}\r\n","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { getServerSession } from \"next-auth\"\r\nimport { authOptions } from \"@/lib/auth\"\r\nimport { z } from \"zod\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { logActivity } from \"@/lib/activity-logger\"\r\nimport { clearPermissionCache } from \"@/lib/rbac\"\r\nimport { PERMISSIONS, DEFAULT_ROLES, getAllPermissions } from \"@/lib/permissions\"\r\nimport { requirePermission } from \"@/lib/rbac-helpers\"\r\n\r\nconst roleSchema = z.object({\r\n  name: z.string().min(1, \"Role name is required\"),\r\n  description: z.string().optional(),\r\n  permissionIds: z.array(z.number()).optional(),\r\n})\r\n\r\n/**\r\n * Get all roles\r\n */\r\nexport async function getRoles() {\r\n  const session = await getServerSession(authOptions)\r\n  if (!session) throw new Error(\"Unauthorized\")\r\n\r\n  // Enforce RBAC - no role-based bypasses\r\n  await requirePermission(parseInt(session.user.id), PERMISSIONS.ROLE.READ)\r\n\r\n  const roles = await prisma.role.findMany({\r\n    include: {\r\n      _count: {\r\n        select: {\r\n          permissions: true,\r\n          userRoles: true,\r\n        },\r\n      },\r\n      permissions: {\r\n        include: {\r\n          permission: true,\r\n        },\r\n      },\r\n    },\r\n    orderBy: { name: \"asc\" },\r\n  })\r\n\r\n  return roles\r\n}\r\n\r\n/**\r\n * Get a single role by ID\r\n */\r\nexport async function getRole(id: number) {\r\n  const session = await getServerSession(authOptions)\r\n  if (!session) throw new Error(\"Unauthorized\")\r\n\r\n  // Enforce RBAC - no role-based bypasses\r\n  await requirePermission(parseInt(session.user.id), PERMISSIONS.ROLE.READ)\r\n\r\n  const role = await prisma.role.findUnique({\r\n    where: { id },\r\n    include: {\r\n      permissions: {\r\n        include: {\r\n          permission: true,\r\n        },\r\n      },\r\n      userRoles: {\r\n        include: {\r\n          user: {\r\n            select: { id: true, username: true, email: true },\r\n          },\r\n        },\r\n      },\r\n    },\r\n  })\r\n\r\n  return role\r\n}\r\n\r\n/**\r\n * Create a new role\r\n */\r\nexport async function createRole(formData: FormData) {\r\n  const session = await getServerSession(authOptions)\r\n  if (!session) return { error: \"Unauthorized\" }\r\n\r\n  try {\r\n    // Enforce RBAC - no role-based bypasses\r\n    await requirePermission(parseInt(session.user.id), PERMISSIONS.ROLE.CREATE)\r\n  } catch (e) {\r\n    return { error: \"Permission denied\" }\r\n  }\r\n\r\n  const name = formData.get(\"name\") as string\r\n  const description = formData.get(\"description\") as string\r\n  const permissionIdsStr = formData.get(\"permissionIds\") as string\r\n\r\n  let permissionIds: number[] = []\r\n  if (permissionIdsStr) {\r\n    try {\r\n      permissionIds = JSON.parse(permissionIdsStr)\r\n    } catch {\r\n      // Ignore parse errors\r\n    }\r\n  }\r\n\r\n  const validated = roleSchema.safeParse({ name, description, permissionIds })\r\n\r\n  if (!validated.success) {\r\n    return { error: \"Validation failed\" }\r\n  }\r\n\r\n  try {\r\n    const role = await prisma.role.create({\r\n      data: {\r\n        name: validated.data.name,\r\n        description: validated.data.description || null,\r\n        permissions: validated.data.permissionIds && validated.data.permissionIds.length > 0 ? {\r\n          create: validated.data.permissionIds.map(permissionId => ({\r\n            permissionId,\r\n          })),\r\n        } : undefined,\r\n      },\r\n      include: {\r\n        permissions: {\r\n          include: { permission: true },\r\n        },\r\n      },\r\n    })\r\n\r\n    // Log activity\r\n    await logActivity({\r\n      actionType: \"role_created\",\r\n      actionCategory: \"settings\",\r\n      actionSummary: `Role \"${role.name}\" created`,\r\n      actionDetails: {\r\n        roleId: role.id,\r\n        roleName: role.name,\r\n        permissionCount: role.permissions.length,\r\n      },\r\n      performedById: parseInt(session.user.id),\r\n      entityType: \"role\",\r\n      entityId: role.id,\r\n    })\r\n\r\n    revalidatePath(\"/dashboard/admin/roles\")\r\n    return { success: true, role }\r\n  } catch (e: any) {\r\n    if (e.code === \"P2002\") {\r\n      return { error: \"Role with this name already exists\" }\r\n    }\r\n    console.error(e)\r\n    return { error: \"Failed to create role\" }\r\n  }\r\n}\r\n\r\n/**\r\n * Update a role\r\n */\r\nexport async function updateRole(id: number, formData: FormData) {\r\n  const session = await getServerSession(authOptions)\r\n  if (!session) return { error: \"Unauthorized\" }\r\n\r\n  try {\r\n    // Enforce RBAC - no role-based bypasses\r\n    await requirePermission(parseInt(session.user.id), PERMISSIONS.ROLE.UPDATE)\r\n  } catch (e) {\r\n    return { error: \"Permission denied\" }\r\n  }\r\n\r\n  // Check if role is system role\r\n  const existingRole = await prisma.role.findUnique({\r\n    where: { id },\r\n    select: { isSystemRole: true, name: true },\r\n  })\r\n\r\n  if (existingRole?.isSystemRole && existingRole.name === \"System Admin\") {\r\n    return { error: \"Cannot modify System Admin role\" }\r\n  }\r\n\r\n  const name = formData.get(\"name\") as string\r\n  const description = formData.get(\"description\") as string\r\n  const permissionIdsStr = formData.get(\"permissionIds\") as string\r\n\r\n  let permissionIds: number[] = []\r\n  if (permissionIdsStr) {\r\n    try {\r\n      permissionIds = JSON.parse(permissionIdsStr)\r\n    } catch {\r\n      // Ignore parse errors\r\n    }\r\n  }\r\n\r\n  const validated = roleSchema.partial().safeParse({ name, description, permissionIds })\r\n\r\n  if (!validated.success) {\r\n    return { error: \"Validation failed\" }\r\n  }\r\n\r\n  try {\r\n    // Update role\r\n    const role = await prisma.role.update({\r\n      where: { id },\r\n      data: {\r\n        name: validated.data.name,\r\n        description: validated.data.description !== undefined ? validated.data.description : undefined,\r\n      },\r\n    })\r\n\r\n    // Update permissions if provided\r\n    if (validated.data.permissionIds !== undefined) {\r\n      // Remove all existing permissions\r\n      await prisma.rolePermission.deleteMany({\r\n        where: { roleId: id },\r\n      })\r\n\r\n      // Add new permissions (SQLite doesn't support createMany with unique constraints)\r\n      if (permissionIds.length > 0) {\r\n        for (const permissionId of permissionIds) {\r\n          try {\r\n            await prisma.rolePermission.create({\r\n              data: {\r\n                roleId: id,\r\n                permissionId,\r\n              },\r\n            })\r\n          } catch (e: any) {\r\n            // Skip if already exists\r\n            if (e.code !== 'P2002') {\r\n              throw e\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Clear permission caches for all users with this role\r\n      const usersWithRole = await prisma.userRole.findMany({\r\n        where: { roleId: id },\r\n        select: { userId: true, scopeId: true },\r\n      })\r\n\r\n      for (const userRole of usersWithRole) {\r\n        clearPermissionCache(userRole.userId, userRole.scopeId || undefined)\r\n      }\r\n    }\r\n\r\n    // Log activity\r\n    await logActivity({\r\n      actionType: \"role_updated\",\r\n      actionCategory: \"settings\",\r\n      actionSummary: `Role \"${role.name}\" updated`,\r\n      actionDetails: {\r\n        roleId: role.id,\r\n        roleName: role.name,\r\n      },\r\n      performedById: parseInt(session.user.id),\r\n      entityType: \"role\",\r\n      entityId: role.id,\r\n    })\r\n\r\n    revalidatePath(\"/dashboard/admin/roles\")\r\n    revalidatePath(`/dashboard/admin/roles/${id}`)\r\n    return { success: true }\r\n  } catch (e: any) {\r\n    if (e.code === \"P2002\") {\r\n      return { error: \"Role with this name already exists\" }\r\n    }\r\n    console.error(e)\r\n    return { error: \"Failed to update role\" }\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a role\r\n */\r\nexport async function deleteRole(id: number) {\r\n  const session = await getServerSession(authOptions)\r\n  if (!session) return { error: \"Unauthorized\" }\r\n\r\n  try {\r\n    // Enforce RBAC - no role-based bypasses\r\n    await requirePermission(parseInt(session.user.id), PERMISSIONS.ROLE.DELETE)\r\n  } catch (e) {\r\n    return { error: \"Permission denied\" }\r\n  }\r\n\r\n  // Check if role is system role\r\n  const role = await prisma.role.findUnique({\r\n    where: { id },\r\n    select: { isSystemRole: true, name: true },\r\n  })\r\n\r\n  if (role?.isSystemRole) {\r\n    return { error: \"Cannot delete system role\" }\r\n  }\r\n\r\n  // Check if any users have this role\r\n  const userCount = await prisma.userRole.count({\r\n    where: { roleId: id },\r\n  })\r\n\r\n  if (userCount > 0) {\r\n    return { error: `Cannot delete role: ${userCount} user(s) have this role assigned` }\r\n  }\r\n\r\n  try {\r\n    await prisma.role.delete({\r\n      where: { id },\r\n    })\r\n\r\n    // Log activity\r\n    await logActivity({\r\n      actionType: \"role_deleted\",\r\n      actionCategory: \"settings\",\r\n      actionSummary: `Role \"${role?.name}\" deleted`,\r\n      actionDetails: {\r\n        roleId: id,\r\n        roleName: role?.name,\r\n      },\r\n      performedById: parseInt(session.user.id),\r\n      entityType: \"role\",\r\n      entityId: id,\r\n    })\r\n\r\n    revalidatePath(\"/dashboard/admin/roles\")\r\n    return { success: true }\r\n  } catch (e) {\r\n    console.error(e)\r\n    return { error: \"Failed to delete role\" }\r\n  }\r\n}\r\n\r\n/**\r\n * Get all permissions\r\n */\r\nexport async function getPermissions() {\r\n  const session = await getServerSession(authOptions)\r\n  if (!session) throw new Error(\"Unauthorized\")\r\n\r\n  const permissions = await prisma.permission.findMany({\r\n    orderBy: [{ module: \"asc\" }, { name: \"asc\" }],\r\n  })\r\n\r\n  // Group by module\r\n  const grouped: Record<string, typeof permissions> = {}\r\n  for (const perm of permissions) {\r\n    if (!grouped[perm.module]) {\r\n      grouped[perm.module] = []\r\n    }\r\n    grouped[perm.module].push(perm)\r\n  }\r\n\r\n  return { permissions, grouped }\r\n}\r\n\r\n/**\r\n * Assign role to user\r\n */\r\nexport async function assignRoleToUser(\r\n  userId: number,\r\n  roleId: number,\r\n  scopeType?: \"global\" | \"project\",\r\n  scopeId?: number\r\n) {\r\n  const session = await getServerSession(authOptions)\r\n  if (!session) return { error: \"Unauthorized\" }\r\n\r\n  try {\r\n    // Enforce RBAC - no role-based bypasses\r\n    await requirePermission(parseInt(session.user.id), PERMISSIONS.ROLE.ASSIGN)\r\n  } catch (e) {\r\n    return { error: \"Permission denied\" }\r\n  }\r\n\r\n  try {\r\n    await prisma.userRole.create({\r\n      data: {\r\n        userId,\r\n        roleId,\r\n        scopeType: scopeType || null,\r\n        scopeId: scopeId || null,\r\n        assignedBy: parseInt(session.user.id),\r\n      },\r\n    })\r\n\r\n    // Clear permission cache\r\n    clearPermissionCache(userId, scopeId)\r\n\r\n    // Log activity\r\n    await logActivity({\r\n      actionType: \"role_assigned\",\r\n      actionCategory: \"settings\",\r\n      actionSummary: `Role assigned to user`,\r\n      actionDetails: {\r\n        userId,\r\n        roleId,\r\n        scopeType,\r\n        scopeId,\r\n      },\r\n      performedById: parseInt(session.user.id),\r\n      affectedUserId: userId,\r\n      entityType: \"role\",\r\n      entityId: roleId,\r\n    })\r\n\r\n    revalidatePath(\"/dashboard/admin/users\")\r\n    return { success: true }\r\n  } catch (e: any) {\r\n    if (e.code === \"P2002\") {\r\n      return { error: \"User already has this role\" }\r\n    }\r\n    console.error(e)\r\n    return { error: \"Failed to assign role\" }\r\n  }\r\n}\r\n\r\n/**\r\n * Remove role from user\r\n */\r\nexport async function removeRoleFromUser(\r\n  userId: number,\r\n  roleId: number,\r\n  scopeType?: \"global\" | \"project\",\r\n  scopeId?: number\r\n) {\r\n  const session = await getServerSession(authOptions)\r\n  if (!session) return { error: \"Unauthorized\" }\r\n\r\n  try {\r\n    // Enforce RBAC - no role-based bypasses\r\n    await requirePermission(parseInt(session.user.id), PERMISSIONS.ROLE.ASSIGN)\r\n  } catch (e) {\r\n    return { error: \"Permission denied\" }\r\n  }\r\n\r\n  try {\r\n    await prisma.userRole.deleteMany({\r\n      where: {\r\n        userId,\r\n        roleId,\r\n        scopeType: scopeType || null,\r\n        scopeId: scopeId || null,\r\n      },\r\n    })\r\n\r\n    // Clear permission cache\r\n    clearPermissionCache(userId, scopeId)\r\n\r\n    // Log activity\r\n    await logActivity({\r\n      actionType: \"role_removed\",\r\n      actionCategory: \"settings\",\r\n      actionSummary: `Role removed from user`,\r\n      actionDetails: {\r\n        userId,\r\n        roleId,\r\n        scopeType,\r\n        scopeId,\r\n      },\r\n      performedById: parseInt(session.user.id),\r\n      affectedUserId: userId,\r\n      entityType: \"role\",\r\n      entityId: roleId,\r\n    })\r\n\r\n    revalidatePath(\"/dashboard/admin/users\")\r\n    return { success: true }\r\n  } catch (e) {\r\n    console.error(e)\r\n    return { error: \"Failed to remove role\" }\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize default roles and permissions\r\n */\r\nexport async function initializeRBAC() {\r\n  try {\r\n    console.log(\"Initializing RBAC system...\")\r\n\r\n    // Create all permissions\r\n    const allPermissionKeys = getAllPermissions()\r\n    const permissionMap = new Map<string, number>()\r\n\r\n    for (const key of allPermissionKeys) {\r\n      const [module, ...actionParts] = key.split(\".\")\r\n      const action = actionParts.join(\".\")\r\n      const name = action.replace(/_/g, \" \").replace(/\\b\\w/g, l => l.toUpperCase())\r\n      const category = actionParts.length > 1 ? actionParts[0] : null\r\n\r\n      const permission = await prisma.permission.upsert({\r\n        where: { key },\r\n        update: {},\r\n        create: {\r\n          key,\r\n          name,\r\n          description: `Permission to ${action.replace(/_/g, \" \")}`,\r\n          module,\r\n          category,\r\n        },\r\n      })\r\n\r\n      permissionMap.set(key, permission.id)\r\n    }\r\n\r\n    console.log(`‚úÖ Created/updated ${permissionMap.size} permissions`)\r\n\r\n    // STEP 1: Delete ALL user role assignments first\r\n    const userRoleCount = await prisma.userRole.count()\r\n    if (userRoleCount > 0) {\r\n      console.log(`üóëÔ∏è  Removing ${userRoleCount} user role assignment(s)`)\r\n      await prisma.userRole.deleteMany({})\r\n      console.log(`‚úÖ Deleted all user role assignments`)\r\n    }\r\n\r\n    // STEP 2: Delete ALL role permissions\r\n    const rolePermissionCount = await prisma.rolePermission.count()\r\n    if (rolePermissionCount > 0) {\r\n      console.log(`üóëÔ∏è  Removing ${rolePermissionCount} role permission(s)`)\r\n      await prisma.rolePermission.deleteMany({})\r\n      console.log(`‚úÖ Deleted all role permissions`)\r\n    }\r\n\r\n    // STEP 3: Delete ALL existing roles (including system roles)\r\n    // First, explicitly delete old role names that shouldn't exist\r\n    const oldRoleNames = [\"Super Admin\", \"Project Admin\", \"Audit Admin\"]\r\n    for (const oldRoleName of oldRoleNames) {\r\n      const deleted = await prisma.role.deleteMany({\r\n        where: { name: oldRoleName },\r\n      })\r\n      if (deleted.count > 0) {\r\n        console.log(`üóëÔ∏è  Deleted old role: ${oldRoleName}`)\r\n      }\r\n    }\r\n\r\n    // Now delete ALL remaining roles\r\n    const existingRoleCount = await prisma.role.count()\r\n    if (existingRoleCount > 0) {\r\n      console.log(`üóëÔ∏è  Deleting ${existingRoleCount} remaining role(s)...`)\r\n      const deletedRoles = await prisma.role.deleteMany({})\r\n      console.log(`‚úÖ Deleted ${deletedRoles.count} role(s)`)\r\n      \r\n      // Verify deletion\r\n      const remainingRoles = await prisma.role.count()\r\n      if (remainingRoles > 0) {\r\n        console.log(`‚ö†Ô∏è  Warning: ${remainingRoles} role(s) still exist after deletion`)\r\n        const remaining = await prisma.role.findMany({ select: { id: true, name: true } })\r\n        console.log(`   Remaining roles: ${remaining.map(r => r.name).join(\", \")}`)\r\n      }\r\n    } else {\r\n      console.log(`‚ÑπÔ∏è  No existing roles to delete`)\r\n    }\r\n\r\n    // Create new default roles (all old roles have been deleted, so we use create)\r\n    for (const [roleKey, roleData] of Object.entries(DEFAULT_ROLES)) {\r\n      // Check if role already exists (shouldn't happen after delete, but just in case)\r\n      const existingRole = await prisma.role.findUnique({\r\n        where: { name: roleData.name },\r\n      })\r\n\r\n      let role\r\n      if (existingRole) {\r\n        // Update existing role if it somehow still exists\r\n        role = await prisma.role.update({\r\n          where: { id: existingRole.id },\r\n          data: {\r\n            description: roleData.description,\r\n            isSystemRole: roleData.isSystemRole,\r\n          },\r\n        })\r\n        // Clear existing permissions\r\n        await prisma.rolePermission.deleteMany({\r\n          where: { roleId: role.id },\r\n        })\r\n      } else {\r\n        // Create new role\r\n        role = await prisma.role.create({\r\n          data: {\r\n            name: roleData.name,\r\n            description: roleData.description,\r\n            isSystemRole: roleData.isSystemRole,\r\n          },\r\n        })\r\n      }\r\n\r\n      // Assign permissions to role\r\n      const permissionIds = roleData.permissions\r\n        .map(key => permissionMap.get(key))\r\n        .filter((id): id is number => id !== undefined)\r\n\r\n      // Remove existing permissions\r\n      await prisma.rolePermission.deleteMany({\r\n        where: { roleId: role.id },\r\n      })\r\n\r\n      // Add new permissions (SQLite doesn't support createMany with unique constraints)\r\n      if (permissionIds.length > 0) {\r\n        for (const permissionId of permissionIds) {\r\n          try {\r\n            await prisma.rolePermission.create({\r\n              data: {\r\n                roleId: role.id,\r\n                permissionId,\r\n              },\r\n            })\r\n          } catch (e: any) {\r\n            // Skip if already exists\r\n            if (e.code !== 'P2002') {\r\n              throw e\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      console.log(`‚úÖ Created/updated role: ${role.name} with ${permissionIds.length} permissions`)\r\n    }\r\n\r\n    console.log(\"‚úÖ RBAC initialization completed!\")\r\n    return { success: true }\r\n  } catch (error: any) {\r\n    console.error(\"‚ùå RBAC initialization failed:\", error)\r\n    return { error: error.message }\r\n  }\r\n}\r\n\r\n","export {getPublicSystemSettings as '0033db22356cbf8845a3517099b63dfc38d1147299'} from 'ACTIONS_MODULE0'\nexport {getAllProjectsUnreadNotificationCount as '00686a7231b739e4fe9b8305b757bc0e83827b9865'} from 'ACTIONS_MODULE1'\nexport {getAllProjectsNotifications as '4004a0aae390e2c1aeb900c79065f312ac43d90f8d'} from 'ACTIONS_MODULE1'\nexport {markProjectNotificationAsRead as '60691655a7ad6aec29ab9691d8571a0d380be93da1'} from 'ACTIONS_MODULE1'\nexport {getUsers as '0078a5996050e1da89a66893bd05780e75185392cb'} from 'ACTIONS_MODULE2'\nexport {createUser as '401fc4e21517ebfbd3eebabb3ac6ad3bf2fb7443a7'} from 'ACTIONS_MODULE2'\nexport {getUser as '406fd270e8a350e38c78e4b79321560707aa26fd1a'} from 'ACTIONS_MODULE2'\nexport {deleteUser as '40abdcd9a05b7e5b6a27a4efd7412defa3f340c60c'} from 'ACTIONS_MODULE2'\nexport {updateUserTeam as '6020ac488ab0f44300111f3a8024b04b647106d187'} from 'ACTIONS_MODULE2'\nexport {toggleUserStatus as '60b33fdd6fc55215f2569d47e96e5d33d33f4f707f'} from 'ACTIONS_MODULE2'\nexport {updateUser as '60e1fb0fb657783a6424ba7525af9dca8a6316a12b'} from 'ACTIONS_MODULE2'\nexport {getTeams as '000b6b4fc682f5b92871a66c0311a087451073067d'} from 'ACTIONS_MODULE3'\nexport {getAvailableProjects as '40220937dde4293d9f0bf5a425d05335bdc2930814'} from 'ACTIONS_MODULE3'\nexport {createTeam as '404302e6527c8c0424fe4e6a0812dd3f9ee5fad749'} from 'ACTIONS_MODULE3'\nexport {getTeamProjects as '40d262c653cb585b83ff6f03afb8a05a8f61e23a18'} from 'ACTIONS_MODULE3'\nexport {deleteTeam as '40e6475c1d47d2ff245175aefb8d73f5f7df5fad9c'} from 'ACTIONS_MODULE3'\nexport {getTeam as '40f8a92a189582ac7a7fcdf1ff304dbcf4401f1dc5'} from 'ACTIONS_MODULE3'\nexport {updateTeam as '60278acd0ffe289349b3e3387dd2813159632c358e'} from 'ACTIONS_MODULE3'\nexport {removeMemberFromTeam as '60b69acfa49cb854dd3912651668ce9af6d01a1527'} from 'ACTIONS_MODULE3'\nexport {removeProjectFromTeam as '60d6167c34faec1d09835a40e8132b96c1ee7a4ed0'} from 'ACTIONS_MODULE3'\nexport {addProjectToTeam as '60ef84a9ad667e7d49ef9c80bd8d94651b75e6268f'} from 'ACTIONS_MODULE3'\nexport {addMemberToTeam as '70cfe62d32831304d63f72a2766fa81478529867f3'} from 'ACTIONS_MODULE3'\nexport {logActivity as '40daa1d9c7314de4957a7669434db12aaa24630ba4'} from 'ACTIONS_MODULE4'\nexport {getRoles as '00315332eefe7e5ae034444c5aa3d0b43abd813c65'} from 'ACTIONS_MODULE5'\nexport {getPermissions as '004c2554a1592062d1a2d5dabdc6ce8941b8bf3a44'} from 'ACTIONS_MODULE5'\nexport {initializeRBAC as '00a7551eb825197a762c03325de2ebb2525343d67a'} from 'ACTIONS_MODULE5'\nexport {createRole as '4040b6468aa9508d1d4802a99825a53e6c660decfe'} from 'ACTIONS_MODULE5'\nexport {getRole as '4077386d824b9d6d8daac5a6f8bf4124f35c6f5f09'} from 'ACTIONS_MODULE5'\nexport {deleteRole as '40c034babb4ca926f97b6b4d48e79b952d57077416'} from 'ACTIONS_MODULE5'\nexport {updateRole as '605a370aec7719011993943417a0dd46a68cd1b815'} from 'ACTIONS_MODULE5'\nexport {removeRoleFromUser as '782b125d292e676b0aeedfa8f470593862cedc359d'} from 'ACTIONS_MODULE5'\nexport {assignRoleToUser as '787a1fbc130c3c6d92e3009448f9235df28bea0dee'} from 'ACTIONS_MODULE5'\nexport {createUser as '401fc4e21517ebfbd3eebabb3ac6ad3bf2fb7443a7'} from 'ACTIONS_MODULE2'\nexport {deleteUser as '40abdcd9a05b7e5b6a27a4efd7412defa3f340c60c'} from 'ACTIONS_MODULE2'\nexport {toggleUserStatus as '60b33fdd6fc55215f2569d47e96e5d33d33f4f707f'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":"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"}