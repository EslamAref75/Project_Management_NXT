module.exports=[199973,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(450246),e=a.i(915929),f=a.i(449597),g=a.i(114678),h=a.i(416219),i=a.i(893884),j=a.i(424150);function k(a,b,c){var d,e,f,g,h;let i,k,l=Object.assign({},(0,j.getDefaultOptions)()),m=(d=a,e=c.timeZone,f=c.locale??l.locale,new Intl.DateTimeFormat(f?[f.code,"en-US"]:void 0,{timeZone:e,timeZoneName:d}));return"formatToParts"in m?function(a,b){let c=a.formatToParts(b);for(let a=c.length-1;a>=0;--a)if("timeZoneName"===c[a].type)return c[a].value}(m,b):(g=m,h=b,i=g.format(h).replace(/\u200E/g,""),(k=/ [\w-+ ]+$/.exec(i))?k[0].substr(1):"")}let l={year:0,month:1,day:2,hour:3,minute:4,second:5},m={},n=new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),o="06/25/2014, 00:00:00"===n||"â€Ž06â€Ž/â€Ž25â€Ž/â€Ž2014â€Ž â€Ž00â€Ž:â€Ž00â€Ž:â€Ž00"===n;function p(a,b,c,d,e,f,g){let h=new Date(0);return h.setUTCFullYear(a,b,c),h.setUTCHours(d,e,f,g),h}let q=/^(Z)$/,r=/^([+-]\d{2})$/,s=/^([+-])(\d{2}):?(\d{2})$/;function t(a,b,c){let d,e;if(!a)return 0;let f=q.exec(a);if(f)return 0;if(f=r.exec(a))return v(d=parseInt(f[1],10))?-(36e5*d):NaN;if(f=s.exec(a)){d=parseInt(f[2],10);let a=parseInt(f[3],10);return v(d,a)?(e=36e5*Math.abs(d)+6e4*a,"+"===f[1]?-e:e):NaN}if(function(a){if(w[a])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:a}),w[a]=!0,!0}catch(a){return!1}}(a)){var g;b=new Date(b||Date.now());let d=u(c?b:p((g=b).getFullYear(),g.getMonth(),g.getDate(),g.getHours(),g.getMinutes(),g.getSeconds(),g.getMilliseconds()),a);return-(c?d:function(a,b,c){let d=a.getTime()-b,e=u(new Date(d),c);if(b===e)return b;let f=u(new Date(d-=e-b),c);return e===f?e:Math.max(e,f)}(b,d,a))}return NaN}function u(a,b){var c,d,e;let f,g,h,i=(m[c=b]||(m[c]=o?new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:c,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:c,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),"formatToParts"in(h=m[c])?function(a,b){try{let c=a.formatToParts(b),d=[];for(let a=0;a<c.length;a++){let b=l[c[a].type];void 0!==b&&(d[b]=parseInt(c[a].value,10))}return d}catch(a){if(a instanceof RangeError)return[NaN];throw a}}(h,a):(d=h,e=a,f=d.format(e),[parseInt((g=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(f))[3],10),parseInt(g[1],10),parseInt(g[2],10),parseInt(g[4],10),parseInt(g[5],10),parseInt(g[6],10)])),j=p(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),k=a.getTime(),n=k%1e3;return j-(k-=n>=0?n:1e3+n)}function v(a,b){return -23<=a&&a<=23&&(null==b||0<=b&&b<=59)}let w={},x={X:function(a,b,c){let d=y(c.timeZone,a);if(0===d)return"Z";switch(b){case"X":return B(d);case"XXXX":case"XX":return A(d);default:return A(d,":")}},x:function(a,b,c){let d=y(c.timeZone,a);switch(b){case"x":return B(d);case"xxxx":case"xx":return A(d);default:return A(d,":")}},O:function(a,b,c){let d=y(c.timeZone,a);switch(b){case"O":case"OO":case"OOO":return"GMT"+function(a,b=""){let c=a>0?"-":"+",d=Math.abs(a),e=Math.floor(d/60),f=d%60;return 0===f?c+String(e):c+String(e)+b+z(f,2)}(d,":");default:return"GMT"+A(d,":")}},z:function(a,b,c){switch(b){case"z":case"zz":case"zzz":return k("short",a,c);default:return k("long",a,c)}}};function y(a,b){let c=a?t(a,b,!0)/6e4:b?.getTimezoneOffset()??0;if(Number.isNaN(c))throw RangeError("Invalid time zone specified: "+a);return c}function z(a,b){let c=Math.abs(a).toString();for(;c.length<b;)c="0"+c;return(a<0?"-":"")+c}function A(a,b=""){let c=Math.abs(a);return(a>0?"-":"+")+z(Math.floor(c/60),2)+b+z(Math.floor(c%60),2)}function B(a,b){return a%60==0?(a>0?"-":"+")+z(Math.abs(a)/60,2):A(a,b)}function C(a){let b=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()));return b.setUTCFullYear(a.getFullYear()),a-b}let D=/^([0-9W+-]+)(T| )(.*)/,E=/^([0-9W+-]+)(.*)/,F=/^(\d{2})$/,G=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],H=/^(\d{4})/,I=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],J=/^-(\d{2})$/,K=/^-?(\d{3})$/,L=/^-?(\d{2})-?(\d{2})$/,M=/^-?W(\d{2})$/,N=/^-?W(\d{2})-?(\d{1})$/,O=/^(\d{2}([.,]\d*)?)$/,P=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,Q=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,R=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/;function S(a,b={}){if(arguments.length<1)throw TypeError("1 argument required, but only "+arguments.length+" present");if(null===a)return new Date(NaN);let c=null==b.additionalDigits?2:Number(b.additionalDigits);if(2!==c&&1!==c&&0!==c)throw RangeError("additionalDigits must be 0, 1 or 2");if(a instanceof Date||"object"==typeof a&&"[object Date]"===Object.prototype.toString.call(a))return new Date(a.getTime());if("number"==typeof a||"[object Number]"===Object.prototype.toString.call(a))return new Date(a);if("[object String]"!==Object.prototype.toString.call(a))return new Date(NaN);let d=function(a){let b,c={},d=D.exec(a);if(d?(c.date=d[1],b=d[3]):(d=E.exec(a))?(c.date=d[1],b=d[2]):(c.date=null,b=a),b){let a=R.exec(b);a?(c.time=b.replace(a[1],""),c.timeZone=a[1].trim()):c.time=b}return c}(a),{year:e,restDateString:f}=function(a,b){if(a){let c=G[b],d=I[b],e=H.exec(a)||d.exec(a);if(e){let b=e[1];return{year:parseInt(b,10),restDateString:a.slice(b.length)}}if(e=F.exec(a)||c.exec(a)){let b=e[1];return{year:100*parseInt(b,10),restDateString:a.slice(b.length)}}}return{year:null}}(d.date,c),g=function(a,b){let c,d,e;if(null===b)return null;if(!a||!a.length)return(c=new Date(0)).setUTCFullYear(b),c;let f=J.exec(a);if(f)return(c=new Date(0),X(b,d=parseInt(f[1],10)-1))?(c.setUTCFullYear(b,d),c):new Date(NaN);if(f=K.exec(a)){c=new Date(0);let a=parseInt(f[1],10);return!function(a,b){if(b<1)return!1;let c=W(a);return(!c||!(b>366))&&(!!c||!(b>365))}(b,a)?new Date(NaN):(c.setUTCFullYear(b,0,a),c)}if(f=L.exec(a)){c=new Date(0),d=parseInt(f[1],10)-1;let a=parseInt(f[2],10);return X(b,d,a)?(c.setUTCFullYear(b,d,a),c):new Date(NaN)}if(f=M.exec(a))return Y(e=parseInt(f[1],10)-1)?T(b,e):new Date(NaN);if(f=N.exec(a)){e=parseInt(f[1],10)-1;let a=parseInt(f[2],10)-1;return Y(e,a)?T(b,e,a):new Date(NaN)}return null}(f,e);if(null===g||isNaN(g.getTime())||!g)return new Date(NaN);{let a,c=g.getTime(),e=0;if(d.time&&(null===(e=function(a){let b,c,d=O.exec(a);if(d)return Z(b=parseFloat(d[1].replace(",",".")))?b%24*36e5:NaN;if(d=P.exec(a))return Z(b=parseInt(d[1],10),c=parseFloat(d[2].replace(",",".")))?b%24*36e5+6e4*c:NaN;if(d=Q.exec(a)){b=parseInt(d[1],10),c=parseInt(d[2],10);let a=parseFloat(d[3].replace(",","."));return Z(b,c,a)?b%24*36e5+6e4*c+1e3*a:NaN}return null}(d.time))||isNaN(e)))return new Date(NaN);if(d.timeZone||b.timeZone){if(isNaN(a=t(d.timeZone||b.timeZone,new Date(c+e))))return new Date(NaN)}else a=C(new Date(c+e)),a=C(new Date(c+e+a));return new Date(c+e+a)}}function T(a,b,c){b=b||0,c=c||0;let d=new Date(0);d.setUTCFullYear(a,0,4);let e=7*b+c+1-(d.getUTCDay()||7);return d.setUTCDate(d.getUTCDate()+e),d}let U=[31,28,31,30,31,30,31,31,30,31,30,31],V=[31,29,31,30,31,30,31,31,30,31,30,31];function W(a){return a%400==0||a%4==0&&a%100!=0}function X(a,b,c){if(b<0||b>11)return!1;if(null!=c){if(c<1)return!1;let d=W(a);if(d&&c>V[b]||!d&&c>U[b])return!1}return!0}function Y(a,b){return!(a<0)&&!(a>52)&&(null==b||!(b<0)&&!(b>6))}function Z(a,b,c){return!(a<0)&&!(a>=25)&&(null==b||!(b<0)&&!(b>=60))&&(null==c||!(c<0)&&!(c>=60))}let $=/([xXOz]+)|''|'(''|[^'])+('|$)/g;function _(a,b,c,d){var e;let f,g,h;return d={...d,timeZone:b,originalDate:a},function(a,b,c={}){let d=(b=String(b)).match($);if(d){let e=S(c.originalDate||a,c);b=d.reduce(function(a,b){if("'"===b[0])return a;let d=a.indexOf(b),f="'"===a[d-1],g=a.replace(b,"'"+x[b[0]](e,b,c)+"'");return f?g.substring(0,d-1)+g.substring(d+1):g},b)}return(0,i.format)(a,b,c)}((f=t(b,e=S(e=a,{timeZone:d.timeZone}),!0),g=new Date(e.getTime()-f),(h=new Date(0)).setFullYear(g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate()),h.setHours(g.getUTCHours(),g.getUTCMinutes(),g.getUTCSeconds(),g.getUTCMilliseconds()),h),c,d)}var aa=a.i(522734),ab=a.i(814747);let ac="Africa/Cairo",ad=ab.join(process.cwd(),".last-focus-reset");function ae(){return _(new Date,ac,"yyyy-MM-dd")}async function af(){try{let a=ae(),b=function(){try{if(!aa.existsSync(ad))return null;return aa.readFileSync(ad,"utf-8").trim()}catch{return null}}();if(!b)return!0;return b!==a}catch(a){return console.error("Error checking if reset needed:",a),!1}}async function ag(){try{let b=(0,g.startOfDay)(new Date),d=(0,h.endOfDay)(new Date),e=await c.prisma.task.findMany({where:{plannedDate:{gte:b,lte:d}},select:{id:!0}});e.length>0&&(await c.prisma.task.updateMany({where:{id:{in:e.map(a=>a.id)}},data:{plannedDate:null}}),await c.prisma.activityLog.create({data:{actionType:"system_reset_focus",actionCategory:"today_task",actionSummary:`Automatic daily reset cleared ${e.length} tasks from today's focus`,actionDetails:JSON.stringify({resetTime:new Date().toISOString(),cairoDate:ae(),tasksCleared:e.length,timezone:ac}),entityType:"system",entityId:0}}));var a=ae();try{aa.writeFileSync(ad,a,"utf-8")}catch(a){console.error("Failed to save reset date:",a)}return console.log(`âœ… Auto-reset: Cleared ${e.length} tasks from today's focus`),{success:!0,message:`Cleared ${e.length} tasks from today's focus`,tasksCleared:e.length}}catch(a){return console.error("clearAllUsersFocus Error:",a),{error:"Failed to clear all users' focus",details:a.message}}}async function ah(){try{if(await af()){let a=_(new Date,ac,"PPpp");console.log(`ðŸ”„ New day detected in Cairo timezone: ${a}`),console.log("Triggering automatic reset of today's focus..."),await ag()}}catch(a){console.error("Error in autoCheckAndReset:",a)}}async function ai(){try{if(process.env.DATABASE_URL)try{await ah()}catch(a){console.error("Auto-reset check failed (non-blocking):",a)}let a=await (0,d.getServerSession)(e.authOptions);if(!a)return console.error("getFocusData: No session"),{focusTasks:[],libraryTasks:[],error:"Unauthorized"};let b=parseInt(a.user.id),f=(0,g.startOfDay)(new Date),i=(0,h.endOfDay)(new Date),j=await c.prisma.task.findMany({where:{assignees:{some:{id:b}},plannedDate:{gte:f,lte:i},status:{not:"completed"}},select:{id:!0,title:!0,status:!0,priority:!0,estimatedHours:!0,project:{select:{name:!0}}},orderBy:{priority:"desc"}}),k=await c.prisma.task.findMany({where:{assignees:{some:{id:b}},status:{not:"completed"},OR:[{plannedDate:null},{plannedDate:{lt:f}},{plannedDate:{gt:i}}]},select:{id:!0,title:!0,status:!0,priority:!0,estimatedHours:!0,project:{select:{name:!0}}},orderBy:{updatedAt:"desc"}});return{focusTasks:j,libraryTasks:k}}catch(a){return console.error("getFocusData Error:",a),{focusTasks:[],libraryTasks:[],error:a.message}}}async function aj(a,b){if(!await (0,d.getServerSession)(e.authOptions))return{error:"Unauthorized"};try{return await c.prisma.task.update({where:{id:a},data:{plannedDate:b}}),(0,f.revalidatePath)("/dashboard/focus"),{success:!0}}catch(a){return{error:"Failed to update task"}}}async function ak(){let a=await (0,d.getServerSession)(e.authOptions);if(!a)return{error:"Unauthorized"};try{let b=parseInt(a.user.id),d=(0,g.startOfDay)(new Date),e=(0,h.endOfDay)(new Date),i=await c.prisma.task.findMany({where:{assignees:{some:{id:b}},plannedDate:{gte:d,lte:e}},select:{id:!0}});return i.length>0&&await c.prisma.task.updateMany({where:{id:{in:i.map(a=>a.id)}},data:{plannedDate:null}}),(0,f.revalidatePath)("/dashboard/focus"),{success:!0}}catch(a){return{error:"Failed to clear focus"}}}(0,a.i(287907).ensureServerEntryExports)([ai,aj,ak]),(0,b.registerServerReference)(ai,"007d5ef8e5bd6c6d8278ed033292d0ab70046d8135",null),(0,b.registerServerReference)(aj,"60b0af629419f8586c8423795027b3c794e41679cf",null),(0,b.registerServerReference)(ak,"00ad55c3850c3b3723d967a043bb948c065a439feb",null),a.s(["clearFocus",()=>ak,"getFocusData",()=>ai,"setFocusDate",()=>aj],199973)}];

//# sourceMappingURL=nxt_New%20folder_Project_Management_NXT_src_app_actions_focus_ts_a466daf3._.js.map