module.exports=[273054,a=>{"use strict";var b=a.i(555163);function c(a,...d){let e=b.constructFrom.bind(null,a||d.find(a=>"object"==typeof a));return d.map(e)}a.s(["normalizeDates",()=>c])},25254,a=>{"use strict";var b=a.i(194893);function c(a){let c=(0,b.toDate)(a),d=new Date(Date.UTC(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds()));return d.setUTCFullYear(c.getFullYear()),a-d}a.s(["getTimezoneOffsetInMilliseconds",()=>c])},269477,a=>{"use strict";var b=a.i(25254),c=a.i(273054),d=a.i(407716),e=a.i(114678);function f(a,f,g){let[h,i]=(0,c.normalizeDates)(g?.in,a,f),j=(0,e.startOfDay)(h),k=(0,e.startOfDay)(i);return Math.round((j-(0,b.getTimezoneOffsetInMilliseconds)(j)-(k-(0,b.getTimezoneOffsetInMilliseconds)(k)))/d.millisecondsInDay)}a.s(["differenceInCalendarDays",()=>f])},462266,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(450246),e=a.i(915929),f=a.i(661698),g=a.i(449597),h=a.i(126695),i=a.i(57693),j=a.i(766050),k=a.i(287907);let l=f.z.object({name:f.z.string().min(1,"Name is required"),type:f.z.string().optional(),projectTypeId:f.z.coerce.number().optional().nullable(),projectStatusId:f.z.coerce.number().optional().nullable(),description:f.z.string().optional(),scope:f.z.string().optional(),status:f.z.string().optional(),startDate:f.z.string().optional(),endDate:f.z.string().optional(),projectManagerId:f.z.coerce.number().optional()});async function m(){if(!await (0,d.getServerSession)(e.authOptions))throw Error("Unauthorized");return await c.prisma.project.findMany({orderBy:{createdAt:"desc"},select:{id:!0,name:!0,description:!0,status:!0,type:!0,projectStatusId:!0,projectTypeId:!0,projectManagerId:!0,startDate:!0,endDate:!0,createdAt:!0,createdById:!0,projectManager:{select:{id:!0,username:!0,email:!0,avatarUrl:!0}},_count:{select:{tasks:!0,projectUsers:!0,notifications:!0}}}})}async function n(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};let{search:f="",category:g=[],status:h=[],priority:j=[],startDate:k,endDate:l,projectManager:m,page:n=1,limit:o=12}=a;try{let a={};if(f&&(a.name={contains:f}),g.length>0&&(a.type={in:g}),h.length>0){let b=[],c=[];h.forEach(a=>{let d=parseInt(a);isNaN(d)?c.push(a):b.push(d)});let d=[];b.length>0&&d.push({projectStatusId:{in:b}});let e=c.filter(a=>"active"!==a&&"completed"!==a);e.length>0&&d.push({status:{in:e},projectStatusId:null}),c.includes("active")&&(d.push({status:"active"}),d.push({projectStatus:{isActive:!0}})),c.includes("completed")&&(d.push({status:"completed"}),d.push({projectStatus:{isFinal:!0}})),d.length>0&&(a.OR=d),j.length>0&&(a.priority={in:j})}if(k||l){let b=[];k&&b.push({startDate:{gte:new Date(k)}}),l&&b.push({endDate:{lte:new Date(l)}}),b.length>0&&(a.AND=[...a.AND||[],...b])}if(m&&(a.projectManagerId=parseInt(m)),!await (0,i.hasPermissionWithoutRoleBypass)(parseInt(b.user.id),"project.viewAll")){let c=[{projectManagerId:parseInt(b.user.id)},{createdById:parseInt(b.user.id)}];a.OR?(a.AND=[...a.AND||[],{OR:[...a.OR,...c]}],delete a.OR):a.OR=c}let[d,e]=await Promise.all([c.prisma.project.findMany({where:a,skip:(n-1)*o,take:o,orderBy:{createdAt:"desc"},select:{id:!0,name:!0,description:!0,status:!0,type:!0,projectStatusId:!0,projectTypeId:!0,projectManagerId:!0,startDate:!0,endDate:!0,createdAt:!0,createdById:!0,projectManager:{select:{id:!0,username:!0,email:!0,avatarUrl:!0}},_count:{select:{tasks:!0,projectUsers:!0,notifications:!0}}}}),c.prisma.project.count({where:a})]);return{success:!0,projects:d,total:e,page:n,limit:o}}catch(a){return console.error("Error fetching projects with filters:",a),{error:a.message||"Failed to fetch projects"}}}async function o(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if(!await (0,i.hasPermissionWithoutRoleBypass)(parseInt(b.user.id),j.PERMISSIONS.PROJECT.CREATE))return{error:"Permission denied: You don't have permission to create projects"};let f=a.get("name"),k=a.get("type"),m=a.get("projectTypeId"),n=a.get("description"),o=a.get("scope"),p=a.get("startDate"),q=a.get("endDate"),r=a.get("projectManagerId"),s=k||"";if(m)try{let a=await c.prisma.projectType.findUnique({where:{id:parseInt(m)},select:{name:!0}});a&&(s=a.name)}catch(a){console.error("Error fetching project type:",a)}let t=l.safeParse({name:f,type:s||void 0,projectTypeId:m?parseInt(m):null,description:n,scope:o,startDate:p,endDate:q,projectManagerId:r});if(!t.success)return console.error(t.error),{error:"Validation failed",details:t.error.format()};try{let a=await c.prisma.project.create({data:{name:t.data.name,type:t.data.type||"",projectTypeId:t.data.projectTypeId,description:t.data.description,scope:t.data.scope,status:t.data.status,startDate:t.data.startDate?new Date(t.data.startDate):null,endDate:t.data.endDate?new Date(t.data.endDate):null,projectManagerId:t.data.projectManagerId&&t.data.projectManagerId>0?t.data.projectManagerId:null,createdById:parseInt(b.user.id)}});try{await (0,h.logActivity)({actionType:"project_created",actionCategory:"project",actionSummary:`Project "${a.name}" created`,actionDetails:{projectId:a.id,projectName:a.name,projectType:a.type,status:a.status},performedById:parseInt(b.user.id),projectId:a.id,entityType:"project",entityId:a.id}),console.log("[Project Creation] Activity logging completed")}catch(a){console.error("[Project Creation] Failed to log activity:",a)}return(0,g.revalidatePath)("/dashboard/projects"),(0,g.revalidatePath)("/dashboard"),{success:!0}}catch(a){return console.error(a),{error:"Failed to create project"}}}async function p(a){if(!await (0,d.getServerSession)(e.authOptions))throw Error("Unauthorized");let[b,f,g]=await Promise.all([c.prisma.project.findUnique({where:{id:a},select:{id:!0,name:!0,description:!0,status:!0,type:!0,priority:!0,projectStatusId:!0,projectTypeId:!0,projectManagerId:!0,startDate:!0,endDate:!0,createdAt:!0,createdById:!0,urgentMarkedAt:!0,urgentMarkedById:!0,projectType:{select:{id:!0,name:!0}},projectStatus:{select:{id:!0,name:!0}},projectManager:{select:{id:!0,username:!0,email:!0,avatarUrl:!0}},urgentMarkedBy:{select:{id:!0,username:!0}},_count:{select:{tasks:!0,projectUsers:!0,projectTeams:!0}}}}),c.prisma.task.findMany({where:{projectId:a},orderBy:{createdAt:"desc"},select:{id:!0,title:!0,description:!0,status:!0,taskStatusId:!0,priority:!0,dueDate:!0,createdAt:!0,assignees:{select:{id:!0,username:!0,email:!0,avatarUrl:!0}},attachments:{select:{id:!0,fileName:!0,fileUrl:!0,fileType:!0,fileSize:!0}},dependencies:{select:{dependencyType:!0,dependsOnTaskId:!0,dependsOnTask:{select:{id:!0,title:!0,status:!0,taskStatusId:!0}}}}}}),c.prisma.projectTeam.findMany({where:{projectId:a},select:{id:!0,teamId:!0,team:{select:{id:!0,name:!0,description:!0,teamLead:{select:{id:!0,username:!0,email:!0,avatarUrl:!0}},members:{select:{id:!0,userId:!0,user:{select:{id:!0,username:!0,email:!0,avatarUrl:!0}}}}}}}})]);return b?{...b,tasks:f,projectTeams:g}:null}async function q(a,b){let f=await (0,d.getServerSession)(e.authOptions);if(!f)return{error:"Unauthorized"};let h=await c.prisma.project.findUnique({where:{id:a},select:{id:!0,createdById:!0}});if(!h)return{error:"Project not found"};let k=await (0,i.hasPermissionWithoutRoleBypass)(parseInt(f.user.id),j.PERMISSIONS.PROJECT.UPDATE,a),m=h.createdById===parseInt(f.user.id);if(!k&&!m)return{error:"Permission denied: You don't have permission to update this project"};let n=b.get("name"),o=b.get("type"),p=b.get("projectTypeId"),q=b.get("projectStatusId"),r=b.get("description"),s=b.get("scope"),t=b.get("status"),u=b.get("startDate"),v=b.get("endDate"),w=b.get("projectManagerId"),x=o||"";if(p)try{let a=await c.prisma.projectType.findUnique({where:{id:parseInt(p)},select:{name:!0}});a&&(x=a.name)}catch(a){console.error("Error fetching project type:",a)}let y=t||"";if(q&&c.prisma.projectStatus)try{let a=await c.prisma.projectStatus.findUnique({where:{id:parseInt(q)},select:{name:!0}});a&&(y=a.name)}catch(a){console.error("Error fetching project status:",a)}let z=l.safeParse({name:n,type:x||void 0,projectTypeId:p?parseInt(p):null,projectStatusId:q?parseInt(q):null,description:r,scope:s,status:y||void 0,startDate:u,endDate:v,projectManagerId:w});if(!z.success)return console.error(z.error),{error:"Validation failed",details:z.error.format()};try{return await c.prisma.project.update({where:{id:a},data:{name:z.data.name,type:z.data.type||"",projectTypeId:z.data.projectTypeId,projectStatusId:z.data.projectStatusId,description:z.data.description,scope:z.data.scope,status:y||z.data.status||"",startDate:z.data.startDate?new Date(z.data.startDate):null,endDate:z.data.endDate?new Date(z.data.endDate):null,projectManagerId:z.data.projectManagerId&&z.data.projectManagerId>0?z.data.projectManagerId:null}}),(0,g.revalidatePath)("/dashboard/projects"),(0,g.revalidatePath)(`/dashboard/projects/${a}`),(0,g.revalidatePath)("/dashboard"),{success:!0}}catch(a){return console.error(a),{error:"Failed to update project",details:a.message}}}async function r(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};let f=await c.prisma.project.findUnique({where:{id:a},select:{id:!0,createdById:!0,name:!0}});if(!f)return{error:"Project not found"};let h=await (0,i.hasPermissionWithoutRoleBypass)(parseInt(b.user.id),j.PERMISSIONS.PROJECT.DELETE,a),k=f.createdById===parseInt(b.user.id);if(!h&&!k)return{error:"Permission denied: You don't have permission to delete this project"};let l=await c.prisma.task.count({where:{projectId:a}});try{return await c.prisma.project.delete({where:{id:a}}),console.log(`Project ${a} deleted successfully${l>0?` along with ${l} task(s)`:""}`),(0,g.revalidatePath)("/dashboard/projects"),(0,g.revalidatePath)("/dashboard"),{success:!0}}catch(a){return console.error(a),{error:"Failed to delete project",details:a.message}}}(0,k.ensureServerEntryExports)([m,n,o,p,q,r]),(0,b.registerServerReference)(m,"003ae2a452e6e1e8ebee86f206a9903396d5df13b8",null),(0,b.registerServerReference)(n,"406144e6cbbfbe91083d4680cc56756da14a65698a",null),(0,b.registerServerReference)(o,"401e3f4be30a5d5dbee04214aa788c798e018c4c21",null),(0,b.registerServerReference)(p,"402c9fcdaf734573eeb364d1e92aac14ecf31bcfb9",null),(0,b.registerServerReference)(q,"601c00162e3e64028c2b657a9e3982df01dad141d5",null),(0,b.registerServerReference)(r,"40fdba31998d7a3efe7c944c688cf93002e917af7b",null),a.s(["createProject",()=>o,"deleteProject",()=>r,"getProject",()=>p,"getProjects",()=>m,"getProjectsWithFilters",()=>n,"updateProject",()=>q])},194893,407716,555163,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}a.s(["constructFromSymbol",0,b,"millisecondsInDay",0,864e5,"millisecondsInHour",0,36e5,"millisecondsInWeek",0,6048e5,"minutesInDay",0,1440,"minutesInMonth",0,43200],407716),a.s(["constructFrom",()=>c],555163),a.s(["toDate",()=>d],194893)},114678,a=>{"use strict";var b=a.i(194893);function c(a,c){let d=(0,b.toDate)(a,c?.in);return d.setHours(0,0,0,0),d}a.s(["startOfDay",()=>c])},416219,a=>{"use strict";var b=a.i(194893);function c(a,c){let d=(0,b.toDate)(a,c?.in);return d.setHours(23,59,59,999),d}a.s(["endOfDay",()=>c])},285839,443585,a=>{"use strict";var b=a.i(555163),c=a.i(194893);function d(a,d,e){let f=(0,c.toDate)(a,e?.in);return isNaN(d)?(0,b.constructFrom)(e?.in||a,NaN):(d&&f.setDate(f.getDate()+d),f)}function e(a,b,c){return d(a,-b,c)}a.s(["addDays",()=>d],443585),a.s(["subDays",()=>e],285839)},567435,a=>{"use strict";var b=a.i(194893);function c(a,c){let d=(0,b.toDate)(a,c?.in),e=d.getMonth();return d.setFullYear(d.getFullYear(),e+1,0),d.setHours(23,59,59,999),d}a.s(["endOfMonth",()=>c])},602076,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(450246),e=a.i(915929),f=a.i(443585),g=a.i(285839),h=a.i(273054),i=a.i(269477);function j(a,b){let c=a.getFullYear()-b.getFullYear()||a.getMonth()-b.getMonth()||a.getDate()-b.getDate()||a.getHours()-b.getHours()||a.getMinutes()-b.getMinutes()||a.getSeconds()-b.getSeconds()||a.getMilliseconds()-b.getMilliseconds();return c<0?-1:c>0?1:c}async function k(a){try{let b=await (0,d.getServerSession)(e.authOptions);if(!b||!b.user||!b.user.id)return{error:"Unauthorized"};let k=parseInt(b.user.id),l=b.user.role;if("project"===a.entityType){if(!a.entityId)return{error:"Project ID required"};let b=await c.prisma.project.findUnique({where:{id:a.entityId},select:{projectManagerId:!0}});if(!b)return{error:"Project not found"};if(b.projectManagerId!==k&&"admin"!==l&&"system_admin"!==l&&!await c.prisma.projectUser.findFirst({where:{projectId:a.entityId,userId:k}}))return{error:"Forbidden: You do not have access to this project"}}let{periodA:m}=a,n=new Date(m.start),o=new Date(m.end),p=function(a,b,c){let[d,e]=(0,h.normalizeDates)(void 0,a,b),f=j(d,e),g=Math.abs((0,i.differenceInCalendarDays)(d,e));d.setDate(d.getDate()-f*g);let k=Number(j(d,e)===-f),l=f*(g-k);return 0===l?0:l}(o,n)+1,q={start:(0,g.subDays)(n,p),end:(0,g.subDays)(n,1)},r={};"project"===a.entityType&&(r.projectId=a.entityId),"team"===a.entityType&&(r.teamId=a.entityId),"user"===a.entityType&&(r.assignees={some:{id:a.entityId}});let s=async a=>c.prisma.task.findMany({where:{...r,createdAt:{lte:a.end}},include:{dependencies:{include:{dependsOnTask:!0}},assignees:!0}}),[t,u]=await Promise.all([s({start:n,end:o}),s(q)]),v=(a,b)=>{let c=a.filter(a=>"completed"===a.status&&a.completedAt&&a.completedAt>=b.start&&a.completedAt<=b.end),d=c.reduce((a,b)=>a+b.estimatedHours,0),e=a.filter(a=>a.dueDate&&a.dueDate>=b.start&&a.dueDate<=b.end).length,f=e>0?c.length/e*100:0,g=a.filter(a=>"completed"!==a.status&&"cancelled"!==a.status),h=g.filter(a=>a.dependencies.some(a=>a.dependsOnTask&&"completed"!==a.dependsOnTask.status)),i=g.length>0?h.length/g.length*100:0,j=a.filter(a=>a.dueDate&&a.dueDate<b.end&&(!a.completedAt||a.completedAt>b.end)).length;return{velocity:d,completionRate:f,blockedRatio:i,overdueCount:j,activeTasks:g}},w=v(t,{start:n,end:o}),x=v(u,q),y=(a,b,c)=>{let d=a-b,e=0;0!==b?e=Math.round((a-b)/Math.abs(b)*100):0!==a&&(e=100);let f="neutral";return d>.1&&(f="up"),d<-.1&&(f="down"),{value:Math.round(10*a)/10,unit:c,trend:f,delta:Math.round(10*d)/10,percentChange:e}},z=[],A=t.filter(a=>a.dependencies.some(b=>{let c=b.dependsOnTask;return c&&c.completedAt&&a.plannedDate&&c.completedAt>a.plannedDate})).length;A>0&&z.push({name:"Dependency Delay",description:`${A} tasks were delayed by upstream dependencies.`,severity:A>3?"high":"medium",impactedKpis:["velocity","blockedRatio"],count:A});let B=t.filter(a=>"urgent"===a.priority&&a.createdAt>=m.start&&a.createdAt<=m.end);B.length>0&&z.push({name:"Urgent Task Load",description:`${B.length} urgent tasks disrupted the flow.`,severity:B.length>2?"high":"medium",impactedKpis:["velocity","completionRate"],count:B.length}),w.activeTasks.length;let C=w.activeTasks.reduce((a,b)=>a+b.estimatedHours,0),D=(w.velocity+x.velocity)/2,E=null,F=null,G=[],H=0;C>0&&(D>0?(E=C/D,F=(0,f.addDays)(new Date,Math.ceil(7*E))):(G.push("Zero velocity - cannot predict completion"),H+=5)),w.blockedRatio>10&&(G.push("High blocked ratio (>10%)"),H+=3),w.overdueCount>x.overdueCount&&(G.push("Growing overdue backlog"),H+=2);let I="low";return H>=3&&(I="medium"),H>=6&&(I="high"),{summary:{velocity:y(w.velocity,x.velocity,"hrs"),completionRate:y(w.completionRate,x.completionRate,"%"),blockedRatio:y(w.blockedRatio,x.blockedRatio,"%"),overdueTasks:y(w.overdueCount,x.overdueCount,"tasks"),overallRisk:I},causes:z,forecast:{predictedCompletionDate:F,weeksRemaining:E?Math.round(10*E)/10:null,riskLevel:I,confidenceScore:80*(D>0),riskFactors:G},actions:[]}}catch(a){return console.error("Error generating progress report:",a),{error:a.message||"Failed to generate report"}}}(0,a.i(287907).ensureServerEntryExports)([k]),(0,b.registerServerReference)(k,"40cb366c952aa9f33058dfcd245b147872e9dc1a09",null),a.s(["getProgressReport",()=>k],602076)},898299,a=>{"use strict";var b=a.i(962460),c=a.i(153544),d=a.i(184251),e=a.i(347656),f=a.i(450246),g=a.i(915929),h=a.i(114678),i=a.i(416219),j=a.i(285839),k=a.i(194893),l=a.i(567435),m=a.i(57693);async function n(){let a=await (0,f.getServerSession)(g.authOptions);if(!a)return[];try{let b={};return"admin"!==a.user.role&&(b.OR=[{projectManagerId:parseInt(a.user.id)},{createdById:parseInt(a.user.id)}]),await e.prisma.project.findMany({where:b,select:{id:!0,name:!0},orderBy:{name:"asc"}})}catch(a){return console.error("Error fetching projects:",a),[]}}async function o(a){var b;let c,d=await (0,f.getServerSession)(g.authOptions);if(!d)return{error:"Unauthorized"};let{dateRange:n}=a,o=n?.start||(b=new Date,(c=(0,k.toDate)(b,void 0)).setDate(1),c.setHours(0,0,0,0),c),p=n?.end||(0,l.endOfMonth)(new Date);try{let a={createdAt:{gte:o,lte:p}};"admin"!==d.user.role&&(a.OR=[{projectManagerId:parseInt(d.user.id)},{createdById:parseInt(d.user.id)}]);let[b,c,f,g]=await Promise.all([e.prisma.project.count({where:a}),e.prisma.project.count({where:{...a,status:"active"}}),e.prisma.project.count({where:{...a,status:"completed"}}),e.prisma.project.count({where:{...a,status:"on_hold"}})]),k=await (0,m.hasPermissionWithoutRoleBypass)(parseInt(d.user.id),"project.viewAll")?void 0:await e.prisma.project.findMany({where:{OR:[{projectManagerId:parseInt(d.user.id)},{createdById:parseInt(d.user.id)}]},select:{id:!0}}).then(a=>a.map(a=>a.id)),l={createdAt:{gte:o,lte:p}};void 0!==k&&(l.projectId={in:k});let[n,q,r,s,t]=await Promise.all([e.prisma.task.count({where:l}),e.prisma.task.count({where:{...l,status:{in:["pending","in_progress","review"]}}}),e.prisma.task.count({where:{...l,status:"completed"}}),e.prisma.task.count({where:{...l,OR:[{status:"waiting"},{dependencies:{some:{dependsOnTask:{status:{not:"completed"}}}}}]}}),e.prisma.task.count({where:{...l,dueDate:{lt:new Date},status:{not:"completed"}}})]),u=(0,h.startOfDay)(new Date),v=(0,i.endOfDay)(new Date),w={plannedDate:{gte:u,lte:v}};void 0!==k&&(w.projectId={in:k});let[x,y]=await Promise.all([e.prisma.task.count({where:w}),e.prisma.task.count({where:{...w,status:"completed"}})]),z=x>0?Math.round(y/x*100):0,A=[];for(let a=6;a>=0;a--){let b=(0,j.subDays)(new Date,a),c=(0,h.startOfDay)(b),d=(0,i.endOfDay)(b),f={createdAt:{gte:c,lte:d}};void 0!==k&&(f.projectId={in:k});let[g,l]=await Promise.all([e.prisma.task.count({where:f}),e.prisma.task.count({where:{...f,status:"completed"}})]);A.push({date:b.toISOString().split("T")[0],created:g,completed:l})}let B=await e.prisma.project.groupBy({by:["status"],where:a,_count:{id:!0}}),C=await e.prisma.task.groupBy({by:["status"],where:l,_count:{id:!0}});return{success:!0,data:{projects:{total:b,active:c,completed:f,onHold:g,statusDistribution:B.map(a=>({status:a.status,count:a._count.id}))},tasks:{total:n,open:q,completed:r,blocked:s,overdue:t,statusDistribution:C.map(a=>({status:a.status,count:a._count.id}))},todaysTasks:{total:x,completed:y,completionRate:z},weeklyTrend:A}}}catch(a){return console.error("Error fetching overview reports:",a),{error:a.message||"Failed to fetch overview reports"}}}async function p(a){let b=await (0,f.getServerSession)(g.authOptions);if(!b)return{error:"Unauthorized"};let{projectId:c,category:d,status:h,startDate:i,endDate:j,projectManagerId:k}=a;try{let a={};c&&(a.id=c),d&&d.length>0&&(a.type={in:d}),h&&h.length>0&&(a.status={in:h}),(i||j)&&(a.createdAt={},i&&(a.createdAt.gte=i),j&&(a.createdAt.lte=j)),k&&(a.projectManagerId=k),"admin"!==b.user.role&&(a.OR=[{projectManagerId:parseInt(b.user.id)},{createdById:parseInt(b.user.id)}]);let f=(await e.prisma.project.findMany({where:a,include:{tasks:{select:{id:!0,status:!0,dueDate:!0,dependencies:{select:{dependsOnTask:{select:{status:!0}}}}}},projectManager:{select:{id:!0,username:!0}}}})).map(a=>{let b=a.tasks||[],c=b.length,d=b.filter(a=>"completed"===a.status).length,e=c>0?Math.round(d/c*100):0,f=b.filter(a=>"waiting"===a.status||a.dependencies.some(a=>"completed"!==a.dependsOnTask.status)),g=b.filter(a=>a.dueDate&&new Date(a.dueDate)<new Date&&"completed"!==a.status);return{id:a.id,name:a.name,status:a.status,type:a.type,progress:e,totalTasks:c,completedTasks:d,blockedTasks:f.length,overdueTasks:g.length,projectManager:a.projectManager?.username||"Unassigned",startDate:a.startDate,endDate:a.endDate}});return{success:!0,data:f}}catch(a){return console.error("Error fetching project reports:",a),{error:a.message||"Failed to fetch project reports"}}}async function q(a){let b=await (0,f.getServerSession)(g.authOptions);if(!b)return{error:"Unauthorized"};let{projectId:c,assigneeId:d,status:h,priority:i,dependencyState:j,startDate:k,endDate:l}=a;try{let a={};if(c&&c.length>0&&(a.projectId={in:c}),d&&(a.assignees={some:{id:d}}),h&&h.length>0&&(a.status={in:h}),i&&i.length>0&&(a.priority={in:i}),j&&"all"!==j&&("blocked"===j?a.OR=[{status:"waiting"},{dependencies:{some:{dependsOnTask:{status:{not:"completed"}}}}}]:"free"===j?(a.dependencies={none:{}},a.status={not:"waiting"}):"blocking"===j&&(a.dependents={some:{}})),(k||l)&&(a.createdAt={},k&&(a.createdAt.gte=k),l&&(a.createdAt.lte=l)),"admin"!==b.user.role){let c=[{assignees:{some:{id:parseInt(b.user.id)}}},{createdById:parseInt(b.user.id)}];a.OR?(a.AND=[...a.AND||[],{OR:[...a.OR,...c]}],delete a.OR):a.OR=c}let f=await e.prisma.task.findMany({where:a,include:{project:{select:{id:!0,name:!0}},assignees:{select:{id:!0,username:!0}},dependencies:{include:{dependsOnTask:{select:{status:!0}}}}}}),g=f.length,m=f.reduce((a,b)=>(a[b.status]=(a[b.status]||0)+1,a),{}),n=f.reduce((a,b)=>(a[b.priority]=(a[b.priority]||0)+1,a),{}),o=f.filter(a=>"completed"===a.status).length,p=f.filter(a=>a.dueDate&&new Date(a.dueDate)<new Date&&"completed"!==a.status).length,q=f.filter(a=>"completed"===a.status&&a.updatedAt),r=q.length>0?q.reduce((a,b)=>{let c=new Date(b.createdAt).getTime(),d=new Date(b.updatedAt).getTime();return a+(d-c)},0)/q.length:0,s=f.filter(a=>"waiting"===a.status||a.dependencies.some(a=>"completed"!==a.dependsOnTask.status)).length;return{success:!0,data:{total:g,completed:o,overdue:p,blockedByDependencies:s,averageCompletionTime:r,byStatus:Object.entries(m).map(([a,b])=>({status:a,count:b})),byPriority:Object.entries(n).map(([a,b])=>({priority:a,count:b})),tasks:f.slice(0,100)}}}catch(a){return console.error("Error fetching task reports:",a),{error:a.message||"Failed to fetch task reports"}}}async function r(a){let b=await (0,f.getServerSession)(g.authOptions);if(!b)return{error:"Unauthorized"};let{date:c=new Date,userId:d,projectId:j}=a,k=(0,h.startOfDay)(c),l=(0,i.endOfDay)(c);try{let a={plannedDate:{gte:k,lte:l}};d?a.assignees={some:{id:d}}:"admin"!==b.user.role&&(a.assignees={some:{id:parseInt(b.user.id)}}),j&&(a.projectId=j);let f=await e.prisma.task.findMany({where:a,include:{project:{select:{id:!0,name:!0}},assignees:{select:{id:!0,username:!0}}}}),g=f.length,h=f.filter(a=>"completed"===a.status).length,i=g>0?Math.round(h/g*100):0,m=f.reduce((a,b)=>(b.assignees.forEach(c=>{a[c.id]||(a[c.id]={userId:c.id,username:c.username,total:0,completed:0}),a[c.id].total++,"completed"===b.status&&a[c.id].completed++}),a),{});return{success:!0,data:{date:c.toISOString().split("T")[0],total:g,completed:h,incomplete:g-h,completionRate:i,byUser:Object.values(m),tasks:f.map(a=>({id:a.id,title:a.title,status:a.status,priority:a.priority,project:a.project.name,assignees:a.assignees.map(a=>a.username)}))}}}catch(a){return console.error("Error fetching today's reports:",a),{error:a.message||"Failed to fetch today's reports"}}}async function s(a){let b=await (0,f.getServerSession)(g.authOptions);if(!b)return{error:"Unauthorized"};if("admin"!==b.user.role)return{error:"Unauthorized: Admin access required"};let{teamId:c,userId:d,projectId:h,startDate:i,endDate:j}=a;try{let a={};h&&(a.projectId=h),(i||j)&&(a.createdAt={},i&&(a.createdAt.gte=i),j&&(a.createdAt.lte=j)),d?a.assignees={some:{id:d}}:c&&(a.teamId=c);let b=await e.prisma.task.findMany({where:a,include:{assignees:{select:{id:!0,username:!0}},project:{select:{id:!0,name:!0}}}}),f={};return b.forEach(a=>{a.assignees.forEach(b=>{f[b.id]||(f[b.id]={userId:b.id,username:b.username,total:0,completed:0,overdue:0,blocked:0}),f[b.id].total++,"completed"===a.status&&f[b.id].completed++,a.dueDate&&new Date(a.dueDate)<new Date&&"completed"!==a.status&&f[b.id].overdue++,"waiting"===a.status&&f[b.id].blocked++})}),{success:!0,data:{users:Object.values(f).map(a=>({...a,completionRate:a.total>0?Math.round(a.completed/a.total*100):0,overdueRate:a.total>0?Math.round(a.overdue/a.total*100):0}))}}}catch(a){return console.error("Error fetching team/user reports:",a),{error:a.message||"Failed to fetch team/user reports"}}}async function t(a){let b=await (0,f.getServerSession)(g.authOptions);if(!b)return{error:"Unauthorized"};if("admin"!==b.user.role)return{error:"Unauthorized: Admin access required"};let{userId:c,actionType:d,entityType:h,startDate:i,endDate:j,page:k=1,limit:l=50}=a;try{let a={};c&&(a.performedById=c),d&&(a.actionType=d),h&&(a.entityType=h),(i||j)&&(a.createdAt={},i&&(a.createdAt.gte=i),j&&(a.createdAt.lte=j));let[b,f]=await Promise.all([e.prisma.activityLog.findMany({where:a,skip:(k-1)*l,take:l,orderBy:{createdAt:"desc"},include:{performedBy:{select:{id:!0,username:!0,email:!0}}}}),e.prisma.activityLog.count({where:a})]),g=await e.prisma.activityLog.groupBy({by:["actionType"],where:a,_count:{id:!0}});return{success:!0,data:{logs:b,total:f,page:k,limit:l,byActionType:g.map(a=>({actionType:a.actionType,count:a._count.id}))}}}catch(a){return console.error("Error fetching activity reports:",a),{error:a.message||"Failed to fetch activity reports"}}}(0,a.i(287907).ensureServerEntryExports)([n,o,p,q,r,s,t]),(0,d.registerServerReference)(n,"00da921d2d632ba7e89405e47535a513abac90089f",null),(0,d.registerServerReference)(o,"406484f4f706f63530be79074d5b12dcb1b385ded1",null),(0,d.registerServerReference)(p,"4098ad2bdd8073130c7e76c7023ab783f516d336a0",null),(0,d.registerServerReference)(q,"40e4bb39ff97cebfb3d7d51d275e06550fb05094b7",null),(0,d.registerServerReference)(r,"40fdf1940fc18692e48c4caf9673b19168e6cc2232",null),(0,d.registerServerReference)(s,"406e9d86129fdcaa2c59294a7d823ec24dad2dbb70",null),(0,d.registerServerReference)(t,"4027ee99637e70a11e6d008b17e9c6ade5d63f5e91",null);var u=a.i(462266),v=a.i(476662),w=a.i(602076);a.s([],86669),a.i(86669),a.s(["0033db22356cbf8845a3517099b63dfc38d1147299",()=>b.getPublicSystemSettings,"003ae2a452e6e1e8ebee86f206a9903396d5df13b8",()=>u.getProjects,"00686a7231b739e4fe9b8305b757bc0e83827b9865",()=>c.getAllProjectsUnreadNotificationCount,"0078a5996050e1da89a66893bd05780e75185392cb",()=>v.getUsers,"00da921d2d632ba7e89405e47535a513abac90089f",()=>n,"4004a0aae390e2c1aeb900c79065f312ac43d90f8d",()=>c.getAllProjectsNotifications,"4027ee99637e70a11e6d008b17e9c6ade5d63f5e91",()=>t,"406484f4f706f63530be79074d5b12dcb1b385ded1",()=>o,"406e9d86129fdcaa2c59294a7d823ec24dad2dbb70",()=>s,"4098ad2bdd8073130c7e76c7023ab783f516d336a0",()=>p,"40cb366c952aa9f33058dfcd245b147872e9dc1a09",()=>w.getProgressReport,"40e4bb39ff97cebfb3d7d51d275e06550fb05094b7",()=>q,"40fdf1940fc18692e48c4caf9673b19168e6cc2232",()=>r,"60691655a7ad6aec29ab9691d8571a0d380be93da1",()=>c.markProjectNotificationAsRead],898299)}];

//# sourceMappingURL=nxt_New%20folder_Project_Management_NXT_de292576._.js.map