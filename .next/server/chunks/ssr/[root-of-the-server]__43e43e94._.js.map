{"version":3,"sources":["turbopack:///[project]/nxt/New folder/Project_Management_NXT/node_modules/openid-client/package.json","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/lib/rbac-helpers.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/lib/rbac.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/lib/activity-logger.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/lib/permissions.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/constants.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/constructFrom.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/toDate.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/startOfDay.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/endOfDay.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/addDays.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/subDays.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/lib/stats.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/addWeeks.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/subWeeks.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/app/actions/project-priority.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/app/actions/dashboard.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/.next-internal/server/app/dashboard/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["{\"name\":\"openid-client\",\"version\":\"5.7.1\",\"description\":\"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs\",\"keywords\":[\"auth\",\"authentication\",\"basic\",\"certified\",\"client\",\"connect\",\"dynamic\",\"electron\",\"hybrid\",\"identity\",\"implicit\",\"oauth\",\"oauth2\",\"oidc\",\"openid\",\"passport\",\"relying party\",\"strategy\"],\"homepage\":\"https://github.com/panva/openid-client\",\"repository\":\"panva/openid-client\",\"funding\":{\"url\":\"https://github.com/sponsors/panva\"},\"license\":\"MIT\",\"author\":\"Filip Skokan <panva.ip@gmail.com>\",\"exports\":{\"types\":\"./types/index.d.ts\",\"import\":\"./lib/index.mjs\",\"require\":\"./lib/index.js\"},\"main\":\"./lib/index.js\",\"types\":\"./types/index.d.ts\",\"files\":[\"lib\",\"types/index.d.ts\"],\"scripts\":{\"format\":\"npx prettier --loglevel silent --write ./lib ./test ./certification ./types\",\"test\":\"mocha test/**/*.test.js\"},\"dependencies\":{\"jose\":\"^4.15.9\",\"lru-cache\":\"^6.0.0\",\"object-hash\":\"^2.2.0\",\"oidc-token-hash\":\"^5.0.3\"},\"devDependencies\":{\"@types/node\":\"^16.18.106\",\"@types/passport\":\"^1.0.16\",\"base64url\":\"^3.0.1\",\"chai\":\"^4.5.0\",\"mocha\":\"^10.7.3\",\"nock\":\"^13.5.5\",\"prettier\":\"^2.8.8\",\"readable-mock-req\":\"^0.2.2\",\"sinon\":\"^9.2.4\",\"timekeeper\":\"^2.3.1\"},\"standard-version\":{\"scripts\":{\"postchangelog\":\"sed -i '' -e 's/### \\\\[/## [/g' CHANGELOG.md\"},\"types\":[{\"type\":\"feat\",\"section\":\"Features\"},{\"type\":\"fix\",\"section\":\"Fixes\"},{\"type\":\"chore\",\"hidden\":true},{\"type\":\"docs\",\"hidden\":true},{\"type\":\"style\",\"hidden\":true},{\"type\":\"refactor\",\"section\":\"Refactor\",\"hidden\":false},{\"type\":\"perf\",\"section\":\"Performance\",\"hidden\":false},{\"type\":\"test\",\"hidden\":true}]}}","/**\r\n * RBAC Helper Functions - Proper Authorization Without Role Bypasses\r\n * \r\n * These functions ensure that all permission checks go through the RBAC system,\r\n * preventing authorization bypasses from legacy role-based checks.\r\n */\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { hasPermission, clearPermissionCache } from \"@/lib/rbac\"\r\n\r\n/**\r\n * Custom error classes for authorization\r\n */\r\nexport class UnauthorizedError extends Error {\r\n  constructor(message: string, public code: string = \"UNAUTHORIZED\") {\r\n    super(message)\r\n    this.name = \"UnauthorizedError\"\r\n  }\r\n}\r\n\r\nexport class ForbiddenError extends Error {\r\n  constructor(message: string, public code: string = \"FORBIDDEN\") {\r\n    super(message)\r\n    this.name = \"ForbiddenError\"\r\n  }\r\n}\r\n\r\nexport class NotFoundError extends Error {\r\n  constructor(message: string, public code: string = \"NOT_FOUND\") {\r\n    super(message)\r\n    this.name = \"NotFoundError\"\r\n  }\r\n}\r\n\r\n/**\r\n * Require specific permission - throws UnauthorizedError if denied\r\n * This is the ONLY way to check permissions - no role-based bypasses\r\n *\r\n * @param userId - User ID to check\r\n * @param permission - Permission key (e.g., \"project.delete\")\r\n * @param projectId - Optional project ID for resource-scoped permissions\r\n * @throws UnauthorizedError if permission denied\r\n *\r\n * @example\r\n * await requirePermission(userId, \"project.delete\", projectId)\r\n */\r\nexport async function requirePermission(\r\n  userId: number,\r\n  permission: string,\r\n  projectId?: number\r\n): Promise<void> {\r\n  // Check permission through RBAC system ONLY\r\n  // No role checks, no bypasses\r\n  const allowed = await hasPermissionWithoutRoleBypass(userId, permission, projectId)\r\n\r\n  if (!allowed) {\r\n    throw new UnauthorizedError(`Permission denied: ${permission}`, \"PERMISSION_DENIED\")\r\n  }\r\n}\r\n\r\n/**\r\n * Require any of multiple permissions\r\n * Throws error if user has none of them\r\n *\r\n * @param userId - User ID\r\n * @param permissions - Array of permission keys\r\n * @param projectId - Optional project ID\r\n * @throws UnauthorizedError if all permissions denied\r\n */\r\nexport async function requireAnyPermission(\r\n  userId: number,\r\n  permissions: string[],\r\n  projectId?: number\r\n): Promise<void> {\r\n  // Check if user has at least one permission\r\n  for (const permission of permissions) {\r\n    const allowed = await hasPermissionWithoutRoleBypass(userId, permission, projectId)\r\n    if (allowed) return\r\n  }\r\n\r\n  throw new UnauthorizedError(\r\n    `Permission denied: requires one of [${permissions.join(\", \")}]`,\r\n    \"PERMISSION_DENIED\"\r\n  )\r\n}\r\n\r\n/**\r\n * Check permission WITHOUT role-based bypasses\r\n * This is the core RBAC check - pure permission system\r\n *\r\n * @param userId - User ID\r\n * @param permission - Permission key\r\n * @param projectId - Optional project ID\r\n * @returns true if user has the permission\r\n */\r\nexport async function hasPermissionWithoutRoleBypass(\r\n  userId: number,\r\n  permission: string,\r\n  projectId?: number\r\n): Promise<boolean> {\r\n  // Check through RBAC system only\r\n  // The old hasPermission() function had bypasses for admin role\r\n  // We use a pure RBAC check here\r\n\r\n  try {\r\n    // Get user's roles and their permissions\r\n    const userRoles = await prisma.userRole.findMany({\r\n      where: {\r\n        userId,\r\n        OR: [\r\n          { scopeType: null }, // Global roles\r\n          { scopeType: \"global\" },\r\n          ...(projectId ? [{ scopeType: \"project\", scopeId: projectId }] : []),\r\n        ],\r\n      },\r\n      include: {\r\n        role: {\r\n          include: {\r\n            permissions: {\r\n              include: {\r\n                permission: true,\r\n              },\r\n            },\r\n          },\r\n        },\r\n      },\r\n    })\r\n\r\n    // Check if any role has the permission\r\n    for (const userRole of userRoles) {\r\n      for (const rolePermission of userRole.role.permissions) {\r\n        if (rolePermission.permission.key === permission) {\r\n          return true\r\n        }\r\n      }\r\n    }\r\n\r\n    return false\r\n  } catch (error) {\r\n    console.error(`Error checking permission ${permission} for user ${userId}:`, error)\r\n    // Fail secure - deny access on error\r\n    return false\r\n  }\r\n}\r\n\r\n/**\r\n * Verify user can access a project with specific permission\r\n * Throws error if project doesn't exist or user lacks permission\r\n *\r\n * @param userId - User ID\r\n * @param projectId - Project ID\r\n * @param permission - Permission key (e.g., \"project.delete\")\r\n * @throws NotFoundError if project doesn't exist\r\n * @throws UnauthorizedError if permission denied\r\n */\r\nexport async function verifyProjectAccess(\r\n  userId: number,\r\n  projectId: number,\r\n  permission: string\r\n): Promise<void> {\r\n  // 1. Verify project exists\r\n  const project = await prisma.project.findUnique({\r\n    where: { id: projectId },\r\n    select: { id: true },\r\n  })\r\n\r\n  if (!project) {\r\n    throw new NotFoundError(`Project ${projectId} not found`)\r\n  }\r\n\r\n  // 2. Check permission through RBAC (no bypasses)\r\n  const allowed = await hasPermissionWithoutRoleBypass(userId, permission, projectId)\r\n\r\n  if (!allowed) {\r\n    throw new UnauthorizedError(\r\n      `You don't have permission to ${permission} on this project`,\r\n      \"PROJECT_ACCESS_DENIED\"\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * Verify user can access a task with specific permission\r\n * Throws error if task doesn't exist or user lacks permission\r\n *\r\n * @param userId - User ID\r\n * @param taskId - Task ID\r\n * @param permission - Permission key (e.g., \"task.update\")\r\n * @throws NotFoundError if task doesn't exist\r\n * @throws UnauthorizedError if permission denied\r\n */\r\nexport async function verifyTaskAccess(\r\n  userId: number,\r\n  taskId: number,\r\n  permission: string\r\n): Promise<void> {\r\n  // 1. Get task and its project\r\n  const task = await prisma.task.findUnique({\r\n    where: { id: taskId },\r\n    select: {\r\n      id: true,\r\n      projectId: true,\r\n    },\r\n  })\r\n\r\n  if (!task) {\r\n    throw new NotFoundError(`Task ${taskId} not found`)\r\n  }\r\n\r\n  // 2. Check permission on the project\r\n  // Tasks are scoped to projects, so we check project-level permissions\r\n  const allowed = await hasPermissionWithoutRoleBypass(userId, permission, task.projectId)\r\n\r\n  if (!allowed) {\r\n    throw new UnauthorizedError(\r\n      `You don't have permission to ${permission} on this task`,\r\n      \"TASK_ACCESS_DENIED\"\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * Verify user is project owner/creator\r\n * Used for operations that should only be available to the creator\r\n *\r\n * @param userId - User ID\r\n * @param projectId - Project ID\r\n * @throws NotFoundError if project doesn't exist\r\n * @throws UnauthorizedError if not the creator\r\n */\r\nexport async function verifyProjectOwner(userId: number, projectId: number): Promise<void> {\r\n  const project = await prisma.project.findUnique({\r\n    where: { id: projectId },\r\n    select: { id: true, createdById: true },\r\n  })\r\n\r\n  if (!project) {\r\n    throw new NotFoundError(`Project ${projectId} not found`)\r\n  }\r\n\r\n  if (project.createdById !== userId) {\r\n    throw new UnauthorizedError(`You are not the owner of this project`, \"NOT_OWNER\")\r\n  }\r\n}\r\n\r\n/**\r\n * Check if user is admin through RBAC (has admin role in system)\r\n * Does NOT grant automatic permissions - must still check individual permissions\r\n *\r\n * @param userId - User ID\r\n * @returns true if user has the \"admin\" role\r\n * @deprecated - Use specific permission checks instead\r\n */\r\nexport async function isAdminUser(userId: number): Promise<boolean> {\r\n  const adminRole = await prisma.userRole.findFirst({\r\n    where: {\r\n      userId,\r\n      role: {\r\n        name: \"admin\",\r\n      },\r\n    },\r\n  })\r\n\r\n  return !!adminRole\r\n}\r\n\r\n/**\r\n * Clear permission cache when user roles change\r\n * Must be called after updating user permissions/roles\r\n *\r\n * @param userId - User ID whose cache to clear\r\n * @param projectId - Optional project ID for project-scoped changes\r\n */\r\nexport function invalidateUserPermissionCache(userId: number, projectId?: number): void {\r\n  clearPermissionCache(userId, projectId)\r\n}\r\n\r\n/**\r\n * Clear all permission caches (use sparingly)\r\n */\r\nexport function invalidateAllPermissionCaches(): void {\r\n  clearPermissionCache(0, undefined) // This clears all caches\r\n}\r\n\r\n/**\r\n * Handle authorization errors in server actions\r\n *\r\n * @param error - Error thrown during authorization\r\n * @returns Response object with error details\r\n *\r\n * @example\r\n * try {\r\n *   await requirePermission(userId, 'project.delete')\r\n * } catch (error) {\r\n *   return handleAuthorizationError(error)\r\n * }\r\n */\r\nexport function handleAuthorizationError(\r\n  error: unknown\r\n): { error: string; code: string; status: number; success: false } {\r\n  if (error instanceof UnauthorizedError) {\r\n    return { error: error.message, code: error.code, status: 403, success: false }\r\n  }\r\n\r\n  if (error instanceof ForbiddenError) {\r\n    return { error: error.message, code: error.code, status: 403, success: false }\r\n  }\r\n\r\n  if (error instanceof NotFoundError) {\r\n    return { error: error.message, code: error.code, status: 404, success: false }\r\n  }\r\n\r\n  console.error(\"Unknown authorization error:\", error)\r\n  return {\r\n    error: \"Authorization failed\",\r\n    code: \"AUTHORIZATION_ERROR\",\r\n    status: 500,\r\n    success: false\r\n  }\r\n}\r\n","/**\r\n * RBAC Permission Checking Utilities\r\n */\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { PERMISSIONS } from \"./permissions\"\r\n\r\n/**\r\n * Cache for user permissions (in-memory, can be replaced with Redis in production)\r\n */\r\nconst permissionCache = new Map<string, { permissions: string[], expiresAt: number }>()\r\n\r\nconst CACHE_TTL = 5 * 60 * 1000 // 5 minutes\r\n\r\n/**\r\n * Get all permissions for a user (with caching)\r\n */\r\nexport async function getUserPermissions(\r\n  userId: number,\r\n  projectId?: number\r\n): Promise<string[]> {\r\n  const cacheKey = `${userId}:${projectId || \"global\"}`\r\n  const cached = permissionCache.get(cacheKey)\r\n  \r\n  if (cached && cached.expiresAt > Date.now()) {\r\n    return cached.permissions\r\n  }\r\n\r\n  // Get all user roles (global and project-scoped)\r\n  const userRoles = await prisma.userRole.findMany({\r\n    where: {\r\n      userId,\r\n      OR: [\r\n        { scopeType: null }, // Global roles\r\n        { scopeType: \"global\" },\r\n        ...(projectId ? [{ scopeType: \"project\", scopeId: projectId }] : []),\r\n      ],\r\n    },\r\n    include: {\r\n      role: {\r\n        include: {\r\n          permissions: {\r\n            include: {\r\n              permission: true,\r\n            },\r\n          },\r\n        },\r\n      },\r\n    },\r\n  })\r\n\r\n  // Collect all unique permissions\r\n  const permissionSet = new Set<string>()\r\n  \r\n  for (const userRole of userRoles) {\r\n    for (const rolePermission of userRole.role.permissions) {\r\n      permissionSet.add(rolePermission.permission.key)\r\n    }\r\n  }\r\n\r\n  const permissions = Array.from(permissionSet)\r\n\r\n  // Cache the result\r\n  permissionCache.set(cacheKey, {\r\n    permissions,\r\n    expiresAt: Date.now() + CACHE_TTL,\r\n  })\r\n\r\n  return permissions\r\n}\r\n\r\n/**\r\n * Check if user has a specific permission\r\n * ⚠️ DEPRECATED - This function has role-based bypasses\r\n * Use hasPermissionWithoutRoleBypass() from rbac-helpers.ts instead\r\n * \r\n * @deprecated - Use hasPermissionWithoutRoleBypass() for new code\r\n */\r\nexport async function hasPermission(\r\n  userId: number,\r\n  permission: string,\r\n  projectId?: number\r\n): Promise<boolean> {\r\n  // Legacy implementation with bypasses - kept for backward compatibility only\r\n  // DO NOT USE IN NEW CODE - this bypasses RBAC\r\n  const user = await prisma.user.findUnique({\r\n    where: { id: userId },\r\n    select: { role: true },\r\n  })\r\n\r\n  // ⚠️ LEGACY BYPASS - Should not exist in new code\r\n  if (user?.role === \"admin\" || user?.role === \"project_manager\") {\r\n    return true\r\n  }\r\n\r\n  // Check RBAC permissions\r\n  const permissions = await getUserPermissions(userId, projectId)\r\n  return permissions.includes(permission)\r\n}\r\n\r\n/**\r\n * ⛔ DEPRECATED - DO NOT USE\r\n * This function allows legacy role-based bypass of RBAC permissions\r\n * Use hasPermissionWithoutRoleBypass() from rbac-helpers.ts instead\r\n */\r\nexport async function hasPermissionOrRole(\r\n  userId: number,\r\n  permission: string,\r\n  allowedLegacyRoles: string[] = [\"admin\", \"project_manager\"],\r\n  projectId?: number\r\n): Promise<boolean> {\r\n  console.warn(\r\n    \"[RBAC] DEPRECATED: hasPermissionOrRole() called. Use hasPermissionWithoutRoleBypass() instead.\"\r\n  )\r\n  throw new Error(\r\n    \"hasPermissionOrRole is deprecated and must be replaced with hasPermissionWithoutRoleBypass(). \" +\r\n    \"This function bypasses RBAC security controls. See rbac-helpers.ts for proper authorization.\"\r\n  )\r\n}\r\n\r\n/**\r\n * Check if user has any of the specified permissions\r\n */\r\nexport async function hasAnyPermission(\r\n  userId: number,\r\n  permissions: string[],\r\n  projectId?: number\r\n): Promise<boolean> {\r\n  const userPermissions = await getUserPermissions(userId, projectId)\r\n  return permissions.some(perm => userPermissions.includes(perm))\r\n}\r\n\r\n/**\r\n * Check if user has all of the specified permissions\r\n */\r\nexport async function hasAllPermissions(\r\n  userId: number,\r\n  permissions: string[],\r\n  projectId?: number\r\n): Promise<boolean> {\r\n  const userPermissions = await getUserPermissions(userId, projectId)\r\n  return permissions.every(perm => userPermissions.includes(perm))\r\n}\r\n\r\n/**\r\n * Get user roles\r\n */\r\nexport async function getUserRoles(\r\n  userId: number,\r\n  projectId?: number\r\n): Promise<Array<{ role: any, scopeType: string | null, scopeId: number | null }>> {\r\n  const userRoles = await prisma.userRole.findMany({\r\n    where: {\r\n      userId,\r\n      OR: [\r\n        { scopeType: null },\r\n        { scopeType: \"global\" },\r\n        ...(projectId ? [{ scopeType: \"project\", scopeId: projectId }] : []),\r\n      ],\r\n    },\r\n    include: {\r\n      role: true,\r\n    },\r\n  })\r\n\r\n  return userRoles.map(ur => ({\r\n    role: ur.role,\r\n    scopeType: ur.scopeType,\r\n    scopeId: ur.scopeId,\r\n  }))\r\n}\r\n\r\n/**\r\n * Check if user has a specific role\r\n */\r\nexport async function hasRole(\r\n  userId: number,\r\n  roleName: string,\r\n  projectId?: number\r\n): Promise<boolean> {\r\n  const roles = await getUserRoles(userId, projectId)\r\n  return roles.some(r => r.role.name === roleName)\r\n}\r\n\r\n/**\r\n * Clear permission cache for a user\r\n */\r\nexport function clearPermissionCache(userId: number, projectId?: number) {\r\n  const cacheKey = `${userId}:${projectId || \"global\"}`\r\n  permissionCache.delete(cacheKey)\r\n}\r\n\r\n/**\r\n * Clear all permission caches\r\n */\r\nexport function clearAllPermissionCaches() {\r\n  permissionCache.clear()\r\n}\r\n\r\n/**\r\n * Require permission - throws error if user doesn't have permission\r\n */\r\nexport async function requirePermission(\r\n  userId: number,\r\n  permission: string,\r\n  projectId?: number\r\n): Promise<void> {\r\n  const has = await hasPermission(userId, permission, projectId)\r\n  if (!has) {\r\n    throw new Error(`Permission denied: ${permission}`)\r\n  }\r\n}\r\n\r\n/**\r\n * Require any permission - throws error if user doesn't have any of the permissions\r\n */\r\nexport async function requireAnyPermission(\r\n  userId: number,\r\n  permissions: string[],\r\n  projectId?: number\r\n): Promise<void> {\r\n  const has = await hasAnyPermission(userId, permissions, projectId)\r\n  if (!has) {\r\n    throw new Error(`Permission denied: requires one of [${permissions.join(\", \")}]`)\r\n  }\r\n}\r\n\r\n","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { headers } from \"next/headers\"\r\n\r\nexport type ActionCategory =\r\n  | \"auth\"\r\n  | \"project\"\r\n  | \"task\"\r\n  | \"dependency\"\r\n  | \"settings\"\r\n  | \"notification\"\r\n  | \"today_task\"\r\n\r\nexport type ActionType =\r\n  // Auth\r\n  | \"user_login\"\r\n  | \"user_logout\"\r\n  | \"login_failed\"\r\n  | \"role_changed\"\r\n  | \"user_activated\"\r\n  | \"user_suspended\"\r\n  // RBAC\r\n  | \"role_created\"\r\n  | \"role_updated\"\r\n  | \"role_deleted\"\r\n  | \"role_assigned\"\r\n  | \"role_removed\"\r\n  // Project\r\n  | \"project_created\"\r\n  | \"project_updated\"\r\n  | \"project_archived\"\r\n  | \"project_manager_changed\"\r\n  | \"team_member_added\"\r\n  | \"team_member_removed\"\r\n  | \"project_settings_changed\"\r\n  | \"project_marked_urgent\"\r\n  | \"project_urgent_acknowledged\"\r\n  | \"project_urgent_removed\"\r\n  | \"project_assigned_to_team\"\r\n  | \"project_removed_from_team\"\r\n  | \"file_uploaded\"\r\n  | \"file_downloaded\"\r\n  | \"file_deleted\"\r\n  // Team\r\n  | \"team_created\"\r\n  | \"team_updated\"\r\n  | \"team_deleted\"\r\n  // Task\r\n  | \"task_created\"\r\n  | \"task_updated\"\r\n  | \"task_deleted\"\r\n  | \"task_assigned\"\r\n  | \"task_reassigned\"\r\n  | \"task_status_changed\"\r\n  | \"task_status_updated\"\r\n  | \"task_priority_changed\"\r\n  | \"subtask_created\"\r\n  | \"subtask_updated\"\r\n  | \"subtask_completed\"\r\n  // Dependency\r\n  | \"dependency_added\"\r\n  | \"dependency_removed\"\r\n  | \"task_blocked\"\r\n  | \"task_unblocked\"\r\n  // Today's Tasks\r\n  | \"today_task_assigned\"\r\n  | \"today_task_modified\"\r\n  | \"today_task_removed\"\r\n  | \"auto_carryover_executed\"\r\n  // Settings\r\n  | \"global_settings_updated\"\r\n  | \"project_settings_updated\"\r\n  | \"user_settings_updated\"\r\n  | \"project_type_created\"\r\n  | \"project_type_updated\"\r\n  | \"project_type_deleted\"\r\n  | \"project_type_toggled\"\r\n  | \"project_status_created\"\r\n  | \"project_status_updated\"\r\n  | \"project_status_deleted\"\r\n  | \"project_status_toggled\"\r\n  | \"project_statuses_reordered\"\r\n  | \"task_status_created\"\r\n  | \"task_status_updated\"\r\n  | \"task_status_deleted\"\r\n  | \"task_status_toggled\"\r\n  | \"task_statuses_reordered\"\r\n  // Notifications\r\n  | \"notification_settings_changed\"\r\n  | \"admin_override_executed\"\r\n  | \"manual_unblock\"\r\n\r\ninterface LogActivityParams {\r\n  actionType: ActionType\r\n  actionCategory: ActionCategory\r\n  actionSummary: string\r\n  actionDetails?: Record<string, any>\r\n  performedById: number\r\n  affectedUserId?: number\r\n  projectId?: number\r\n  entityType?: string\r\n  entityId?: number\r\n  ipAddress?: string\r\n  userAgent?: string\r\n}\r\n\r\n/**\r\n * Log an activity to the activity log\r\n * This function should be called after any important action\r\n */\r\nexport async function logActivity(params: LogActivityParams): Promise<void> {\r\n  console.log(\"[ActivityLogger] ====== START LOGGING ======\")\r\n  console.log(\"[ActivityLogger] Received params:\", JSON.stringify(params, null, 2))\r\n\r\n  try {\r\n    // Sanitize actionDetails to remove sensitive information\r\n    const sanitizedDetails = sanitizeActionDetails(params.actionDetails || {})\r\n\r\n    console.log(\"[ActivityLogger] Sanitized details:\", JSON.stringify(sanitizedDetails, null, 2))\r\n    console.log(\"[ActivityLogger] Logging activity:\", {\r\n      actionType: params.actionType,\r\n      actionCategory: params.actionCategory,\r\n      actionSummary: params.actionSummary,\r\n      performedById: params.performedById,\r\n    })\r\n\r\n    // Try to create with new schema first\r\n    try {\r\n      const result = await prisma.activityLog.create({\r\n        data: {\r\n          actionType: params.actionType,\r\n          actionCategory: params.actionCategory,\r\n          actionSummary: params.actionSummary,\r\n          actionDetails: Object.keys(sanitizedDetails).length > 0\r\n            ? JSON.stringify(sanitizedDetails)\r\n            : null,\r\n          performedById: params.performedById,\r\n          affectedUserId: params.affectedUserId || null,\r\n          projectId: params.projectId || null,\r\n          entityType: params.entityType || null,\r\n          entityId: params.entityId || null,\r\n          ipAddress: params.ipAddress || await getClientIP(),\r\n          userAgent: params.userAgent || await getUserAgent(),\r\n          // Legacy fields (required by database)\r\n          action: params.actionType, // Map actionType to legacy action field\r\n          description: params.actionSummary, // Map actionSummary to legacy description field\r\n          userId: params.performedById, // Map performedById to legacy userId field\r\n        },\r\n      })\r\n      console.log(\"[ActivityLogger] ✅ Successfully logged activity with ID:\", result.id)\r\n      console.log(\"[ActivityLogger] ====== END LOGGING (SUCCESS) ======\")\r\n      return\r\n    } catch (schemaError: any) {\r\n      console.error(\"[ActivityLogger] ❌ Schema error occurred:\")\r\n      console.error(\"[ActivityLogger] Error message:\", schemaError.message)\r\n      console.error(\"[ActivityLogger] Error code:\", schemaError.code)\r\n      console.error(\"[ActivityLogger] Error meta:\", JSON.stringify(schemaError.meta, null, 2))\r\n      // If new columns don't exist, fall back to old schema\r\n      if (schemaError.message?.includes('no such column') || schemaError.code === 'P2003' || schemaError.code === 'P2011') {\r\n        console.warn(\"[ActivityLogger] New columns not found, using legacy schema. Please run migration.\")\r\n        await prisma.$executeRawUnsafe(`\r\n          INSERT INTO activity_logs (action, description, entity_type, entity_id, ip_address, user_id, created_at)\r\n          VALUES (?, ?, ?, ?, ?, ?, datetime('now'))\r\n        `,\r\n          params.actionType,\r\n          params.actionSummary,\r\n          params.entityType || null,\r\n          params.entityId || null,\r\n          params.ipAddress || await getClientIP() || null,\r\n          params.performedById\r\n        )\r\n        console.log(\"[ActivityLogger] ✅ Logged using legacy schema\")\r\n        console.log(\"[ActivityLogger] ====== END LOGGING (LEGACY) ======\")\r\n        return\r\n      } else {\r\n        console.error(\"[ActivityLogger] ❌ Unknown schema error, rethrowing\")\r\n        throw schemaError\r\n      }\r\n    }\r\n  } catch (error: any) {\r\n    // Log errors but don't throw - activity logging should never break the main flow\r\n    console.error(\"[ActivityLogger] ❌❌❌ CRITICAL ERROR - Failed to log activity ❌❌❌\")\r\n    console.error(\"[ActivityLogger] Error message:\", error?.message || error)\r\n    console.error(\"[ActivityLogger] Error code:\", error?.code)\r\n    console.error(\"[ActivityLogger] Error meta:\", JSON.stringify(error?.meta, null, 2))\r\n    console.error(\"[ActivityLogger] Error stack:\", error?.stack)\r\n    console.error(\"[ActivityLogger] ====== END LOGGING (ERROR) ======\")\r\n  }\r\n}\r\n\r\n/**\r\n * Sanitize action details to remove sensitive information\r\n */\r\nfunction sanitizeActionDetails(details: Record<string, any>): Record<string, any> {\r\n  const sensitiveKeys = [\r\n    'password',\r\n    'passwordHash',\r\n    'password_hash',\r\n    'token',\r\n    'secret',\r\n    'apiKey',\r\n    'api_key',\r\n    'accessToken',\r\n    'refreshToken',\r\n  ]\r\n\r\n  const sanitized = { ...details }\r\n\r\n  for (const key of sensitiveKeys) {\r\n    if (key in sanitized) {\r\n      sanitized[key] = '[REDACTED]'\r\n    }\r\n  }\r\n\r\n  // Recursively sanitize nested objects\r\n  for (const key in sanitized) {\r\n    if (typeof sanitized[key] === 'object' && sanitized[key] !== null && !Array.isArray(sanitized[key])) {\r\n      sanitized[key] = sanitizeActionDetails(sanitized[key])\r\n    }\r\n  }\r\n\r\n  return sanitized\r\n}\r\n\r\n/**\r\n * Get client IP address from headers\r\n */\r\nasync function getClientIP(): Promise<string | null> {\r\n  try {\r\n    const headersList = await headers()\r\n    const forwarded = headersList.get('x-forwarded-for')\r\n    const realIP = headersList.get('x-real-ip')\r\n\r\n    if (forwarded) {\r\n      return forwarded.split(',')[0].trim()\r\n    }\r\n    if (realIP) {\r\n      return realIP\r\n    }\r\n    return null\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Get user agent from headers\r\n */\r\nasync function getUserAgent(): Promise<string | null> {\r\n  try {\r\n    const headersList = await headers()\r\n    return headersList.get('user-agent') || null\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\n","/**\r\n * Permission definitions for RBAC system\r\n * Format: module.action or module.category.action\r\n */\r\n\r\nexport const PERMISSIONS = {\r\n  // User Management\r\n  USER: {\r\n    CREATE: \"user.create\",\r\n    READ: \"user.read\",\r\n    UPDATE: \"user.update\",\r\n    DELETE: \"user.delete\",\r\n    ASSIGN_ROLE: \"user.assign_role\",\r\n    ACTIVATE: \"user.activate\",\r\n    DEACTIVATE: \"user.deactivate\",\r\n  },\r\n\r\n  // Team Management\r\n  TEAM: {\r\n    CREATE: \"team.create\",\r\n    READ: \"team.read\",\r\n    UPDATE: \"team.update\",\r\n    DELETE: \"team.delete\",\r\n    ADD_MEMBER: \"team.add_member\",\r\n    REMOVE_MEMBER: \"team.remove_member\",\r\n    ASSIGN_PROJECT: \"team.assign_project\",\r\n    REMOVE_PROJECT: \"team.remove_project\",\r\n  },\r\n\r\n  // Project Management\r\n  PROJECT: {\r\n    CREATE: \"project.create\",\r\n    READ: \"project.read\",\r\n    UPDATE: \"project.update\",\r\n    DELETE: \"project.delete\",\r\n    ASSIGN_TEAM: \"project.assign_team\",\r\n    REMOVE_TEAM: \"project.remove_team\",\r\n    MANAGE_SETTINGS: \"project.manage_settings\",\r\n  },\r\n\r\n  // Task Management\r\n  TASK: {\r\n    CREATE: \"task.create\",\r\n    READ: \"task.read\",\r\n    UPDATE: \"task.update\",\r\n    DELETE: \"task.delete\",\r\n    ASSIGN: \"task.assign\",\r\n    CHANGE_STATUS: \"task.change_status\",\r\n    CHANGE_PRIORITY: \"task.change_priority\",\r\n  },\r\n\r\n  // Dependency Management\r\n  DEPENDENCY: {\r\n    CREATE: \"dependency.create\",\r\n    READ: \"dependency.read\",\r\n    UPDATE: \"dependency.update\",\r\n    DELETE: \"dependency.delete\",\r\n    MANUAL_UNBLOCK: \"dependency.manual_unblock\",\r\n  },\r\n\r\n  // Today's Tasks Management\r\n  TODAY_TASK: {\r\n    ASSIGN: \"today_task.assign\",\r\n    REMOVE: \"today_task.remove\",\r\n    REORDER: \"today_task.reorder\",\r\n    VIEW_ALL: \"today_task.view_all\",\r\n  },\r\n\r\n  // Settings Management\r\n  SETTINGS: {\r\n    GLOBAL_READ: \"settings.global.read\",\r\n    GLOBAL_EDIT: \"settings.global.edit\",\r\n    PROJECT_READ: \"settings.project.read\",\r\n    PROJECT_EDIT: \"settings.project.edit\",\r\n    USER_READ: \"settings.user.read\",\r\n    USER_EDIT: \"settings.user.edit\",\r\n    // Project Metadata Management\r\n    PROJECT_TYPE_MANAGE: \"settings.project_type.manage\",\r\n    PROJECT_STATUS_MANAGE: \"settings.project_status.manage\",\r\n    TASK_STATUS_MANAGE: \"settings.task_status.manage\",\r\n  },\r\n\r\n  // Notifications Management\r\n  NOTIFICATION: {\r\n    VIEW: \"notification.view\",\r\n    MANAGE: \"notification.manage\",\r\n    CONFIGURE: \"notification.configure\",\r\n  },\r\n\r\n  // Activity Logs & Audit\r\n  LOG: {\r\n    VIEW: \"log.view\",\r\n    EXPORT: \"log.export\",\r\n    VIEW_DETAILS: \"log.view_details\",\r\n  },\r\n\r\n  // Role Management\r\n  ROLE: {\r\n    CREATE: \"role.create\",\r\n    READ: \"role.read\",\r\n    UPDATE: \"role.update\",\r\n    DELETE: \"role.delete\",\r\n    ASSIGN: \"role.assign\",\r\n    MANAGE_PERMISSIONS: \"role.manage_permissions\",\r\n  },\r\n\r\n  // Reports & Exports\r\n  REPORT: {\r\n    VIEW: \"report.view\",\r\n    EXPORT: \"report.export\",\r\n    GENERATE: \"report.generate\",\r\n  },\r\n} as const\r\n\r\n/**\r\n * Permission modules\r\n */\r\nexport const PERMISSION_MODULES = {\r\n  USER: \"user\",\r\n  TEAM: \"team\",\r\n  PROJECT: \"project\",\r\n  TASK: \"task\",\r\n  DEPENDENCY: \"dependency\",\r\n  TODAY_TASK: \"today_task\",\r\n  SETTINGS: \"settings\",\r\n  NOTIFICATION: \"notification\",\r\n  LOG: \"log\",\r\n  ROLE: \"role\",\r\n  REPORT: \"report\",\r\n} as const\r\n\r\n/**\r\n * Default roles and their permissions\r\n */\r\nexport const DEFAULT_ROLES = {\r\n  SYSTEM_ADMIN: {\r\n    name: \"System Admin\",\r\n    description: \"Full system access with all permissions\",\r\n    isSystemRole: true,\r\n    permissions: Object.values(PERMISSIONS).flatMap(module => Object.values(module)),\r\n  },\r\n  PROJECT_MANAGER: {\r\n    name: \"Project Manager\",\r\n    description: \"Manage projects, tasks, teams, and dependencies\",\r\n    isSystemRole: true,\r\n    permissions: [\r\n      // Project Management\r\n      ...Object.values(PERMISSIONS.PROJECT),\r\n      // Task Management\r\n      ...Object.values(PERMISSIONS.TASK),\r\n      // Dependency Management\r\n      ...Object.values(PERMISSIONS.DEPENDENCY),\r\n      // Team Management (limited)\r\n      PERMISSIONS.TEAM.READ,\r\n      PERMISSIONS.TEAM.UPDATE,\r\n      PERMISSIONS.TEAM.ADD_MEMBER,\r\n      PERMISSIONS.TEAM.REMOVE_MEMBER,\r\n      PERMISSIONS.TEAM.ASSIGN_PROJECT,\r\n      PERMISSIONS.TEAM.REMOVE_PROJECT,\r\n      // Today's Tasks\r\n      ...Object.values(PERMISSIONS.TODAY_TASK),\r\n      // Settings (project-level)\r\n      PERMISSIONS.SETTINGS.PROJECT_READ,\r\n      PERMISSIONS.SETTINGS.PROJECT_EDIT,\r\n      PERMISSIONS.SETTINGS.PROJECT_TYPE_MANAGE,\r\n      PERMISSIONS.SETTINGS.PROJECT_STATUS_MANAGE,\r\n      PERMISSIONS.SETTINGS.TASK_STATUS_MANAGE,\r\n      // Notifications\r\n      PERMISSIONS.NOTIFICATION.VIEW,\r\n      PERMISSIONS.NOTIFICATION.MANAGE,\r\n      // Activity Logs\r\n      PERMISSIONS.LOG.VIEW,\r\n      PERMISSIONS.LOG.VIEW_DETAILS,\r\n      // User Management (read-only for assignment)\r\n      PERMISSIONS.USER.READ,\r\n      // Reports\r\n      PERMISSIONS.REPORT.VIEW,\r\n      PERMISSIONS.REPORT.EXPORT,\r\n      PERMISSIONS.REPORT.GENERATE,\r\n    ],\r\n  },\r\n  TEAM_LEAD: {\r\n    name: \"Team Lead\",\r\n    description: \"Manage team tasks, dependencies, and team members\",\r\n    isSystemRole: true,\r\n    permissions: [\r\n      // Project Management (read-only)\r\n      PERMISSIONS.PROJECT.READ,\r\n      // Task Management (for team tasks)\r\n      ...Object.values(PERMISSIONS.TASK),\r\n      // Dependency Management\r\n      ...Object.values(PERMISSIONS.DEPENDENCY),\r\n      // Team Management (own team only)\r\n      PERMISSIONS.TEAM.READ,\r\n      PERMISSIONS.TEAM.UPDATE,\r\n      PERMISSIONS.TEAM.ADD_MEMBER,\r\n      PERMISSIONS.TEAM.REMOVE_MEMBER,\r\n      // Today's Tasks\r\n      ...Object.values(PERMISSIONS.TODAY_TASK),\r\n      // Settings (read-only)\r\n      PERMISSIONS.SETTINGS.PROJECT_READ,\r\n      // Notifications\r\n      PERMISSIONS.NOTIFICATION.VIEW,\r\n      // Activity Logs (team scope)\r\n      PERMISSIONS.LOG.VIEW,\r\n      PERMISSIONS.LOG.VIEW_DETAILS,\r\n      // User Management (read-only for team members)\r\n      PERMISSIONS.USER.READ,\r\n      // Reports (view only)\r\n      PERMISSIONS.REPORT.VIEW,\r\n    ],\r\n  },\r\n  DEVELOPER: {\r\n    name: \"Developer\",\r\n    description: \"Basic task management and updates\",\r\n    isSystemRole: true,\r\n    permissions: [\r\n      // Project Management (read-only)\r\n      PERMISSIONS.PROJECT.READ,\r\n      // Task Management (assigned tasks only)\r\n      PERMISSIONS.TASK.READ,\r\n      PERMISSIONS.TASK.UPDATE,\r\n      PERMISSIONS.TASK.CHANGE_STATUS,\r\n      PERMISSIONS.TASK.CHANGE_PRIORITY,\r\n      // Dependency Management (read-only)\r\n      PERMISSIONS.DEPENDENCY.READ,\r\n      // Today's Tasks\r\n      ...Object.values(PERMISSIONS.TODAY_TASK),\r\n      // Notifications\r\n      PERMISSIONS.NOTIFICATION.VIEW,\r\n      // Activity Logs (own logs)\r\n      PERMISSIONS.LOG.VIEW,\r\n    ],\r\n  },\r\n} as const\r\n\r\n/**\r\n * Get all permission keys as a flat array\r\n */\r\nexport function getAllPermissions(): string[] {\r\n  return Object.values(PERMISSIONS).flatMap(module => Object.values(module))\r\n}\r\n\r\n/**\r\n * Get permissions by module\r\n */\r\nexport function getPermissionsByModule(module: string): string[] {\r\n  const moduleKey = module.toUpperCase() as keyof typeof PERMISSIONS\r\n  if (PERMISSIONS[moduleKey]) {\r\n    return Object.values(PERMISSIONS[moduleKey])\r\n  }\r\n  return []\r\n}\r\n\r\n","/**\n * @module constants\n * @summary Useful constants\n * @description\n * Collection of useful date constants.\n *\n * The constants could be imported from `date-fns/constants`:\n *\n * ```ts\n * import { maxTime, minTime } from \"./constants/date-fns/constants\";\n *\n * function isAllowedTime(time) {\n *   return time <= maxTime && time >= minTime;\n * }\n * ```\n */\n\n/**\n * @constant\n * @name daysInWeek\n * @summary Days in 1 week.\n */\nexport const daysInWeek = 7;\n\n/**\n * @constant\n * @name daysInYear\n * @summary Days in 1 year.\n *\n * @description\n * How many days in a year.\n *\n * One years equals 365.2425 days according to the formula:\n *\n * > Leap year occurs every 4 years, except for years that are divisible by 100 and not divisible by 400.\n * > 1 mean year = (365+1/4-1/100+1/400) days = 365.2425 days\n */\nexport const daysInYear = 365.2425;\n\n/**\n * @constant\n * @name maxTime\n * @summary Maximum allowed time.\n *\n * @example\n * import { maxTime } from \"./constants/date-fns/constants\";\n *\n * const isValid = 8640000000000001 <= maxTime;\n * //=> false\n *\n * new Date(8640000000000001);\n * //=> Invalid Date\n */\nexport const maxTime = Math.pow(10, 8) * 24 * 60 * 60 * 1000;\n\n/**\n * @constant\n * @name minTime\n * @summary Minimum allowed time.\n *\n * @example\n * import { minTime } from \"./constants/date-fns/constants\";\n *\n * const isValid = -8640000000000001 >= minTime;\n * //=> false\n *\n * new Date(-8640000000000001)\n * //=> Invalid Date\n */\nexport const minTime = -maxTime;\n\n/**\n * @constant\n * @name millisecondsInWeek\n * @summary Milliseconds in 1 week.\n */\nexport const millisecondsInWeek = 604800000;\n\n/**\n * @constant\n * @name millisecondsInDay\n * @summary Milliseconds in 1 day.\n */\nexport const millisecondsInDay = 86400000;\n\n/**\n * @constant\n * @name millisecondsInMinute\n * @summary Milliseconds in 1 minute\n */\nexport const millisecondsInMinute = 60000;\n\n/**\n * @constant\n * @name millisecondsInHour\n * @summary Milliseconds in 1 hour\n */\nexport const millisecondsInHour = 3600000;\n\n/**\n * @constant\n * @name millisecondsInSecond\n * @summary Milliseconds in 1 second\n */\nexport const millisecondsInSecond = 1000;\n\n/**\n * @constant\n * @name minutesInYear\n * @summary Minutes in 1 year.\n */\nexport const minutesInYear = 525600;\n\n/**\n * @constant\n * @name minutesInMonth\n * @summary Minutes in 1 month.\n */\nexport const minutesInMonth = 43200;\n\n/**\n * @constant\n * @name minutesInDay\n * @summary Minutes in 1 day.\n */\nexport const minutesInDay = 1440;\n\n/**\n * @constant\n * @name minutesInHour\n * @summary Minutes in 1 hour.\n */\nexport const minutesInHour = 60;\n\n/**\n * @constant\n * @name monthsInQuarter\n * @summary Months in 1 quarter.\n */\nexport const monthsInQuarter = 3;\n\n/**\n * @constant\n * @name monthsInYear\n * @summary Months in 1 year.\n */\nexport const monthsInYear = 12;\n\n/**\n * @constant\n * @name quartersInYear\n * @summary Quarters in 1 year\n */\nexport const quartersInYear = 4;\n\n/**\n * @constant\n * @name secondsInHour\n * @summary Seconds in 1 hour.\n */\nexport const secondsInHour = 3600;\n\n/**\n * @constant\n * @name secondsInMinute\n * @summary Seconds in 1 minute.\n */\nexport const secondsInMinute = 60;\n\n/**\n * @constant\n * @name secondsInDay\n * @summary Seconds in 1 day.\n */\nexport const secondsInDay = secondsInHour * 24;\n\n/**\n * @constant\n * @name secondsInWeek\n * @summary Seconds in 1 week.\n */\nexport const secondsInWeek = secondsInDay * 7;\n\n/**\n * @constant\n * @name secondsInYear\n * @summary Seconds in 1 year.\n */\nexport const secondsInYear = secondsInDay * daysInYear;\n\n/**\n * @constant\n * @name secondsInMonth\n * @summary Seconds in 1 month\n */\nexport const secondsInMonth = secondsInYear / 12;\n\n/**\n * @constant\n * @name secondsInQuarter\n * @summary Seconds in 1 quarter.\n */\nexport const secondsInQuarter = secondsInMonth * 3;\n\n/**\n * @constant\n * @name constructFromSymbol\n * @summary Symbol enabling Date extensions to inherit properties from the reference date.\n *\n * The symbol is used to enable the `constructFrom` function to construct a date\n * using a reference date and a value. It allows to transfer extra properties\n * from the reference date to the new date. It's useful for extensions like\n * [`TZDate`](https://github.com/date-fns/tz) that accept a time zone as\n * a constructor argument.\n */\nexport const constructFromSymbol = Symbol.for(\"constructDateFrom\");\n","import { constructFromSymbol } from \"./constants.js\";\n\n/**\n * @name constructFrom\n * @category Generic Helpers\n * @summary Constructs a date using the reference date and the value\n *\n * @description\n * The function constructs a new date using the constructor from the reference\n * date and the given value. It helps to build generic functions that accept\n * date extensions.\n *\n * It defaults to `Date` if the passed reference date is a number or a string.\n *\n * Starting from v3.7.0, it allows to construct a date using `[Symbol.for(\"constructDateFrom\")]`\n * enabling to transfer extra properties from the reference date to the new date.\n * It's useful for extensions like [`TZDate`](https://github.com/date-fns/tz)\n * that accept a time zone as a constructor argument.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n *\n * @param date - The reference date to take constructor from\n * @param value - The value to create the date\n *\n * @returns Date initialized using the given date and value\n *\n * @example\n * import { constructFrom } from \"./constructFrom/date-fns\";\n *\n * // A function that clones a date preserving the original type\n * function cloneDate<DateType extends Date>(date: DateType): DateType {\n *   return constructFrom(\n *     date, // Use constructor from the given date\n *     date.getTime() // Use the date value to create a new date\n *   );\n * }\n */\nexport function constructFrom(date, value) {\n  if (typeof date === \"function\") return date(value);\n\n  if (date && typeof date === \"object\" && constructFromSymbol in date)\n    return date[constructFromSymbol](value);\n\n  if (date instanceof Date) return new date.constructor(value);\n\n  return new Date(value);\n}\n\n// Fallback for modularized imports:\nexport default constructFrom;\n","import { constructFrom } from \"./constructFrom.js\";\n\n/**\n * @name toDate\n * @category Common Helpers\n * @summary Convert the given argument to an instance of Date.\n *\n * @description\n * Convert the given argument to an instance of Date.\n *\n * If the argument is an instance of Date, the function returns its clone.\n *\n * If the argument is a number, it is treated as a timestamp.\n *\n * If the argument is none of the above, the function returns Invalid Date.\n *\n * Starting from v3.7.0, it clones a date using `[Symbol.for(\"constructDateFrom\")]`\n * enabling to transfer extra properties from the reference date to the new date.\n * It's useful for extensions like [`TZDate`](https://github.com/date-fns/tz)\n * that accept a time zone as a constructor argument.\n *\n * **Note**: *all* Date arguments passed to any *date-fns* function is processed by `toDate`.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param argument - The value to convert\n *\n * @returns The parsed date in the local time zone\n *\n * @example\n * // Clone the date:\n * const result = toDate(new Date(2014, 1, 11, 11, 30, 30))\n * //=> Tue Feb 11 2014 11:30:30\n *\n * @example\n * // Convert the timestamp to date:\n * const result = toDate(1392098430000)\n * //=> Tue Feb 11 2014 11:30:30\n */\nexport function toDate(argument, context) {\n  // [TODO] Get rid of `toDate` or `constructFrom`?\n  return constructFrom(context || argument, argument);\n}\n\n// Fallback for modularized imports:\nexport default toDate;\n","import { toDate } from \"./toDate.js\";\n\n/**\n * The {@link startOfDay} function options.\n */\n\n/**\n * @name startOfDay\n * @category Day Helpers\n * @summary Return the start of a day for the given date.\n *\n * @description\n * Return the start of a day for the given date.\n * The result will be in the local timezone.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The original date\n * @param options - The options\n *\n * @returns The start of a day\n *\n * @example\n * // The start of a day for 2 September 2014 11:55:00:\n * const result = startOfDay(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Tue Sep 02 2014 00:00:00\n */\nexport function startOfDay(date, options) {\n  const _date = toDate(date, options?.in);\n  _date.setHours(0, 0, 0, 0);\n  return _date;\n}\n\n// Fallback for modularized imports:\nexport default startOfDay;\n","import { toDate } from \"./toDate.js\";\n\n/**\n * The {@link endOfDay} function options.\n */\n\n/**\n * @name endOfDay\n * @category Day Helpers\n * @summary Return the end of a day for the given date.\n *\n * @description\n * Return the end of a day for the given date.\n * The result will be in the local timezone.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The original date\n * @param options - An object with options\n *\n * @returns The end of a day\n *\n * @example\n * // The end of a day for 2 September 2014 11:55:00:\n * const result = endOfDay(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Tue Sep 02 2014 23:59:59.999\n */\nexport function endOfDay(date, options) {\n  const _date = toDate(date, options?.in);\n  _date.setHours(23, 59, 59, 999);\n  return _date;\n}\n\n// Fallback for modularized imports:\nexport default endOfDay;\n","import { constructFrom } from \"./constructFrom.js\";\nimport { toDate } from \"./toDate.js\";\n\n/**\n * The {@link addDays} function options.\n */\n\n/**\n * @name addDays\n * @category Day Helpers\n * @summary Add the specified number of days to the given date.\n *\n * @description\n * Add the specified number of days to the given date.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The date to be changed\n * @param amount - The amount of days to be added.\n * @param options - An object with options\n *\n * @returns The new date with the days added\n *\n * @example\n * // Add 10 days to 1 September 2014:\n * const result = addDays(new Date(2014, 8, 1), 10)\n * //=> Thu Sep 11 2014 00:00:00\n */\nexport function addDays(date, amount, options) {\n  const _date = toDate(date, options?.in);\n  if (isNaN(amount)) return constructFrom(options?.in || date, NaN);\n\n  // If 0 days, no-op to avoid changing times in the hour before end of DST\n  if (!amount) return _date;\n\n  _date.setDate(_date.getDate() + amount);\n  return _date;\n}\n\n// Fallback for modularized imports:\nexport default addDays;\n","import { addDays } from \"./addDays.js\";\n\n/**\n * The {@link subDays} function options.\n */\n\n/**\n * @name subDays\n * @category Day Helpers\n * @summary Subtract the specified number of days from the given date.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The date to be changed\n * @param amount - The amount of days to be subtracted.\n * @param options - An object with options\n *\n * @returns The new date with the days subtracted\n *\n * @example\n * // Subtract 10 days from 1 September 2014:\n * const result = subDays(new Date(2014, 8, 1), 10)\n * //=> Fri Aug 22 2014 00:00:00\n */\nexport function subDays(date, amount, options) {\n  return addDays(date, -amount, options);\n}\n\n// Fallback for modularized imports:\nexport default subDays;\n","import { prisma } from \"@/lib/prisma\"\r\nimport { startOfDay, subDays, startOfWeek, subWeeks, endOfDay } from \"date-fns\"\r\n\r\nexport type TrendDirection = \"up\" | \"down\" | \"neutral\"\r\n\r\nexport interface StatTrend {\r\n    direction: TrendDirection\r\n    value: number // Percentage or absolute difference\r\n    percentage: number\r\n}\r\n\r\nexport interface StatWithTrend {\r\n    value: number\r\n    trend: StatTrend | null\r\n}\r\n\r\n/**\r\n * Ensures a snapshot exists for the current day for the given metric.\r\n * If not, it calculates it and saves it.\r\n * NOTE: For this simple implementation, we'll assume the 'value' passed is the current live value.\r\n * In a more complex system, this function might calculate the value itself.\r\n */\r\nexport async function captureDailySnapshot(\r\n    entityType: string,\r\n    entityId: number | null,\r\n    metricKey: string,\r\n    currentValue: number\r\n) {\r\n    const today = startOfDay(new Date())\r\n\r\n    // Check if snapshot exists for today\r\n    const existing = await prisma.statSnapshot.findFirst({\r\n        where: {\r\n            entityType,\r\n            entityId,\r\n            metricKey,\r\n            date: today,\r\n        },\r\n    })\r\n\r\n    if (!existing) {\r\n        await prisma.statSnapshot.create({\r\n            data: {\r\n                entityType,\r\n                entityId,\r\n                metricKey,\r\n                value: currentValue,\r\n                date: today,\r\n            },\r\n        })\r\n    } else if (existing.value !== currentValue) {\r\n        // Update if value changed today (optional, but good for accuracy)\r\n        await prisma.statSnapshot.update({\r\n            where: { id: existing.id },\r\n            data: { value: currentValue },\r\n        })\r\n    }\r\n}\r\n\r\n/**\r\n * Calculates trend based on current value and a previous snapshot.\r\n */\r\nexport async function getStatTrend(\r\n    entityType: string,\r\n    entityId: number | null,\r\n    metricKey: string,\r\n    currentValue: number,\r\n    period: \"daily\" | \"weekly\" = \"daily\"\r\n): Promise<StatTrend | null> {\r\n    const today = startOfDay(new Date())\r\n    let compareDate: Date\r\n\r\n    if (period === \"daily\") {\r\n        compareDate = subDays(today, 1) // Yesterday\r\n    } else {\r\n        compareDate = subWeeks(today, 1) // Last week\r\n    }\r\n\r\n    // Capture current state if needed (side effect, or separate job)\r\n    // We'll capture it here to ensure we have data for tomorrow\r\n    await captureDailySnapshot(entityType, entityId, metricKey, currentValue)\r\n\r\n    // Find the closest snapshot to the compare date\r\n    // We look for one created on that day\r\n    const snapshot = await prisma.statSnapshot.findFirst({\r\n        where: {\r\n            entityType,\r\n            entityId,\r\n            metricKey,\r\n            date: compareDate, // Precise match for day\r\n        },\r\n    })\r\n\r\n    if (!snapshot) {\r\n        // Try to find ANY snapshot before today if exact match fails\r\n        const lastSnapshot = await prisma.statSnapshot.findFirst({\r\n            where: {\r\n                entityType,\r\n                entityId,\r\n                metricKey,\r\n                date: { lt: today }\r\n            },\r\n            orderBy: { date: 'desc' }\r\n        })\r\n\r\n        if (!lastSnapshot) return null // No historical data\r\n\r\n        // Use the most recent prior snapshot for comparison if no exact match\r\n        // This handles gaps in data\r\n        return calculateTrend(currentValue, lastSnapshot.value)\r\n    }\r\n\r\n    return calculateTrend(currentValue, snapshot.value)\r\n}\r\n\r\nfunction calculateTrend(current: number, previous: number): StatTrend {\r\n    if (previous === 0) {\r\n        return {\r\n            direction: current > 0 ? \"up\" : \"neutral\",\r\n            value: current,\r\n            percentage: current > 0 ? 100 : 0\r\n        }\r\n    }\r\n\r\n    const diff = current - previous\r\n    const percentage = Math.round((diff / previous) * 100)\r\n\r\n    let direction: TrendDirection = \"neutral\"\r\n    if (diff > 0) direction = \"up\"\r\n    if (diff < 0) direction = \"down\"\r\n\r\n    return {\r\n        direction,\r\n        value: Math.abs(diff),\r\n        percentage: Math.abs(percentage),\r\n    }\r\n}\r\n","import { addDays } from \"./addDays.js\";\n\n/**\n * The {@link addWeeks} function options.\n */\n\n/**\n * @name addWeeks\n * @category Week Helpers\n * @summary Add the specified number of weeks to the given date.\n *\n * @description\n * Add the specified number of weeks to the given date.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The date to be changed\n * @param amount - The amount of weeks to be added.\n * @param options - An object with options\n *\n * @returns The new date with the weeks added\n *\n * @example\n * // Add 4 weeks to 1 September 2014:\n * const result = addWeeks(new Date(2014, 8, 1), 4)\n * //=> Mon Sep 29 2014 00:00:00\n */\nexport function addWeeks(date, amount, options) {\n  return addDays(date, amount * 7, options);\n}\n\n// Fallback for modularized imports:\nexport default addWeeks;\n","import { addWeeks } from \"./addWeeks.js\";\n\n/**\n * The {@link subWeeks} function options.\n */\n\n/**\n * @name subWeeks\n * @category Week Helpers\n * @summary Subtract the specified number of weeks from the given date.\n *\n * @description\n * Subtract the specified number of weeks from the given date.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The date to be changed\n * @param amount - The amount of weeks to be subtracted.\n * @param options - An object with options\n *\n * @returns The new date with the weeks subtracted\n *\n * @example\n * // Subtract 4 weeks from 1 September 2014:\n * const result = subWeeks(new Date(2014, 8, 1), 4)\n * //=> Mon Aug 04 2014 00:00:00\n */\nexport function subWeeks(date, amount, options) {\n  return addWeeks(date, -amount, options);\n}\n\n// Fallback for modularized imports:\nexport default subWeeks;\n","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { getServerSession } from \"next-auth\"\r\nimport { authOptions } from \"@/lib/auth\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { logActivity } from \"@/lib/activity-logger\"\r\nimport { createProjectNotification } from \"./project-notifications\"\r\nimport { z } from \"zod\"\r\nimport { hasPermissionWithoutRoleBypass } from \"@/lib/rbac-helpers\"\r\n\r\nconst markUrgentSchema = z.object({\r\n    projectId: z.coerce.number(),\r\n    reason: z.string().min(10, \"Reason must be at least 10 characters\"),\r\n})\r\n\r\nexport async function markProjectUrgent(formData: FormData) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const projectId = formData.get(\"projectId\")\r\n    const reason = formData.get(\"reason\")\r\n\r\n    const validated = markUrgentSchema.safeParse({ projectId, reason })\r\n\r\n    if (!validated.success) {\r\n        return { error: \"Validation failed\", details: validated.error.format() }\r\n    }\r\n\r\n    try {\r\n        // Check permissions\r\n        const project = await prisma.project.findUnique({\r\n            where: { id: validated.data.projectId },\r\n            include: {\r\n                projectManager: true,\r\n                projectUsers: true,\r\n                projectTeams: {\r\n                    include: {\r\n                        team: {\r\n                            include: {\r\n                                teamLead: true,\r\n                                members: true\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        })\r\n\r\n        if (!project) {\r\n            return { error: \"Project not found\" }\r\n        }\r\n\r\n        const userId = parseInt(session.user.id)\r\n        \r\n        // Check if user has permission to mark urgent (using RBAC, no role-based bypass)\r\n        const hasPermission = await hasPermissionWithoutRoleBypass(\r\n            userId,\r\n            \"project.markUrgent\",\r\n            validated.data.projectId\r\n        )\r\n\r\n        // Also allow project manager and creator\r\n        const isPM = project.projectManagerId === userId || project.createdById === userId\r\n\r\n        if (!hasPermission && !isPM) {\r\n            return { error: \"Unauthorized: You don't have permission to mark this project as urgent\" }\r\n        }\r\n\r\n        // Update project priority\r\n        const updatedProject = await prisma.project.update({\r\n            where: { id: validated.data.projectId },\r\n            data: {\r\n                priority: \"urgent\",\r\n                urgentReason: validated.data.reason,\r\n                urgentMarkedAt: new Date(),\r\n                urgentMarkedById: userId,\r\n            },\r\n            include: {\r\n                projectManager: true,\r\n                projectUsers: {\r\n                    select: {\r\n                        userId: true\r\n                    }\r\n                },\r\n                projectTeams: {\r\n                    include: {\r\n                        team: {\r\n                            select: {\r\n                                teamLeadId: true,\r\n                                members: {\r\n                                    select: {\r\n                                        userId: true\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        })\r\n\r\n        // Collect users to notify\r\n        const usersToNotify = new Set<number>()\r\n        \r\n        // Add project manager\r\n        if (updatedProject.projectManagerId) {\r\n            usersToNotify.add(updatedProject.projectManagerId)\r\n        }\r\n\r\n        // Add project users\r\n        updatedProject.projectUsers.forEach(pu => {\r\n            usersToNotify.add(pu.userId)\r\n        })\r\n\r\n        // Add team leads\r\n        updatedProject.projectTeams.forEach(pt => {\r\n            if (pt.team.teamLeadId) {\r\n                usersToNotify.add(pt.team.teamLeadId)\r\n            }\r\n            // Add team members\r\n            pt.team.members.forEach(member => {\r\n                usersToNotify.add(member.userId)\r\n            })\r\n        })\r\n\r\n        // Add all admins\r\n        const admins = await prisma.user.findMany({\r\n            where: { role: \"admin\" },\r\n            select: { id: true }\r\n        })\r\n        admins.forEach(admin => usersToNotify.add(admin.id))\r\n\r\n        // Send urgent notifications to all relevant users\r\n        const notificationPromises = Array.from(usersToNotify).map(userId => \r\n            createProjectNotification(\r\n                validated.data.projectId,\r\n                userId,\r\n                {\r\n                    type: \"project_urgent\",\r\n                    entityType: \"project\",\r\n                    entityId: validated.data.projectId,\r\n                    title: `🚨 URGENT: ${updatedProject.name}`,\r\n                    message: `This project has been marked as URGENT. Reason: ${validated.data.reason}`,\r\n                    soundRequired: true,\r\n                    isUrgent: true,\r\n                    requiresAcknowledgment: true,\r\n                }\r\n            )\r\n        )\r\n\r\n        await Promise.all(notificationPromises)\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_marked_urgent\",\r\n            actionCategory: \"project\",\r\n            actionSummary: `Project \"${updatedProject.name}\" marked as URGENT`,\r\n            actionDetails: {\r\n                projectId: updatedProject.id,\r\n                projectName: updatedProject.name,\r\n                reason: validated.data.reason,\r\n                notifiedUsers: Array.from(usersToNotify).length,\r\n            },\r\n            performedById: userId,\r\n            projectId: validated.data.projectId,\r\n            entityType: \"project\",\r\n            entityId: validated.data.projectId,\r\n        })\r\n\r\n        revalidatePath(`/dashboard/projects/${validated.data.projectId}`)\r\n        revalidatePath(\"/dashboard\")\r\n        revalidatePath(\"/dashboard/projects\")\r\n\r\n        return { success: true, project: updatedProject }\r\n    } catch (error: any) {\r\n        console.error(\"Error marking project as urgent:\", error)\r\n        return { error: \"Failed to mark project as urgent\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function acknowledgeUrgentProject(projectId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const userId = parseInt(session.user.id)\r\n\r\n    try {\r\n        const project = await prisma.project.findUnique({\r\n            where: { id: projectId }\r\n        })\r\n\r\n        if (!project) {\r\n            return { error: \"Project not found\" }\r\n        }\r\n\r\n        if (project.priority !== \"urgent\") {\r\n            return { error: \"Project is not marked as urgent\" }\r\n        }\r\n\r\n        // Create or update acknowledgment\r\n        await prisma.urgentProjectAcknowledgement.upsert({\r\n            where: {\r\n                projectId_userId: {\r\n                    projectId: projectId,\r\n                    userId: userId\r\n                }\r\n            },\r\n            create: {\r\n                projectId: projectId,\r\n                userId: userId,\r\n            },\r\n            update: {\r\n                acknowledgedAt: new Date()\r\n            }\r\n        })\r\n\r\n        // Mark urgent notifications as acknowledged for this user\r\n        await prisma.projectNotification.updateMany({\r\n            where: {\r\n                projectId: projectId,\r\n                userId: userId,\r\n                isUrgent: true,\r\n                requiresAcknowledgment: true,\r\n            },\r\n            data: {\r\n                acknowledgedAt: new Date(),\r\n                isRead: true,\r\n            }\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_urgent_acknowledged\",\r\n            actionCategory: \"project\",\r\n            actionSummary: `Acknowledged urgent project \"${project.name}\"`,\r\n            actionDetails: {\r\n                projectId: project.id,\r\n                projectName: project.name,\r\n            },\r\n            performedById: userId,\r\n            projectId: projectId,\r\n            entityType: \"project\",\r\n            entityId: projectId,\r\n        })\r\n\r\n        revalidatePath(`/dashboard/projects/${projectId}`)\r\n        revalidatePath(\"/dashboard\")\r\n\r\n        return { success: true }\r\n    } catch (error: any) {\r\n        console.error(\"Error acknowledging urgent project:\", error)\r\n        return { error: \"Failed to acknowledge urgent project\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function removeUrgentPriority(projectId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const userId = parseInt(session.user.id)\r\n\r\n    try {\r\n        const project = await prisma.project.findUnique({\r\n            where: { id: projectId }\r\n        })\r\n\r\n        if (!project) {\r\n            return { error: \"Project not found\" }\r\n        }\r\n\r\n        // Check if user has permission to remove urgent priority (using RBAC, no role-based bypass)\r\n        const hasPermission = await hasPermissionWithoutRoleBypass(\r\n            userId,\r\n            \"project.removeUrgent\",\r\n            projectId\r\n        )\r\n\r\n        // Also allow project manager and creator\r\n        const isPM = project.projectManagerId === userId || project.createdById === userId\r\n\r\n        if (!hasPermission && !isPM) {\r\n            return { error: \"Unauthorized: You don't have permission to remove urgent priority from this project\" }\r\n        }\r\n\r\n        // Update project\r\n        await prisma.project.update({\r\n            where: { id: projectId },\r\n            data: {\r\n                priority: \"normal\",\r\n                urgentReason: null,\r\n                urgentMarkedAt: null,\r\n                urgentMarkedById: null,\r\n            }\r\n        })\r\n\r\n        // Mark all urgent notifications as read (no longer urgent)\r\n        await prisma.projectNotification.updateMany({\r\n            where: {\r\n                projectId: projectId,\r\n                isUrgent: true,\r\n            },\r\n            data: {\r\n                isRead: true,\r\n                acknowledgedAt: new Date(),\r\n            }\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_urgent_removed\",\r\n            actionCategory: \"project\",\r\n            actionSummary: `Removed urgent priority from project \"${project.name}\"`,\r\n            actionDetails: {\r\n                projectId: project.id,\r\n                projectName: project.name,\r\n            },\r\n            performedById: userId,\r\n            projectId: projectId,\r\n            entityType: \"project\",\r\n            entityId: projectId,\r\n        })\r\n\r\n        revalidatePath(`/dashboard/projects/${projectId}`)\r\n        revalidatePath(\"/dashboard\")\r\n        revalidatePath(\"/dashboard/projects\")\r\n\r\n        return { success: true }\r\n    } catch (error: any) {\r\n        console.error(\"Error removing urgent priority:\", error)\r\n        return { error: \"Failed to remove urgent priority\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function getUrgentProjects() {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const userId = parseInt(session.user.id)\r\n    const userRole = session.user.role || \"developer\"\r\n    const isAdmin = userRole === \"admin\"\r\n\r\n    try {\r\n        const where: any = {\r\n            priority: \"urgent\"\r\n        }\r\n\r\n        // Filter by user's projects if not admin\r\n        if (!isAdmin) {\r\n            where.OR = [\r\n                { projectManagerId: userId },\r\n                { createdById: userId },\r\n                { projectUsers: { some: { userId } } },\r\n                { projectTeams: { some: { team: { teamLeadId: userId } } } },\r\n                { projectTeams: { some: { team: { members: { some: { userId } } } } } }\r\n            ]\r\n        }\r\n\r\n        const projects = await prisma.project.findMany({\r\n            where,\r\n            include: {\r\n                projectManager: {\r\n                    select: {\r\n                        id: true,\r\n                        username: true,\r\n                        avatarUrl: true\r\n                    }\r\n                },\r\n                urgentMarkedBy: {\r\n                    select: {\r\n                        id: true,\r\n                        username: true\r\n                    }\r\n                },\r\n                urgentAcknowledgments: {\r\n                    where: { userId },\r\n                    select: {\r\n                        acknowledgedAt: true\r\n                    }\r\n                }\r\n            },\r\n            orderBy: { urgentMarkedAt: \"desc\" }\r\n        })\r\n\r\n        return { success: true, projects }\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching urgent projects:\", error)\r\n        return { error: \"Failed to fetch urgent projects\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function hasAcknowledgedUrgent(projectId: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return false\r\n\r\n    const userId = parseInt(session.user.id)\r\n\r\n    try {\r\n        const acknowledgment = await prisma.urgentProjectAcknowledgement.findUnique({\r\n            where: {\r\n                projectId_userId: {\r\n                    projectId,\r\n                    userId\r\n                }\r\n            }\r\n        })\r\n\r\n        return !!acknowledgment\r\n    } catch (error) {\r\n        console.error(\"Error checking acknowledgment:\", error)\r\n        return false\r\n    }\r\n}\r\n\r\n","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { getServerSession } from \"next-auth\"\r\nimport { authOptions } from \"@/lib/auth\"\r\nimport { startOfDay, endOfDay } from \"date-fns\"\r\nimport { getStatTrend, StatTrend } from \"@/lib/stats\"\r\nimport { unstable_cache } from \"next/cache\"\r\n\r\n// Separate the data fetching logic to be cached\r\nasync function fetchDashboardSummaryData(userId: number, isAdmin: boolean) {\r\n    const todayStart = startOfDay(new Date())\r\n    const todayEnd = endOfDay(new Date())\r\n\r\n    // Fetch active project statuses and task statuses\r\n    const [projectStatusesResult, taskStatusesResult] = await Promise.all([\r\n        prisma.projectStatus?.findMany({\r\n            where: { isActive: true },\r\n            orderBy: { orderIndex: \"asc\" },\r\n            select: { id: true, name: true, color: true }\r\n        }).catch(() => []),\r\n        prisma.taskStatus?.findMany({\r\n            where: { isActive: true },\r\n            orderBy: { orderIndex: \"asc\" },\r\n            select: { id: true, name: true, color: true, isBlocking: true, isFinal: true }\r\n        }).catch(() => [])\r\n    ])\r\n\r\n    const projectStatuses = projectStatusesResult || []\r\n    const taskStatuses = taskStatusesResult || []\r\n\r\n    // Find blocking task status (for blocked tasks count)\r\n    const blockingTaskStatus = taskStatuses.find(ts => ts.isBlocking)\r\n    const blockingTaskStatusId = blockingTaskStatus?.id\r\n\r\n    // Find final task status (for completed tasks)\r\n    const finalTaskStatus = taskStatuses.find(ts => ts.isFinal)\r\n    const finalTaskStatusId = finalTaskStatus?.id\r\n\r\n    // Projects Statistics\r\n    const projectsWhere = isAdmin ? {} : {\r\n        OR: [\r\n            { projectManagerId: userId },\r\n            { createdById: userId },\r\n            { projectUsers: { some: { userId } } }\r\n        ]\r\n    }\r\n\r\n    // Count projects by status - OPTIMIZED: Use aggregation instead of N+1 queries\r\n    const projectStatusCounts: Record<number, number> = {}\r\n    if (projectStatuses.length > 0) {\r\n        const projectCounts = await prisma.project.groupBy({\r\n            by: ['projectStatusId'],\r\n            where: {\r\n                ...projectsWhere,\r\n                projectStatusId: { in: projectStatuses.map(s => s.id) }\r\n            },\r\n            _count: {\r\n                id: true\r\n            }\r\n        })\r\n\r\n        for (const result of projectCounts) {\r\n            if (result.projectStatusId) {\r\n                projectStatusCounts[result.projectStatusId] = result._count.id\r\n            }\r\n        }\r\n    }\r\n\r\n    // Also count by legacy status for backward compatibility\r\n    const legacyActiveCount = await prisma.project.count({\r\n        where: {\r\n            ...projectsWhere,\r\n            status: \"active\",\r\n            projectStatusId: null\r\n        }\r\n    })\r\n    const legacyOnHoldCount = await prisma.project.count({\r\n        where: {\r\n            ...projectsWhere,\r\n            status: \"on_hold\",\r\n            projectStatusId: null\r\n        }\r\n    })\r\n\r\n    // Count tasks by status - OPTIMIZED: Use aggregation instead of N+1 queries\r\n    const tasksWhere = isAdmin ? {} : {\r\n        project: {\r\n            OR: [\r\n                { projectManagerId: userId },\r\n                { createdById: userId },\r\n                { projectUsers: { some: { userId } } }\r\n            ]\r\n        }\r\n    }\r\n\r\n    const taskStatusCounts: Record<number, number> = {}\r\n    if (taskStatuses.length > 0) {\r\n        const taskCounts = await prisma.task.groupBy({\r\n            by: ['taskStatusId'],\r\n            where: {\r\n                ...tasksWhere,\r\n                taskStatusId: { in: taskStatuses.map(s => s.id) }\r\n            },\r\n            _count: {\r\n                id: true\r\n            }\r\n        })\r\n\r\n        for (const result of taskCounts) {\r\n            if (result.taskStatusId) {\r\n                taskStatusCounts[result.taskStatusId] = result._count.id\r\n            }\r\n        }\r\n    }\r\n\r\n    const [\r\n        totalProjects,\r\n        totalTasks,\r\n        myTasks,\r\n        blockedTasks,\r\n        overdueTasks,\r\n        todaysTasks,\r\n        completedToday,\r\n        recentActivities\r\n    ] = await Promise.all([\r\n        // Total Projects\r\n        prisma.project.count({ where: projectsWhere }),\r\n\r\n        // Total Tasks\r\n        prisma.task.count({\r\n            where: isAdmin ? {} : {\r\n                project: {\r\n                    OR: [\r\n                        { projectManagerId: userId },\r\n                        { createdById: userId },\r\n                        { projectUsers: { some: { userId } } }\r\n                    ]\r\n                }\r\n            }\r\n        }),\r\n\r\n        // My Tasks\r\n        prisma.task.count({\r\n            where: {\r\n                assignees: { some: { id: userId } }\r\n            }\r\n        }),\r\n\r\n        // Blocked Tasks (using blocking status or legacy \"waiting\")\r\n        prisma.task.count({\r\n            where: {\r\n                OR: (() => {\r\n                    const conditions: any[] = []\r\n                    if (blockingTaskStatusId) {\r\n                        conditions.push({ taskStatusId: blockingTaskStatusId })\r\n                    }\r\n                    conditions.push({ status: \"waiting\", taskStatusId: null })\r\n                    return conditions\r\n                })(),\r\n                ...(isAdmin ? {} : {\r\n                    project: {\r\n                        OR: [\r\n                            { projectManagerId: userId },\r\n                            { createdById: userId },\r\n                            { projectUsers: { some: { userId } } }\r\n                        ]\r\n                    }\r\n                })\r\n            }\r\n        }),\r\n\r\n        // Overdue Tasks (not in final status)\r\n        prisma.task.count({\r\n            where: {\r\n                dueDate: { lt: new Date() },\r\n                OR: (() => {\r\n                    const conditions: any[] = []\r\n                    if (finalTaskStatusId) {\r\n                        conditions.push({ taskStatusId: { not: finalTaskStatusId } })\r\n                    }\r\n                    conditions.push({ status: { not: \"completed\" }, taskStatusId: null })\r\n                    return conditions\r\n                })(),\r\n                ...(isAdmin ? {} : {\r\n                    OR: [\r\n                        { assignees: { some: { id: userId } } },\r\n                        {\r\n                            project: {\r\n                                OR: [\r\n                                    { projectManagerId: userId },\r\n                                    { createdById: userId }\r\n                                ]\r\n                            }\r\n                        }\r\n                    ]\r\n                })\r\n            }\r\n        }),\r\n\r\n        // Today's Tasks (not in final status)\r\n        prisma.task.count({\r\n            where: {\r\n                assignees: { some: { id: userId } },\r\n                plannedDate: {\r\n                    gte: todayStart,\r\n                    lte: todayEnd\r\n                },\r\n                OR: (() => {\r\n                    const conditions: any[] = []\r\n                    if (finalTaskStatusId) {\r\n                        conditions.push({ taskStatusId: { not: finalTaskStatusId } })\r\n                    }\r\n                    conditions.push({ status: { not: \"completed\" }, taskStatusId: null })\r\n                    return conditions\r\n                })()\r\n            }\r\n        }),\r\n\r\n        // Completed Today (using final status or legacy \"completed\")\r\n        prisma.task.count({\r\n            where: {\r\n                assignees: { some: { id: userId } },\r\n                updatedAt: {\r\n                    gte: todayStart,\r\n                    lte: todayEnd\r\n                },\r\n                OR: (() => {\r\n                    const conditions: any[] = []\r\n                    if (finalTaskStatusId) {\r\n                        conditions.push({ taskStatusId: finalTaskStatusId })\r\n                    }\r\n                    conditions.push({ status: \"completed\", taskStatusId: null })\r\n                    return conditions\r\n                })()\r\n            }\r\n        }),\r\n\r\n        // Recent Activities (last 10)\r\n        prisma.activityLog.findMany({\r\n            where: isAdmin ? {} : {\r\n                OR: [\r\n                    { performedById: userId },\r\n                    { affectedUserId: userId },\r\n                    {\r\n                        project: {\r\n                            OR: [\r\n                                { projectManagerId: userId },\r\n                                { createdById: userId },\r\n                                { projectUsers: { some: { userId } } }\r\n                            ]\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            select: {\r\n                id: true,\r\n                actionType: true,\r\n                actionSummary: true,\r\n                actionDetails: true,\r\n                createdAt: true,\r\n                performedById: true,\r\n                projectId: true,\r\n                performedBy: {\r\n                    select: {\r\n                        id: true,\r\n                        username: true,\r\n                        avatarUrl: true\r\n                    }\r\n                },\r\n                project: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true\r\n                    }\r\n                }\r\n            },\r\n            orderBy: { createdAt: \"desc\" },\r\n            take: 10\r\n        })\r\n    ])\r\n\r\n    // Calculate Trends\r\n    // Admin gets global trends, Users get their dashboard trends\r\n    const entityType = isAdmin ? \"global\" : \"user_dashboard\"\r\n    const entityId = isAdmin ? null : userId\r\n\r\n    const [\r\n        totalProjectsTrend,\r\n        totalTasksTrend,\r\n        myTasksTrend,\r\n        blockedTasksTrend,\r\n        overdueTasksTrend,\r\n        todaysTasksTrend,\r\n        completedTodayTrend\r\n    ] = await Promise.all([\r\n        getStatTrend(entityType, entityId, \"total_projects\", totalProjects),\r\n        getStatTrend(entityType, entityId, \"total_tasks\", totalTasks),\r\n        getStatTrend(\"user_dashboard\", userId, \"my_tasks\", myTasks), // My Tasks is always user scoped\r\n        getStatTrend(entityType, entityId, \"blocked_tasks\", blockedTasks),\r\n        getStatTrend(entityType, entityId, \"overdue_tasks\", overdueTasks),\r\n        getStatTrend(\"user_dashboard\", userId, \"todays_tasks_total\", todaysTasks),\r\n        getStatTrend(\"user_dashboard\", userId, \"todays_tasks_completed\", completedToday)\r\n    ])\r\n\r\n    return {\r\n        success: true,\r\n        projects: {\r\n            total: totalProjects,\r\n            trend: totalProjectsTrend,\r\n            statusCounts: projectStatusCounts,\r\n            legacyActive: legacyActiveCount,\r\n            legacyOnHold: legacyOnHoldCount\r\n        },\r\n        projectStatuses: projectStatuses.map(ps => ({\r\n            id: ps.id,\r\n            name: ps.name,\r\n            color: ps.color\r\n        })),\r\n        tasks: {\r\n            total: totalTasks,\r\n            trend: totalTasksTrend,\r\n            myTasks: myTasks,\r\n            myTasksTrend: myTasksTrend,\r\n            blocked: blockedTasks,\r\n            blockedTrend: blockedTasksTrend,\r\n            overdue: overdueTasks,\r\n            overdueTrend: overdueTasksTrend,\r\n            statusCounts: taskStatusCounts\r\n        },\r\n        taskStatuses: taskStatuses.map(ts => ({\r\n            id: ts.id,\r\n            name: ts.name,\r\n            color: ts.color,\r\n            isBlocking: ts.isBlocking,\r\n            isFinal: ts.isFinal\r\n        })),\r\n        todayTasks: {\r\n            total: todaysTasks,\r\n            totalTrend: todaysTasksTrend,\r\n            completed: completedToday,\r\n            completedTrend: completedTodayTrend\r\n        },\r\n        recentActivities\r\n    }\r\n}\r\n\r\n// Create the cached version\r\nconst getCachedDashboardSummary = unstable_cache(\r\n    fetchDashboardSummaryData,\r\n    ['dashboard-summary'],\r\n    {\r\n        revalidate: 60, // Cache for 60 seconds\r\n        tags: ['dashboard']\r\n    }\r\n)\r\n\r\nexport async function getDashboardSummary() {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\", success: false }\r\n\r\n    const userId = parseInt(session.user.id)\r\n    const userRole = session.user.role || \"developer\"\r\n    const isAdmin = userRole === \"admin\"\r\n\r\n    try {\r\n        // Pass userId and isAdmin as primitives to the cached function\r\n        // unstable_cache arguments form part of the cache key\r\n        return await getCachedDashboardSummary(userId, isAdmin)\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching dashboard summary:\", error)\r\n        return { error: \"Failed to fetch dashboard data\", details: error.message, success: false }\r\n    }\r\n}\r\n\r\n// Separate data fetching for focus tasks\r\nasync function fetchTodaysFocusTasksData(userId: number) {\r\n    const todayStart = startOfDay(new Date())\r\n    const todayEnd = endOfDay(new Date())\r\n\r\n    const tasks = await prisma.task.findMany({\r\n        where: {\r\n            assignees: { some: { id: userId } },\r\n            plannedDate: {\r\n                gte: todayStart,\r\n                lte: todayEnd\r\n            }\r\n        },\r\n        select: {\r\n            id: true,\r\n            title: true,\r\n            description: true,\r\n            priority: true,\r\n            status: true,\r\n            dueDate: true,\r\n            plannedDate: true,\r\n            createdAt: true,\r\n            projectId: true,\r\n            project: {\r\n                select: {\r\n                    id: true,\r\n                    name: true\r\n                }\r\n            },\r\n            assignees: {\r\n                select: {\r\n                    id: true,\r\n                    username: true,\r\n                    avatarUrl: true\r\n                }\r\n            },\r\n            dependencies: {\r\n                select: {\r\n                    taskId: true,\r\n                    dependsOnTaskId: true,\r\n                    dependencyType: true,\r\n                    dependsOnTask: {\r\n                        select: {\r\n                            id: true,\r\n                            status: true,\r\n                            title: true\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            _count: {\r\n                select: {\r\n                    comments: true,\r\n                    attachments: true\r\n                }\r\n            }\r\n        },\r\n        orderBy: [\r\n            { priority: \"desc\" },\r\n            { createdAt: \"asc\" }\r\n        ]\r\n    })\r\n\r\n    return { success: true, tasks }\r\n}\r\n\r\nconst getCachedTodaysFocusTasks = unstable_cache(\r\n    fetchTodaysFocusTasksData,\r\n    ['dashboard-focus-tasks'],\r\n    {\r\n        revalidate: 60,\r\n        tags: ['dashboard', 'tasks']\r\n    }\r\n)\r\n\r\nexport async function getTodaysFocusTasks() {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\", success: false }\r\n\r\n    const userId = parseInt(session.user.id)\r\n\r\n    try {\r\n        return await getCachedTodaysFocusTasks(userId)\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching today's focus tasks:\", error)\r\n        return { error: \"Failed to fetch today's tasks\", details: error.message, success: false }\r\n    }\r\n}\r\n","export {getPublicSystemSettings as '0033db22356cbf8845a3517099b63dfc38d1147299'} from 'ACTIONS_MODULE0'\nexport {getAllProjectsUnreadNotificationCount as '00686a7231b739e4fe9b8305b757bc0e83827b9865'} from 'ACTIONS_MODULE1'\nexport {getAllProjectsNotifications as '4004a0aae390e2c1aeb900c79065f312ac43d90f8d'} from 'ACTIONS_MODULE1'\nexport {markProjectNotificationAsRead as '60691655a7ad6aec29ab9691d8571a0d380be93da1'} from 'ACTIONS_MODULE1'\nexport {getDashboardSummary as '0059cd3e195cf85d3e59a91eb54091d7bf4cbae302'} from 'ACTIONS_MODULE2'\nexport {getTodaysFocusTasks as '0060f55b20101b46209916d322e57fe57b7697ebe9'} from 'ACTIONS_MODULE2'\nexport {updateTaskStatus as '709a22b83fb95b514103e9a68c206c65a10f984982'} from 'ACTIONS_MODULE3'\nexport {getUrgentProjects as '002d971c7f5a3882ee40ebedc20527bd73b0bb1658'} from 'ACTIONS_MODULE4'\nexport {acknowledgeUrgentProject as '40271b869aa95cc70186c7d92a799fd4ff185374b6'} from 'ACTIONS_MODULE4'\n"],"names":[],"mappings":"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","ignoreList":[5,6,7,8,9,10,11,13,14]}