{"version":3,"sources":["../../../../../../../nxt/New%20folder/Project_Management_NXT/.next-internal/server/app/register/page/actions.js%20%28server%20actions%20loader%29","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/app/actions/register.ts"],"sourcesContent":["export {getPublicSystemSettings as '0033db22356cbf8845a3517099b63dfc38d1147299'} from 'ACTIONS_MODULE0'\nexport {registerUser as '40939913bcced5129a7de9a93cfc6e92fdacf5ef98'} from 'ACTIONS_MODULE1'\n","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport bcrypt from \"bcryptjs\"\r\nimport { z } from \"zod\"\r\n\r\nconst registerSchema = z.object({\r\n    username: z.string().min(3, \"Username must be at least 3 characters\"),\r\n    email: z.string().email(\"Invalid email address\"),\r\n    password: z.string().min(6, \"Password must be at least 6 characters\"),\r\n})\r\n\r\nexport async function registerUser(formData: FormData) {\r\n    const username = formData.get(\"username\")\r\n    const email = formData.get(\"email\")\r\n    const password = formData.get(\"password\")\r\n\r\n    // Server-side validation\r\n    const validatedFields = registerSchema.safeParse({\r\n        username,\r\n        email,\r\n        password,\r\n    })\r\n\r\n    if (!validatedFields.success) {\r\n        return {\r\n            error: \"Validation failed. Please check your inputs.\",\r\n            details: validatedFields.error.flatten().fieldErrors,\r\n        }\r\n    }\r\n\r\n    const { username: validUsername, email: validEmail, password: validPassword } = validatedFields.data\r\n\r\n    try {\r\n        // Check if user exists\r\n        const existingUser = await prisma.user.findFirst({\r\n            where: {\r\n                OR: [{ email: validEmail }, { username: validUsername }],\r\n            },\r\n        })\r\n\r\n        if (existingUser) {\r\n            return { error: \"User with this email or username already exists.\" }\r\n        }\r\n\r\n        // Hash password\r\n        const hashedPassword = await bcrypt.hash(validPassword, 10)\r\n\r\n        // Create user\r\n        await prisma.user.create({\r\n            data: {\r\n                username: validUsername,\r\n                email: validEmail,\r\n                passwordHash: hashedPassword,\r\n                role: \"developer\", // Default role\r\n            },\r\n        })\r\n\r\n        return { success: true }\r\n    } catch (error) {\r\n        console.error(\"Registration error:\", error)\r\n        return { error: \"Something went wrong. Please try again.\" }\r\n    }\r\n}\r\n"],"names":[],"mappings":"wCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,sBCEA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,sBAEA,IAAM,EAAiB,EAAA,CAAC,CAAC,MAAM,CAAC,CAC5B,SAAU,EAAA,CAAC,CAAC,MAAM,GAAG,GAAG,CAAC,EAAG,0CAC5B,MAAO,EAAA,CAAC,CAAC,MAAM,GAAG,KAAK,CAAC,yBACxB,SAAU,EAAA,CAAC,CAAC,MAAM,GAAG,GAAG,CAAC,EAAG,yCAChC,GAEO,eAAe,EAAa,CAAkB,EACjD,IAAM,EAAW,EAAS,GAAG,CAAC,YACxB,EAAQ,EAAS,GAAG,CAAC,SACrB,EAAW,EAAS,GAAG,CAAC,YAGxB,EAAkB,EAAe,SAAS,CAAC,CAC7C,iBACA,WACA,CACJ,GAEA,GAAI,CAAC,EAAgB,OAAO,CACxB,CAD0B,KACnB,CACH,MAAO,+CACP,QAAS,EAAgB,KAAK,CAAC,OAAO,GAAG,WAAW,AACxD,EAGJ,GAAM,CAAE,SAAU,CAAa,CAAE,MAAO,CAAU,CAAE,SAAU,CAAa,CAAE,CAAG,EAAgB,IAAI,CAEpG,GAAI,CAQA,GANqB,CAMjB,KANuB,EAAA,MAAM,CAAC,AAMhB,IANoB,CAAC,SAAS,CAAC,CAC7C,MAAO,CACH,GAAI,CAAC,CAAE,MAAO,CAAW,EAAG,CAAE,SAAU,CAAc,EAC1D,AAD4D,CAEhE,GAGI,MAAO,CAAE,MAAO,kDAAmD,EAIvE,IAAM,EAAiB,MAAM,EAAA,OAAM,CAAC,IAAI,CAAC,EAAe,IAYxD,OATA,MAAM,EAAA,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CACrB,KAAM,CACF,SAAU,EACV,MAAO,EACP,aAAc,EACd,KAAM,WACV,CACJ,GAEO,CAAE,SAAS,CAAK,CAC3B,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,sBAAuB,GAC9B,CAAE,MAAO,yCAA0C,CAC9D,CACJ,iCAnDsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA"}