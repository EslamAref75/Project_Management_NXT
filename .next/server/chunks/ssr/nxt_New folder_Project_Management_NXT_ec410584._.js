module.exports=[590187,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(450246),e=a.i(915929),f=a.i(449597),g=a.i(126695),h=a.i(153544),i=a.i(661698),j=a.i(57693),k=a.i(287907);let l=i.z.object({projectId:i.z.coerce.number(),reason:i.z.string().min(10,"Reason must be at least 10 characters")});async function m(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};let i=a.get("projectId"),k=a.get("reason"),m=l.safeParse({projectId:i,reason:k});if(!m.success)return{error:"Validation failed",details:m.error.format()};try{let a=await c.prisma.project.findUnique({where:{id:m.data.projectId},include:{projectManager:!0,projectUsers:!0,projectTeams:{include:{team:{include:{teamLead:!0,members:!0}}}}}});if(!a)return{error:"Project not found"};let d=parseInt(b.user.id),e=await (0,j.hasPermissionWithoutRoleBypass)(d,"project.markUrgent",m.data.projectId),i=a.projectManagerId===d||a.createdById===d;if(!e&&!i)return{error:"Unauthorized: You don't have permission to mark this project as urgent"};let k=await c.prisma.project.update({where:{id:m.data.projectId},data:{priority:"urgent",urgentReason:m.data.reason,urgentMarkedAt:new Date,urgentMarkedById:d},include:{projectManager:!0,projectUsers:{select:{userId:!0}},projectTeams:{include:{team:{select:{teamLeadId:!0,members:{select:{userId:!0}}}}}}}}),l=new Set;k.projectManagerId&&l.add(k.projectManagerId),k.projectUsers.forEach(a=>{l.add(a.userId)}),k.projectTeams.forEach(a=>{a.team.teamLeadId&&l.add(a.team.teamLeadId),a.team.members.forEach(a=>{l.add(a.userId)})}),(await c.prisma.user.findMany({where:{role:"admin"},select:{id:!0}})).forEach(a=>l.add(a.id));let n=Array.from(l).map(a=>(0,h.createProjectNotification)(m.data.projectId,a,{type:"project_urgent",entityType:"project",entityId:m.data.projectId,title:`ðŸš¨ URGENT: ${k.name}`,message:`This project has been marked as URGENT. Reason: ${m.data.reason}`,soundRequired:!0,isUrgent:!0,requiresAcknowledgment:!0}));return await Promise.all(n),await (0,g.logActivity)({actionType:"project_marked_urgent",actionCategory:"project",actionSummary:`Project "${k.name}" marked as URGENT`,actionDetails:{projectId:k.id,projectName:k.name,reason:m.data.reason,notifiedUsers:Array.from(l).length},performedById:d,projectId:m.data.projectId,entityType:"project",entityId:m.data.projectId}),(0,f.revalidatePath)(`/dashboard/projects/${m.data.projectId}`),(0,f.revalidatePath)("/dashboard"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0,project:k}}catch(a){return console.error("Error marking project as urgent:",a),{error:"Failed to mark project as urgent",details:a.message}}}async function n(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};let h=parseInt(b.user.id);try{let b=await c.prisma.project.findUnique({where:{id:a}});if(!b)return{error:"Project not found"};if("urgent"!==b.priority)return{error:"Project is not marked as urgent"};return await c.prisma.urgentProjectAcknowledgement.upsert({where:{projectId_userId:{projectId:a,userId:h}},create:{projectId:a,userId:h},update:{acknowledgedAt:new Date}}),await c.prisma.projectNotification.updateMany({where:{projectId:a,userId:h,isUrgent:!0,requiresAcknowledgment:!0},data:{acknowledgedAt:new Date,isRead:!0}}),await (0,g.logActivity)({actionType:"project_urgent_acknowledged",actionCategory:"project",actionSummary:`Acknowledged urgent project "${b.name}"`,actionDetails:{projectId:b.id,projectName:b.name},performedById:h,projectId:a,entityType:"project",entityId:a}),(0,f.revalidatePath)(`/dashboard/projects/${a}`),(0,f.revalidatePath)("/dashboard"),{success:!0}}catch(a){return console.error("Error acknowledging urgent project:",a),{error:"Failed to acknowledge urgent project",details:a.message}}}async function o(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};let h=parseInt(b.user.id);try{let b=await c.prisma.project.findUnique({where:{id:a}});if(!b)return{error:"Project not found"};let d=await (0,j.hasPermissionWithoutRoleBypass)(h,"project.removeUrgent",a),e=b.projectManagerId===h||b.createdById===h;if(!d&&!e)return{error:"Unauthorized: You don't have permission to remove urgent priority from this project"};return await c.prisma.project.update({where:{id:a},data:{priority:"normal",urgentReason:null,urgentMarkedAt:null,urgentMarkedById:null}}),await c.prisma.projectNotification.updateMany({where:{projectId:a,isUrgent:!0},data:{isRead:!0,acknowledgedAt:new Date}}),await (0,g.logActivity)({actionType:"project_urgent_removed",actionCategory:"project",actionSummary:`Removed urgent priority from project "${b.name}"`,actionDetails:{projectId:b.id,projectName:b.name},performedById:h,projectId:a,entityType:"project",entityId:a}),(0,f.revalidatePath)(`/dashboard/projects/${a}`),(0,f.revalidatePath)("/dashboard"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0}}catch(a){return console.error("Error removing urgent priority:",a),{error:"Failed to remove urgent priority",details:a.message}}}async function p(){let a=await (0,d.getServerSession)(e.authOptions);if(!a)return{error:"Unauthorized"};let b=parseInt(a.user.id),f=a.user.role||"developer";try{let a={priority:"urgent"};"admin"!==f&&(a.OR=[{projectManagerId:b},{createdById:b},{projectUsers:{some:{userId:b}}},{projectTeams:{some:{team:{teamLeadId:b}}}},{projectTeams:{some:{team:{members:{some:{userId:b}}}}}}]);let d=await c.prisma.project.findMany({where:a,include:{projectManager:{select:{id:!0,username:!0,avatarUrl:!0}},urgentMarkedBy:{select:{id:!0,username:!0}},urgentAcknowledgments:{where:{userId:b},select:{acknowledgedAt:!0}}},orderBy:{urgentMarkedAt:"desc"}});return{success:!0,projects:d}}catch(a){return console.error("Error fetching urgent projects:",a),{error:"Failed to fetch urgent projects",details:a.message}}}async function q(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return!1;let f=parseInt(b.user.id);try{return!!await c.prisma.urgentProjectAcknowledgement.findUnique({where:{projectId_userId:{projectId:a,userId:f}}})}catch(a){return console.error("Error checking acknowledgment:",a),!1}}(0,k.ensureServerEntryExports)([m,n,o,p,q]),(0,b.registerServerReference)(m,"409f63a3c373c5a1d91cbdece6bed64e7ad1bb9de3",null),(0,b.registerServerReference)(n,"40271b869aa95cc70186c7d92a799fd4ff185374b6",null),(0,b.registerServerReference)(o,"40a1ef9e59469b9018d9dca101e2d6830cd362dfa4",null),(0,b.registerServerReference)(p,"002d971c7f5a3882ee40ebedc20527bd73b0bb1658",null),(0,b.registerServerReference)(q,"406dc0bd8d7e9cdb49e1d05a07a97ade94458c58d0",null),a.s(["acknowledgeUrgentProject",()=>n,"getUrgentProjects",()=>p,"hasAcknowledgedUrgent",()=>q,"markProjectUrgent",()=>m,"removeUrgentPriority",()=>o])},668092,a=>{"use strict";var b=a.i(962460),c=a.i(153544),d=a.i(462266),e=a.i(126695),f=a.i(476662),g=a.i(188417),h=a.i(352827),i=a.i(486431),j=a.i(590187);a.s([],783242),a.i(783242),a.s(["0033db22356cbf8845a3517099b63dfc38d1147299",()=>b.getPublicSystemSettings,"003ae2a452e6e1e8ebee86f206a9903396d5df13b8",()=>d.getProjects,"0067b4066470cdfc7051409a87b3c7ea74b1f3dbad",()=>g.getAllProjectsStats,"00686a7231b739e4fe9b8305b757bc0e83827b9865",()=>c.getAllProjectsUnreadNotificationCount,"0078a5996050e1da89a66893bd05780e75185392cb",()=>f.getUsers,"4004a0aae390e2c1aeb900c79065f312ac43d90f8d",()=>c.getAllProjectsNotifications,"401e3f4be30a5d5dbee04214aa788c798e018c4c21",()=>d.createProject,"401fc4e21517ebfbd3eebabb3ac6ad3bf2fb7443a7",()=>f.createUser,"402c9fcdaf734573eeb364d1e92aac14ecf31bcfb9",()=>d.getProject,"406144e6cbbfbe91083d4680cc56756da14a65698a",()=>d.getProjectsWithFilters,"406fd270e8a350e38c78e4b79321560707aa26fd1a",()=>f.getUser,"408c06bc00554e58667a6497e03286e21786a0b4de",()=>g.getProjectStats,"4092a06687f1e4d6d11b97639f194f16619a7c015f",()=>g.getTaskStats,"409f63a3c373c5a1d91cbdece6bed64e7ad1bb9de3",()=>j.markProjectUrgent,"40a1ef9e59469b9018d9dca101e2d6830cd362dfa4",()=>j.removeUrgentPriority,"40abdcd9a05b7e5b6a27a4efd7412defa3f340c60c",()=>f.deleteUser,"40daa1d9c7314de4957a7669434db12aaa24630ba4",()=>e.logActivity,"40eb0a5c1df80ac1d9c012cf4d456e2b96fc6eccd4",()=>i.getProjectStatuses,"40fdba31998d7a3efe7c944c688cf93002e917af7b",()=>d.deleteProject,"601c00162e3e64028c2b657a9e3982df01dad141d5",()=>d.updateProject,"6020ac488ab0f44300111f3a8024b04b647106d187",()=>f.updateUserTeam,"60691655a7ad6aec29ab9691d8571a0d380be93da1",()=>c.markProjectNotificationAsRead,"60b33fdd6fc55215f2569d47e96e5d33d33f4f707f",()=>f.toggleUserStatus,"60e05fd890f5d06ad446fdd4907a3fbe4311fe3ac9",()=>g.getSummaryStatsWithTrends,"60e1fb0fb657783a6424ba7525af9dca8a6316a12b",()=>f.updateUser,"60ec9252c798f5964d56c5d51f9afd9f2f40212108",()=>h.getProjectTypes],668092)}];

//# sourceMappingURL=nxt_New%20folder_Project_Management_NXT_ec410584._.js.map