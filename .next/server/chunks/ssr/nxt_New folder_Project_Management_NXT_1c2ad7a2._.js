module.exports=[477449,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(450246),e=a.i(915929),f=a.i(449597),g=a.i(661698),h=a.i(126695),i=a.i(57693),j=a.i(766050),k=a.i(287907);async function l(a){return(0,i.hasPermissionWithoutRoleBypass)(a,j.PERMISSIONS.SETTINGS.TASK_STATUS_MANAGE)}let m=g.z.object({name:g.z.string().min(1,"Name is required"),color:g.z.string().regex(/^#[0-9A-Fa-f]{6}$/,"Color must be a valid hex color"),isDefault:g.z.boolean(),isFinal:g.z.boolean(),isBlocking:g.z.boolean(),orderIndex:g.z.number().int().min(0),isActive:g.z.boolean()});async function n(a=!1){if(!await (0,d.getServerSession)(e.authOptions))return{error:"Unauthorized"};try{if(!c.prisma.taskStatus)return{error:"TaskStatus model not found. Please stop the dev server, run 'npx prisma generate', and restart the server.",details:"Prisma client needs to be regenerated after adding the TaskStatus model"};let b=await c.prisma.taskStatus.findMany({where:a?{}:{isActive:!0},orderBy:[{orderIndex:"asc"},{name:"asc"}]});return{success:!0,taskStatuses:b}}catch(a){if(console.error("Error fetching task statuses:",a),a.message?.includes("taskStatus")||a.message?.includes("does not exist"))return{error:"TaskStatus model not found. Please stop the dev server, run 'npx prisma generate', and restart the server.",details:a.message};return{error:"Failed to fetch task statuses",details:a.message}}}async function o(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if(!await l(parseInt(b.user.id)))return{error:"Permission denied: You don't have permission to manage task statuses"};if(!c.prisma.taskStatus)return{error:"TaskStatus model not found. Please stop the dev server, run 'npx prisma generate', and restart the server.",details:"Prisma client needs to be regenerated after adding the TaskStatus model"};let g=a.get("name"),i=a.get("color")||"#6b7280",j=a.get("isDefault"),k=a.get("isFinal"),n=a.get("isBlocking"),o=a.get("orderIndex"),p=a.get("isActive"),q="true"===String(j),r="true"===String(k),s="true"===String(n),t="true"===String(p);if(console.log("Creating task status with values:",{name:g,color:i,isDefault:q,isFinal:r,isBlocking:s,orderIndex:o?parseInt(o):0,isActive:t}),q)try{await c.prisma.taskStatus.updateMany({where:{isDefault:!0},data:{isDefault:!1}})}catch(a){if(a.message?.includes("taskStatus")||a.message?.includes("does not exist"))console.warn("TaskStatus model not available, skipping default status update");else throw a}let u=m.safeParse({name:g,color:i,isDefault:q,isFinal:r,isBlocking:s,orderIndex:o?parseInt(o):0,isActive:t});if(!u.success)return console.error("Validation failed:",u.error.format()),{error:"Validation failed",details:u.error.format()};try{console.log("Creating task status with validated data:",u.data);let a=await c.prisma.taskStatus.create({data:u.data});console.log("Task status created successfully:",a);try{await (0,h.logActivity)({actionType:"task_status_created",actionCategory:"settings",actionSummary:`Task status "${a.name}" created`,actionDetails:{statusId:a.id,statusName:a.name,color:a.color,isDefault:a.isDefault,isFinal:a.isFinal,isBlocking:a.isBlocking},performedById:parseInt(b.user.id),entityType:"task_status",entityId:a.id})}catch(a){console.error("Failed to log activity:",a)}return(0,f.revalidatePath)("/dashboard/settings/projects"),(0,f.revalidatePath)("/dashboard/tasks"),{success:!0,taskStatus:a}}catch(a){if(console.error("Error creating task status:",a),console.error("Error details:",{code:a.code,meta:a.meta,message:a.message}),"P2021"===a.code||a.message?.includes("does not exist")||a.message?.includes("no such table"))return{error:"Database table not found. Please run the migration: npx prisma db execute --file prisma/migrations/manual_add_task_statuses.sql --schema prisma/schema.prisma",details:a.message};if("P2002"===a.code)return{error:"A task status with this name already exists"};return{error:"Failed to create task status",details:a.message}}}async function p(a,b){let g=await (0,d.getServerSession)(e.authOptions);if(!g)return{error:"Unauthorized"};if("admin"!==g.user.role)return{error:"Only admins can update task statuses"};let i=await c.prisma.taskStatus.findUnique({where:{id:a}});if(!i)return{error:"Task status not found"};let j=b.get("name"),k=b.get("color")||"#6b7280",l=b.get("isDefault"),n=b.get("isFinal"),o=b.get("isBlocking"),p=b.get("isActive"),q=b.get("orderIndex"),r="true"===String(l),s="true"===String(n),t="true"===String(o),u="true"===String(p);if(console.log("Update - Parsed form values:",{name:j,color:k,isDefaultValue:l,isDefault:r,isFinalValue:n,isFinal:s,isBlockingValue:o,isBlocking:t,isActiveValue:p,isActive:u,orderIndex:q}),r&&!i.isDefault)try{await c.prisma.taskStatus.updateMany({where:{isDefault:!0},data:{isDefault:!1}})}catch(a){console.error("Error unsetting other defaults:",a)}let v=m.safeParse({name:j,color:k,isDefault:r,isFinal:s,isBlocking:t,orderIndex:q?parseInt(q):i.orderIndex,isActive:u});if(!v.success)return console.error("Validation failed:",v.error.format()),{error:"Validation failed",details:v.error.format()};try{let b={name:i.name,color:i.color,isDefault:i.isDefault,isFinal:i.isFinal,isBlocking:i.isBlocking,isActive:i.isActive,orderIndex:i.orderIndex},d=await c.prisma.taskStatus.update({where:{id:a},data:v.data});try{await (0,h.logActivity)({actionType:"task_status_updated",actionCategory:"settings",actionSummary:`Task status "${d.name}" updated`,actionDetails:{statusId:d.id,oldValues:b,newValues:{name:d.name,color:d.color,isDefault:d.isDefault,isFinal:d.isFinal,isBlocking:d.isBlocking,isActive:d.isActive,orderIndex:d.orderIndex}},performedById:parseInt(g.user.id),entityType:"task_status",entityId:d.id})}catch(a){console.error("Failed to log activity:",a)}return(0,f.revalidatePath)("/dashboard/settings/projects"),(0,f.revalidatePath)("/dashboard/tasks"),{success:!0,taskStatus:d}}catch(a){if(console.error("Error updating task status:",a),"P2002"===a.code)return{error:"A task status with this name already exists"};return{error:"Failed to update task status",details:a.message}}}async function q(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if("admin"!==b.user.role)return{error:"Only admins can delete task statuses"};let g=await c.prisma.taskStatus.findUnique({where:{id:a},include:{tasks:{take:1}}});if(!g)return{error:"Task status not found"};if(g.tasks.length>0)return{error:"Cannot delete task status. It is assigned to existing tasks. Please deactivate it instead.",details:`${g.tasks.length} task(s) are using this status`};try{await c.prisma.taskStatus.delete({where:{id:a}});try{await (0,h.logActivity)({actionType:"task_status_deleted",actionCategory:"settings",actionSummary:`Task status "${g.name}" deleted`,actionDetails:{statusId:g.id,statusName:g.name},performedById:parseInt(b.user.id),entityType:"task_status",entityId:g.id})}catch(a){console.error("Failed to log activity:",a)}return(0,f.revalidatePath)("/dashboard/settings/projects"),(0,f.revalidatePath)("/dashboard/tasks"),{success:!0}}catch(a){return console.error("Error deleting task status:",a),{error:"Failed to delete task status",details:a.message}}}async function r(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if("admin"!==b.user.role)return{error:"Only admins can toggle task statuses"};let g=await c.prisma.taskStatus.findUnique({where:{id:a}});if(!g)return{error:"Task status not found"};try{let d=!g.isActive,e=await c.prisma.taskStatus.update({where:{id:a},data:{isActive:d}});try{await (0,h.logActivity)({actionType:"task_status_toggled",actionCategory:"settings",actionSummary:`Task status "${g.name}" ${d?"activated":"deactivated"}`,actionDetails:{statusId:g.id,statusName:g.name,oldValue:g.isActive,newValue:d},performedById:parseInt(b.user.id),entityType:"task_status",entityId:g.id})}catch(a){console.error("Failed to log activity:",a)}return(0,f.revalidatePath)("/dashboard/settings/projects"),(0,f.revalidatePath)("/dashboard/tasks"),{success:!0,taskStatus:e}}catch(a){return console.error("Error toggling task status:",a),{error:"Failed to toggle task status",details:a.message}}}async function s(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if("admin"!==b.user.role)return{error:"Only admins can reorder task statuses"};try{let d=a.map((a,b)=>c.prisma.taskStatus.update({where:{id:a},data:{orderIndex:b}}));await Promise.all(d);try{await (0,h.logActivity)({actionType:"task_statuses_reordered",actionCategory:"settings",actionSummary:"Task statuses reordered",actionDetails:{newOrder:a},performedById:parseInt(b.user.id),entityType:"task_status",entityId:a[0]||0})}catch(a){console.error("Failed to log activity:",a)}return(0,f.revalidatePath)("/dashboard/settings/projects"),(0,f.revalidatePath)("/dashboard/tasks"),{success:!0}}catch(a){return console.error("Error reordering task statuses:",a),{error:"Failed to reorder task statuses",details:a.message}}}(0,k.ensureServerEntryExports)([n,o,p,q,r,s]),(0,b.registerServerReference)(n,"4086c7fd748133615eeab378484f8213d761238fbf",null),(0,b.registerServerReference)(o,"409ffaa16924c74c678cf301d6dd2c99296e10aaeb",null),(0,b.registerServerReference)(p,"60f41f919904eb5c1356712769a66aa6e55829aaab",null),(0,b.registerServerReference)(q,"40fe576746d9067777bbe9321cc75cceccb9421471",null),(0,b.registerServerReference)(r,"40efaf506c057383e8b5ff321991a6dfa7996990f0",null),(0,b.registerServerReference)(s,"40c2a352954e779c0634ba3022f9a2a67fb11df537",null),a.s(["createTaskStatus",()=>o,"deleteTaskStatus",()=>q,"getTaskStatuses",()=>n,"toggleTaskStatusActive",()=>r,"updateTaskStatus",()=>p])},740284,a=>{"use strict";var b=a.i(962460),c=a.i(153544),d=a.i(6588),e=a.i(126695),f=a.i(723212),g=a.i(476662),h=a.i(184251),i=a.i(347656),j=a.i(450246),k=a.i(915929),l=a.i(449597),m=a.i(661698),n=a.i(287907);let o=m.z.object({parentTaskId:m.z.number(),title:m.z.string().min(1,"Title is required"),description:m.z.string().optional(),priority:m.z.enum(["low","medium","high","critical","normal"]).default("normal"),startDate:m.z.string().optional().nullable(),dueDate:m.z.string().optional().nullable(),estimatedHours:m.z.number().min(0).default(0),assignedToId:m.z.number().optional().nullable(),teamId:m.z.number().optional().nullable()});async function p(a){let b=await (0,j.getServerSession)(k.authOptions);if(!b)return{error:"Unauthorized"};let c=o.safeParse(a);if(!c.success){console.error("Validation failed object:",JSON.stringify(c,null,2));let a=c.error.flatten();console.error("Flattened errors:",a);let b=Object.values(a.fieldErrors)[0]?.[0],d=a.formErrors[0];return{error:b||d||"Invalid input"}}let{parentTaskId:d,title:e,description:f,priority:g,startDate:h,dueDate:m,estimatedHours:n,assignedToId:p,teamId:q}=c.data,r=parseInt(b.user.id);try{let a=await i.prisma.task.findUnique({where:{id:d}});if(!a)return{error:"Parent task not found"};let b=await i.prisma.subtask.create({data:{title:e,description:f,priority:g,startDate:h?new Date(h):null,dueDate:m?new Date(m):null,estimatedHours:n,parentTaskId:d,createdById:r,assignedToId:p,teamId:q}});return(0,l.revalidatePath)(`/dashboard/projects/${a.projectId}/tasks/${d}`),(0,l.revalidatePath)(`/dashboard/tasks/${d}`),(0,l.revalidatePath)("/dashboard/tasks"),{success:!0,subtask:b}}catch(a){return console.error("Create Subtask Error:",a),{error:"Failed to create subtask"}}}async function q(a){if(!await (0,j.getServerSession)(k.authOptions))return{error:"Unauthorized"};try{return{subtasks:await i.prisma.subtask.findMany({where:{parentTaskId:a},include:{assignedTo:{select:{id:!0,username:!0,avatarUrl:!0}},creator:{select:{username:!0}}},orderBy:{createdAt:"asc"}})}}catch(a){return{error:"Failed to fetch subtasks"}}}async function r(a,b){if(!await (0,j.getServerSession)(k.authOptions))return{error:"Unauthorized"};try{let c=await i.prisma.subtask.update({where:{id:a},data:{...b,startDate:null===b.startDate?null:b.startDate?new Date(b.startDate):void 0,dueDate:null===b.dueDate?null:b.dueDate?new Date(b.dueDate):void 0},include:{parentTask:!0}});return c.parentTask&&(0,l.revalidatePath)(`/dashboard/projects/${c.parentTask.projectId}/tasks/${c.parentTaskId}`),(0,l.revalidatePath)(`/dashboard/tasks/${c.parentTaskId}`),(0,l.revalidatePath)("/dashboard/tasks"),{success:!0,subtask:c}}catch(a){return console.error("Update Subtask Error:",a),{error:"Failed to update subtask"}}}async function s(a){if(!await (0,j.getServerSession)(k.authOptions))return{error:"Unauthorized"};try{let b=await i.prisma.subtask.delete({where:{id:a},include:{parentTask:!0}});return b.parentTask&&(0,l.revalidatePath)(`/dashboard/projects/${b.parentTask.projectId}/tasks/${b.parentTaskId}`),(0,l.revalidatePath)(`/dashboard/tasks/${b.parentTaskId}`),(0,l.revalidatePath)("/dashboard/tasks"),{success:!0}}catch(a){return{error:"Failed to delete subtask"}}}(0,n.ensureServerEntryExports)([p,q,r,s]),(0,h.registerServerReference)(p,"4092279ff8e6ca25b90aeb832f385d51d9d7c60d48",null),(0,h.registerServerReference)(q,"409a92bc0fdbc33eade4071051d719c4100685d38f",null),(0,h.registerServerReference)(r,"600329ba0ba9cc97651d7734bbf3d4a35a31ef80d5",null),(0,h.registerServerReference)(s,"403f8a5c068c0438ff16759bb9ee34241fe1078c6f",null);let t=m.z.object({content:m.z.string().min(1,"Content is required"),taskId:m.z.coerce.number(),projectId:m.z.coerce.number()});async function u(a){let b=await (0,j.getServerSession)(k.authOptions);if(!b)return{error:"Unauthorized"};let d=a.get("content"),e=a.get("taskId"),f=a.get("projectId"),g=t.safeParse({content:d,taskId:e,projectId:f});if(!g.success)return{error:"Validation failed"};try{let a,d=await i.prisma.task.findUnique({where:{id:g.data.taskId},select:{id:!0,title:!0,projectId:!0}});if(!d)return{error:"Task not found"};let e=await i.prisma.comment.create({data:{content:g.data.content,taskId:g.data.taskId,userId:parseInt(b.user.id)}}),f=(a=g.data.content.match(/@([\w.-]+)/g))?[...new Set(a.map(a=>a.substring(1)))]:[];if(console.log("ðŸ“ Comment Content:",g.data.content),console.log("ðŸ‘€ Extracted Mentions:",f),f.length>0){let a=await i.prisma.user.findMany({where:{username:{in:f}},select:{id:!0,username:!0}});console.log("ðŸ‘¥ Found Mentioned Users:",a);let h=await i.prisma.user.findUnique({where:{id:parseInt(b.user.id)},select:{username:!0}});for(let f of a){if(f.id===parseInt(b.user.id)){console.log("ðŸš« Skipping self-mention for user:",f.username);continue}await i.prisma.commentMention.create({data:{commentId:e.id,userId:f.id}}),console.log("ðŸ”” Creating notification for:",f.username),await (0,c.createProjectNotification)(g.data.projectId,f.id,{type:"comment_mention",entityType:"comment_mention",entityId:g.data.taskId,title:"You were mentioned in a comment",message:`${h?.username||"Someone"} mentioned you in a comment on task "${d.title}"`,soundRequired:!0,isUrgent:!1,requiresAcknowledgment:!1})}}return(0,l.revalidatePath)(`/dashboard/projects/${g.data.projectId}/tasks/${g.data.taskId}`),{success:!0}}catch(a){return console.error(a),{error:"Failed to create comment"}}}(0,n.ensureServerEntryExports)([u]),(0,h.registerServerReference)(u,"40a65e7babeb7969d8364ec60bd423ee1c78b2ae4a",null);var v=a.i(477449);a.s([],355240),a.i(355240),a.s(["000fbd81a81ae8a8928c77cb3ace462c34a924fe15",()=>d.getAllTasks,"00176f3ab9f7a89d717fcba315d11e24c1f7818b0b",()=>d.getMyTasks,"0033db22356cbf8845a3517099b63dfc38d1147299",()=>b.getPublicSystemSettings,"00686a7231b739e4fe9b8305b757bc0e83827b9865",()=>c.getAllProjectsUnreadNotificationCount,"0078a5996050e1da89a66893bd05780e75185392cb",()=>g.getUsers,"4004a0aae390e2c1aeb900c79065f312ac43d90f8d",()=>c.getAllProjectsNotifications,"4009825537fe252354e189caeeedab8c017606c70b",()=>f.getTaskDependents,"401205bebba1cf3dc7d8ff35126dbeee53f67d0ee7",()=>f.getTaskDependencies,"401fc4e21517ebfbd3eebabb3ac6ad3bf2fb7443a7",()=>g.createUser,"402619b555ef898d642e1eaa38261c5090360b7909",()=>f.isTaskBlocked,"402d88094f0d43ffbbdb2cc55981130389e939c098",()=>d.createTask,"403db43b4fa87e3c4395d96062ae591067c02e1975",()=>d.getTasksWithFilters,"403f8a5c068c0438ff16759bb9ee34241fe1078c6f",()=>s,"406fd270e8a350e38c78e4b79321560707aa26fd1a",()=>g.getUser,"4073df5af18efe51e33e158abaa2dd30f11932484d",()=>c.getProjectNotificationPreferences,"4086c7fd748133615eeab378484f8213d761238fbf",()=>v.getTaskStatuses,"408efdebfc4004ac6153e7e7c6e1bfcf2efead0da8",()=>d.getTask,"4092279ff8e6ca25b90aeb832f385d51d9d7c60d48",()=>p,"40a65e7babeb7969d8364ec60bd423ee1c78b2ae4a",()=>u,"40abdcd9a05b7e5b6a27a4efd7412defa3f340c60c",()=>g.deleteUser,"40b408831ea3954e375d99f8ba4ff27359527e7e4b",()=>f.createTaskDependency,"40c086aae8b4c1ddec14829c213410ee4c5d2ec0b4",()=>c.markAllProjectNotificationsAsRead,"40c45036bf2dcfbc3a3b624285c3d3d3366fc5ed73",()=>c.getProjectUnreadNotificationCount,"40daa1d9c7314de4957a7669434db12aaa24630ba4",()=>e.logActivity,"40db1cdcc45db655c6914f09995d8097bcc488bbce",()=>d.deleteTask,"40dd61ff2058f534f42f49da426a52f160b4b04ec1",()=>f.getAvailableDependencyTasks,"600329ba0ba9cc97651d7734bbf3d4a35a31ef80d5",()=>r,"6020ac488ab0f44300111f3a8024b04b647106d187",()=>g.updateUserTeam,"604f3a4a12d21d9ff500f2582d8b0d2c84fbc7c29b",()=>f.removeTaskDependency,"6066449d29d31fc61eee331d63571737ef28220e06",()=>d.updateTask,"60691655a7ad6aec29ab9691d8571a0d380be93da1",()=>c.markProjectNotificationAsRead,"60b33fdd6fc55215f2569d47e96e5d33d33f4f707f",()=>g.toggleUserStatus,"60d7258dffa20b5ae58a4ac333313c2a6cc4aeb7a7",()=>c.updateProjectNotificationPreferences,"60e11d18f808d2843f4d06a35ea4ad9027dd8b4de1",()=>c.getProjectNotifications,"60e1fb0fb657783a6424ba7525af9dca8a6316a12b",()=>g.updateUser,"705f7777ed9cdc6c32f418ba57dcb7f4b84f8c002a",()=>c.createProjectNotification,"709a22b83fb95b514103e9a68c206c65a10f984982",()=>d.updateTaskStatus],740284)}];

//# sourceMappingURL=nxt_New%20folder_Project_Management_NXT_1c2ad7a2._.js.map