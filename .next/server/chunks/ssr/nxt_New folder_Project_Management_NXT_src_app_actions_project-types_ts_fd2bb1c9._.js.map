{"version":3,"sources":["../../../../../../../nxt/New%20folder/Project_Management_NXT/src/app/actions/project-types.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/app/actions/project-statuses.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { getServerSession } from \"next-auth\"\r\nimport { authOptions } from \"@/lib/auth\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { z } from \"zod\"\r\nimport { logActivity } from \"@/lib/activity-logger\"\r\nimport { hasPermissionWithoutRoleBypass } from \"@/lib/rbac-helpers\"\r\nimport { PERMISSIONS } from \"@/lib/permissions\"\r\n\r\n// Helper function to check project metadata management permission (no role-based bypass)\r\nasync function checkProjectMetadataPermission(userId: number): Promise<boolean> {\r\n    return hasPermissionWithoutRoleBypass(\r\n        userId,\r\n        PERMISSIONS.SETTINGS.PROJECT_TYPE_MANAGE\r\n    )\r\n}\r\n\r\nconst projectTypeSchema = z.object({\r\n    name: z.string().min(1, \"Name is required\").max(100),\r\n    description: z.string().optional(),\r\n    isActive: z.boolean().default(true),\r\n    displayOrder: z.number().int().default(0),\r\n    color: z.string().optional(),\r\n    icon: z.string().optional(),\r\n})\r\n\r\nexport async function getProjectTypes(includeInactive = false, includeUsageCount = false) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        const where = includeInactive ? {} : { isActive: true }\r\n        \r\n        const projectTypes = await prisma.projectType.findMany({\r\n            where,\r\n            orderBy: [\r\n                { displayOrder: \"asc\" },\r\n                { name: \"asc\" }\r\n            ],\r\n            include: includeUsageCount ? {\r\n                _count: {\r\n                    select: { projects: true }\r\n                }\r\n            } : undefined,\r\n        })\r\n\r\n        // Format the result to include usage count\r\n        const formattedTypes = includeUsageCount\r\n            ? projectTypes.map(type => ({\r\n                ...type,\r\n                usageCount: (type as any)._count?.projects || 0\r\n            }))\r\n            : projectTypes\r\n\r\n        return { success: true, projectTypes: formattedTypes }\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching project types:\", error)\r\n        return { error: \"Failed to fetch project types\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function createProjectType(formData: FormData) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const hasPermission = await checkProjectMetadataPermission(parseInt(session.user.id))\r\n    if (!hasPermission) {\r\n        return { error: \"Permission denied: You don't have permission to manage project types\" }\r\n    }\r\n\r\n    const name = formData.get(\"name\")\r\n    const description = formData.get(\"description\")\r\n    const isActive = formData.get(\"isActive\") === \"true\"\r\n    const displayOrder = formData.get(\"displayOrder\")\r\n    const color = formData.get(\"color\")\r\n    const icon = formData.get(\"icon\")\r\n\r\n    const validated = projectTypeSchema.safeParse({\r\n        name,\r\n        description: description || undefined,\r\n        isActive,\r\n        displayOrder: displayOrder ? parseInt(displayOrder as string) : 0,\r\n        color: color || undefined,\r\n        icon: icon || undefined,\r\n    })\r\n\r\n    if (!validated.success) {\r\n        return { error: \"Validation failed\", details: validated.error.format() }\r\n    }\r\n\r\n    try {\r\n        const projectType = await prisma.projectType.create({\r\n            data: validated.data,\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_type_created\",\r\n            actionCategory: \"settings\",\r\n            actionSummary: `Project type \"${projectType.name}\" created`,\r\n            actionDetails: {\r\n                typeId: projectType.id,\r\n                typeName: projectType.name,\r\n                description: projectType.description,\r\n                isActive: projectType.isActive,\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            entityType: \"project_type\",\r\n            entityId: projectType.id,\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/settings\")\r\n        revalidatePath(\"/dashboard/projects\")\r\n        \r\n        return { success: true, projectType }\r\n    } catch (error: any) {\r\n        console.error(\"Error creating project type:\", error)\r\n        console.error(\"Error details:\", {\r\n            code: error.code,\r\n            meta: error.meta,\r\n            message: error.message,\r\n        })\r\n        \r\n        // Check if table doesn't exist\r\n        if (error.code === \"P2021\" || error.message?.includes(\"does not exist\")) {\r\n            return { \r\n                error: \"Database table not found. Please run the migration: npx prisma db execute --file prisma/migrations/20250103000001_add_project_types/migration.sql\",\r\n                details: error.message \r\n            }\r\n        }\r\n        \r\n        return { error: \"Failed to create project type\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function updateProjectType(id: number, formData: FormData) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const hasPermission = await checkProjectMetadataPermission(parseInt(session.user.id))\r\n    if (!hasPermission) {\r\n        return { error: \"Permission denied: You don't have permission to manage project types\" }\r\n    }\r\n\r\n    const name = formData.get(\"name\")\r\n    const description = formData.get(\"description\")\r\n    const isActive = formData.get(\"isActive\") === \"true\"\r\n    const displayOrder = formData.get(\"displayOrder\")\r\n    const color = formData.get(\"color\")\r\n    const icon = formData.get(\"icon\")\r\n\r\n    const validated = projectTypeSchema.safeParse({\r\n        name,\r\n        description: description || undefined,\r\n        isActive,\r\n        displayOrder: displayOrder ? parseInt(displayOrder as string) : 0,\r\n        color: color || undefined,\r\n        icon: icon || undefined,\r\n    })\r\n\r\n    if (!validated.success) {\r\n        return { error: \"Validation failed\", details: validated.error.format() }\r\n    }\r\n\r\n    try {\r\n        const existing = await prisma.projectType.findUnique({\r\n            where: { id },\r\n        })\r\n\r\n        if (!existing) {\r\n            return { error: \"Project type not found\" }\r\n        }\r\n\r\n        const projectType = await prisma.projectType.update({\r\n            where: { id },\r\n            data: validated.data,\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_type_updated\",\r\n            actionCategory: \"settings\",\r\n            actionSummary: `Project type \"${projectType.name}\" updated`,\r\n            actionDetails: {\r\n                typeId: projectType.id,\r\n                oldValues: {\r\n                    name: existing.name,\r\n                    description: existing.description,\r\n                    isActive: existing.isActive,\r\n                },\r\n                newValues: {\r\n                    name: projectType.name,\r\n                    description: projectType.description,\r\n                    isActive: projectType.isActive,\r\n                },\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            entityType: \"project_type\",\r\n            entityId: projectType.id,\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/settings\")\r\n        revalidatePath(\"/dashboard/projects\")\r\n        \r\n        return { success: true, projectType }\r\n    } catch (error: any) {\r\n        console.error(\"Error updating project type:\", error)\r\n        return { error: \"Failed to update project type\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function deleteProjectType(id: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const hasPermission = await checkProjectMetadataPermission(parseInt(session.user.id))\r\n    if (!hasPermission) {\r\n        return { error: \"Permission denied: You don't have permission to manage project types\" }\r\n    }\r\n\r\n    try {\r\n        // Check if any projects are using this type\r\n        const projectsCount = await prisma.project.count({\r\n            where: { projectTypeId: id },\r\n        })\r\n\r\n        if (projectsCount > 0) {\r\n            return { \r\n                error: `Cannot delete project type. ${projectsCount} project(s) are using it.` \r\n            }\r\n        }\r\n\r\n        const type = await prisma.projectType.findUnique({\r\n            where: { id },\r\n        })\r\n\r\n        if (!type) {\r\n            return { error: \"Project type not found\" }\r\n        }\r\n\r\n        await prisma.projectType.delete({\r\n            where: { id },\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_type_deleted\",\r\n            actionCategory: \"settings\",\r\n            actionSummary: `Project type \"${type.name}\" deleted`,\r\n            actionDetails: {\r\n                typeId: type.id,\r\n                typeName: type.name,\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            entityType: \"project_type\",\r\n            entityId: type.id,\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/settings\")\r\n        revalidatePath(\"/dashboard/projects\")\r\n        \r\n        return { success: true }\r\n    } catch (error: any) {\r\n        console.error(\"Error deleting project type:\", error)\r\n        return { error: \"Failed to delete project type\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function toggleProjectTypeStatus(id: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const hasPermission = await checkProjectMetadataPermission(parseInt(session.user.id))\r\n    if (!hasPermission) {\r\n        return { error: \"Permission denied: You don't have permission to manage project types\" }\r\n    }\r\n\r\n    try {\r\n        const current = await prisma.projectType.findUnique({\r\n            where: { id },\r\n            select: { isActive: true },\r\n        })\r\n\r\n        if (!current) {\r\n            return { error: \"Project type not found\" }\r\n        }\r\n\r\n        const projectType = await prisma.projectType.update({\r\n            where: { id },\r\n            data: { isActive: !current.isActive },\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_type_toggled\",\r\n            actionCategory: \"settings\",\r\n            actionSummary: `Project type \"${projectType.name}\" ${projectType.isActive ? \"activated\" : \"deactivated\"}`,\r\n            actionDetails: {\r\n                typeId: projectType.id,\r\n                typeName: projectType.name,\r\n                isActive: projectType.isActive,\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            entityType: \"project_type\",\r\n            entityId: projectType.id,\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/settings\")\r\n        revalidatePath(\"/dashboard/projects\")\r\n        \r\n        return { success: true, projectType }\r\n    } catch (error: any) {\r\n        console.error(\"Error toggling project type status:\", error)\r\n        return { error: \"Failed to toggle project type status\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function reorderProjectTypes(ids: number[]) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const hasPermission = await checkProjectMetadataPermission(parseInt(session.user.id))\r\n    if (!hasPermission) {\r\n        return { error: \"Permission denied: You don't have permission to manage project types\" }\r\n    }\r\n\r\n    try {\r\n        // Update display order for each project type\r\n        const updates = ids.map((id, index) =>\r\n            prisma.projectType.update({\r\n                where: { id },\r\n                data: { displayOrder: index },\r\n            })\r\n        )\r\n\r\n        await Promise.all(updates)\r\n\r\n        revalidatePath(\"/dashboard/settings\")\r\n        revalidatePath(\"/dashboard/projects\")\r\n        \r\n        return { success: true }\r\n    } catch (error: any) {\r\n        console.error(\"Error reordering project types:\", error)\r\n        return { error: \"Failed to reorder project types\", details: error.message }\r\n    }\r\n}\r\n\r\n","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { getServerSession } from \"next-auth\"\r\nimport { authOptions } from \"@/lib/auth\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { z } from \"zod\"\r\nimport { logActivity } from \"@/lib/activity-logger\"\r\nimport { hasPermissionWithoutRoleBypass } from \"@/lib/rbac-helpers\"\r\nimport { PERMISSIONS } from \"@/lib/permissions\"\r\n\r\n// Helper function to check project status management permission (no role-based bypass)\r\nasync function checkProjectStatusPermission(userId: number): Promise<boolean> {\r\n    return hasPermissionWithoutRoleBypass(\r\n        userId,\r\n        PERMISSIONS.SETTINGS.PROJECT_STATUS_MANAGE\r\n    )\r\n}\r\n\r\nconst projectStatusSchema = z.object({\r\n    name: z.string().min(1, \"Name is required\").max(100),\r\n    color: z.string().regex(/^#[0-9A-Fa-f]{6}$/, \"Color must be a valid hex color\"),\r\n    isDefault: z.boolean().default(false),\r\n    isFinal: z.boolean().default(false),\r\n    isUrgent: z.boolean().default(false),\r\n    orderIndex: z.number().int().default(0),\r\n    isActive: z.boolean().default(true),\r\n})\r\n\r\nexport async function getProjectStatuses(includeInactive = false) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    try {\r\n        // Check if ProjectStatus model exists in Prisma client\r\n        if (!prisma.projectStatus) {\r\n            return { \r\n                error: \"ProjectStatus model not found. Please stop the dev server, run 'npx prisma generate', and restart the server.\",\r\n                details: \"Prisma client needs to be regenerated after adding the ProjectStatus model\"\r\n            }\r\n        }\r\n\r\n        const where = includeInactive ? {} : { isActive: true }\r\n        \r\n        const projectStatuses = await prisma.projectStatus.findMany({\r\n            where,\r\n            orderBy: [\r\n                { orderIndex: \"asc\" },\r\n                { name: \"asc\" }\r\n            ],\r\n        })\r\n\r\n        return { success: true, projectStatuses }\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching project statuses:\", error)\r\n        \r\n        // Check if it's a model not found error\r\n        if (error.message?.includes(\"projectStatus\") || error.message?.includes(\"does not exist\")) {\r\n            return { \r\n                error: \"ProjectStatus model not found. Please stop the dev server, run 'npx prisma generate', and restart the server.\",\r\n                details: error.message\r\n            }\r\n        }\r\n        \r\n        return { error: \"Failed to fetch project statuses\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function createProjectStatus(formData: FormData) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const hasPermission = await checkProjectStatusPermission(parseInt(session.user.id))\r\n    if (!hasPermission) {\r\n        return { error: \"Permission denied: You don't have permission to manage project statuses\" }\r\n    }\r\n\r\n    // Check if ProjectStatus model exists in Prisma client\r\n    if (!prisma.projectStatus) {\r\n        return { \r\n            error: \"ProjectStatus model not found. Please stop the dev server, run 'npx prisma generate', and restart the server.\",\r\n            details: \"Prisma client needs to be regenerated after adding the ProjectStatus model\"\r\n        }\r\n    }\r\n\r\n    const name = formData.get(\"name\")\r\n    const color = formData.get(\"color\") || \"#6b7280\"\r\n    const isDefaultValue = formData.get(\"isDefault\")\r\n    const isFinalValue = formData.get(\"isFinal\")\r\n    const isUrgentValue = formData.get(\"isUrgent\")\r\n    const isActiveValue = formData.get(\"isActive\")\r\n    const orderIndex = formData.get(\"orderIndex\")\r\n    \r\n    // Handle boolean values - FormData returns strings, so convert properly\r\n    const isDefault = String(isDefaultValue) === \"true\"\r\n    const isFinal = String(isFinalValue) === \"true\"\r\n    const isUrgent = String(isUrgentValue) === \"true\"\r\n    const isActive = String(isActiveValue) === \"true\"\r\n\r\n    // If setting as default, unset other defaults\r\n    if (isDefault) {\r\n        try {\r\n            await prisma.projectStatus.updateMany({\r\n                where: { isDefault: true },\r\n                data: { isDefault: false },\r\n            })\r\n        } catch (error: any) {\r\n            // If projectStatus model doesn't exist yet, skip this step\r\n            // This can happen if Prisma client hasn't been regenerated\r\n            if (error.message?.includes(\"projectStatus\") || error.message?.includes(\"does not exist\")) {\r\n                console.warn(\"ProjectStatus model not available, skipping default status update\")\r\n            } else {\r\n                throw error\r\n            }\r\n        }\r\n    }\r\n\r\n    // Debug: Log the values being parsed\r\n    console.log(\"Creating project status with values:\", {\r\n        name,\r\n        color,\r\n        isDefault,\r\n        isFinal,\r\n        isUrgent,\r\n        orderIndex: orderIndex ? parseInt(orderIndex as string) : 0,\r\n        isActive,\r\n    })\r\n\r\n    const validated = projectStatusSchema.safeParse({\r\n        name,\r\n        color,\r\n        isDefault,\r\n        isFinal,\r\n        isUrgent,\r\n        orderIndex: orderIndex ? parseInt(orderIndex as string) : 0,\r\n        isActive,\r\n    })\r\n\r\n    if (!validated.success) {\r\n        console.error(\"Validation failed:\", validated.error.format())\r\n        return { error: \"Validation failed\", details: validated.error.format() }\r\n    }\r\n\r\n    try {\r\n        const projectStatus = await prisma.projectStatus.create({\r\n            data: validated.data,\r\n        })\r\n\r\n        // Log activity\r\n        try {\r\n            await logActivity({\r\n                actionType: \"project_status_created\",\r\n                actionCategory: \"settings\",\r\n                actionSummary: `Project status \"${projectStatus.name}\" created`,\r\n                actionDetails: {\r\n                    statusId: projectStatus.id,\r\n                    statusName: projectStatus.name,\r\n                    color: projectStatus.color,\r\n                    isDefault: projectStatus.isDefault,\r\n                    isFinal: projectStatus.isFinal,\r\n                    isUrgent: projectStatus.isUrgent,\r\n                },\r\n                performedById: parseInt(session.user.id),\r\n                entityType: \"project_status\",\r\n                entityId: projectStatus.id,\r\n            })\r\n        } catch (logError) {\r\n            console.error(\"Failed to log activity:\", logError)\r\n            // Don't fail the creation if logging fails\r\n        }\r\n\r\n        revalidatePath(\"/dashboard/settings/projects\")\r\n        revalidatePath(\"/dashboard/projects\")\r\n        \r\n        return { success: true, projectStatus }\r\n    } catch (error: any) {\r\n        console.error(\"Error creating project status:\", error)\r\n        console.error(\"Error details:\", {\r\n            code: error.code,\r\n            meta: error.meta,\r\n            message: error.message,\r\n        })\r\n        \r\n        // Check if table doesn't exist\r\n        if (error.code === \"P2021\" || error.message?.includes(\"does not exist\") || error.message?.includes(\"no such table\")) {\r\n            return { \r\n                error: \"Database table not found. Please run the migration: npx prisma db execute --file prisma/migrations/manual_add_project_statuses.sql --schema prisma/schema.prisma\",\r\n                details: error.message \r\n            }\r\n        }\r\n        \r\n        if (error.code === \"P2002\") {\r\n            return { error: \"A project status with this name already exists\" }\r\n        }\r\n        \r\n        return { error: \"Failed to create project status\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function updateProjectStatus(id: number, formData: FormData) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    if (session.user.role !== \"admin\") {\r\n        return { error: \"Only admins can update project statuses\" }\r\n    }\r\n\r\n    const existingStatus = await prisma.projectStatus.findUnique({\r\n        where: { id },\r\n    })\r\n\r\n    if (!existingStatus) {\r\n        return { error: \"Project status not found\" }\r\n    }\r\n\r\n    const name = formData.get(\"name\")\r\n    const color = formData.get(\"color\") || \"#6b7280\"\r\n    const isDefaultValue = formData.get(\"isDefault\")\r\n    const isFinalValue = formData.get(\"isFinal\")\r\n    const isUrgentValue = formData.get(\"isUrgent\")\r\n    const isActiveValue = formData.get(\"isActive\")\r\n    const orderIndex = formData.get(\"orderIndex\")\r\n    \r\n    // Handle boolean values - FormData returns strings, so convert properly\r\n    const isDefault = String(isDefaultValue) === \"true\"\r\n    const isFinal = String(isFinalValue) === \"true\"\r\n    const isUrgent = String(isUrgentValue) === \"true\"\r\n    const isActive = String(isActiveValue) === \"true\"\r\n    \r\n    console.log(\"Update - Parsed form values:\", {\r\n        name,\r\n        color,\r\n        isDefaultValue,\r\n        isDefault,\r\n        isFinalValue,\r\n        isFinal,\r\n        isUrgentValue,\r\n        isUrgent,\r\n        isActiveValue,\r\n        isActive,\r\n        orderIndex\r\n    })\r\n\r\n    // If setting as default, unset other defaults\r\n    if (isDefault && !existingStatus.isDefault) {\r\n        try {\r\n            await prisma.projectStatus.updateMany({\r\n                where: { isDefault: true },\r\n                data: { isDefault: false },\r\n            })\r\n        } catch (error: any) {\r\n            console.error(\"Error unsetting other defaults:\", error)\r\n        }\r\n    }\r\n\r\n    const validated = projectStatusSchema.safeParse({\r\n        name,\r\n        color,\r\n        isDefault,\r\n        isFinal,\r\n        isUrgent,\r\n        orderIndex: orderIndex ? parseInt(orderIndex as string) : existingStatus.orderIndex,\r\n        isActive,\r\n    })\r\n\r\n    if (!validated.success) {\r\n        return { error: \"Validation failed\", details: validated.error.format() }\r\n    }\r\n\r\n    try {\r\n        const projectStatus = await prisma.projectStatus.update({\r\n            where: { id },\r\n            data: validated.data,\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_status_updated\",\r\n            actionCategory: \"settings\",\r\n            actionSummary: `Project status \"${projectStatus.name}\" updated`,\r\n            actionDetails: {\r\n                statusId: projectStatus.id,\r\n                statusName: projectStatus.name,\r\n                oldValues: {\r\n                    name: existingStatus.name,\r\n                    color: existingStatus.color,\r\n                    isDefault: existingStatus.isDefault,\r\n                    isFinal: existingStatus.isFinal,\r\n                    isUrgent: existingStatus.isUrgent,\r\n                },\r\n                newValues: {\r\n                    name: projectStatus.name,\r\n                    color: projectStatus.color,\r\n                    isDefault: projectStatus.isDefault,\r\n                    isFinal: projectStatus.isFinal,\r\n                    isUrgent: projectStatus.isUrgent,\r\n                },\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            entityType: \"project_status\",\r\n            entityId: projectStatus.id,\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/settings/projects\")\r\n        revalidatePath(\"/dashboard/projects\")\r\n        \r\n        return { success: true, projectStatus }\r\n    } catch (error: any) {\r\n        console.error(\"Error updating project status:\", error)\r\n        \r\n        if (error.code === \"P2002\") {\r\n            return { error: \"A project status with this name already exists\" }\r\n        }\r\n        \r\n        return { error: \"Failed to update project status\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function deleteProjectStatus(id: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    if (session.user.role !== \"admin\") {\r\n        return { error: \"Only admins can delete project statuses\" }\r\n    }\r\n\r\n    try {\r\n        // Check if any projects are using this status\r\n        const projectsCount = await prisma.project.count({\r\n            where: { projectStatusId: id },\r\n        })\r\n\r\n        if (projectsCount > 0) {\r\n            return { \r\n                error: `Cannot delete project status. ${projectsCount} project(s) are using it. Deactivate it instead.` \r\n            }\r\n        }\r\n\r\n        const status = await prisma.projectStatus.findUnique({\r\n            where: { id },\r\n        })\r\n\r\n        if (!status) {\r\n            return { error: \"Project status not found\" }\r\n        }\r\n\r\n        await prisma.projectStatus.delete({\r\n            where: { id },\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_status_deleted\",\r\n            actionCategory: \"settings\",\r\n            actionSummary: `Project status \"${status.name}\" deleted`,\r\n            actionDetails: {\r\n                statusId: status.id,\r\n                statusName: status.name,\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            entityType: \"project_status\",\r\n            entityId: status.id,\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/settings/projects\")\r\n        revalidatePath(\"/dashboard/projects\")\r\n        \r\n        return { success: true }\r\n    } catch (error: any) {\r\n        console.error(\"Error deleting project status:\", error)\r\n        return { error: \"Failed to delete project status\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function toggleProjectStatusActive(id: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    if (session.user.role !== \"admin\") {\r\n        return { error: \"Only admins can toggle project status\" }\r\n    }\r\n\r\n    try {\r\n        const current = await prisma.projectStatus.findUnique({\r\n            where: { id },\r\n            select: { isActive: true, name: true },\r\n        })\r\n\r\n        if (!current) {\r\n            return { error: \"Project status not found\" }\r\n        }\r\n\r\n        const projectStatus = await prisma.projectStatus.update({\r\n            where: { id },\r\n            data: { isActive: !current.isActive },\r\n        })\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_status_toggled\",\r\n            actionCategory: \"settings\",\r\n            actionSummary: `Project status \"${projectStatus.name}\" ${projectStatus.isActive ? \"activated\" : \"deactivated\"}`,\r\n            actionDetails: {\r\n                statusId: projectStatus.id,\r\n                statusName: projectStatus.name,\r\n                isActive: projectStatus.isActive,\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n            entityType: \"project_status\",\r\n            entityId: projectStatus.id,\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/settings/projects\")\r\n        revalidatePath(\"/dashboard/projects\")\r\n        \r\n        return { success: true, projectStatus }\r\n    } catch (error: any) {\r\n        console.error(\"Error toggling project status:\", error)\r\n        return { error: \"Failed to toggle project status\", details: error.message }\r\n    }\r\n}\r\n\r\nexport async function reorderProjectStatuses(ids: number[]) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    if (session.user.role !== \"admin\") {\r\n        return { error: \"Only admins can reorder project statuses\" }\r\n    }\r\n\r\n    try {\r\n        // Update order index for each project status\r\n        const updates = ids.map((id, index) =>\r\n            prisma.projectStatus.update({\r\n                where: { id },\r\n                data: { orderIndex: index },\r\n            })\r\n        )\r\n\r\n        await Promise.all(updates)\r\n\r\n        // Log activity\r\n        await logActivity({\r\n            actionType: \"project_statuses_reordered\",\r\n            actionCategory: \"settings\",\r\n            actionSummary: \"Project statuses reordered\",\r\n            actionDetails: {\r\n                statusIds: ids,\r\n            },\r\n            performedById: parseInt(session.user.id),\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/settings/projects\")\r\n        revalidatePath(\"/dashboard/projects\")\r\n        \r\n        return { success: true }\r\n    } catch (error: any) {\r\n        console.error(\"Error reordering project statuses:\", error)\r\n        return { error: \"Failed to reorder project statuses\", details: error.message }\r\n    }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}