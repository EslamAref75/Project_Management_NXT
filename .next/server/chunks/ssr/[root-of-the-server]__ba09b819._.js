module.exports=[792509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},921517,(a,b,c)=>{b.exports=a.x("http",()=>require("http"))},254799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},449719,(a,b,c)=>{b.exports=a.x("assert",()=>require("assert"))},145706,(a,b,c)=>{b.exports=a.x("querystring",()=>require("querystring"))},500874,(a,b,c)=>{b.exports=a.x("buffer",()=>require("buffer"))},406461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},524836,(a,b,c)=>{b.exports=a.x("https",()=>require("https"))},427699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},504166,a=>{a.v({name:"openid-client",version:"5.7.1",description:"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs",keywords:["auth","authentication","basic","certified","client","connect","dynamic","electron","hybrid","identity","implicit","oauth","oauth2","oidc","openid","passport","relying party","strategy"],homepage:"https://github.com/panva/openid-client",repository:"panva/openid-client",funding:{url:"https://github.com/sponsors/panva"},license:"MIT",author:"Filip Skokan <panva.ip@gmail.com>",exports:{types:"./types/index.d.ts",import:"./lib/index.mjs",require:"./lib/index.js"},main:"./lib/index.js",types:"./types/index.d.ts",files:["lib","types/index.d.ts"],scripts:{format:"npx prettier --loglevel silent --write ./lib ./test ./certification ./types",test:"mocha test/**/*.test.js"},dependencies:{jose:"^4.15.9","lru-cache":"^6.0.0","object-hash":"^2.2.0","oidc-token-hash":"^5.0.3"},devDependencies:{"@types/node":"^16.18.106","@types/passport":"^1.0.16",base64url:"^3.0.1",chai:"^4.5.0",mocha:"^10.7.3",nock:"^13.5.5",prettier:"^2.8.8","readable-mock-req":"^0.2.2",sinon:"^9.2.4",timekeeper:"^2.3.1"},"standard-version":{scripts:{postchangelog:"sed -i '' -e 's/### \\[/## [/g' CHANGELOG.md"},types:[{type:"feat",section:"Features"},{type:"fix",section:"Fixes"},{type:"chore",hidden:!0},{type:"docs",hidden:!0},{type:"style",hidden:!0},{type:"refactor",section:"Refactor",hidden:!1},{type:"perf",section:"Performance",hidden:!1},{type:"test",hidden:!0}]}})},57693,662338,a=>{"use strict";var b=a.i(347656);let c=new Map;async function d(a,d){let e=`${a}:${d||"global"}`,f=c.get(e);if(f&&f.expiresAt>Date.now())return f.permissions;let g=await b.prisma.userRole.findMany({where:{userId:a,OR:[{scopeType:null},{scopeType:"global"},...d?[{scopeType:"project",scopeId:d}]:[]]},include:{role:{include:{permissions:{include:{permission:!0}}}}}}),h=new Set;for(let a of g)for(let b of a.role.permissions)h.add(b.permission.key);let i=Array.from(h);return c.set(e,{permissions:i,expiresAt:Date.now()+3e5}),i}async function e(a,c){return(await b.prisma.userRole.findMany({where:{userId:a,OR:[{scopeType:null},{scopeType:"global"},...c?[{scopeType:"project",scopeId:c}]:[]]},include:{role:!0}})).map(a=>({role:a.role,scopeType:a.scopeType,scopeId:a.scopeId}))}function f(a,b){let d=`${a}:${b||"global"}`;c.delete(d)}a.s(["clearPermissionCache",()=>f,"getUserPermissions",()=>d,"getUserRoles",()=>e],662338);class g extends Error{code;constructor(a,b="UNAUTHORIZED"){super(a),this.code=b,this.name="UnauthorizedError"}}class h extends Error{code;constructor(a,b="FORBIDDEN"){super(a),this.code=b,this.name="ForbiddenError"}}class i extends Error{code;constructor(a,b="NOT_FOUND"){super(a),this.code=b,this.name="NotFoundError"}}async function j(a,b,c){if(!await k(a,b,c))throw new g(`Permission denied: ${b}`,"PERMISSION_DENIED")}async function k(a,c,d){try{for(let e of(await b.prisma.userRole.findMany({where:{userId:a,OR:[{scopeType:null},{scopeType:"global"},...d?[{scopeType:"project",scopeId:d}]:[]]},include:{role:{include:{permissions:{include:{permission:!0}}}}}})))for(let a of e.role.permissions)if(a.permission.key===c)return!0;return!1}catch(b){return console.error(`Error checking permission ${c} for user ${a}:`,b),!1}}function l(a){return a instanceof g||a instanceof h?{error:a.message,code:a.code,status:403,success:!1}:a instanceof i?{error:a.message,code:a.code,status:404,success:!1}:(console.error("Unknown authorization error:",a),{error:"Authorization failed",code:"AUTHORIZATION_ERROR",status:500,success:!1})}a.s(["handleAuthorizationError",()=>l,"hasPermissionWithoutRoleBypass",()=>k,"requirePermission",()=>j],57693)},126695,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(541265);async function e(a){console.log("[ActivityLogger] ====== START LOGGING ======"),console.log("[ActivityLogger] Received params:",JSON.stringify(a,null,2));try{let b=function a(b){let c={...b};for(let a of["password","passwordHash","password_hash","token","secret","apiKey","api_key","accessToken","refreshToken"])a in c&&(c[a]="[REDACTED]");for(let b in c)"object"!=typeof c[b]||null===c[b]||Array.isArray(c[b])||(c[b]=a(c[b]));return c}(a.actionDetails||{});console.log("[ActivityLogger] Sanitized details:",JSON.stringify(b,null,2)),console.log("[ActivityLogger] Logging activity:",{actionType:a.actionType,actionCategory:a.actionCategory,actionSummary:a.actionSummary,performedById:a.performedById});try{let d=await c.prisma.activityLog.create({data:{actionType:a.actionType,actionCategory:a.actionCategory,actionSummary:a.actionSummary,actionDetails:Object.keys(b).length>0?JSON.stringify(b):null,performedById:a.performedById,affectedUserId:a.affectedUserId||null,projectId:a.projectId||null,entityType:a.entityType||null,entityId:a.entityId||null,ipAddress:a.ipAddress||await f(),userAgent:a.userAgent||await g(),action:a.actionType,description:a.actionSummary,userId:a.performedById}});console.log("[ActivityLogger] ✅ Successfully logged activity with ID:",d.id),console.log("[ActivityLogger] ====== END LOGGING (SUCCESS) ======");return}catch(b){if(console.error("[ActivityLogger] ❌ Schema error occurred:"),console.error("[ActivityLogger] Error message:",b.message),console.error("[ActivityLogger] Error code:",b.code),console.error("[ActivityLogger] Error meta:",JSON.stringify(b.meta,null,2)),b.message?.includes("no such column")||"P2003"===b.code||"P2011"===b.code){console.warn("[ActivityLogger] New columns not found, using legacy schema. Please run migration."),await c.prisma.$executeRawUnsafe(`
          INSERT INTO activity_logs (action, description, entity_type, entity_id, ip_address, user_id, created_at)
          VALUES (?, ?, ?, ?, ?, ?, datetime('now'))
        `,a.actionType,a.actionSummary,a.entityType||null,a.entityId||null,a.ipAddress||await f()||null,a.performedById),console.log("[ActivityLogger] ✅ Logged using legacy schema"),console.log("[ActivityLogger] ====== END LOGGING (LEGACY) ======");return}throw console.error("[ActivityLogger] ❌ Unknown schema error, rethrowing"),b}}catch(a){console.error("[ActivityLogger] ❌❌❌ CRITICAL ERROR - Failed to log activity ❌❌❌"),console.error("[ActivityLogger] Error message:",a?.message||a),console.error("[ActivityLogger] Error code:",a?.code),console.error("[ActivityLogger] Error meta:",JSON.stringify(a?.meta,null,2)),console.error("[ActivityLogger] Error stack:",a?.stack),console.error("[ActivityLogger] ====== END LOGGING (ERROR) ======")}}async function f(){try{let a=await (0,d.headers)(),b=a.get("x-forwarded-for"),c=a.get("x-real-ip");if(b)return b.split(",")[0].trim();if(c)return c;return null}catch{return null}}async function g(){try{return(await (0,d.headers)()).get("user-agent")||null}catch{return null}}(0,a.i(287907).ensureServerEntryExports)([e]),(0,b.registerServerReference)(e,"40daa1d9c7314de4957a7669434db12aaa24630ba4",null),a.s(["logActivity",()=>e])},194893,407716,555163,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}a.s(["constructFromSymbol",0,b,"millisecondsInDay",0,864e5,"millisecondsInHour",0,36e5,"millisecondsInWeek",0,6048e5,"minutesInDay",0,1440,"minutesInMonth",0,43200],407716),a.s(["constructFrom",()=>c],555163),a.s(["toDate",()=>d],194893)},114678,a=>{"use strict";var b=a.i(194893);function c(a,c){let d=(0,b.toDate)(a,c?.in);return d.setHours(0,0,0,0),d}a.s(["startOfDay",()=>c])},416219,a=>{"use strict";var b=a.i(194893);function c(a,c){let d=(0,b.toDate)(a,c?.in);return d.setHours(23,59,59,999),d}a.s(["endOfDay",()=>c])},826335,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(450246),e=a.i(915929),f=a.i(661698),g=a.i(449597),h=a.i(126695),i=a.i(57693),j=a.i(287907);let k=f.z.object({name:f.z.string().min(1,"Name is required"),description:f.z.string().optional(),teamLeadId:f.z.coerce.number().optional(),status:f.z.enum(["active","inactive"]).default("active"),memberIds:f.z.array(f.z.number()).optional()});async function l(){if(!await (0,d.getServerSession)(e.authOptions))throw Error("Unauthorized");return await c.prisma.team.findMany({include:{_count:{select:{users:!0,tasks:!0,members:!0,projectTeams:!0}},teamLead:{select:{id:!0,username:!0,email:!0,avatarUrl:!0}},users:{take:5,select:{username:!0,email:!0,avatarUrl:!0}},members:{take:5,include:{user:{select:{id:!0,username:!0,email:!0,avatarUrl:!0}}}}},orderBy:{createdAt:"desc"}})}async function m(a){if(!await (0,d.getServerSession)(e.authOptions))throw Error("Unauthorized");return await c.prisma.team.findUnique({where:{id:a},include:{teamLead:{select:{id:!0,username:!0,email:!0,avatarUrl:!0,role:!0}},members:{include:{user:{select:{id:!0,username:!0,email:!0,avatarUrl:!0,role:!0}}},orderBy:{joinedAt:"desc"}},projectTeams:{include:{project:{select:{id:!0,name:!0,status:!0,startDate:!0,endDate:!0,projectManager:{select:{id:!0,username:!0,email:!0}}}}},orderBy:{assignedAt:"desc"}},_count:{select:{tasks:!0,members:!0,projectTeams:!0}}}})}async function n(a){if(!await (0,d.getServerSession)(e.authOptions))throw Error("Unauthorized");return(await c.prisma.projectTeam.findMany({where:{teamId:a},include:{project:{select:{id:!0,name:!0,status:!0,startDate:!0,endDate:!0,projectManager:{select:{id:!0,username:!0,email:!0}}}}},orderBy:{assignedAt:"desc"}})).map(a=>a.project)}async function o(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(b.user.id),"team.create")}catch(a){return(0,i.handleAuthorizationError)(a)}let f=a.get("name"),j=a.get("description"),l=a.get("teamLeadId"),m=a.get("status")||"active",n=a.get("memberIds"),o=[];if(n)try{o=JSON.parse(n)}catch{}let p=k.safeParse({name:f,description:j,teamLeadId:l?parseInt(l):void 0,status:m,memberIds:o});if(!p.success)return{error:"Validation failed"};try{let a=await c.prisma.team.create({data:{name:p.data.name,description:p.data.description,teamLeadId:p.data.teamLeadId||null,status:p.data.status,members:p.data.memberIds&&p.data.memberIds.length>0?{create:p.data.memberIds.map(a=>({userId:a,role:a===p.data.teamLeadId?"lead":"member"}))}:void 0},include:{teamLead:!0,members:{include:{user:!0}}}});return await (0,h.logActivity)({actionType:"team_created",actionCategory:"project",actionSummary:`Team "${a.name}" created`,actionDetails:{teamId:a.id,teamName:a.name,status:a.status,teamLeadId:a.teamLeadId,memberCount:a.members.length},performedById:parseInt(b.user.id),entityType:"team",entityId:a.id}),(0,g.revalidatePath)("/dashboard/teams"),{success:!0,team:a}}catch(a){return console.error(a),{error:"Failed to create team"}}}async function p(a,b){let f=await (0,d.getServerSession)(e.authOptions);if(!f)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(f.user.id),"team.update")}catch(a){return(0,i.handleAuthorizationError)(a)}let j=b.get("name"),l=b.get("description"),m=b.get("teamLeadId"),n=b.get("status"),o=k.partial().safeParse({name:j,description:l,teamLeadId:m?parseInt(m):void 0,status:n});if(!o.success)return{error:"Validation failed"};try{let b=await c.prisma.team.update({where:{id:a},data:{name:o.data.name,description:o.data.description,teamLeadId:void 0!==o.data.teamLeadId?o.data.teamLeadId:void 0,status:o.data.status}});return await (0,h.logActivity)({actionType:"team_updated",actionCategory:"project",actionSummary:`Team "${b.name}" updated`,actionDetails:{teamId:b.id,teamName:b.name},performedById:parseInt(f.user.id),entityType:"team",entityId:b.id}),(0,g.revalidatePath)("/dashboard/teams"),(0,g.revalidatePath)(`/dashboard/teams/${a}`),{success:!0}}catch(a){return console.error(a),{error:"Failed to update team"}}}async function q(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(b.user.id),"team.delete")}catch(a){return(0,i.handleAuthorizationError)(a)}try{let d=await c.prisma.team.findUnique({where:{id:a},select:{name:!0}});return await c.prisma.team.delete({where:{id:a}}),d&&await (0,h.logActivity)({actionType:"team_deleted",actionCategory:"project",actionSummary:`Team "${d.name}" deleted`,actionDetails:{teamId:a,teamName:d.name},performedById:parseInt(b.user.id),entityType:"team",entityId:a}),(0,g.revalidatePath)("/dashboard/teams"),{success:!0}}catch(a){return{error:"Failed to delete team"}}}async function r(a,b){let f=await (0,d.getServerSession)(e.authOptions);if(!f)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(f.user.id),"team.addProject")}catch(a){return(0,i.handleAuthorizationError)(a)}try{let d=await c.prisma.team.findUnique({where:{id:a},select:{status:!0,name:!0}});if(!d)return{error:"Team not found"};if("active"!==d.status)return{error:"Cannot assign projects to inactive teams"};return await c.prisma.projectTeam.create({data:{teamId:a,projectId:b}}),await (0,h.logActivity)({actionType:"project_assigned_to_team",actionCategory:"project",actionSummary:`Project assigned to team "${d.name}"`,actionDetails:{teamId:a,projectId:b},performedById:parseInt(f.user.id),projectId:b,entityType:"team",entityId:a}),(0,g.revalidatePath)(`/dashboard/teams/${a}`),{success:!0}}catch(a){if("P2002"===a.code)return{error:"Project is already assigned to this team"};return console.error(a),{error:"Failed to assign project to team"}}}async function s(a,b){let f=await (0,d.getServerSession)(e.authOptions);if(!f)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(f.user.id),"team.removeProject")}catch(a){return(0,i.handleAuthorizationError)(a)}try{let d=await c.prisma.team.findUnique({where:{id:a},select:{name:!0}});return await c.prisma.projectTeam.delete({where:{projectId_teamId:{projectId:b,teamId:a}}}),d&&await (0,h.logActivity)({actionType:"project_removed_from_team",actionCategory:"project",actionSummary:`Project removed from team "${d.name}"`,actionDetails:{teamId:a,projectId:b},performedById:parseInt(f.user.id),projectId:b,entityType:"team",entityId:a}),(0,g.revalidatePath)(`/dashboard/teams/${a}`),{success:!0}}catch(a){return console.error(a),{error:"Failed to remove project from team"}}}async function t(a,b,f="member"){let h=await (0,d.getServerSession)(e.authOptions);if(!h)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(h.user.id),"team.addMember")}catch(a){return(0,i.handleAuthorizationError)(a)}try{return await c.prisma.teamMember.create({data:{teamId:a,userId:b,role:f}}),(0,g.revalidatePath)(`/dashboard/teams/${a}`),{success:!0}}catch(a){if("P2002"===a.code)return{error:"User is already a member of this team"};return console.error(a),{error:"Failed to add member to team"}}}async function u(a,b){let f=await (0,d.getServerSession)(e.authOptions);if(!f)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(f.user.id),"team.removeMember")}catch(a){return(0,i.handleAuthorizationError)(a)}try{return await c.prisma.teamMember.delete({where:{teamId_userId:{teamId:a,userId:b}}}),(0,g.revalidatePath)(`/dashboard/teams/${a}`),{success:!0}}catch(a){return console.error(a),{error:"Failed to remove member from team"}}}async function v(a){if(!await (0,d.getServerSession)(e.authOptions))throw Error("Unauthorized");return await c.prisma.project.findMany({where:{projectTeams:{none:{teamId:a}}},select:{id:!0,name:!0,status:!0,projectManager:{select:{id:!0,username:!0,email:!0}}},orderBy:{name:"asc"}})}(0,j.ensureServerEntryExports)([l,m,n,o,p,q,r,s,t,u,v]),(0,b.registerServerReference)(l,"000b6b4fc682f5b92871a66c0311a087451073067d",null),(0,b.registerServerReference)(m,"40f8a92a189582ac7a7fcdf1ff304dbcf4401f1dc5",null),(0,b.registerServerReference)(n,"40d262c653cb585b83ff6f03afb8a05a8f61e23a18",null),(0,b.registerServerReference)(o,"404302e6527c8c0424fe4e6a0812dd3f9ee5fad749",null),(0,b.registerServerReference)(p,"60278acd0ffe289349b3e3387dd2813159632c358e",null),(0,b.registerServerReference)(q,"40e6475c1d47d2ff245175aefb8d73f5f7df5fad9c",null),(0,b.registerServerReference)(r,"60ef84a9ad667e7d49ef9c80bd8d94651b75e6268f",null),(0,b.registerServerReference)(s,"60d6167c34faec1d09835a40e8132b96c1ee7a4ed0",null),(0,b.registerServerReference)(t,"70cfe62d32831304d63f72a2766fa81478529867f3",null),(0,b.registerServerReference)(u,"60b69acfa49cb854dd3912651668ce9af6d01a1527",null),(0,b.registerServerReference)(v,"40220937dde4293d9f0bf5a425d05335bdc2930814",null),a.s(["addMemberToTeam",()=>t,"addProjectToTeam",()=>r,"createTeam",()=>o,"deleteTeam",()=>q,"getAvailableProjects",()=>v,"getTeam",()=>m,"getTeamProjects",()=>n,"getTeams",()=>l,"removeMemberFromTeam",()=>u,"removeProjectFromTeam",()=>s,"updateTeam",()=>p])},88526,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(450246),e=a.i(915929),f=a.i(449597),g=a.i(114678),h=a.i(416219),i=a.i(153544),j=a.i(57693);async function k(){let a=await (0,d.getServerSession)(e.authOptions);return a?{authorized:await (0,j.hasPermissionWithoutRoleBypass)(parseInt(a.user.id),"task.assign"),session:a}:{authorized:!1,session:null}}async function l(){let{authorized:a,session:b}=await k();if(!a||!b)return{error:"Unauthorized: Only admins and project managers can access this panel"};try{let a=(await c.prisma.user.findMany({where:{isActive:!0},include:{team:{select:{id:!0,name:!0}},assignedTasks:{select:{projectId:!0},distinct:["projectId"]}},orderBy:{username:"asc"}})).map(a=>({id:a.id,username:a.username,email:a.email,role:a.role,avatarUrl:a.avatarUrl,team:a.team,activeProjectsCount:a.assignedTasks.length}));return{success:!0,users:a}}catch(a){return console.error("getUsersForAssignment Error:",a),{error:"Failed to fetch users",details:a.message}}}async function m(a,b,d){let{authorized:e,session:f}=await k();if(!e||!f)return{error:"Unauthorized"};try{let e=d||new Date,f=(0,g.startOfDay)(e),i=(0,h.endOfDay)(e),j=await c.prisma.task.findMany({where:{projectId:b,assignees:{some:{id:a}},status:{not:"completed"}},include:{project:{select:{id:!0,name:!0}},dependencies:{include:{dependsOnTask:{select:{id:!0,title:!0,status:!0}}}},assignees:{select:{id:!0,username:!0}}},orderBy:{updatedAt:"desc"}}),k=j.filter(a=>{if(!a.plannedDate)return!0;let b=new Date(a.plannedDate);return!(b>=f&&b<=i)}),l=j.filter(a=>{if(!a.plannedDate)return!1;let b=new Date(a.plannedDate);return b>=f&&b<=i}),m=j.map(a=>{let b=a.dependencies.filter(a=>"completed"!==a.dependsOnTask.status);return{...a,isBlocked:b.length>0,blockingDependencies:b.map(a=>({id:a.dependsOnTask.id,title:a.dependsOnTask.title,status:a.dependsOnTask.status}))}});return{success:!0,availableTasks:m.filter(a=>k.some(b=>b.id===a.id)),todayTasks:m.filter(a=>l.some(b=>b.id===a.id))}}catch(a){return console.error("getUserProjectTasks Error:",a),{error:"Failed to fetch tasks",details:a.message}}}async function n(a,b,d){let{authorized:e,session:j}=await k();if(!e||!j)return{error:"Unauthorized"};try{let e=await c.prisma.task.findFirst({where:{id:b,assignees:{some:{id:a}}}});if(!e)return{error:"Task not found or not assigned to this user"};let k=d||new Date,l=(0,g.startOfDay)(k),m=(0,h.endOfDay)(k);if(await c.prisma.task.findFirst({where:{id:b,plannedDate:{gte:l,lte:m}}}))return{error:"Task is already assigned to this date's focus"};let n=await c.prisma.task.findUnique({where:{id:b},include:{project:{select:{id:!0}}}});await c.prisma.task.update({where:{id:b},data:{plannedDate:k}}),n&&await (0,i.createProjectNotification)(n.project.id,a,{type:"today_task",entityType:"task",entityId:b,title:"Today's Task Assigned",message:`Task "${e.title}" has been added to your Today's Tasks`,soundRequired:!1});try{await c.prisma.activityLog.create({data:{userId:parseInt(j.user.id),action:"assign_today_task",description:`Assigned task "${e.title}" to user ${a} for today`,entityType:"task",entityId:b}})}catch(a){console.error("Failed to log activity:",a)}return(0,f.revalidatePath)("/dashboard/today-tasks-assignment"),(0,f.revalidatePath)("/dashboard/focus"),{success:!0}}catch(a){return console.error("assignTodayTask Error:",a),{error:"Failed to assign task",details:a.message}}}async function o(a,b){let{authorized:d,session:e}=await k();if(!d||!e)return{error:"Unauthorized"};try{let d=await c.prisma.task.findFirst({where:{id:b,assignees:{some:{id:a}}}});if(!d)return{error:"Task not found or not assigned to this user"};let g=await c.prisma.task.findUnique({where:{id:b},include:{project:{select:{id:!0}}}});await c.prisma.task.update({where:{id:b},data:{plannedDate:null}}),g&&await (0,i.createProjectNotification)(g.project.id,a,{type:"today_task",entityType:"task",entityId:b,title:"Today's Task Removed",message:`Task "${d.title}" has been removed from your Today's Tasks`,soundRequired:!1});try{await c.prisma.activityLog.create({data:{userId:parseInt(e.user.id),action:"remove_today_task",description:`Removed task "${d.title}" from user ${a}'s today's focus`,entityType:"task",entityId:b}})}catch(a){console.error("Failed to log activity:",a)}return(0,f.revalidatePath)("/dashboard/today-tasks-assignment"),(0,f.revalidatePath)("/dashboard/focus"),{success:!0}}catch(a){return console.error("removeTodayTask Error:",a),{error:"Failed to remove task",details:a.message}}}async function p(a){let{authorized:b,session:d}=await k();if(!b||!d)return{error:"Unauthorized"};try{let b=await c.prisma.project.findMany({where:{tasks:{some:{assignees:{some:{id:a}}}}},select:{id:!0,name:!0},orderBy:{name:"asc"}});return{success:!0,projects:b}}catch(a){return console.error("getUserProjects Error:",a),{error:"Failed to fetch projects",details:a.message}}}async function q(a){let{authorized:b,session:d}=await k();if(!b||!d)return{error:"Unauthorized"};try{let b=a||new Date,d=(0,g.startOfDay)(b),e=(0,h.endOfDay)(b),f=await c.prisma.user.findMany({where:{isActive:!0},select:{id:!0,assignedTasks:{select:{id:!0,projectId:!0,plannedDate:!0,status:!0}}}}),i={};return f.forEach(a=>{let b=a.assignedTasks.filter(a=>{if(!a.plannedDate)return!1;let b=new Date(a.plannedDate);return b>=d&&b<=e&&"completed"!==a.status}),c=a.assignedTasks.filter(a=>"completed"!==a.status);i[a.id]={today:b.length,total:c.length}}),{success:!0,counts:i}}catch(a){return console.error("getUsersTaskCounts Error:",a),{error:"Failed to fetch task counts",details:a.message}}}async function r(a){let{authorized:b,session:d}=await k();if(!b||!d)return{error:"Unauthorized"};try{let b=a||new Date,d=(0,g.startOfDay)(b),e=(0,h.endOfDay)(b),f=(await c.prisma.project.findMany({where:{tasks:{some:{assignees:{some:{id:{not:void 0}}},status:{not:"completed"}}}},include:{tasks:{where:{assignees:{some:{id:{not:void 0}}},status:{not:"completed"}},include:{assignees:{select:{id:!0,username:!0,email:!0}},dependencies:{include:{dependsOnTask:{select:{id:!0,title:!0,status:!0}}}}},orderBy:{updatedAt:"desc"}}},orderBy:{name:"asc"}})).map(a=>{let b=a.tasks.filter(a=>{if(!a.plannedDate)return!1;let b=new Date(a.plannedDate);return b>=d&&b<=e}),c=a.tasks.map(a=>{let b=a.dependencies.filter(a=>"completed"!==a.dependsOnTask.status);return{...a,isBlocked:b.length>0,blockingDependencies:b.map(a=>({id:a.dependsOnTask.id,title:a.dependsOnTask.title,status:a.dependsOnTask.status}))}});return{id:a.id,name:a.name,status:a.status,todayTasks:b.map(a=>{let b=c.find(b=>b.id===a.id);return{id:a.id,title:a.title,status:a.status,priority:a.priority,assignees:a.assignees,isBlocked:b?.isBlocked||!1,blockingDependencies:b?.blockingDependencies||[]}}),allTasks:c}});return{success:!0,projects:f}}catch(a){return console.error("getProjectsWithUserTasks Error:",a),{error:"Failed to fetch projects",details:a.message}}}(0,a.i(287907).ensureServerEntryExports)([l,m,n,o,p,q,r]),(0,b.registerServerReference)(l,"000b69dbd513216f97e19a2d13af47b7cbfbb9758a",null),(0,b.registerServerReference)(m,"70b1c0d756af3710a21ea6e02af89929be757461b2",null),(0,b.registerServerReference)(n,"70a25aac68da7562c938431ab2abea0ec1fb5b1b9d",null),(0,b.registerServerReference)(o,"6002dc22fdb945660d8cebe1b84f80d0e1d43ca74a",null),(0,b.registerServerReference)(p,"40d34329def7d6aaeeb22920f3debfca1a323f382b",null),(0,b.registerServerReference)(q,"4075a53d559255c305d494b04d1aca412d3b59c1c5",null),(0,b.registerServerReference)(r,"4006938d4f18f3474a93c54985b4af1bac8a8f1844",null),a.s(["assignTodayTask",()=>n,"getProjectsWithUserTasks",()=>r,"getUserProjectTasks",()=>m,"getUserProjects",()=>p,"getUsersForAssignment",()=>l,"getUsersTaskCounts",()=>q,"removeTodayTask",()=>o])},296211,a=>{"use strict";var b=a.i(962460),c=a.i(153544),d=a.i(88526),e=a.i(826335),f=a.i(126695);a.s([],168232),a.i(168232),a.s(["000b69dbd513216f97e19a2d13af47b7cbfbb9758a",()=>d.getUsersForAssignment,"000b6b4fc682f5b92871a66c0311a087451073067d",()=>e.getTeams,"0033db22356cbf8845a3517099b63dfc38d1147299",()=>b.getPublicSystemSettings,"00686a7231b739e4fe9b8305b757bc0e83827b9865",()=>c.getAllProjectsUnreadNotificationCount,"4004a0aae390e2c1aeb900c79065f312ac43d90f8d",()=>c.getAllProjectsNotifications,"4006938d4f18f3474a93c54985b4af1bac8a8f1844",()=>d.getProjectsWithUserTasks,"40220937dde4293d9f0bf5a425d05335bdc2930814",()=>e.getAvailableProjects,"404302e6527c8c0424fe4e6a0812dd3f9ee5fad749",()=>e.createTeam,"4073df5af18efe51e33e158abaa2dd30f11932484d",()=>c.getProjectNotificationPreferences,"4075a53d559255c305d494b04d1aca412d3b59c1c5",()=>d.getUsersTaskCounts,"40c086aae8b4c1ddec14829c213410ee4c5d2ec0b4",()=>c.markAllProjectNotificationsAsRead,"40c45036bf2dcfbc3a3b624285c3d3d3366fc5ed73",()=>c.getProjectUnreadNotificationCount,"40d262c653cb585b83ff6f03afb8a05a8f61e23a18",()=>e.getTeamProjects,"40d34329def7d6aaeeb22920f3debfca1a323f382b",()=>d.getUserProjects,"40daa1d9c7314de4957a7669434db12aaa24630ba4",()=>f.logActivity,"40e6475c1d47d2ff245175aefb8d73f5f7df5fad9c",()=>e.deleteTeam,"40f8a92a189582ac7a7fcdf1ff304dbcf4401f1dc5",()=>e.getTeam,"6002dc22fdb945660d8cebe1b84f80d0e1d43ca74a",()=>d.removeTodayTask,"60278acd0ffe289349b3e3387dd2813159632c358e",()=>e.updateTeam,"60691655a7ad6aec29ab9691d8571a0d380be93da1",()=>c.markProjectNotificationAsRead,"60b69acfa49cb854dd3912651668ce9af6d01a1527",()=>e.removeMemberFromTeam,"60d6167c34faec1d09835a40e8132b96c1ee7a4ed0",()=>e.removeProjectFromTeam,"60d7258dffa20b5ae58a4ac333313c2a6cc4aeb7a7",()=>c.updateProjectNotificationPreferences,"60e11d18f808d2843f4d06a35ea4ad9027dd8b4de1",()=>c.getProjectNotifications,"60ef84a9ad667e7d49ef9c80bd8d94651b75e6268f",()=>e.addProjectToTeam,"705f7777ed9cdc6c32f418ba57dcb7f4b84f8c002a",()=>c.createProjectNotification,"70a25aac68da7562c938431ab2abea0ec1fb5b1b9d",()=>d.assignTodayTask,"70b1c0d756af3710a21ea6e02af89929be757461b2",()=>d.getUserProjectTasks,"70cfe62d32831304d63f72a2766fa81478529867f3",()=>e.addMemberToTeam],296211)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ba09b819._.js.map