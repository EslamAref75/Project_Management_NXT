module.exports=[10471,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(450246),e=a.i(915929),f=a.i(449597),g=a.i(57693);async function h(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{authorized:!1,session:null,hasAdminPermission:!1};let f=parseInt(b.user.id),h=await (0,g.hasPermissionWithoutRoleBypass)(f,"admin.access"),i=await c.prisma.project.findUnique({where:{id:a},select:{id:!0,projectManagerId:!0,createdById:!0}});if(!i)return{authorized:!1,session:null,hasAdminPermission:!1,error:"Project not found"};let j=i.projectManagerId===f||i.createdById===f;return{authorized:h||j,session:b,hasAdminPermission:h,isProjectManager:j}}async function i(a){let{authorized:b,session:d}=await h(a);if(!b||!d)return{error:"Unauthorized: Only project managers and admins can access project settings"};try{let b=await c.prisma.projectSetting.findMany({where:{projectId:a},orderBy:[{category:"asc"},{key:"asc"}],include:{updater:{select:{id:!0,username:!0,email:!0}}}}),d={};return b.forEach(a=>{d[a.category]||(d[a.category]=[]),d[a.category].push({id:a.id,key:a.key,value:JSON.parse(a.value),category:a.category,enabled:a.enabled,updatedAt:a.updatedAt,updatedBy:a.updater})}),{success:!0,settings:d}}catch(a){return console.error("getProjectSettings Error:",a),{error:"Failed to fetch project settings",details:a.message}}}async function j(a){if(!await (0,d.getServerSession)(e.authOptions))return{error:"Unauthorized"};try{let b=await c.prisma.projectSetting.findMany({where:{projectId:a,enabled:!0}}),d=await c.prisma.systemSetting.findMany(),e={};for(let a of["general","tasks","dependencies","today_tasks","workflow","permissions","notifications"]){let c=b.find(b=>b.category===a&&b.key===a),f=d.find(b=>b.category===a&&b.key===a);c&&c.enabled?e[a]={value:JSON.parse(c.value),source:"project",enabled:!0}:f?e[a]={value:JSON.parse(f.value),source:"global",enabled:!1}:e[a]={value:null,source:"system",enabled:!1}}return{success:!0,settings:e}}catch(a){return console.error("getResolvedProjectSettings Error:",a),{error:"Failed to fetch resolved settings",details:a.message}}}async function k(a,b){let{authorized:d,session:e}=await h(a);if(!d||!e)return{error:"Unauthorized"};try{let d=await c.prisma.projectSetting.findUnique({where:{projectId_key:{projectId:a,key:b}},include:{updater:{select:{id:!0,username:!0,email:!0}}}});if(!d)return{error:"Setting not found"};return{success:!0,setting:{id:d.id,key:d.key,value:JSON.parse(d.value),category:d.category,enabled:d.enabled,updatedAt:d.updatedAt,updatedBy:d.updater}}}catch(a){return console.error("getProjectSetting Error:",a),{error:"Failed to fetch setting",details:a.message}}}async function l(a,b,d,e=!0,g){let{authorized:i,session:j,hasAdminPermission:k}=await h(a);if(!i||!j)return{error:"Unauthorized"};try{let h=await c.prisma.projectSetting.findUnique({where:{projectId_key:{projectId:a,key:b}}}),i=h?.value||null,k=JSON.stringify(d),l=await c.prisma.projectSetting.upsert({where:{projectId_key:{projectId:a,key:b}},create:{projectId:a,key:b,category:b,value:k,enabled:e,updatedBy:parseInt(j.user.id)},update:{value:k,enabled:e,updatedBy:parseInt(j.user.id)}});return await c.prisma.projectSettingsChangeLog.create({data:{projectId:a,settingKey:b,category:l.category,oldValue:i,newValue:k,reason:g||null,changedBy:parseInt(j.user.id),settingId:l.id}}),(0,f.revalidatePath)(`/dashboard/projects/${a}`),(0,f.revalidatePath)(`/dashboard/projects/${a}/settings`),{success:!0,setting:l}}catch(a){return console.error("updateProjectSetting Error:",a),{error:"Failed to update setting",details:a.message}}}async function m(a,b,d,e,g=!0){let{authorized:i,session:j}=await h(a);if(!i||!j)return{error:"Unauthorized"};try{if(await c.prisma.projectSetting.findUnique({where:{projectId_key:{projectId:a,key:b}}}))return{error:"Setting with this key already exists"};let h=await c.prisma.projectSetting.create({data:{projectId:a,key:b,category:d,value:JSON.stringify(e),enabled:g,updatedBy:parseInt(j.user.id)}});return await c.prisma.projectSettingsChangeLog.create({data:{projectId:a,settingKey:b,category:d,oldValue:null,newValue:JSON.stringify(e),reason:"Setting created",changedBy:parseInt(j.user.id),settingId:h.id}}),(0,f.revalidatePath)(`/dashboard/projects/${a}/settings`),{success:!0,setting:h}}catch(a){return console.error("createProjectSetting Error:",a),{error:"Failed to create setting",details:a.message}}}async function n(a,b,d=50,e=0){let{authorized:f,session:g}=await h(a);if(!f||!g)return{error:"Unauthorized"};try{let f={projectId:a};b&&(f.settingKey=b);let g=await c.prisma.projectSettingsChangeLog.findMany({where:f,include:{changer:{select:{id:!0,username:!0,email:!0}},setting:{select:{key:!0,category:!0}}},orderBy:{createdAt:"desc"},take:d,skip:e}),h=await c.prisma.projectSettingsChangeLog.count({where:f});return{success:!0,logs:g.map(a=>({id:a.id,settingKey:a.settingKey,category:a.setting?.category,oldValue:a.oldValue?JSON.parse(a.oldValue):null,newValue:JSON.parse(a.newValue),reason:a.reason,changedBy:a.changer,createdAt:a.createdAt})),total:h,limit:d,offset:e}}catch(a){return console.error("getProjectSettingsChangeLog Error:",a),{error:"Failed to fetch change log",details:a.message}}}async function o(a,b){let{authorized:d,session:e}=await h(a);if(!d||!e)return{error:"Unauthorized"};try{let d=await c.prisma.projectSetting.update({where:{projectId_key:{projectId:a,key:b}},data:{enabled:!1}});return await c.prisma.projectSettingsChangeLog.create({data:{projectId:a,settingKey:b,category:d.category,oldValue:d.value,newValue:JSON.stringify({enabled:!1}),reason:"Reset to global default",changedBy:parseInt(e.user.id),settingId:d.id}}),(0,f.revalidatePath)(`/dashboard/projects/${a}/settings`),{success:!0,message:"Setting reset to global default"}}catch(a){return console.error("resetProjectSetting Error:",a),{error:"Failed to reset setting",details:a.message}}}(0,a.i(287907).ensureServerEntryExports)([i,j,k,l,m,n,o]),(0,b.registerServerReference)(i,"403775645662f7593a65be1a569d77a1a93596c3ae",null),(0,b.registerServerReference)(j,"40b69736d10082c7029d6a3ba958f68a26bb984d11",null),(0,b.registerServerReference)(k,"60dd758f1f511cf854a107f1bb542f2741d586bc05",null),(0,b.registerServerReference)(l,"7cf014ca08e543e0266b1bf98988bb7f513f6a9a2b",null),(0,b.registerServerReference)(m,"7c78551cafee9f072ea8e2de6a74f1f2afe17a47d6",null),(0,b.registerServerReference)(n,"7802fce46123ca10d47a8086a9d3ea3e96b95af191",null),(0,b.registerServerReference)(o,"605b6b24e07efe1c92d678d775d9b33fe01c191a36",null),a.s(["createProjectSetting",()=>m,"getProjectSetting",()=>k,"getProjectSettings",()=>i,"getProjectSettingsChangeLog",()=>n,"getResolvedProjectSettings",()=>j,"resetProjectSetting",()=>o,"updateProjectSetting",()=>l])},335554,a=>{"use strict";var b=a.i(962460),c=a.i(153544),d=a.i(462266),e=a.i(126695),f=a.i(10471);a.s([],50427),a.i(50427),a.s(["0033db22356cbf8845a3517099b63dfc38d1147299",()=>b.getPublicSystemSettings,"003ae2a452e6e1e8ebee86f206a9903396d5df13b8",()=>d.getProjects,"00686a7231b739e4fe9b8305b757bc0e83827b9865",()=>c.getAllProjectsUnreadNotificationCount,"4004a0aae390e2c1aeb900c79065f312ac43d90f8d",()=>c.getAllProjectsNotifications,"401e3f4be30a5d5dbee04214aa788c798e018c4c21",()=>d.createProject,"402c9fcdaf734573eeb364d1e92aac14ecf31bcfb9",()=>d.getProject,"403775645662f7593a65be1a569d77a1a93596c3ae",()=>f.getProjectSettings,"406144e6cbbfbe91083d4680cc56756da14a65698a",()=>d.getProjectsWithFilters,"40b69736d10082c7029d6a3ba958f68a26bb984d11",()=>f.getResolvedProjectSettings,"40daa1d9c7314de4957a7669434db12aaa24630ba4",()=>e.logActivity,"40fdba31998d7a3efe7c944c688cf93002e917af7b",()=>d.deleteProject,"601c00162e3e64028c2b657a9e3982df01dad141d5",()=>d.updateProject,"605b6b24e07efe1c92d678d775d9b33fe01c191a36",()=>f.resetProjectSetting,"60691655a7ad6aec29ab9691d8571a0d380be93da1",()=>c.markProjectNotificationAsRead,"60dd758f1f511cf854a107f1bb542f2741d586bc05",()=>f.getProjectSetting,"7802fce46123ca10d47a8086a9d3ea3e96b95af191",()=>f.getProjectSettingsChangeLog,"7c78551cafee9f072ea8e2de6a74f1f2afe17a47d6",()=>f.createProjectSetting,"7cf014ca08e543e0266b1bf98988bb7f513f6a9a2b",()=>f.updateProjectSetting],335554)}];

//# sourceMappingURL=nxt_New%20folder_Project_Management_NXT_6a660dc7._.js.map