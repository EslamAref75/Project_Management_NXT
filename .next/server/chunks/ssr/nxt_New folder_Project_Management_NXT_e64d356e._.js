module.exports=[826335,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(450246),e=a.i(915929),f=a.i(661698),g=a.i(449597),h=a.i(126695),i=a.i(57693),j=a.i(287907);let k=f.z.object({name:f.z.string().min(1,"Name is required"),description:f.z.string().optional(),teamLeadId:f.z.coerce.number().optional(),status:f.z.enum(["active","inactive"]).default("active"),memberIds:f.z.array(f.z.number()).optional()});async function l(){if(!await (0,d.getServerSession)(e.authOptions))throw Error("Unauthorized");return await c.prisma.team.findMany({include:{_count:{select:{users:!0,tasks:!0,members:!0,projectTeams:!0}},teamLead:{select:{id:!0,username:!0,email:!0,avatarUrl:!0}},users:{take:5,select:{username:!0,email:!0,avatarUrl:!0}},members:{take:5,include:{user:{select:{id:!0,username:!0,email:!0,avatarUrl:!0}}}}},orderBy:{createdAt:"desc"}})}async function m(a){if(!await (0,d.getServerSession)(e.authOptions))throw Error("Unauthorized");return await c.prisma.team.findUnique({where:{id:a},include:{teamLead:{select:{id:!0,username:!0,email:!0,avatarUrl:!0,role:!0}},members:{include:{user:{select:{id:!0,username:!0,email:!0,avatarUrl:!0,role:!0}}},orderBy:{joinedAt:"desc"}},projectTeams:{include:{project:{select:{id:!0,name:!0,status:!0,startDate:!0,endDate:!0,projectManager:{select:{id:!0,username:!0,email:!0}}}}},orderBy:{assignedAt:"desc"}},_count:{select:{tasks:!0,members:!0,projectTeams:!0}}}})}async function n(a){if(!await (0,d.getServerSession)(e.authOptions))throw Error("Unauthorized");return(await c.prisma.projectTeam.findMany({where:{teamId:a},include:{project:{select:{id:!0,name:!0,status:!0,startDate:!0,endDate:!0,projectManager:{select:{id:!0,username:!0,email:!0}}}}},orderBy:{assignedAt:"desc"}})).map(a=>a.project)}async function o(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(b.user.id),"team.create")}catch(a){return(0,i.handleAuthorizationError)(a)}let f=a.get("name"),j=a.get("description"),l=a.get("teamLeadId"),m=a.get("status")||"active",n=a.get("memberIds"),o=[];if(n)try{o=JSON.parse(n)}catch{}let p=k.safeParse({name:f,description:j,teamLeadId:l?parseInt(l):void 0,status:m,memberIds:o});if(!p.success)return{error:"Validation failed"};try{let a=await c.prisma.team.create({data:{name:p.data.name,description:p.data.description,teamLeadId:p.data.teamLeadId||null,status:p.data.status,members:p.data.memberIds&&p.data.memberIds.length>0?{create:p.data.memberIds.map(a=>({userId:a,role:a===p.data.teamLeadId?"lead":"member"}))}:void 0},include:{teamLead:!0,members:{include:{user:!0}}}});return await (0,h.logActivity)({actionType:"team_created",actionCategory:"project",actionSummary:`Team "${a.name}" created`,actionDetails:{teamId:a.id,teamName:a.name,status:a.status,teamLeadId:a.teamLeadId,memberCount:a.members.length},performedById:parseInt(b.user.id),entityType:"team",entityId:a.id}),(0,g.revalidatePath)("/dashboard/teams"),{success:!0,team:a}}catch(a){return console.error(a),{error:"Failed to create team"}}}async function p(a,b){let f=await (0,d.getServerSession)(e.authOptions);if(!f)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(f.user.id),"team.update")}catch(a){return(0,i.handleAuthorizationError)(a)}let j=b.get("name"),l=b.get("description"),m=b.get("teamLeadId"),n=b.get("status"),o=k.partial().safeParse({name:j,description:l,teamLeadId:m?parseInt(m):void 0,status:n});if(!o.success)return{error:"Validation failed"};try{let b=await c.prisma.team.update({where:{id:a},data:{name:o.data.name,description:o.data.description,teamLeadId:void 0!==o.data.teamLeadId?o.data.teamLeadId:void 0,status:o.data.status}});return await (0,h.logActivity)({actionType:"team_updated",actionCategory:"project",actionSummary:`Team "${b.name}" updated`,actionDetails:{teamId:b.id,teamName:b.name},performedById:parseInt(f.user.id),entityType:"team",entityId:b.id}),(0,g.revalidatePath)("/dashboard/teams"),(0,g.revalidatePath)(`/dashboard/teams/${a}`),{success:!0}}catch(a){return console.error(a),{error:"Failed to update team"}}}async function q(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(b.user.id),"team.delete")}catch(a){return(0,i.handleAuthorizationError)(a)}try{let d=await c.prisma.team.findUnique({where:{id:a},select:{name:!0}});return await c.prisma.team.delete({where:{id:a}}),d&&await (0,h.logActivity)({actionType:"team_deleted",actionCategory:"project",actionSummary:`Team "${d.name}" deleted`,actionDetails:{teamId:a,teamName:d.name},performedById:parseInt(b.user.id),entityType:"team",entityId:a}),(0,g.revalidatePath)("/dashboard/teams"),{success:!0}}catch(a){return{error:"Failed to delete team"}}}async function r(a,b){let f=await (0,d.getServerSession)(e.authOptions);if(!f)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(f.user.id),"team.addProject")}catch(a){return(0,i.handleAuthorizationError)(a)}try{let d=await c.prisma.team.findUnique({where:{id:a},select:{status:!0,name:!0}});if(!d)return{error:"Team not found"};if("active"!==d.status)return{error:"Cannot assign projects to inactive teams"};return await c.prisma.projectTeam.create({data:{teamId:a,projectId:b}}),await (0,h.logActivity)({actionType:"project_assigned_to_team",actionCategory:"project",actionSummary:`Project assigned to team "${d.name}"`,actionDetails:{teamId:a,projectId:b},performedById:parseInt(f.user.id),projectId:b,entityType:"team",entityId:a}),(0,g.revalidatePath)(`/dashboard/teams/${a}`),{success:!0}}catch(a){if("P2002"===a.code)return{error:"Project is already assigned to this team"};return console.error(a),{error:"Failed to assign project to team"}}}async function s(a,b){let f=await (0,d.getServerSession)(e.authOptions);if(!f)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(f.user.id),"team.removeProject")}catch(a){return(0,i.handleAuthorizationError)(a)}try{let d=await c.prisma.team.findUnique({where:{id:a},select:{name:!0}});return await c.prisma.projectTeam.delete({where:{projectId_teamId:{projectId:b,teamId:a}}}),d&&await (0,h.logActivity)({actionType:"project_removed_from_team",actionCategory:"project",actionSummary:`Project removed from team "${d.name}"`,actionDetails:{teamId:a,projectId:b},performedById:parseInt(f.user.id),projectId:b,entityType:"team",entityId:a}),(0,g.revalidatePath)(`/dashboard/teams/${a}`),{success:!0}}catch(a){return console.error(a),{error:"Failed to remove project from team"}}}async function t(a,b,f="member"){let h=await (0,d.getServerSession)(e.authOptions);if(!h)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(h.user.id),"team.addMember")}catch(a){return(0,i.handleAuthorizationError)(a)}try{return await c.prisma.teamMember.create({data:{teamId:a,userId:b,role:f}}),(0,g.revalidatePath)(`/dashboard/teams/${a}`),{success:!0}}catch(a){if("P2002"===a.code)return{error:"User is already a member of this team"};return console.error(a),{error:"Failed to add member to team"}}}async function u(a,b){let f=await (0,d.getServerSession)(e.authOptions);if(!f)return{error:"Unauthorized"};try{await (0,i.requirePermission)(parseInt(f.user.id),"team.removeMember")}catch(a){return(0,i.handleAuthorizationError)(a)}try{return await c.prisma.teamMember.delete({where:{teamId_userId:{teamId:a,userId:b}}}),(0,g.revalidatePath)(`/dashboard/teams/${a}`),{success:!0}}catch(a){return console.error(a),{error:"Failed to remove member from team"}}}async function v(a){if(!await (0,d.getServerSession)(e.authOptions))throw Error("Unauthorized");return await c.prisma.project.findMany({where:{projectTeams:{none:{teamId:a}}},select:{id:!0,name:!0,status:!0,projectManager:{select:{id:!0,username:!0,email:!0}}},orderBy:{name:"asc"}})}(0,j.ensureServerEntryExports)([l,m,n,o,p,q,r,s,t,u,v]),(0,b.registerServerReference)(l,"000b6b4fc682f5b92871a66c0311a087451073067d",null),(0,b.registerServerReference)(m,"40f8a92a189582ac7a7fcdf1ff304dbcf4401f1dc5",null),(0,b.registerServerReference)(n,"40d262c653cb585b83ff6f03afb8a05a8f61e23a18",null),(0,b.registerServerReference)(o,"404302e6527c8c0424fe4e6a0812dd3f9ee5fad749",null),(0,b.registerServerReference)(p,"60278acd0ffe289349b3e3387dd2813159632c358e",null),(0,b.registerServerReference)(q,"40e6475c1d47d2ff245175aefb8d73f5f7df5fad9c",null),(0,b.registerServerReference)(r,"60ef84a9ad667e7d49ef9c80bd8d94651b75e6268f",null),(0,b.registerServerReference)(s,"60d6167c34faec1d09835a40e8132b96c1ee7a4ed0",null),(0,b.registerServerReference)(t,"70cfe62d32831304d63f72a2766fa81478529867f3",null),(0,b.registerServerReference)(u,"60b69acfa49cb854dd3912651668ce9af6d01a1527",null),(0,b.registerServerReference)(v,"40220937dde4293d9f0bf5a425d05335bdc2930814",null),a.s(["addMemberToTeam",()=>t,"addProjectToTeam",()=>r,"createTeam",()=>o,"deleteTeam",()=>q,"getAvailableProjects",()=>v,"getTeam",()=>m,"getTeamProjects",()=>n,"getTeams",()=>l,"removeMemberFromTeam",()=>u,"removeProjectFromTeam",()=>s,"updateTeam",()=>p])},163852,a=>{"use strict";var b=a.i(962460),c=a.i(153544),d=a.i(826335),e=a.i(126695),f=a.i(476662);a.s([],78087),a.i(78087),a.s(["000b6b4fc682f5b92871a66c0311a087451073067d",()=>d.getTeams,"0033db22356cbf8845a3517099b63dfc38d1147299",()=>b.getPublicSystemSettings,"00686a7231b739e4fe9b8305b757bc0e83827b9865",()=>c.getAllProjectsUnreadNotificationCount,"0078a5996050e1da89a66893bd05780e75185392cb",()=>f.getUsers,"4004a0aae390e2c1aeb900c79065f312ac43d90f8d",()=>c.getAllProjectsNotifications,"401fc4e21517ebfbd3eebabb3ac6ad3bf2fb7443a7",()=>f.createUser,"40220937dde4293d9f0bf5a425d05335bdc2930814",()=>d.getAvailableProjects,"404302e6527c8c0424fe4e6a0812dd3f9ee5fad749",()=>d.createTeam,"406fd270e8a350e38c78e4b79321560707aa26fd1a",()=>f.getUser,"40abdcd9a05b7e5b6a27a4efd7412defa3f340c60c",()=>f.deleteUser,"40d262c653cb585b83ff6f03afb8a05a8f61e23a18",()=>d.getTeamProjects,"40daa1d9c7314de4957a7669434db12aaa24630ba4",()=>e.logActivity,"40e6475c1d47d2ff245175aefb8d73f5f7df5fad9c",()=>d.deleteTeam,"40f8a92a189582ac7a7fcdf1ff304dbcf4401f1dc5",()=>d.getTeam,"6020ac488ab0f44300111f3a8024b04b647106d187",()=>f.updateUserTeam,"60278acd0ffe289349b3e3387dd2813159632c358e",()=>d.updateTeam,"60691655a7ad6aec29ab9691d8571a0d380be93da1",()=>c.markProjectNotificationAsRead,"60b33fdd6fc55215f2569d47e96e5d33d33f4f707f",()=>f.toggleUserStatus,"60b69acfa49cb854dd3912651668ce9af6d01a1527",()=>d.removeMemberFromTeam,"60d6167c34faec1d09835a40e8132b96c1ee7a4ed0",()=>d.removeProjectFromTeam,"60e1fb0fb657783a6424ba7525af9dca8a6316a12b",()=>f.updateUser,"60ef84a9ad667e7d49ef9c80bd8d94651b75e6268f",()=>d.addProjectToTeam,"70cfe62d32831304d63f72a2766fa81478529867f3",()=>d.addMemberToTeam],163852)}];

//# sourceMappingURL=nxt_New%20folder_Project_Management_NXT_e64d356e._.js.map