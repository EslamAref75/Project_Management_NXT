module.exports=[352827,486431,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(450246),e=a.i(915929),f=a.i(449597),g=a.i(661698),h=a.i(126695),i=a.i(57693),j=a.i(766050),k=a.i(287907);async function l(a){return(0,i.hasPermissionWithoutRoleBypass)(a,j.PERMISSIONS.SETTINGS.PROJECT_TYPE_MANAGE)}let m=g.z.object({name:g.z.string().min(1,"Name is required").max(100),description:g.z.string().optional(),isActive:g.z.boolean().default(!0),displayOrder:g.z.number().int().default(0),color:g.z.string().optional(),icon:g.z.string().optional()});async function n(a=!1,b=!1){if(!await (0,d.getServerSession)(e.authOptions))return{error:"Unauthorized"};try{let d=await c.prisma.projectType.findMany({where:a?{}:{isActive:!0},orderBy:[{displayOrder:"asc"},{name:"asc"}],include:b?{_count:{select:{projects:!0}}}:void 0}),e=b?d.map(a=>({...a,usageCount:a._count?.projects||0})):d;return{success:!0,projectTypes:e}}catch(a){return console.error("Error fetching project types:",a),{error:"Failed to fetch project types",details:a.message}}}async function o(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if(!await l(parseInt(b.user.id)))return{error:"Permission denied: You don't have permission to manage project types"};let g=a.get("name"),i=a.get("description"),j="true"===a.get("isActive"),k=a.get("displayOrder"),n=a.get("color"),o=a.get("icon"),p=m.safeParse({name:g,description:i||void 0,isActive:j,displayOrder:k?parseInt(k):0,color:n||void 0,icon:o||void 0});if(!p.success)return{error:"Validation failed",details:p.error.format()};try{let a=await c.prisma.projectType.create({data:p.data});return await (0,h.logActivity)({actionType:"project_type_created",actionCategory:"settings",actionSummary:`Project type "${a.name}" created`,actionDetails:{typeId:a.id,typeName:a.name,description:a.description,isActive:a.isActive},performedById:parseInt(b.user.id),entityType:"project_type",entityId:a.id}),(0,f.revalidatePath)("/dashboard/settings"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0,projectType:a}}catch(a){if(console.error("Error creating project type:",a),console.error("Error details:",{code:a.code,meta:a.meta,message:a.message}),"P2021"===a.code||a.message?.includes("does not exist"))return{error:"Database table not found. Please run the migration: npx prisma db execute --file prisma/migrations/20250103000001_add_project_types/migration.sql",details:a.message};return{error:"Failed to create project type",details:a.message}}}async function p(a,b){let g=await (0,d.getServerSession)(e.authOptions);if(!g)return{error:"Unauthorized"};if(!await l(parseInt(g.user.id)))return{error:"Permission denied: You don't have permission to manage project types"};let i=b.get("name"),j=b.get("description"),k="true"===b.get("isActive"),n=b.get("displayOrder"),o=b.get("color"),p=b.get("icon"),q=m.safeParse({name:i,description:j||void 0,isActive:k,displayOrder:n?parseInt(n):0,color:o||void 0,icon:p||void 0});if(!q.success)return{error:"Validation failed",details:q.error.format()};try{let b=await c.prisma.projectType.findUnique({where:{id:a}});if(!b)return{error:"Project type not found"};let d=await c.prisma.projectType.update({where:{id:a},data:q.data});return await (0,h.logActivity)({actionType:"project_type_updated",actionCategory:"settings",actionSummary:`Project type "${d.name}" updated`,actionDetails:{typeId:d.id,oldValues:{name:b.name,description:b.description,isActive:b.isActive},newValues:{name:d.name,description:d.description,isActive:d.isActive}},performedById:parseInt(g.user.id),entityType:"project_type",entityId:d.id}),(0,f.revalidatePath)("/dashboard/settings"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0,projectType:d}}catch(a){return console.error("Error updating project type:",a),{error:"Failed to update project type",details:a.message}}}async function q(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if(!await l(parseInt(b.user.id)))return{error:"Permission denied: You don't have permission to manage project types"};try{let d=await c.prisma.project.count({where:{projectTypeId:a}});if(d>0)return{error:`Cannot delete project type. ${d} project(s) are using it.`};let e=await c.prisma.projectType.findUnique({where:{id:a}});if(!e)return{error:"Project type not found"};return await c.prisma.projectType.delete({where:{id:a}}),await (0,h.logActivity)({actionType:"project_type_deleted",actionCategory:"settings",actionSummary:`Project type "${e.name}" deleted`,actionDetails:{typeId:e.id,typeName:e.name},performedById:parseInt(b.user.id),entityType:"project_type",entityId:e.id}),(0,f.revalidatePath)("/dashboard/settings"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0}}catch(a){return console.error("Error deleting project type:",a),{error:"Failed to delete project type",details:a.message}}}async function r(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if(!await l(parseInt(b.user.id)))return{error:"Permission denied: You don't have permission to manage project types"};try{let d=await c.prisma.projectType.findUnique({where:{id:a},select:{isActive:!0}});if(!d)return{error:"Project type not found"};let e=await c.prisma.projectType.update({where:{id:a},data:{isActive:!d.isActive}});return await (0,h.logActivity)({actionType:"project_type_toggled",actionCategory:"settings",actionSummary:`Project type "${e.name}" ${e.isActive?"activated":"deactivated"}`,actionDetails:{typeId:e.id,typeName:e.name,isActive:e.isActive},performedById:parseInt(b.user.id),entityType:"project_type",entityId:e.id}),(0,f.revalidatePath)("/dashboard/settings"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0,projectType:e}}catch(a){return console.error("Error toggling project type status:",a),{error:"Failed to toggle project type status",details:a.message}}}async function s(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if(!await l(parseInt(b.user.id)))return{error:"Permission denied: You don't have permission to manage project types"};try{let b=a.map((a,b)=>c.prisma.projectType.update({where:{id:a},data:{displayOrder:b}}));return await Promise.all(b),(0,f.revalidatePath)("/dashboard/settings"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0}}catch(a){return console.error("Error reordering project types:",a),{error:"Failed to reorder project types",details:a.message}}}async function t(a){return(0,i.hasPermissionWithoutRoleBypass)(a,j.PERMISSIONS.SETTINGS.PROJECT_STATUS_MANAGE)}(0,k.ensureServerEntryExports)([n,o,p,q,r,s]),(0,b.registerServerReference)(n,"60ec9252c798f5964d56c5d51f9afd9f2f40212108",null),(0,b.registerServerReference)(o,"409bfe17a6e18c6eefdf27cc2d63cd3af4ce1159fa",null),(0,b.registerServerReference)(p,"60f8d1074cb6207c775a9d7a0e9294b9b201443e82",null),(0,b.registerServerReference)(q,"405efd76e418f6527f8db1a411a5ed99a6086e285e",null),(0,b.registerServerReference)(r,"40a28f296d3c75f57ff9d1ea44e224268ca46fdd85",null),(0,b.registerServerReference)(s,"407e619cfdad7de441b960c0a4859e410685cc3684",null),a.s(["createProjectType",()=>o,"deleteProjectType",()=>q,"getProjectTypes",()=>n,"toggleProjectTypeStatus",()=>r,"updateProjectType",()=>p],352827);let u=g.z.object({name:g.z.string().min(1,"Name is required").max(100),color:g.z.string().regex(/^#[0-9A-Fa-f]{6}$/,"Color must be a valid hex color"),isDefault:g.z.boolean().default(!1),isFinal:g.z.boolean().default(!1),isUrgent:g.z.boolean().default(!1),orderIndex:g.z.number().int().default(0),isActive:g.z.boolean().default(!0)});async function v(a=!1){if(!await (0,d.getServerSession)(e.authOptions))return{error:"Unauthorized"};try{if(!c.prisma.projectStatus)return{error:"ProjectStatus model not found. Please stop the dev server, run 'npx prisma generate', and restart the server.",details:"Prisma client needs to be regenerated after adding the ProjectStatus model"};let b=await c.prisma.projectStatus.findMany({where:a?{}:{isActive:!0},orderBy:[{orderIndex:"asc"},{name:"asc"}]});return{success:!0,projectStatuses:b}}catch(a){if(console.error("Error fetching project statuses:",a),a.message?.includes("projectStatus")||a.message?.includes("does not exist"))return{error:"ProjectStatus model not found. Please stop the dev server, run 'npx prisma generate', and restart the server.",details:a.message};return{error:"Failed to fetch project statuses",details:a.message}}}async function w(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if(!await t(parseInt(b.user.id)))return{error:"Permission denied: You don't have permission to manage project statuses"};if(!c.prisma.projectStatus)return{error:"ProjectStatus model not found. Please stop the dev server, run 'npx prisma generate', and restart the server.",details:"Prisma client needs to be regenerated after adding the ProjectStatus model"};let g=a.get("name"),i=a.get("color")||"#6b7280",j=a.get("isDefault"),k=a.get("isFinal"),l=a.get("isUrgent"),m=a.get("isActive"),n=a.get("orderIndex"),o="true"===String(j),p="true"===String(k),q="true"===String(l),r="true"===String(m);if(o)try{await c.prisma.projectStatus.updateMany({where:{isDefault:!0},data:{isDefault:!1}})}catch(a){if(a.message?.includes("projectStatus")||a.message?.includes("does not exist"))console.warn("ProjectStatus model not available, skipping default status update");else throw a}console.log("Creating project status with values:",{name:g,color:i,isDefault:o,isFinal:p,isUrgent:q,orderIndex:n?parseInt(n):0,isActive:r});let s=u.safeParse({name:g,color:i,isDefault:o,isFinal:p,isUrgent:q,orderIndex:n?parseInt(n):0,isActive:r});if(!s.success)return console.error("Validation failed:",s.error.format()),{error:"Validation failed",details:s.error.format()};try{let a=await c.prisma.projectStatus.create({data:s.data});try{await (0,h.logActivity)({actionType:"project_status_created",actionCategory:"settings",actionSummary:`Project status "${a.name}" created`,actionDetails:{statusId:a.id,statusName:a.name,color:a.color,isDefault:a.isDefault,isFinal:a.isFinal,isUrgent:a.isUrgent},performedById:parseInt(b.user.id),entityType:"project_status",entityId:a.id})}catch(a){console.error("Failed to log activity:",a)}return(0,f.revalidatePath)("/dashboard/settings/projects"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0,projectStatus:a}}catch(a){if(console.error("Error creating project status:",a),console.error("Error details:",{code:a.code,meta:a.meta,message:a.message}),"P2021"===a.code||a.message?.includes("does not exist")||a.message?.includes("no such table"))return{error:"Database table not found. Please run the migration: npx prisma db execute --file prisma/migrations/manual_add_project_statuses.sql --schema prisma/schema.prisma",details:a.message};if("P2002"===a.code)return{error:"A project status with this name already exists"};return{error:"Failed to create project status",details:a.message}}}async function x(a,b){let g=await (0,d.getServerSession)(e.authOptions);if(!g)return{error:"Unauthorized"};if("admin"!==g.user.role)return{error:"Only admins can update project statuses"};let i=await c.prisma.projectStatus.findUnique({where:{id:a}});if(!i)return{error:"Project status not found"};let j=b.get("name"),k=b.get("color")||"#6b7280",l=b.get("isDefault"),m=b.get("isFinal"),n=b.get("isUrgent"),o=b.get("isActive"),p=b.get("orderIndex"),q="true"===String(l),r="true"===String(m),s="true"===String(n),t="true"===String(o);if(console.log("Update - Parsed form values:",{name:j,color:k,isDefaultValue:l,isDefault:q,isFinalValue:m,isFinal:r,isUrgentValue:n,isUrgent:s,isActiveValue:o,isActive:t,orderIndex:p}),q&&!i.isDefault)try{await c.prisma.projectStatus.updateMany({where:{isDefault:!0},data:{isDefault:!1}})}catch(a){console.error("Error unsetting other defaults:",a)}let v=u.safeParse({name:j,color:k,isDefault:q,isFinal:r,isUrgent:s,orderIndex:p?parseInt(p):i.orderIndex,isActive:t});if(!v.success)return{error:"Validation failed",details:v.error.format()};try{let b=await c.prisma.projectStatus.update({where:{id:a},data:v.data});return await (0,h.logActivity)({actionType:"project_status_updated",actionCategory:"settings",actionSummary:`Project status "${b.name}" updated`,actionDetails:{statusId:b.id,statusName:b.name,oldValues:{name:i.name,color:i.color,isDefault:i.isDefault,isFinal:i.isFinal,isUrgent:i.isUrgent},newValues:{name:b.name,color:b.color,isDefault:b.isDefault,isFinal:b.isFinal,isUrgent:b.isUrgent}},performedById:parseInt(g.user.id),entityType:"project_status",entityId:b.id}),(0,f.revalidatePath)("/dashboard/settings/projects"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0,projectStatus:b}}catch(a){if(console.error("Error updating project status:",a),"P2002"===a.code)return{error:"A project status with this name already exists"};return{error:"Failed to update project status",details:a.message}}}async function y(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if("admin"!==b.user.role)return{error:"Only admins can delete project statuses"};try{let d=await c.prisma.project.count({where:{projectStatusId:a}});if(d>0)return{error:`Cannot delete project status. ${d} project(s) are using it. Deactivate it instead.`};let e=await c.prisma.projectStatus.findUnique({where:{id:a}});if(!e)return{error:"Project status not found"};return await c.prisma.projectStatus.delete({where:{id:a}}),await (0,h.logActivity)({actionType:"project_status_deleted",actionCategory:"settings",actionSummary:`Project status "${e.name}" deleted`,actionDetails:{statusId:e.id,statusName:e.name},performedById:parseInt(b.user.id),entityType:"project_status",entityId:e.id}),(0,f.revalidatePath)("/dashboard/settings/projects"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0}}catch(a){return console.error("Error deleting project status:",a),{error:"Failed to delete project status",details:a.message}}}async function z(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if("admin"!==b.user.role)return{error:"Only admins can toggle project status"};try{let d=await c.prisma.projectStatus.findUnique({where:{id:a},select:{isActive:!0,name:!0}});if(!d)return{error:"Project status not found"};let e=await c.prisma.projectStatus.update({where:{id:a},data:{isActive:!d.isActive}});return await (0,h.logActivity)({actionType:"project_status_toggled",actionCategory:"settings",actionSummary:`Project status "${e.name}" ${e.isActive?"activated":"deactivated"}`,actionDetails:{statusId:e.id,statusName:e.name,isActive:e.isActive},performedById:parseInt(b.user.id),entityType:"project_status",entityId:e.id}),(0,f.revalidatePath)("/dashboard/settings/projects"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0,projectStatus:e}}catch(a){return console.error("Error toggling project status:",a),{error:"Failed to toggle project status",details:a.message}}}async function A(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};if("admin"!==b.user.role)return{error:"Only admins can reorder project statuses"};try{let d=a.map((a,b)=>c.prisma.projectStatus.update({where:{id:a},data:{orderIndex:b}}));return await Promise.all(d),await (0,h.logActivity)({actionType:"project_statuses_reordered",actionCategory:"settings",actionSummary:"Project statuses reordered",actionDetails:{statusIds:a},performedById:parseInt(b.user.id)}),(0,f.revalidatePath)("/dashboard/settings/projects"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0}}catch(a){return console.error("Error reordering project statuses:",a),{error:"Failed to reorder project statuses",details:a.message}}}(0,k.ensureServerEntryExports)([v,w,x,y,z,A]),(0,b.registerServerReference)(v,"40eb0a5c1df80ac1d9c012cf4d456e2b96fc6eccd4",null),(0,b.registerServerReference)(w,"40a74427d2644bccb6484ef387adfb75292463f76d",null),(0,b.registerServerReference)(x,"604f6e533c8ca2a4912a1ac71147f742593e73c415",null),(0,b.registerServerReference)(y,"40ec2af0f521f12446e739887e5c43eaec70fae9f8",null),(0,b.registerServerReference)(z,"40175cc470e34c2839ab0cca8512ab71fda5f72bb6",null),(0,b.registerServerReference)(A,"406bed43655a702690b8bb9b1e974078a2f83b7c6d",null),a.s(["createProjectStatus",()=>w,"deleteProjectStatus",()=>y,"getProjectStatuses",()=>v,"toggleProjectStatusActive",()=>z,"updateProjectStatus",()=>x],486431)}];

//# sourceMappingURL=nxt_New%20folder_Project_Management_NXT_src_app_actions_project-types_ts_fd2bb1c9._.js.map