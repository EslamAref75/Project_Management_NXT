module.exports=[273054,a=>{"use strict";var b=a.i(555163);function c(a,...d){let e=b.constructFrom.bind(null,a||d.find(a=>"object"==typeof a));return d.map(e)}a.s(["normalizeDates",()=>c])},25254,a=>{"use strict";var b=a.i(194893);function c(a){let c=(0,b.toDate)(a),d=new Date(Date.UTC(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds()));return d.setUTCFullYear(c.getFullYear()),a-d}a.s(["getTimezoneOffsetInMilliseconds",()=>c])},269477,a=>{"use strict";var b=a.i(25254),c=a.i(273054),d=a.i(407716),e=a.i(114678);function f(a,f,g){let[h,i]=(0,c.normalizeDates)(g?.in,a,f),j=(0,e.startOfDay)(h),k=(0,e.startOfDay)(i);return Math.round((j-(0,b.getTimezoneOffsetInMilliseconds)(j)-(k-(0,b.getTimezoneOffsetInMilliseconds)(k)))/d.millisecondsInDay)}a.s(["differenceInCalendarDays",()=>f])},405002,a=>{"use strict";var b=a.i(194893);function c(a){return!(!(a instanceof Date||"object"==typeof a&&"[object Date]"===Object.prototype.toString.call(a))&&"number"!=typeof a||isNaN(+(0,b.toDate)(a)))}a.s(["isValid",()=>c],405002)},522734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},181711,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(555163),e=a.i(194893);function f(a,b){let c=(0,e.toDate)(a,b?.in).getDay();return 0===c||6===c}var g=a.i(273054),h=a.i(443585),i=a.i(269477),j=a.i(114678),k=a.i(405002);async function l(a){let b=await c.prisma.task.findUnique({where:{id:a},include:{assignees:{select:{id:!0}},dependencies:{include:{dependsOnTask:!0}}}});if(!b)return null;let l=b.estimatedHours>0?b.estimatedHours/8:1;if(b.assignees.length>0){let a=await c.prisma.task.findMany({where:{assignees:{some:{id:{in:b.assignees.map(a=>a.id)}}},status:"completed",completedAt:{not:null}},take:10,orderBy:{completedAt:"desc"},select:{estimatedHours:!0,actualHours:!0,createdAt:!0,completedAt:!0}});if(a.length>0){let c=0,d=0;a.forEach(a=>{a.estimatedHours>0&&a.actualHours>0&&(c+=a.actualHours/a.estimatedHours,d++)});let e=d>0?c/d:1.2;b.estimatedHours>0&&(l=b.estimatedHours*e/8)}}let m=new Date,n=!1;if(b.dependencies.length>0){let a=new Date;for(let c of b.dependencies){let b=c.dependsOnTask;if("completed"!==b.status&&!b.taskStatusId){let c=b.dueDate?new Date(b.dueDate):(0,h.addDays)(new Date,1);c>a&&(a=c),n=!0}}a>m&&(m=a)}let o=function(a,b,c){let g=(0,e.toDate)(a,void 0),h=f(g,void 0);if(isNaN(b))return(0,d.constructFrom)(void 0,NaN);let i=g.getHours(),j=b<0?-1:1,k=Math.trunc(b/5);g.setDate(g.getDate()+7*k);let l=Math.abs(b%5);for(;l>0;)g.setDate(g.getDate()+j),f(g,void 0)||(l-=1);h&&f(g,void 0)&&0!==b&&(6===(0,e.toDate)(g,void 0).getDay()&&g.setDate(g.getDate()+(j<0?2:-1)),0===(0,e.toDate)(g,void 0).getDay()&&g.setDate(g.getDate()+(j<0?1:-2)));return g.setHours(i),g}(m,Math.ceil(l)),p=85,q=[];n&&(p-=15,q.push("Dependent on incomplete tasks")),b.dueDate&&o>b.dueDate&&q.push("Historical velocity suggests delay"),0===b.assignees.length&&(p-=20,q.push("No assignee to gauge velocity"));let r="low";return b.dueDate&&o>b.dueDate&&(r=function(a,b,c){let[d,e]=(0,g.normalizeDates)(void 0,a,b);if(!(0,k.isValid)(d)||!(0,k.isValid)(e))return NaN;let l=(0,i.differenceInCalendarDays)(d,e),m=l<0?-1:1,n=Math.trunc(l/7),o=5*n,p=(0,h.addDays)(e,7*n);for(;!function(a,b,c){let[d,e]=(0,g.normalizeDates)(void 0,a,b);return+(0,j.startOfDay)(d)==+(0,j.startOfDay)(e)}(d,p);)o+=f(p,void 0)?0:m,p=(0,h.addDays)(p,m);return 0===o?0:o}(o,b.dueDate)>2?"high":"medium"),{taskId:a,predictedDate:o,riskLevel:r,confidence:p,explanation:q.join(", ")||"Based on average team velocity"}}var m=a.i(450246),n=a.i(915929);async function o(a){if(!await (0,m.getServerSession)(n.authOptions))return{error:"Unauthorized"};try{let b=await Promise.all(a.map(async a=>{let b=await l(a);return{taskId:a,prediction:b}})),c={};return b.forEach(a=>{c[a.taskId]=a.prediction}),{success:!0,data:c}}catch(a){return console.error("Failed to get forecasts",a),{error:"Failed to load forecasts"}}}(0,a.i(287907).ensureServerEntryExports)([o]),(0,b.registerServerReference)(o,"40014e02ec0435626c5ced3cf35fc455f331fe89cf",null),a.s(["getForecastsForTasks",()=>o],181711)},590187,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(450246),e=a.i(915929),f=a.i(449597),g=a.i(126695),h=a.i(153544),i=a.i(661698),j=a.i(57693),k=a.i(287907);let l=i.z.object({projectId:i.z.coerce.number(),reason:i.z.string().min(10,"Reason must be at least 10 characters")});async function m(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};let i=a.get("projectId"),k=a.get("reason"),m=l.safeParse({projectId:i,reason:k});if(!m.success)return{error:"Validation failed",details:m.error.format()};try{let a=await c.prisma.project.findUnique({where:{id:m.data.projectId},include:{projectManager:!0,projectUsers:!0,projectTeams:{include:{team:{include:{teamLead:!0,members:!0}}}}}});if(!a)return{error:"Project not found"};let d=parseInt(b.user.id),e=await (0,j.hasPermissionWithoutRoleBypass)(d,"project.markUrgent",m.data.projectId),i=a.projectManagerId===d||a.createdById===d;if(!e&&!i)return{error:"Unauthorized: You don't have permission to mark this project as urgent"};let k=await c.prisma.project.update({where:{id:m.data.projectId},data:{priority:"urgent",urgentReason:m.data.reason,urgentMarkedAt:new Date,urgentMarkedById:d},include:{projectManager:!0,projectUsers:{select:{userId:!0}},projectTeams:{include:{team:{select:{teamLeadId:!0,members:{select:{userId:!0}}}}}}}}),l=new Set;k.projectManagerId&&l.add(k.projectManagerId),k.projectUsers.forEach(a=>{l.add(a.userId)}),k.projectTeams.forEach(a=>{a.team.teamLeadId&&l.add(a.team.teamLeadId),a.team.members.forEach(a=>{l.add(a.userId)})}),(await c.prisma.user.findMany({where:{role:"admin"},select:{id:!0}})).forEach(a=>l.add(a.id));let n=Array.from(l).map(a=>(0,h.createProjectNotification)(m.data.projectId,a,{type:"project_urgent",entityType:"project",entityId:m.data.projectId,title:`ðŸš¨ URGENT: ${k.name}`,message:`This project has been marked as URGENT. Reason: ${m.data.reason}`,soundRequired:!0,isUrgent:!0,requiresAcknowledgment:!0}));return await Promise.all(n),await (0,g.logActivity)({actionType:"project_marked_urgent",actionCategory:"project",actionSummary:`Project "${k.name}" marked as URGENT`,actionDetails:{projectId:k.id,projectName:k.name,reason:m.data.reason,notifiedUsers:Array.from(l).length},performedById:d,projectId:m.data.projectId,entityType:"project",entityId:m.data.projectId}),(0,f.revalidatePath)(`/dashboard/projects/${m.data.projectId}`),(0,f.revalidatePath)("/dashboard"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0,project:k}}catch(a){return console.error("Error marking project as urgent:",a),{error:"Failed to mark project as urgent",details:a.message}}}async function n(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};let h=parseInt(b.user.id);try{let b=await c.prisma.project.findUnique({where:{id:a}});if(!b)return{error:"Project not found"};if("urgent"!==b.priority)return{error:"Project is not marked as urgent"};return await c.prisma.urgentProjectAcknowledgement.upsert({where:{projectId_userId:{projectId:a,userId:h}},create:{projectId:a,userId:h},update:{acknowledgedAt:new Date}}),await c.prisma.projectNotification.updateMany({where:{projectId:a,userId:h,isUrgent:!0,requiresAcknowledgment:!0},data:{acknowledgedAt:new Date,isRead:!0}}),await (0,g.logActivity)({actionType:"project_urgent_acknowledged",actionCategory:"project",actionSummary:`Acknowledged urgent project "${b.name}"`,actionDetails:{projectId:b.id,projectName:b.name},performedById:h,projectId:a,entityType:"project",entityId:a}),(0,f.revalidatePath)(`/dashboard/projects/${a}`),(0,f.revalidatePath)("/dashboard"),{success:!0}}catch(a){return console.error("Error acknowledging urgent project:",a),{error:"Failed to acknowledge urgent project",details:a.message}}}async function o(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return{error:"Unauthorized"};let h=parseInt(b.user.id);try{let b=await c.prisma.project.findUnique({where:{id:a}});if(!b)return{error:"Project not found"};let d=await (0,j.hasPermissionWithoutRoleBypass)(h,"project.removeUrgent",a),e=b.projectManagerId===h||b.createdById===h;if(!d&&!e)return{error:"Unauthorized: You don't have permission to remove urgent priority from this project"};return await c.prisma.project.update({where:{id:a},data:{priority:"normal",urgentReason:null,urgentMarkedAt:null,urgentMarkedById:null}}),await c.prisma.projectNotification.updateMany({where:{projectId:a,isUrgent:!0},data:{isRead:!0,acknowledgedAt:new Date}}),await (0,g.logActivity)({actionType:"project_urgent_removed",actionCategory:"project",actionSummary:`Removed urgent priority from project "${b.name}"`,actionDetails:{projectId:b.id,projectName:b.name},performedById:h,projectId:a,entityType:"project",entityId:a}),(0,f.revalidatePath)(`/dashboard/projects/${a}`),(0,f.revalidatePath)("/dashboard"),(0,f.revalidatePath)("/dashboard/projects"),{success:!0}}catch(a){return console.error("Error removing urgent priority:",a),{error:"Failed to remove urgent priority",details:a.message}}}async function p(){let a=await (0,d.getServerSession)(e.authOptions);if(!a)return{error:"Unauthorized"};let b=parseInt(a.user.id),f=a.user.role||"developer";try{let a={priority:"urgent"};"admin"!==f&&(a.OR=[{projectManagerId:b},{createdById:b},{projectUsers:{some:{userId:b}}},{projectTeams:{some:{team:{teamLeadId:b}}}},{projectTeams:{some:{team:{members:{some:{userId:b}}}}}}]);let d=await c.prisma.project.findMany({where:a,include:{projectManager:{select:{id:!0,username:!0,avatarUrl:!0}},urgentMarkedBy:{select:{id:!0,username:!0}},urgentAcknowledgments:{where:{userId:b},select:{acknowledgedAt:!0}}},orderBy:{urgentMarkedAt:"desc"}});return{success:!0,projects:d}}catch(a){return console.error("Error fetching urgent projects:",a),{error:"Failed to fetch urgent projects",details:a.message}}}async function q(a){let b=await (0,d.getServerSession)(e.authOptions);if(!b)return!1;let f=parseInt(b.user.id);try{return!!await c.prisma.urgentProjectAcknowledgement.findUnique({where:{projectId_userId:{projectId:a,userId:f}}})}catch(a){return console.error("Error checking acknowledgment:",a),!1}}(0,k.ensureServerEntryExports)([m,n,o,p,q]),(0,b.registerServerReference)(m,"409f63a3c373c5a1d91cbdece6bed64e7ad1bb9de3",null),(0,b.registerServerReference)(n,"40271b869aa95cc70186c7d92a799fd4ff185374b6",null),(0,b.registerServerReference)(o,"40a1ef9e59469b9018d9dca101e2d6830cd362dfa4",null),(0,b.registerServerReference)(p,"002d971c7f5a3882ee40ebedc20527bd73b0bb1658",null),(0,b.registerServerReference)(q,"406dc0bd8d7e9cdb49e1d05a07a97ade94458c58d0",null),a.s(["acknowledgeUrgentProject",()=>n,"getUrgentProjects",()=>p,"hasAcknowledgedUrgent",()=>q,"markProjectUrgent",()=>m,"removeUrgentPriority",()=>o])},924868,(a,b,c)=>{b.exports=a.x("fs/promises",()=>require("fs/promises"))},942722,a=>{"use strict";let b={"image/jpeg":{ext:"jpg",maxSize:5242880},"image/png":{ext:"png",maxSize:5242880},"image/webp":{ext:"webp",maxSize:5242880},"image/gif":{ext:"gif",maxSize:5242880},"image/svg+xml":{ext:"svg",maxSize:2097152},"application/pdf":{ext:"pdf",maxSize:0xa00000},"application/msword":{ext:"doc",maxSize:0xa00000},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{ext:"docx",maxSize:0xa00000},"application/vnd.ms-excel":{ext:"xls",maxSize:0xa00000},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{ext:"xlsx",maxSize:0xa00000},"text/plain":{ext:"txt",maxSize:5242880},"text/csv":{ext:"csv",maxSize:5242880}},c=["exe","bat","cmd","com","scr","vbs","js","jar","zip","rar","7z","dll","msi","app","deb","rpm","dmg","pkg","run","sh","bash","zsh","ps1","psc1","msh","msh1","mshxml","msh1xml","pssc","psc2","msh2","msh2xml","psc3","msh3","msh3xml","aspx","asp","php","php3","php4","php5","jsp","jspx","jspf","jsw","jsv","jspx","wsh","wsf","py","pyc","pyo","rb","rbw","cgi","pl","ada","asm","bas","c","cpp","cxx","cc","h","hpp","cs","java","class","swift","kt","go","rs","ts","tsx","jsx"];function d(a){if(!a)return{valid:!1,error:"No file provided"};if(!a.name||""===a.name.trim())return{valid:!1,error:"File must have a name"};if(!b[a.type]){let c=Object.keys(b).join(", ");return{valid:!1,error:`File type "${a.type||"unknown"}" is not allowed. Supported types: ${c}`}}let d=b[a.type].maxSize;if(0===a.size)return{valid:!1,error:"File is empty"};if(a.size>d){let b=(d/1024/1024).toFixed(2),c=(a.size/1024/1024).toFixed(2);return{valid:!1,error:`File size ${c}MB exceeds maximum ${b}MB for this file type`}}let e=g(a.name).toLowerCase();if(e&&c.includes(e))return{valid:!1,error:`File extension ".${e}" is not allowed for security reasons`};let f=b[a.type].ext;return e&&e!==f&&console.warn(`Warning: File extension ".${e}" may not match MIME type "${a.type}". Expected: ".${f}"`),{valid:!0}}function e(a){return a?a.replace(/\\/g,"").replace(/\//g,"").replace(/\.\./g,"").replace(/[<>:"|?*\x00-\x1f]/g,"").replace(/\s+/g,"_").substring(0,255):"file"}function f(a,b){let c=g(a),d=Date.now(),e=Math.random().toString(36).substring(2,8);return`u${b}_${d}_${e}.${c}`}function g(a){if(!a)return"";let b=a.split(".");return b.length>1?b[b.length-1]:""}async function h(a,b){let c={"image/jpeg":[255,216,255],"image/png":[137,80,78,71],"image/gif":[71,73,70],"image/webp":[82,73,70,70],"application/pdf":[37,80,68,70]}[b];if(!c)return!0;let d=new Uint8Array(a);if(d.length<c.length)return!1;for(let a=0;a<c.length;a++)if(d[a]!==c[a])return!1;return!0}function i(a){let b=["B","KB","MB","GB"],c=a,d=0;for(;c>=1024&&d<b.length-1;)c/=1024,d++;return`${c.toFixed(2)} ${b[d]}`}a.s(["generateSafeFilename",()=>f,"getReadableFileSize",()=>i,"sanitizeFilename",()=>e,"validateFileContent",()=>h,"validateFileUpload",()=>d])},681170,a=>{"use strict";var b=a.i(184251),c=a.i(347656),d=a.i(450246),e=a.i(915929);async function f(a={}){try{let b=await (0,d.getServerSession)(e.authOptions);if(!b?.user?.id)return{success:!1,error:"Unauthorized"};if("admin"!==b.user.role)return{success:!1,error:"Access denied. Admin only."};let{limit:f=50,offset:g=0,startDate:h,endDate:i,userId:j,projectId:k,category:l,entityType:m,search:n}=a,o={};(h||i)&&(o.createdAt={},h&&(o.createdAt.gte=h),i&&(o.createdAt.lte=i)),j&&(o.performedById=j),k&&(o.projectId=k),l&&(o.actionCategory=l),m&&(o.entityType=m),n&&n.trim()&&(o.OR=[{actionSummary:{contains:n.trim()}},{actionDetails:{contains:n.trim()}},{actionType:{contains:n.trim()}}]);let p=[],q=0;try{let[a,b]=await Promise.all([c.prisma.activityLog.findMany({where:o,include:{performedBy:{select:{id:!0,username:!0,email:!0,role:!0}},affectedUser:{select:{id:!0,username:!0,email:!0}},project:{select:{id:!0,name:!0}}},orderBy:{createdAt:"desc"},take:f,skip:g}),c.prisma.activityLog.count({where:o})]);p=a,q=b}catch(a){if(a.message?.includes("Unknown arg")||"P2009"===a.code){console.warn("[ActivityLogs] Relations not available, using basic query");let[a,b]=await Promise.all([c.prisma.activityLog.findMany({where:o,orderBy:{createdAt:"desc"},take:f,skip:g}),c.prisma.activityLog.count({where:o})]);p=a.map(a=>({...a,performedBy:a.userId?{id:a.userId,username:"Unknown",email:"",role:""}:null,affectedUser:null,project:null})),q=b}else throw a}return{success:!0,logs:p,total:q,limit:f,offset:g}}catch(a){return console.error("Error fetching activity logs:",a),{success:!1,error:a?.message||"Failed to fetch activity logs"}}}async function g(a){try{let b=await (0,d.getServerSession)(e.authOptions);if(!b?.user?.id)return{success:!1,error:"Unauthorized"};if("admin"!==b.user.role)return{success:!1,error:"Access denied. Admin only."};let f=await c.prisma.activityLog.findUnique({where:{id:a},include:{performedBy:{select:{id:!0,username:!0,email:!0,role:!0}},affectedUser:{select:{id:!0,username:!0,email:!0}},project:{select:{id:!0,name:!0}}}});if(!f)return{success:!1,error:"Activity log not found"};return{success:!0,log:f}}catch(a){return console.error("Error fetching activity log:",a),{success:!1,error:a?.message||"Failed to fetch activity log"}}}async function h(a,b){try{let f=await (0,d.getServerSession)(e.authOptions);if(!f?.user?.id)return{success:!1,error:"Unauthorized"};if("admin"!==f.user.role)return{success:!1,error:"Access denied. Admin only."};let g={};(a||b)&&(g.createdAt={},a&&(g.createdAt.gte=a),b&&(g.createdAt.lte=b));let[h,i,j,k]=await Promise.all([c.prisma.activityLog.count({where:g}),c.prisma.activityLog.groupBy({by:["actionCategory"],where:g,_count:!0}),c.prisma.activityLog.groupBy({by:["performedById"],where:g,_count:!0,orderBy:{_count:{performedById:"desc"}},take:10}),c.prisma.activityLog.findMany({where:g,orderBy:{createdAt:"desc"},take:10,select:{id:!0,actionType:!0,actionSummary:!0,createdAt:!0,performedBy:{select:{username:!0}}}})]);return{success:!0,stats:{totalLogs:h,byCategory:i.map(a=>({category:a.actionCategory,count:a._count})),byUser:j.map(a=>({userId:a.performedById,count:a._count})),recentActivity:k}}}catch(a){return console.error("Error fetching activity log stats:",a),{success:!1,error:a?.message||"Failed to fetch activity log stats"}}}(0,a.i(287907).ensureServerEntryExports)([f,g,h]),(0,b.registerServerReference)(f,"404fd7d1c33d728683f2bb688d48969be05c615525",null),(0,b.registerServerReference)(g,"40e1abf0f2bc1465cb8e9167bcdb1cde8574cdfa83",null),(0,b.registerServerReference)(h,"6040cb0ffe8e1b4249eda0ae384f1c91a50fdfd9bf",null),a.s(["getActivityLogs",()=>f])},47897,a=>{"use strict";var b=a.i(962460),c=a.i(153544),d=a.i(462266),e=a.i(126695),f=a.i(476662),g=a.i(188417),h=a.i(181711),i=a.i(352827),j=a.i(486431),k=a.i(590187),l=a.i(681170),m=a.i(6588),n=a.i(184251),o=a.i(347656),p=a.i(450246),q=a.i(915929),r=a.i(449597),s=a.i(924868),t=a.i(814747),u=a.i(522734),v=a.i(942722),w=a.i(287907);let x=(0,t.join)(process.cwd(),"public","uploads");async function y(){(0,u.existsSync)(x)||await (0,s.mkdir)(x,{recursive:!0})}async function z(a){let b=await (0,p.getServerSession)(q.authOptions);if(!b)return{error:"Unauthorized",code:"UNAUTHORIZED"};let c=a.get("file"),d=a.get("projectId"),f=a.get("taskId");if(!c||!d)return{error:"File and project ID are required",code:"MISSING_PARAMS"};try{let a=(0,v.validateFileUpload)(c);if(!a.valid)return{error:a.error||"Invalid file",code:"INVALID_FILE"};let g=await c.arrayBuffer();if(!await (0,v.validateFileContent)(g,c.type))return{error:"File content does not match declared type. Possible spoofing attempt.",code:"CONTENT_MISMATCH"};await y();let h=(0,v.generateSafeFilename)(c.name,parseInt(b.user.id)),i=(0,t.join)(x,h),j=Buffer.from(g);await (0,s.writeFile)(i,j);let k=`/uploads/${h}`,l=await o.prisma.attachment.create({data:{fileName:(0,v.sanitizeFilename)(c.name),fileUrl:k,fileType:c.type||null,fileSize:c.size||null,taskId:f?parseInt(f):null,uploadedById:parseInt(b.user.id)}});return await (0,e.logActivity)({actionType:"file_uploaded",actionCategory:"project",actionSummary:`File "${(0,v.sanitizeFilename)(c.name)}" uploaded`,actionDetails:{fileName:(0,v.sanitizeFilename)(c.name),fileSize:c.size,fileType:c.type,attachmentId:l.id,validationPassed:!0},performedById:parseInt(b.user.id),projectId:parseInt(d),entityType:"attachment",entityId:l.id}),(0,r.revalidatePath)(`/dashboard/projects/${d}`),{success:!0,attachment:l,code:"UPLOAD_SUCCESS"}}catch(a){return console.error("File upload error:",a),{error:"Failed to upload file",code:"UPLOAD_FAILED",details:a.message}}}async function A(a){if(!await (0,p.getServerSession)(q.authOptions))return{error:"Unauthorized"};try{let b=(await o.prisma.task.findMany({where:{projectId:a},select:{id:!0}})).map(a=>a.id),c=await o.prisma.attachment.findMany({where:{OR:[{taskId:{in:b}},{taskId:null}]},include:{uploader:{select:{id:!0,username:!0,avatarUrl:!0}},task:{select:{id:!0,title:!0}}},orderBy:{uploadedAt:"desc"}});return{success:!0,attachments:c}}catch(a){return console.error("Error fetching attachments:",a),{error:"Failed to fetch attachments",details:a.message}}}async function B(b,c){let d=await (0,p.getServerSession)(q.authOptions);if(!d)return{error:"Unauthorized"};try{let f=await o.prisma.attachment.findUnique({where:{id:b}});if(!f)return{error:"Attachment not found"};if(f.uploadedById!==parseInt(d.user.id)&&"admin"!==d.user.role)return{error:"Unauthorized: You can only delete your own files"};try{let b=(0,t.join)(process.cwd(),"public",f.fileUrl);if((0,u.existsSync)(b)){let{unlink:c}=await a.A(260815);await c(b)}}catch(a){console.error("Error deleting file from disk:",a)}return await o.prisma.attachment.delete({where:{id:b}}),await (0,e.logActivity)({actionType:"file_deleted",actionCategory:"project",actionSummary:`File "${f.fileName}" deleted`,actionDetails:{fileName:f.fileName,attachmentId:f.id},performedById:parseInt(d.user.id),projectId:c,entityType:"attachment",entityId:b}),(0,r.revalidatePath)(`/dashboard/projects/${c}`),{success:!0}}catch(a){return console.error("Error deleting attachment:",a),{error:"Failed to delete attachment",details:a.message}}}(0,w.ensureServerEntryExports)([z,A,B]),(0,n.registerServerReference)(z,"40c036377622299eab7c3fedd2f88987461f8f0471",null),(0,n.registerServerReference)(A,"400d0b446f3a38c15d257fe7d9046d0aa056070e15",null),(0,n.registerServerReference)(B,"60c92747f45f0a848c5a9d51dc879510962f79e0b1",null),a.s([],990205),a.i(990205),a.s(["0033db22356cbf8845a3517099b63dfc38d1147299",()=>b.getPublicSystemSettings,"003ae2a452e6e1e8ebee86f206a9903396d5df13b8",()=>d.getProjects,"0067b4066470cdfc7051409a87b3c7ea74b1f3dbad",()=>g.getAllProjectsStats,"00686a7231b739e4fe9b8305b757bc0e83827b9865",()=>c.getAllProjectsUnreadNotificationCount,"0078a5996050e1da89a66893bd05780e75185392cb",()=>f.getUsers,"40014e02ec0435626c5ced3cf35fc455f331fe89cf",()=>h.getForecastsForTasks,"4004a0aae390e2c1aeb900c79065f312ac43d90f8d",()=>c.getAllProjectsNotifications,"400d0b446f3a38c15d257fe7d9046d0aa056070e15",()=>A,"401e3f4be30a5d5dbee04214aa788c798e018c4c21",()=>d.createProject,"401fc4e21517ebfbd3eebabb3ac6ad3bf2fb7443a7",()=>f.createUser,"40271b869aa95cc70186c7d92a799fd4ff185374b6",()=>k.acknowledgeUrgentProject,"402c9fcdaf734573eeb364d1e92aac14ecf31bcfb9",()=>d.getProject,"402d88094f0d43ffbbdb2cc55981130389e939c098",()=>m.createTask,"404fd7d1c33d728683f2bb688d48969be05c615525",()=>l.getActivityLogs,"406144e6cbbfbe91083d4680cc56756da14a65698a",()=>d.getProjectsWithFilters,"406dc0bd8d7e9cdb49e1d05a07a97ade94458c58d0",()=>k.hasAcknowledgedUrgent,"406fd270e8a350e38c78e4b79321560707aa26fd1a",()=>f.getUser,"4073df5af18efe51e33e158abaa2dd30f11932484d",()=>c.getProjectNotificationPreferences,"408c06bc00554e58667a6497e03286e21786a0b4de",()=>g.getProjectStats,"4092a06687f1e4d6d11b97639f194f16619a7c015f",()=>g.getTaskStats,"409f63a3c373c5a1d91cbdece6bed64e7ad1bb9de3",()=>k.markProjectUrgent,"40a1ef9e59469b9018d9dca101e2d6830cd362dfa4",()=>k.removeUrgentPriority,"40abdcd9a05b7e5b6a27a4efd7412defa3f340c60c",()=>f.deleteUser,"40c036377622299eab7c3fedd2f88987461f8f0471",()=>z,"40c086aae8b4c1ddec14829c213410ee4c5d2ec0b4",()=>c.markAllProjectNotificationsAsRead,"40c45036bf2dcfbc3a3b624285c3d3d3366fc5ed73",()=>c.getProjectUnreadNotificationCount,"40daa1d9c7314de4957a7669434db12aaa24630ba4",()=>e.logActivity,"40eb0a5c1df80ac1d9c012cf4d456e2b96fc6eccd4",()=>j.getProjectStatuses,"40fdba31998d7a3efe7c944c688cf93002e917af7b",()=>d.deleteProject,"601c00162e3e64028c2b657a9e3982df01dad141d5",()=>d.updateProject,"6020ac488ab0f44300111f3a8024b04b647106d187",()=>f.updateUserTeam,"60691655a7ad6aec29ab9691d8571a0d380be93da1",()=>c.markProjectNotificationAsRead,"60b33fdd6fc55215f2569d47e96e5d33d33f4f707f",()=>f.toggleUserStatus,"60c92747f45f0a848c5a9d51dc879510962f79e0b1",()=>B,"60d7258dffa20b5ae58a4ac333313c2a6cc4aeb7a7",()=>c.updateProjectNotificationPreferences,"60e05fd890f5d06ad446fdd4907a3fbe4311fe3ac9",()=>g.getSummaryStatsWithTrends,"60e11d18f808d2843f4d06a35ea4ad9027dd8b4de1",()=>c.getProjectNotifications,"60e1fb0fb657783a6424ba7525af9dca8a6316a12b",()=>f.updateUser,"60ec9252c798f5964d56c5d51f9afd9f2f40212108",()=>i.getProjectTypes,"705f7777ed9cdc6c32f418ba57dcb7f4b84f8c002a",()=>c.createProjectNotification,"709a22b83fb95b514103e9a68c206c65a10f984982",()=>m.updateTaskStatus],47897)},260815,a=>{a.v(a=>Promise.resolve().then(()=>a(924868)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__7b7b776b._.js.map