{"version":3,"sources":["../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/_lib/normalizeDates.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/_lib/getTimezoneOffsetInMilliseconds.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/differenceInCalendarDays.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/app/actions/projects.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/constants.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/constructFrom.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/toDate.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/startOfDay.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/endOfDay.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/addDays.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/subDays.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/endOfMonth.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/app/actions/progress-report.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/differenceInDays.js","../../../../../../../nxt/New%20folder/Project_Management_NXT/.next-internal/server/app/dashboard/reports/page/actions.js%20%28server%20actions%20loader%29","../../../../../../../nxt/New%20folder/Project_Management_NXT/src/app/actions/reports.ts","../../../../../../../nxt/New%20folder/Project_Management_NXT/node_modules/date-fns/startOfMonth.js"],"sourcesContent":["import { constructFrom } from \"../constructFrom.js\";\n\nexport function normalizeDates(context, ...dates) {\n  const normalize = constructFrom.bind(\n    null,\n    context || dates.find((date) => typeof date === \"object\"),\n  );\n  return dates.map(normalize);\n}\n","import { toDate } from \"../toDate.js\";\n\n/**\n * Google Chrome as of 67.0.3396.87 introduced timezones with offset that includes seconds.\n * They usually appear for dates that denote time before the timezones were introduced\n * (e.g. for 'Europe/Prague' timezone the offset is GMT+00:57:44 before 1 October 1891\n * and GMT+01:00:00 after that date)\n *\n * Date#getTimezoneOffset returns the offset in minutes and would return 57 for the example above,\n * which would lead to incorrect calculations.\n *\n * This function returns the timezone offset in milliseconds that takes seconds in account.\n */\nexport function getTimezoneOffsetInMilliseconds(date) {\n  const _date = toDate(date);\n  const utcDate = new Date(\n    Date.UTC(\n      _date.getFullYear(),\n      _date.getMonth(),\n      _date.getDate(),\n      _date.getHours(),\n      _date.getMinutes(),\n      _date.getSeconds(),\n      _date.getMilliseconds(),\n    ),\n  );\n  utcDate.setUTCFullYear(_date.getFullYear());\n  return +date - +utcDate;\n}\n","import { getTimezoneOffsetInMilliseconds } from \"./_lib/getTimezoneOffsetInMilliseconds.js\";\nimport { normalizeDates } from \"./_lib/normalizeDates.js\";\nimport { millisecondsInDay } from \"./constants.js\";\nimport { startOfDay } from \"./startOfDay.js\";\n\n/**\n * The {@link differenceInCalendarDays} function options.\n */\n\n/**\n * @name differenceInCalendarDays\n * @category Day Helpers\n * @summary Get the number of calendar days between the given dates.\n *\n * @description\n * Get the number of calendar days between the given dates. This means that the times are removed\n * from the dates and then the difference in days is calculated.\n *\n * @param laterDate - The later date\n * @param earlierDate - The earlier date\n * @param options - The options object\n *\n * @returns The number of calendar days\n *\n * @example\n * // How many calendar days are between\n * // 2 July 2011 23:00:00 and 2 July 2012 00:00:00?\n * const result = differenceInCalendarDays(\n *   new Date(2012, 6, 2, 0, 0),\n *   new Date(2011, 6, 2, 23, 0)\n * )\n * //=> 366\n * // How many calendar days are between\n * // 2 July 2011 23:59:00 and 3 July 2011 00:01:00?\n * const result = differenceInCalendarDays(\n *   new Date(2011, 6, 3, 0, 1),\n *   new Date(2011, 6, 2, 23, 59)\n * )\n * //=> 1\n */\nexport function differenceInCalendarDays(laterDate, earlierDate, options) {\n  const [laterDate_, earlierDate_] = normalizeDates(\n    options?.in,\n    laterDate,\n    earlierDate,\n  );\n\n  const laterStartOfDay = startOfDay(laterDate_);\n  const earlierStartOfDay = startOfDay(earlierDate_);\n\n  const laterTimestamp =\n    +laterStartOfDay - getTimezoneOffsetInMilliseconds(laterStartOfDay);\n  const earlierTimestamp =\n    +earlierStartOfDay - getTimezoneOffsetInMilliseconds(earlierStartOfDay);\n\n  // Round the number of days to the nearest integer because the number of\n  // milliseconds in a day is not constant (e.g. it's different in the week of\n  // the daylight saving time clock shift).\n  return Math.round((laterTimestamp - earlierTimestamp) / millisecondsInDay);\n}\n\n// Fallback for modularized imports:\nexport default differenceInCalendarDays;\n","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { getServerSession } from \"next-auth\"\r\nimport { authOptions } from \"@/lib/auth\"\r\nimport { z } from \"zod\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { logActivity } from \"@/lib/activity-logger\"\r\nimport { hasPermissionWithoutRoleBypass, handleAuthorizationError } from \"@/lib/rbac-helpers\"\r\nimport { PERMISSIONS } from \"@/lib/permissions\"\r\nimport { selectPatterns } from \"@/lib/query-optimization\"\r\n\r\nconst projectSchema = z.object({\r\n    name: z.string().min(1, \"Name is required\"),\r\n    type: z.string().optional(), // Legacy field, kept for backward compatibility\r\n    projectTypeId: z.coerce.number().optional().nullable(),\r\n    projectStatusId: z.coerce.number().optional().nullable(),\r\n    description: z.string().optional(),\r\n    scope: z.string().optional(),\r\n    status: z.string().optional(), // Legacy field, kept for backward compatibility\r\n    startDate: z.string().optional(),\r\n    endDate: z.string().optional(),\r\n    projectManagerId: z.coerce.number().optional(),\r\n})\r\n\r\nexport async function getProjects() {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) throw new Error(\"Unauthorized\")\r\n\r\n    // ✅ OPTIMIZED: Use select pattern instead of fetching all columns\r\n    // Fetch only necessary fields to reduce data transfer\r\n    const projects = await prisma.project.findMany({\r\n        orderBy: { createdAt: \"desc\" },\r\n        select: {\r\n            id: true,\r\n            name: true,\r\n            description: true,\r\n            status: true,\r\n            type: true,\r\n            projectStatusId: true,\r\n            projectTypeId: true,\r\n            projectManagerId: true,\r\n            startDate: true,\r\n            endDate: true,\r\n            createdAt: true,\r\n            createdById: true,\r\n            projectManager: {\r\n                select: {\r\n                    id: true,\r\n                    username: true,\r\n                    email: true,\r\n                    avatarUrl: true,\r\n                },\r\n            },\r\n            _count: {\r\n                select: {\r\n                    tasks: true,\r\n                    projectUsers: true,\r\n                    notifications: true,\r\n                },\r\n            },\r\n        },\r\n    })\r\n\r\n    return projects\r\n}\r\n\r\nexport async function getProjectsWithFilters(params: {\r\n    search?: string\r\n    category?: string[]\r\n    status?: string[]\r\n    priority?: string[]\r\n    startDate?: string\r\n    endDate?: string\r\n    projectManager?: string\r\n    page?: number\r\n    limit?: number\r\n}) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const {\r\n        search = \"\",\r\n        category = [],\r\n        status = [],\r\n        priority = [],\r\n        startDate,\r\n        endDate,\r\n        projectManager,\r\n        page = 1,\r\n        limit = 12,\r\n    } = params\r\n\r\n    try {\r\n        const where: any = {}\r\n\r\n        // Search filter\r\n        if (search) {\r\n            where.name = { contains: search }\r\n        }\r\n\r\n        // Category filter\r\n        if (category.length > 0) {\r\n            where.type = { in: category }\r\n        }\r\n\r\n        // Status filter - support both status IDs (for dynamic statuses) and legacy status names\r\n        if (status.length > 0) {\r\n            const statusIds: number[] = []\r\n            const statusNames: string[] = []\r\n\r\n            status.forEach(s => {\r\n                const id = parseInt(s)\r\n                if (!isNaN(id)) {\r\n                    statusIds.push(id)\r\n                } else {\r\n                    statusNames.push(s)\r\n                }\r\n            })\r\n\r\n            const statusConditions: any[] = []\r\n            if (statusIds.length > 0) {\r\n                statusConditions.push({ projectStatusId: { in: statusIds } })\r\n            }\r\n\r\n            // Handle specific named statuses (legacy)\r\n            const legacyStatusNames = statusNames.filter(s => s !== \"active\" && s !== \"completed\")\r\n            if (legacyStatusNames.length > 0) {\r\n                statusConditions.push({ status: { in: legacyStatusNames }, projectStatusId: null })\r\n            }\r\n\r\n            // Handle \"active\" meta-status (Legacy \"active\" OR Dynamic isActive=true)\r\n            if (statusNames.includes(\"active\")) {\r\n                statusConditions.push({ status: \"active\" })\r\n                statusConditions.push({ projectStatus: { isActive: true } })\r\n            }\r\n\r\n            // Handle \"completed\" meta-status (Legacy \"completed\" OR Dynamic isFinal=true)\r\n            if (statusNames.includes(\"completed\")) {\r\n                statusConditions.push({ status: \"completed\" })\r\n                statusConditions.push({ projectStatus: { isFinal: true } })\r\n            }\r\n\r\n            if (statusConditions.length > 0) {\r\n                where.OR = statusConditions\r\n            }\r\n\r\n            // Priority filter\r\n            if (priority.length > 0) {\r\n                where.priority = { in: priority }\r\n            }\r\n        }\r\n\r\n        // Date range filter\r\n        if (startDate || endDate) {\r\n            const dateConditions: any[] = []\r\n            if (startDate) {\r\n                dateConditions.push({ startDate: { gte: new Date(startDate) } })\r\n            }\r\n            if (endDate) {\r\n                dateConditions.push({ endDate: { lte: new Date(endDate) } })\r\n            }\r\n            if (dateConditions.length > 0) {\r\n                where.AND = [...(where.AND || []), ...dateConditions]\r\n            }\r\n        }\r\n\r\n        // Project Manager filter\r\n        if (projectManager) {\r\n            where.projectManagerId = parseInt(projectManager)\r\n        }\r\n\r\n        // Role-based filtering - Use RBAC instead of hardcoded roles\r\n        const canViewAllProjects = await hasPermissionWithoutRoleBypass(\r\n            parseInt(session.user.id),\r\n            \"project.viewAll\"\r\n        )\r\n\r\n        // If user doesn't have project.viewAll permission, restrict visibility\r\n        if (!canViewAllProjects) {\r\n            // For users without viewAll permission, show only projects they're assigned to\r\n            const userConditions = [\r\n                { projectManagerId: parseInt(session.user.id) },\r\n                { createdById: parseInt(session.user.id) },\r\n            ]\r\n\r\n            if (where.OR) {\r\n                where.AND = [\r\n                    ...(where.AND || []),\r\n                    { OR: [...where.OR, ...userConditions] }\r\n                ]\r\n                delete where.OR\r\n            } else {\r\n                where.OR = userConditions\r\n            }\r\n        }\r\n\r\n        const skip = (page - 1) * limit\r\n\r\n        const [projects, total] = await Promise.all([\r\n            prisma.project.findMany({\r\n                where,\r\n                skip,\r\n                take: limit,\r\n                orderBy: { createdAt: \"desc\" },\r\n                select: {\r\n                    id: true,\r\n                    name: true,\r\n                    description: true,\r\n                    status: true,\r\n                    type: true,\r\n                    projectStatusId: true,\r\n                    projectTypeId: true,\r\n                    projectManagerId: true,\r\n                    startDate: true,\r\n                    endDate: true,\r\n                    createdAt: true,\r\n                    createdById: true,\r\n                    projectManager: {\r\n                        select: {\r\n                            id: true,\r\n                            username: true,\r\n                            email: true,\r\n                            avatarUrl: true,\r\n                        },\r\n                    },\r\n                    _count: {\r\n                        select: {\r\n                            tasks: true,\r\n                            projectUsers: true,\r\n                            notifications: true,\r\n                        },\r\n                    },\r\n                },\r\n            }),\r\n            prisma.project.count({ where }),\r\n        ])\r\n\r\n        return {\r\n            success: true,\r\n            projects,\r\n            total,\r\n            page,\r\n            limit,\r\n        }\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching projects with filters:\", error)\r\n        return {\r\n            error: error.message || \"Failed to fetch projects\",\r\n        }\r\n    }\r\n}\r\n\r\nexport async function createProject(formData: FormData) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    // Check permission using RBAC (no role-based bypass)\r\n    const hasPermission = await hasPermissionWithoutRoleBypass(\r\n        parseInt(session.user.id),\r\n        PERMISSIONS.PROJECT.CREATE\r\n    )\r\n\r\n    if (!hasPermission) {\r\n        return { error: \"Permission denied: You don't have permission to create projects\" }\r\n    }\r\n\r\n    const name = formData.get(\"name\") as string\r\n    const type = formData.get(\"type\") as string\r\n    const projectTypeId = formData.get(\"projectTypeId\")\r\n    const description = formData.get(\"description\") as string\r\n    const scope = formData.get(\"scope\") as string\r\n    const startDate = formData.get(\"startDate\") as string\r\n    const endDate = formData.get(\"endDate\") as string\r\n    const projectManagerId = formData.get(\"projectManagerId\")\r\n\r\n    // If projectTypeId is provided, get the type name from the ProjectType\r\n    let typeName = type || \"\"\r\n    if (projectTypeId) {\r\n        try {\r\n            const projectType = await prisma.projectType.findUnique({\r\n                where: { id: parseInt(projectTypeId as string) },\r\n                select: { name: true }\r\n            })\r\n            if (projectType) {\r\n                typeName = projectType.name\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error fetching project type:\", error)\r\n        }\r\n    }\r\n\r\n    const validated = projectSchema.safeParse({\r\n        name,\r\n        type: typeName || undefined,\r\n        projectTypeId: projectTypeId ? parseInt(projectTypeId as string) : null,\r\n        description,\r\n        scope,\r\n        startDate,\r\n        endDate,\r\n        projectManagerId\r\n    })\r\n\r\n    if (!validated.success) {\r\n        console.error(validated.error)\r\n        return { error: \"Validation failed\", details: validated.error.format() }\r\n    }\r\n\r\n    try {\r\n        const project = await prisma.project.create({\r\n            data: {\r\n                name: validated.data.name,\r\n                type: validated.data.type || \"\",\r\n                projectTypeId: validated.data.projectTypeId,\r\n                description: validated.data.description,\r\n                scope: validated.data.scope,\r\n                status: validated.data.status,\r\n                startDate: validated.data.startDate ? new Date(validated.data.startDate) : null,\r\n                endDate: validated.data.endDate ? new Date(validated.data.endDate) : null,\r\n                projectManagerId: (validated.data.projectManagerId && validated.data.projectManagerId > 0) ? validated.data.projectManagerId : null,\r\n                createdById: parseInt(session.user.id),\r\n            }\r\n        })\r\n\r\n        // Log activity\r\n        try {\r\n            await logActivity({\r\n                actionType: \"project_created\",\r\n                actionCategory: \"project\",\r\n                actionSummary: `Project \"${project.name}\" created`,\r\n                actionDetails: {\r\n                    projectId: project.id,\r\n                    projectName: project.name,\r\n                    projectType: project.type,\r\n                    status: project.status,\r\n                },\r\n                performedById: parseInt(session.user.id),\r\n                projectId: project.id,\r\n                entityType: \"project\",\r\n                entityId: project.id,\r\n            })\r\n            console.log(\"[Project Creation] Activity logging completed\")\r\n        } catch (logError) {\r\n            console.error(\"[Project Creation] Failed to log activity:\", logError)\r\n            // Don't fail the project creation if logging fails\r\n        }\r\n\r\n        revalidatePath(\"/dashboard/projects\")\r\n        revalidatePath(\"/dashboard\")\r\n        return { success: true }\r\n    } catch (e) {\r\n        console.error(e)\r\n        return { error: \"Failed to create project\" }\r\n    }\r\n}\r\n\r\nexport async function getProject(id: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) throw new Error(\"Unauthorized\")\r\n\r\n    // ✅ OPTIMIZED: Separate queries for different data needs\r\n    // Fetch project details, tasks, and team in parallel instead of nested includes\r\n    const [project, tasks, teams] = await Promise.all([\r\n        // Query 1: Project with basic relationships\r\n        prisma.project.findUnique({\r\n            where: { id },\r\n            select: {\r\n                id: true,\r\n                name: true,\r\n                description: true,\r\n                status: true,\r\n                type: true,\r\n                priority: true,\r\n                projectStatusId: true,\r\n                projectTypeId: true,\r\n                projectManagerId: true,\r\n                startDate: true,\r\n                endDate: true,\r\n                createdAt: true,\r\n                createdById: true,\r\n                // isUrgent: true, // Removed as it doesn't exist on Project model\r\n                urgentMarkedAt: true,\r\n                urgentMarkedById: true,\r\n                projectType: {\r\n                    select: { id: true, name: true }\r\n                },\r\n                projectStatus: {\r\n                    select: { id: true, name: true }\r\n                },\r\n                projectManager: {\r\n                    select: {\r\n                        id: true,\r\n                        username: true,\r\n                        email: true,\r\n                        avatarUrl: true\r\n                    }\r\n                },\r\n                urgentMarkedBy: {\r\n                    select: {\r\n                        id: true,\r\n                        username: true\r\n                    }\r\n                },\r\n                _count: {\r\n                    select: {\r\n                        tasks: true,\r\n                        projectUsers: true,\r\n                        projectTeams: true\r\n                    }\r\n                }\r\n            }\r\n        }),\r\n\r\n        // Query 2: Tasks with minimal dependencies\r\n        prisma.task.findMany({\r\n            where: { projectId: id },\r\n            orderBy: { createdAt: \"desc\" },\r\n            select: {\r\n                id: true,\r\n                title: true,\r\n                description: true,\r\n                status: true,\r\n                taskStatusId: true,\r\n                priority: true,\r\n                dueDate: true,\r\n                createdAt: true,\r\n                assignees: {\r\n                    select: {\r\n                        id: true,\r\n                        username: true,\r\n                        email: true,\r\n                        avatarUrl: true\r\n                    }\r\n                },\r\n                attachments: {\r\n                    select: {\r\n                        id: true,\r\n                        fileName: true,\r\n                        fileUrl: true,\r\n                        fileType: true,\r\n                        fileSize: true\r\n                    }\r\n                },\r\n                dependencies: {\r\n                    select: {\r\n                        // id: true, // Removed as TaskDependency has composite key\r\n                        dependencyType: true,\r\n                        dependsOnTaskId: true,\r\n                        dependsOnTask: {\r\n                            select: {\r\n                                id: true,\r\n                                title: true,\r\n                                status: true,\r\n                                taskStatusId: true\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }),\r\n\r\n        // Query 3: Project teams with members\r\n        prisma.projectTeam.findMany({\r\n            where: { projectId: id },\r\n            select: {\r\n                id: true,\r\n                teamId: true,\r\n                team: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                        description: true,\r\n                        teamLead: {\r\n                            select: {\r\n                                id: true,\r\n                                username: true,\r\n                                email: true,\r\n                                avatarUrl: true\r\n                            }\r\n                        },\r\n                        members: {\r\n                            select: {\r\n                                id: true,\r\n                                userId: true,\r\n                                user: {\r\n                                    select: {\r\n                                        id: true,\r\n                                        username: true,\r\n                                        email: true,\r\n                                        avatarUrl: true\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        })\r\n    ])\r\n\r\n    // Combine results\r\n    if (project) {\r\n        return {\r\n            ...project,\r\n            tasks,\r\n            projectTeams: teams\r\n        }\r\n    }\r\n\r\n    return null\r\n}\r\n\r\nexport async function updateProject(id: number, formData: FormData) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    // Verify project exists and user has permission\r\n    const existingProject = await prisma.project.findUnique({\r\n        where: { id },\r\n        select: { id: true, createdById: true }\r\n    })\r\n\r\n    if (!existingProject) {\r\n        return { error: \"Project not found\" }\r\n    }\r\n\r\n    // Check permission using RBAC (no role-based bypass)\r\n    const hasPermission = await hasPermissionWithoutRoleBypass(\r\n        parseInt(session.user.id),\r\n        PERMISSIONS.PROJECT.UPDATE,\r\n        id // projectId for project-scoped permissions\r\n    )\r\n\r\n    // Also allow creator to update their own projects\r\n    const isCreator = existingProject.createdById === parseInt(session.user.id)\r\n\r\n    if (!hasPermission && !isCreator) {\r\n        return { error: \"Permission denied: You don't have permission to update this project\" }\r\n    }\r\n\r\n    const name = formData.get(\"name\") as string\r\n    const type = formData.get(\"type\") as string\r\n    const projectTypeId = formData.get(\"projectTypeId\")\r\n    const projectStatusId = formData.get(\"projectStatusId\")\r\n    const description = formData.get(\"description\") as string\r\n    const scope = formData.get(\"scope\") as string\r\n    const status = formData.get(\"status\") as string\r\n    const startDate = formData.get(\"startDate\") as string\r\n    const endDate = formData.get(\"endDate\") as string\r\n    const projectManagerId = formData.get(\"projectManagerId\")\r\n\r\n    // If projectTypeId is provided, get the type name from the ProjectType\r\n    let typeName = type || \"\"\r\n    if (projectTypeId) {\r\n        try {\r\n            const projectType = await prisma.projectType.findUnique({\r\n                where: { id: parseInt(projectTypeId as string) },\r\n                select: { name: true }\r\n            })\r\n            if (projectType) {\r\n                typeName = projectType.name\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error fetching project type:\", error)\r\n        }\r\n    }\r\n\r\n    // If projectStatusId is provided, get the status name from the ProjectStatus\r\n    let statusName = status || \"\"\r\n    if (projectStatusId && prisma.projectStatus) {\r\n        try {\r\n            const projectStatus = await prisma.projectStatus.findUnique({\r\n                where: { id: parseInt(projectStatusId as string) },\r\n                select: { name: true }\r\n            })\r\n            if (projectStatus) {\r\n                statusName = projectStatus.name\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error fetching project status:\", error)\r\n        }\r\n    }\r\n\r\n    const validated = projectSchema.safeParse({\r\n        name,\r\n        type: typeName || undefined,\r\n        projectTypeId: projectTypeId ? parseInt(projectTypeId as string) : null,\r\n        projectStatusId: projectStatusId ? parseInt(projectStatusId as string) : null,\r\n        description,\r\n        scope,\r\n        status: statusName || undefined,\r\n        startDate,\r\n        endDate,\r\n        projectManagerId\r\n    })\r\n\r\n    if (!validated.success) {\r\n        console.error(validated.error)\r\n        return { error: \"Validation failed\", details: validated.error.format() }\r\n    }\r\n\r\n    try {\r\n        await prisma.project.update({\r\n            where: { id },\r\n            data: {\r\n                name: validated.data.name,\r\n                type: validated.data.type || \"\",\r\n                projectTypeId: validated.data.projectTypeId,\r\n                projectStatusId: validated.data.projectStatusId,\r\n                description: validated.data.description,\r\n                scope: validated.data.scope,\r\n                status: statusName || validated.data.status || \"\",\r\n                startDate: validated.data.startDate ? new Date(validated.data.startDate) : null,\r\n                endDate: validated.data.endDate ? new Date(validated.data.endDate) : null,\r\n                projectManagerId: (validated.data.projectManagerId && validated.data.projectManagerId > 0) ? validated.data.projectManagerId : null,\r\n            }\r\n        })\r\n        revalidatePath(\"/dashboard/projects\")\r\n        revalidatePath(`/dashboard/projects/${id}`)\r\n        revalidatePath(\"/dashboard\")\r\n        return { success: true }\r\n    } catch (e: any) {\r\n        console.error(e)\r\n        return { error: \"Failed to update project\", details: e.message }\r\n    }\r\n}\r\n\r\nexport async function deleteProject(id: number) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    // Verify project exists and user has permission\r\n    const project = await prisma.project.findUnique({\r\n        where: { id },\r\n        select: { id: true, createdById: true, name: true }\r\n    })\r\n\r\n    if (!project) {\r\n        return { error: \"Project not found\" }\r\n    }\r\n\r\n    // Check permission using RBAC (no role-based bypass)\r\n    const hasPermission = await hasPermissionWithoutRoleBypass(\r\n        parseInt(session.user.id),\r\n        PERMISSIONS.PROJECT.DELETE,\r\n        id // projectId for project-scoped permissions\r\n    )\r\n\r\n    // Also allow creator to delete their own projects\r\n    const isCreator = project.createdById === parseInt(session.user.id)\r\n\r\n    if (!hasPermission && !isCreator) {\r\n        return { error: \"Permission denied: You don't have permission to delete this project\" }\r\n    }\r\n\r\n    // Get task count for logging/notification purposes\r\n    const taskCount = await prisma.task.count({\r\n        where: { projectId: id }\r\n    })\r\n\r\n    try {\r\n        // Delete project - tasks will be automatically deleted due to cascade delete\r\n        await prisma.project.delete({\r\n            where: { id }\r\n        })\r\n\r\n        console.log(`Project ${id} deleted successfully${taskCount > 0 ? ` along with ${taskCount} task(s)` : \"\"}`)\r\n        revalidatePath(\"/dashboard/projects\")\r\n        revalidatePath(\"/dashboard\")\r\n        return { success: true }\r\n    } catch (e: any) {\r\n        console.error(e)\r\n        return { error: \"Failed to delete project\", details: e.message }\r\n    }\r\n}\r\n","/**\n * @module constants\n * @summary Useful constants\n * @description\n * Collection of useful date constants.\n *\n * The constants could be imported from `date-fns/constants`:\n *\n * ```ts\n * import { maxTime, minTime } from \"./constants/date-fns/constants\";\n *\n * function isAllowedTime(time) {\n *   return time <= maxTime && time >= minTime;\n * }\n * ```\n */\n\n/**\n * @constant\n * @name daysInWeek\n * @summary Days in 1 week.\n */\nexport const daysInWeek = 7;\n\n/**\n * @constant\n * @name daysInYear\n * @summary Days in 1 year.\n *\n * @description\n * How many days in a year.\n *\n * One years equals 365.2425 days according to the formula:\n *\n * > Leap year occurs every 4 years, except for years that are divisible by 100 and not divisible by 400.\n * > 1 mean year = (365+1/4-1/100+1/400) days = 365.2425 days\n */\nexport const daysInYear = 365.2425;\n\n/**\n * @constant\n * @name maxTime\n * @summary Maximum allowed time.\n *\n * @example\n * import { maxTime } from \"./constants/date-fns/constants\";\n *\n * const isValid = 8640000000000001 <= maxTime;\n * //=> false\n *\n * new Date(8640000000000001);\n * //=> Invalid Date\n */\nexport const maxTime = Math.pow(10, 8) * 24 * 60 * 60 * 1000;\n\n/**\n * @constant\n * @name minTime\n * @summary Minimum allowed time.\n *\n * @example\n * import { minTime } from \"./constants/date-fns/constants\";\n *\n * const isValid = -8640000000000001 >= minTime;\n * //=> false\n *\n * new Date(-8640000000000001)\n * //=> Invalid Date\n */\nexport const minTime = -maxTime;\n\n/**\n * @constant\n * @name millisecondsInWeek\n * @summary Milliseconds in 1 week.\n */\nexport const millisecondsInWeek = 604800000;\n\n/**\n * @constant\n * @name millisecondsInDay\n * @summary Milliseconds in 1 day.\n */\nexport const millisecondsInDay = 86400000;\n\n/**\n * @constant\n * @name millisecondsInMinute\n * @summary Milliseconds in 1 minute\n */\nexport const millisecondsInMinute = 60000;\n\n/**\n * @constant\n * @name millisecondsInHour\n * @summary Milliseconds in 1 hour\n */\nexport const millisecondsInHour = 3600000;\n\n/**\n * @constant\n * @name millisecondsInSecond\n * @summary Milliseconds in 1 second\n */\nexport const millisecondsInSecond = 1000;\n\n/**\n * @constant\n * @name minutesInYear\n * @summary Minutes in 1 year.\n */\nexport const minutesInYear = 525600;\n\n/**\n * @constant\n * @name minutesInMonth\n * @summary Minutes in 1 month.\n */\nexport const minutesInMonth = 43200;\n\n/**\n * @constant\n * @name minutesInDay\n * @summary Minutes in 1 day.\n */\nexport const minutesInDay = 1440;\n\n/**\n * @constant\n * @name minutesInHour\n * @summary Minutes in 1 hour.\n */\nexport const minutesInHour = 60;\n\n/**\n * @constant\n * @name monthsInQuarter\n * @summary Months in 1 quarter.\n */\nexport const monthsInQuarter = 3;\n\n/**\n * @constant\n * @name monthsInYear\n * @summary Months in 1 year.\n */\nexport const monthsInYear = 12;\n\n/**\n * @constant\n * @name quartersInYear\n * @summary Quarters in 1 year\n */\nexport const quartersInYear = 4;\n\n/**\n * @constant\n * @name secondsInHour\n * @summary Seconds in 1 hour.\n */\nexport const secondsInHour = 3600;\n\n/**\n * @constant\n * @name secondsInMinute\n * @summary Seconds in 1 minute.\n */\nexport const secondsInMinute = 60;\n\n/**\n * @constant\n * @name secondsInDay\n * @summary Seconds in 1 day.\n */\nexport const secondsInDay = secondsInHour * 24;\n\n/**\n * @constant\n * @name secondsInWeek\n * @summary Seconds in 1 week.\n */\nexport const secondsInWeek = secondsInDay * 7;\n\n/**\n * @constant\n * @name secondsInYear\n * @summary Seconds in 1 year.\n */\nexport const secondsInYear = secondsInDay * daysInYear;\n\n/**\n * @constant\n * @name secondsInMonth\n * @summary Seconds in 1 month\n */\nexport const secondsInMonth = secondsInYear / 12;\n\n/**\n * @constant\n * @name secondsInQuarter\n * @summary Seconds in 1 quarter.\n */\nexport const secondsInQuarter = secondsInMonth * 3;\n\n/**\n * @constant\n * @name constructFromSymbol\n * @summary Symbol enabling Date extensions to inherit properties from the reference date.\n *\n * The symbol is used to enable the `constructFrom` function to construct a date\n * using a reference date and a value. It allows to transfer extra properties\n * from the reference date to the new date. It's useful for extensions like\n * [`TZDate`](https://github.com/date-fns/tz) that accept a time zone as\n * a constructor argument.\n */\nexport const constructFromSymbol = Symbol.for(\"constructDateFrom\");\n","import { constructFromSymbol } from \"./constants.js\";\n\n/**\n * @name constructFrom\n * @category Generic Helpers\n * @summary Constructs a date using the reference date and the value\n *\n * @description\n * The function constructs a new date using the constructor from the reference\n * date and the given value. It helps to build generic functions that accept\n * date extensions.\n *\n * It defaults to `Date` if the passed reference date is a number or a string.\n *\n * Starting from v3.7.0, it allows to construct a date using `[Symbol.for(\"constructDateFrom\")]`\n * enabling to transfer extra properties from the reference date to the new date.\n * It's useful for extensions like [`TZDate`](https://github.com/date-fns/tz)\n * that accept a time zone as a constructor argument.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n *\n * @param date - The reference date to take constructor from\n * @param value - The value to create the date\n *\n * @returns Date initialized using the given date and value\n *\n * @example\n * import { constructFrom } from \"./constructFrom/date-fns\";\n *\n * // A function that clones a date preserving the original type\n * function cloneDate<DateType extends Date>(date: DateType): DateType {\n *   return constructFrom(\n *     date, // Use constructor from the given date\n *     date.getTime() // Use the date value to create a new date\n *   );\n * }\n */\nexport function constructFrom(date, value) {\n  if (typeof date === \"function\") return date(value);\n\n  if (date && typeof date === \"object\" && constructFromSymbol in date)\n    return date[constructFromSymbol](value);\n\n  if (date instanceof Date) return new date.constructor(value);\n\n  return new Date(value);\n}\n\n// Fallback for modularized imports:\nexport default constructFrom;\n","import { constructFrom } from \"./constructFrom.js\";\n\n/**\n * @name toDate\n * @category Common Helpers\n * @summary Convert the given argument to an instance of Date.\n *\n * @description\n * Convert the given argument to an instance of Date.\n *\n * If the argument is an instance of Date, the function returns its clone.\n *\n * If the argument is a number, it is treated as a timestamp.\n *\n * If the argument is none of the above, the function returns Invalid Date.\n *\n * Starting from v3.7.0, it clones a date using `[Symbol.for(\"constructDateFrom\")]`\n * enabling to transfer extra properties from the reference date to the new date.\n * It's useful for extensions like [`TZDate`](https://github.com/date-fns/tz)\n * that accept a time zone as a constructor argument.\n *\n * **Note**: *all* Date arguments passed to any *date-fns* function is processed by `toDate`.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param argument - The value to convert\n *\n * @returns The parsed date in the local time zone\n *\n * @example\n * // Clone the date:\n * const result = toDate(new Date(2014, 1, 11, 11, 30, 30))\n * //=> Tue Feb 11 2014 11:30:30\n *\n * @example\n * // Convert the timestamp to date:\n * const result = toDate(1392098430000)\n * //=> Tue Feb 11 2014 11:30:30\n */\nexport function toDate(argument, context) {\n  // [TODO] Get rid of `toDate` or `constructFrom`?\n  return constructFrom(context || argument, argument);\n}\n\n// Fallback for modularized imports:\nexport default toDate;\n","import { toDate } from \"./toDate.js\";\n\n/**\n * The {@link startOfDay} function options.\n */\n\n/**\n * @name startOfDay\n * @category Day Helpers\n * @summary Return the start of a day for the given date.\n *\n * @description\n * Return the start of a day for the given date.\n * The result will be in the local timezone.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The original date\n * @param options - The options\n *\n * @returns The start of a day\n *\n * @example\n * // The start of a day for 2 September 2014 11:55:00:\n * const result = startOfDay(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Tue Sep 02 2014 00:00:00\n */\nexport function startOfDay(date, options) {\n  const _date = toDate(date, options?.in);\n  _date.setHours(0, 0, 0, 0);\n  return _date;\n}\n\n// Fallback for modularized imports:\nexport default startOfDay;\n","import { toDate } from \"./toDate.js\";\n\n/**\n * The {@link endOfDay} function options.\n */\n\n/**\n * @name endOfDay\n * @category Day Helpers\n * @summary Return the end of a day for the given date.\n *\n * @description\n * Return the end of a day for the given date.\n * The result will be in the local timezone.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The original date\n * @param options - An object with options\n *\n * @returns The end of a day\n *\n * @example\n * // The end of a day for 2 September 2014 11:55:00:\n * const result = endOfDay(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Tue Sep 02 2014 23:59:59.999\n */\nexport function endOfDay(date, options) {\n  const _date = toDate(date, options?.in);\n  _date.setHours(23, 59, 59, 999);\n  return _date;\n}\n\n// Fallback for modularized imports:\nexport default endOfDay;\n","import { constructFrom } from \"./constructFrom.js\";\nimport { toDate } from \"./toDate.js\";\n\n/**\n * The {@link addDays} function options.\n */\n\n/**\n * @name addDays\n * @category Day Helpers\n * @summary Add the specified number of days to the given date.\n *\n * @description\n * Add the specified number of days to the given date.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The date to be changed\n * @param amount - The amount of days to be added.\n * @param options - An object with options\n *\n * @returns The new date with the days added\n *\n * @example\n * // Add 10 days to 1 September 2014:\n * const result = addDays(new Date(2014, 8, 1), 10)\n * //=> Thu Sep 11 2014 00:00:00\n */\nexport function addDays(date, amount, options) {\n  const _date = toDate(date, options?.in);\n  if (isNaN(amount)) return constructFrom(options?.in || date, NaN);\n\n  // If 0 days, no-op to avoid changing times in the hour before end of DST\n  if (!amount) return _date;\n\n  _date.setDate(_date.getDate() + amount);\n  return _date;\n}\n\n// Fallback for modularized imports:\nexport default addDays;\n","import { addDays } from \"./addDays.js\";\n\n/**\n * The {@link subDays} function options.\n */\n\n/**\n * @name subDays\n * @category Day Helpers\n * @summary Subtract the specified number of days from the given date.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The date to be changed\n * @param amount - The amount of days to be subtracted.\n * @param options - An object with options\n *\n * @returns The new date with the days subtracted\n *\n * @example\n * // Subtract 10 days from 1 September 2014:\n * const result = subDays(new Date(2014, 8, 1), 10)\n * //=> Fri Aug 22 2014 00:00:00\n */\nexport function subDays(date, amount, options) {\n  return addDays(date, -amount, options);\n}\n\n// Fallback for modularized imports:\nexport default subDays;\n","import { toDate } from \"./toDate.js\";\n\n/**\n * The {@link endOfMonth} function options.\n */\n\n/**\n * @name endOfMonth\n * @category Month Helpers\n * @summary Return the end of a month for the given date.\n *\n * @description\n * Return the end of a month for the given date.\n * The result will be in the local timezone.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The original date\n * @param options - An object with options\n *\n * @returns The end of a month\n *\n * @example\n * // The end of a month for 2 September 2014 11:55:00:\n * const result = endOfMonth(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Tue Sep 30 2014 23:59:59.999\n */\nexport function endOfMonth(date, options) {\n  const _date = toDate(date, options?.in);\n  const month = _date.getMonth();\n  _date.setFullYear(_date.getFullYear(), month + 1, 0);\n  _date.setHours(23, 59, 59, 999);\n  return _date;\n}\n\n// Fallback for modularized imports:\nexport default endOfMonth;\n","\"use server\"\r\n\r\nimport { prisma as db } from \"@/lib/prisma\"\r\nimport { getServerSession } from \"next-auth\"\r\nimport { authOptions } from \"@/lib/auth\"\r\nimport { addDays, subDays, differenceInDays } from \"date-fns\"\r\n\r\n// --- Types ---\r\n\r\nexport type EntityType = 'project' | 'team' | 'user' | 'global'\r\n\r\nexport interface Period {\r\n    start: Date\r\n    end: Date\r\n}\r\n\r\nexport interface ReportParams {\r\n    entityType: EntityType\r\n    entityId?: number\r\n    periodA: Period\r\n}\r\n\r\nexport interface KpiData {\r\n    value: number\r\n    unit: string\r\n    trend: 'up' | 'down' | 'neutral'\r\n    delta: number\r\n    percentChange: number | null\r\n}\r\n\r\nexport interface CauseIndicator {\r\n    name: string\r\n    description: string\r\n    severity: 'low' | 'medium' | 'high'\r\n    impactedKpis: string[]\r\n    count: number\r\n}\r\n\r\nexport type RiskLevel = 'low' | 'medium' | 'high'\r\n\r\nexport interface ForecastData {\r\n    predictedCompletionDate: Date | null\r\n    weeksRemaining: number | null\r\n    riskLevel: RiskLevel\r\n    confidenceScore: number\r\n    riskFactors: string[]\r\n}\r\n\r\nexport interface Recommendation {\r\n    title: string\r\n    description: string\r\n    actionType: 'reassign' | 'resolve_dep' | 'reduce_wip' | 'escalate' | 'generic'\r\n    confidence: 'low' | 'medium' | 'high'\r\n    priority: 'normal' | 'high' | 'urgent'\r\n}\r\n\r\nexport interface ProgressReportData {\r\n    summary: {\r\n        velocity: KpiData\r\n        completionRate: KpiData\r\n        blockedRatio: KpiData\r\n        overdueTasks: KpiData\r\n        overallRisk: RiskLevel\r\n    }\r\n    causes: CauseIndicator[]\r\n    forecast: ForecastData\r\n    actions: Recommendation[]\r\n}\r\n\r\n// --- Main Action ---\r\n\r\nexport async function getProgressReport(params: ReportParams): Promise<ProgressReportData | { error: string }> {\r\n    try {\r\n        const session = await getServerSession(authOptions)\r\n        if (!session || !session.user || !session.user.id) {\r\n            return { error: \"Unauthorized\" }\r\n        }\r\n        const userId = parseInt(session.user.id)\r\n        const userRole = session.user.role\r\n\r\n        // 1. Auth & Permission Check\r\n        if (params.entityType === 'project') {\r\n            if (!params.entityId) return { error: \"Project ID required\" }\r\n\r\n            const project = await db.project.findUnique({\r\n                where: { id: params.entityId },\r\n                select: { projectManagerId: true }\r\n            })\r\n\r\n            if (!project) return { error: \"Project not found\" }\r\n\r\n            const isPm = project.projectManagerId === userId\r\n            const isAdmin = userRole === 'admin' || userRole === 'system_admin'\r\n\r\n            if (!isPm && !isAdmin) {\r\n                // Check membership\r\n                const member = await db.projectUser.findFirst({\r\n                    where: { projectId: params.entityId, userId: userId }\r\n                })\r\n                if (!member) {\r\n                    return { error: \"Forbidden: You do not have access to this project\" }\r\n                }\r\n            }\r\n        }\r\n\r\n        // 2. Period Calculation\r\n        const { periodA } = params\r\n        // Ensure we have Date objects (Server Actions serialization handling)\r\n        const startA = new Date(periodA.start)\r\n        const endA = new Date(periodA.end)\r\n\r\n        const durationDays = differenceInDays(endA, startA) + 1\r\n        const periodB: Period = {\r\n            start: subDays(startA, durationDays),\r\n            end: subDays(startA, 1)\r\n        }\r\n\r\n        // 3. Data Fetching\r\n        const whereClause: any = {}\r\n        if (params.entityType === 'project') whereClause.projectId = params.entityId\r\n        if (params.entityType === 'team') whereClause.teamId = params.entityId\r\n        if (params.entityType === 'user') whereClause.assignees = { some: { id: params.entityId } }\r\n\r\n        const fetchTasks = async (period: Period) => {\r\n            return db.task.findMany({\r\n                where: {\r\n                    ...whereClause,\r\n                    createdAt: { lte: period.end }\r\n                },\r\n                include: {\r\n                    dependencies: { include: { dependsOnTask: true } },\r\n                    assignees: true\r\n                }\r\n            })\r\n        }\r\n\r\n        const [tasksA, tasksB] = await Promise.all([\r\n            fetchTasks({ start: startA, end: endA }),\r\n            fetchTasks(periodB)\r\n        ])\r\n\r\n        // 4. KPI Calculation Helper\r\n         \r\n        const calculateMetrics = (tasks: typeof tasksA, period: Period) => {\r\n            // Velocity: Sum of estimatedHours for tasks completed within the period\r\n            const completedInPeriod = tasks.filter(t =>\r\n                t.status === 'completed' &&\r\n                t.completedAt &&\r\n                t.completedAt >= period.start &&\r\n                t.completedAt <= period.end\r\n            )\r\n            const velocity = completedInPeriod.reduce((sum, t) => sum + t.estimatedHours, 0)\r\n\r\n            // Completion Rate: Tasks scheduled (due) in period vs completed\r\n            const scheduledInPeriod = tasks.filter(t =>\r\n                t.dueDate &&\r\n                t.dueDate >= period.start &&\r\n                t.dueDate <= period.end\r\n            )\r\n            const scheduledCount = scheduledInPeriod.length\r\n\r\n            // Count how many of those scheduled were actually completed (at any time? or within period? Plan says \"Efficiency of closing tasks within period\")\r\n            // Logic: (Tasks Completed in Period / Tasks Scheduled for Period)\r\n            const completionRate = scheduledCount > 0 ? (completedInPeriod.length / scheduledCount) * 100 : 0\r\n\r\n            // Blocked Ratio: Active tasks with unmet dependencies\r\n            const activeTasks = tasks.filter(t => t.status !== 'completed' && t.status !== 'cancelled')\r\n            const blockedTasks = activeTasks.filter(t => {\r\n                return t.dependencies.some(d => d.dependsOnTask && d.dependsOnTask.status !== 'completed')\r\n            })\r\n            const blockedRatio = activeTasks.length > 0 ? (blockedTasks.length / activeTasks.length) * 100 : 0\r\n\r\n            // Overdue Count (At end of period snapshot approximation)\r\n            const overdueCount = tasks.filter(t =>\r\n                t.dueDate &&\r\n                t.dueDate < period.end &&\r\n                (!t.completedAt || t.completedAt > period.end)\r\n            ).length\r\n\r\n            return { velocity, completionRate, blockedRatio, overdueCount, activeTasks }\r\n        }\r\n\r\n        const metricsA = calculateMetrics(tasksA, { start: startA, end: endA })\r\n        const metricsB = calculateMetrics(tasksB, periodB)\r\n\r\n        // 5. Comparison Helper\r\n        const compare = (valA: number, valB: number, unit: string): KpiData => {\r\n            const delta = valA - valB\r\n            let percentChange = 0\r\n            if (valB !== 0) {\r\n                percentChange = Math.round(((valA - valB) / Math.abs(valB)) * 100)\r\n            } else if (valA !== 0) {\r\n                percentChange = 100\r\n            }\r\n\r\n            let trend: 'up' | 'down' | 'neutral' = 'neutral'\r\n            if (delta > 0.1) trend = 'up'\r\n            if (delta < -0.1) trend = 'down'\r\n\r\n            return {\r\n                value: Math.round(valA * 10) / 10,\r\n                unit,\r\n                trend,\r\n                delta: Math.round(delta * 10) / 10,\r\n                percentChange\r\n            }\r\n        }\r\n\r\n        // 6. Cause Analysis\r\n        const causes: CauseIndicator[] = []\r\n\r\n        // Dependency Delay\r\n        const delayCount = tasksA.filter(t => {\r\n            return t.dependencies.some(d => {\r\n                const dep = d.dependsOnTask\r\n                return dep && dep.completedAt && t.plannedDate && dep.completedAt > t.plannedDate\r\n            })\r\n        }).length\r\n\r\n        if (delayCount > 0) {\r\n            causes.push({\r\n                name: \"Dependency Delay\",\r\n                description: `${delayCount} tasks were delayed by upstream dependencies.`,\r\n                severity: delayCount > 3 ? 'high' : 'medium',\r\n                impactedKpis: ['velocity', 'blockedRatio'],\r\n                count: delayCount\r\n            })\r\n        }\r\n\r\n        // Urgent Load\r\n        // Count tasks with priority 'urgent' created in period A\r\n        const urgentTasks = tasksA.filter(t =>\r\n            t.priority === 'urgent' &&\r\n            t.createdAt >= periodA.start &&\r\n            t.createdAt <= periodA.end\r\n        )\r\n        if (urgentTasks.length > 0) {\r\n            causes.push({\r\n                name: \"Urgent Task Load\",\r\n                description: `${urgentTasks.length} urgent tasks disrupted the flow.`,\r\n                severity: urgentTasks.length > 2 ? 'high' : 'medium',\r\n                impactedKpis: ['velocity', 'completionRate'],\r\n                count: urgentTasks.length\r\n            })\r\n        }\r\n\r\n\r\n        // 7. Forecast\r\n        const activeTasksCount = metricsA.activeTasks.length\r\n        const remainingHours = metricsA.activeTasks.reduce((sum, t) => sum + t.estimatedHours, 0)\r\n        const avgVelocity = (metricsA.velocity + metricsB.velocity) / 2\r\n\r\n        let weeksRemaining = null\r\n        let predictedDate = null\r\n        const riskFactors: string[] = []\r\n        let riskScore = 0\r\n\r\n        if (remainingHours > 0) {\r\n            if (avgVelocity > 0) {\r\n                weeksRemaining = remainingHours / avgVelocity\r\n                predictedDate = addDays(new Date(), Math.ceil(weeksRemaining * 7))\r\n            } else {\r\n                riskFactors.push(\"Zero velocity - cannot predict completion\")\r\n                riskScore += 5\r\n            }\r\n        }\r\n\r\n        if (metricsA.blockedRatio > 10) {\r\n            riskFactors.push(\"High blocked ratio (>10%)\")\r\n            riskScore += 3\r\n        }\r\n        if (metricsA.overdueCount > metricsB.overdueCount) {\r\n            riskFactors.push(\"Growing overdue backlog\")\r\n            riskScore += 2\r\n        }\r\n\r\n        let riskLevel: RiskLevel = 'low'\r\n        if (riskScore >= 3) riskLevel = 'medium'\r\n        if (riskScore >= 6) riskLevel = 'high'\r\n\r\n\r\n        const finalSummary = {\r\n            velocity: compare(metricsA.velocity, metricsB.velocity, 'hrs'),\r\n            completionRate: compare(metricsA.completionRate, metricsB.completionRate, '%'),\r\n            blockedRatio: compare(metricsA.blockedRatio, metricsB.blockedRatio, '%'),\r\n            overdueTasks: compare(metricsA.overdueCount, metricsB.overdueCount, 'tasks'),\r\n            overallRisk: riskLevel\r\n        }\r\n\r\n        return {\r\n            summary: finalSummary,\r\n            causes,\r\n            forecast: {\r\n                predictedCompletionDate: predictedDate,\r\n                weeksRemaining: weeksRemaining ? Math.round(weeksRemaining * 10) / 10 : null,\r\n                riskLevel,\r\n                confidenceScore: avgVelocity > 0 ? 80 : 0,\r\n                riskFactors\r\n            },\r\n            actions: [] // TODO: Recommendations in next iteration if needed\r\n        }\r\n\r\n    } catch (error: any) {\r\n        console.error(\"Error generating progress report:\", error)\r\n        return { error: error.message || \"Failed to generate report\" }\r\n    }\r\n}\r\n","import { normalizeDates } from \"./_lib/normalizeDates.js\";\nimport { differenceInCalendarDays } from \"./differenceInCalendarDays.js\";\n\n/**\n * The {@link differenceInDays} function options.\n */\n\n/**\n * @name differenceInDays\n * @category Day Helpers\n * @summary Get the number of full days between the given dates.\n *\n * @description\n * Get the number of full day periods between two dates. Fractional days are\n * truncated towards zero.\n *\n * One \"full day\" is the distance between a local time in one day to the same\n * local time on the next or previous day. A full day can sometimes be less than\n * or more than 24 hours if a daylight savings change happens between two dates.\n *\n * To ignore DST and only measure exact 24-hour periods, use this instead:\n * `Math.trunc(differenceInHours(dateLeft, dateRight)/24)|0`.\n *\n * @param laterDate - The later date\n * @param earlierDate - The earlier date\n * @param options - An object with options\n *\n * @returns The number of full days according to the local timezone\n *\n * @example\n * // How many full days are between\n * // 2 July 2011 23:00:00 and 2 July 2012 00:00:00?\n * const result = differenceInDays(\n *   new Date(2012, 6, 2, 0, 0),\n *   new Date(2011, 6, 2, 23, 0)\n * )\n * //=> 365\n *\n * @example\n * // How many full days are between\n * // 2 July 2011 23:59:00 and 3 July 2011 00:01:00?\n * const result = differenceInDays(\n *   new Date(2011, 6, 3, 0, 1),\n *   new Date(2011, 6, 2, 23, 59)\n * )\n * //=> 0\n *\n * @example\n * // How many full days are between\n * // 1 March 2020 0:00 and 1 June 2020 0:00 ?\n * // Note: because local time is used, the\n * // result will always be 92 days, even in\n * // time zones where DST starts and the\n * // period has only 92*24-1 hours.\n * const result = differenceInDays(\n *   new Date(2020, 5, 1),\n *   new Date(2020, 2, 1)\n * )\n * //=> 92\n */\nexport function differenceInDays(laterDate, earlierDate, options) {\n  const [laterDate_, earlierDate_] = normalizeDates(\n    options?.in,\n    laterDate,\n    earlierDate,\n  );\n\n  const sign = compareLocalAsc(laterDate_, earlierDate_);\n  const difference = Math.abs(\n    differenceInCalendarDays(laterDate_, earlierDate_),\n  );\n\n  laterDate_.setDate(laterDate_.getDate() - sign * difference);\n\n  // Math.abs(diff in full days - diff in calendar days) === 1 if last calendar day is not full\n  // If so, result must be decreased by 1 in absolute value\n  const isLastDayNotFull = Number(\n    compareLocalAsc(laterDate_, earlierDate_) === -sign,\n  );\n\n  const result = sign * (difference - isLastDayNotFull);\n  // Prevent negative zero\n  return result === 0 ? 0 : result;\n}\n\n// Like `compareAsc` but uses local time not UTC, which is needed\n// for accurate equality comparisons of UTC timestamps that end up\n// having the same representation in local time, e.g. one hour before\n// DST ends vs. the instant that DST ends.\nfunction compareLocalAsc(laterDate, earlierDate) {\n  const diff =\n    laterDate.getFullYear() - earlierDate.getFullYear() ||\n    laterDate.getMonth() - earlierDate.getMonth() ||\n    laterDate.getDate() - earlierDate.getDate() ||\n    laterDate.getHours() - earlierDate.getHours() ||\n    laterDate.getMinutes() - earlierDate.getMinutes() ||\n    laterDate.getSeconds() - earlierDate.getSeconds() ||\n    laterDate.getMilliseconds() - earlierDate.getMilliseconds();\n\n  if (diff < 0) return -1;\n  if (diff > 0) return 1;\n\n  // Return 0 if diff is 0; return NaN if diff is NaN\n  return diff;\n}\n\n// Fallback for modularized imports:\nexport default differenceInDays;\n","export {getPublicSystemSettings as '0033db22356cbf8845a3517099b63dfc38d1147299'} from 'ACTIONS_MODULE0'\nexport {getAllProjectsUnreadNotificationCount as '00686a7231b739e4fe9b8305b757bc0e83827b9865'} from 'ACTIONS_MODULE1'\nexport {getAllProjectsNotifications as '4004a0aae390e2c1aeb900c79065f312ac43d90f8d'} from 'ACTIONS_MODULE1'\nexport {markProjectNotificationAsRead as '60691655a7ad6aec29ab9691d8571a0d380be93da1'} from 'ACTIONS_MODULE1'\nexport {getOverviewReports as '406484f4f706f63530be79074d5b12dcb1b385ded1'} from 'ACTIONS_MODULE2'\nexport {getProjectReports as '4098ad2bdd8073130c7e76c7023ab783f516d336a0'} from 'ACTIONS_MODULE2'\nexport {getProjects as '003ae2a452e6e1e8ebee86f206a9903396d5df13b8'} from 'ACTIONS_MODULE3'\nexport {getUsers as '0078a5996050e1da89a66893bd05780e75185392cb'} from 'ACTIONS_MODULE4'\nexport {getTaskReports as '40e4bb39ff97cebfb3d7d51d275e06550fb05094b7'} from 'ACTIONS_MODULE2'\nexport {getTodaysReports as '40fdf1940fc18692e48c4caf9673b19168e6cc2232'} from 'ACTIONS_MODULE2'\nexport {getProjects as '00da921d2d632ba7e89405e47535a513abac90089f'} from 'ACTIONS_MODULE2'\nexport {getTeamUserReports as '406e9d86129fdcaa2c59294a7d823ec24dad2dbb70'} from 'ACTIONS_MODULE2'\nexport {getActivityReports as '4027ee99637e70a11e6d008b17e9c6ade5d63f5e91'} from 'ACTIONS_MODULE2'\nexport {getProgressReport as '40cb366c952aa9f33058dfcd245b147872e9dc1a09'} from 'ACTIONS_MODULE5'\n","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { getServerSession } from \"next-auth\"\r\nimport { authOptions } from \"@/lib/auth\"\r\nimport { startOfDay, endOfDay, subDays, startOfWeek, endOfWeek, startOfMonth, endOfMonth } from \"date-fns\"\r\nimport { hasPermissionWithoutRoleBypass } from \"@/lib/rbac-helpers\"\r\n\r\n// Helper to get projects (for filters)\r\nexport async function getProjects() {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return []\r\n\r\n    try {\r\n        const where: any = {}\r\n\r\n        if (session.user.role !== \"admin\") {\r\n            where.OR = [\r\n                { projectManagerId: parseInt(session.user.id) },\r\n                { createdById: parseInt(session.user.id) },\r\n            ]\r\n        }\r\n\r\n        const projects = await prisma.project.findMany({\r\n            where,\r\n            select: {\r\n                id: true,\r\n                name: true,\r\n            },\r\n            orderBy: { name: \"asc\" },\r\n        })\r\n\r\n        return projects\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching projects:\", error)\r\n        return []\r\n    }\r\n}\r\n\r\n// Overview Reports\r\nexport async function getOverviewReports(params: {\r\n    dateRange?: { start?: Date; end?: Date }\r\n}) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const { dateRange } = params\r\n    const startDate = dateRange?.start || startOfMonth(new Date())\r\n    const endDate = dateRange?.end || endOfMonth(new Date())\r\n\r\n    try {\r\n        const where: any = {\r\n            createdAt: {\r\n                gte: startDate,\r\n                lte: endDate,\r\n            },\r\n        }\r\n\r\n        // Role-based filtering\r\n        if (session.user.role !== \"admin\") {\r\n            where.OR = [\r\n                { projectManagerId: parseInt(session.user.id) },\r\n                { createdById: parseInt(session.user.id) },\r\n            ]\r\n        }\r\n\r\n        // Projects stats\r\n        const [totalProjects, activeProjects, completedProjects, onHoldProjects] = await Promise.all([\r\n            prisma.project.count({ where }),\r\n            prisma.project.count({ where: { ...where, status: \"active\" } }),\r\n            prisma.project.count({ where: { ...where, status: \"completed\" } }),\r\n            prisma.project.count({ where: { ...where, status: \"on_hold\" } }),\r\n        ])\r\n\r\n        // Tasks stats - Use RBAC to determine if user can see all projects\r\n        const canViewAllProjects = await hasPermissionWithoutRoleBypass(\r\n            parseInt(session.user.id),\r\n            \"project.viewAll\"\r\n        )\r\n        \r\n        const projectIds = canViewAllProjects\r\n            ? undefined\r\n            : await prisma.project.findMany({\r\n                  where: {\r\n                      OR: [\r\n                          { projectManagerId: parseInt(session.user.id) },\r\n                          { createdById: parseInt(session.user.id) },\r\n                      ],\r\n                  },\r\n                  select: { id: true },\r\n              }).then((projects) => projects.map((p) => p.id))\r\n\r\n        const taskWhere: any = {\r\n            createdAt: {\r\n                gte: startDate,\r\n                lte: endDate,\r\n            },\r\n        }\r\n\r\n        if (projectIds !== undefined) {\r\n            taskWhere.projectId = { in: projectIds }\r\n        }\r\n\r\n        const [\r\n            totalTasks,\r\n            openTasks,\r\n            completedTasks,\r\n            blockedTasks,\r\n            overdueTasks,\r\n        ] = await Promise.all([\r\n            prisma.task.count({ where: taskWhere }),\r\n            prisma.task.count({\r\n                where: {\r\n                    ...taskWhere,\r\n                    status: { in: [\"pending\", \"in_progress\", \"review\"] },\r\n                },\r\n            }),\r\n            prisma.task.count({ where: { ...taskWhere, status: \"completed\" } }),\r\n            prisma.task.count({\r\n                where: {\r\n                    ...taskWhere,\r\n                    OR: [\r\n                        { status: \"waiting\" },\r\n                        {\r\n                            dependencies: {\r\n                                some: {\r\n                                    dependsOnTask: {\r\n                                        status: { not: \"completed\" },\r\n                                    },\r\n                                },\r\n                            },\r\n                        },\r\n                    ],\r\n                },\r\n            }),\r\n            prisma.task.count({\r\n                where: {\r\n                    ...taskWhere,\r\n                    dueDate: { lt: new Date() },\r\n                    status: { not: \"completed\" },\r\n                },\r\n            }),\r\n        ])\r\n\r\n        // Today's Tasks stats\r\n        const todayStart = startOfDay(new Date())\r\n        const todayEnd = endOfDay(new Date())\r\n        const todaysTasksWhere: any = {\r\n            plannedDate: {\r\n                gte: todayStart,\r\n                lte: todayEnd,\r\n            },\r\n        }\r\n\r\n        if (projectIds !== undefined) {\r\n            todaysTasksWhere.projectId = { in: projectIds }\r\n        }\r\n\r\n        const [todaysTasksTotal, todaysTasksCompleted] = await Promise.all([\r\n            prisma.task.count({ where: todaysTasksWhere }),\r\n            prisma.task.count({\r\n                where: {\r\n                    ...todaysTasksWhere,\r\n                    status: \"completed\",\r\n                },\r\n            }),\r\n        ])\r\n\r\n        const todaysCompletionRate =\r\n            todaysTasksTotal > 0\r\n                ? Math.round((todaysTasksCompleted / todaysTasksTotal) * 100)\r\n                : 0\r\n\r\n        // Weekly trend (last 7 days)\r\n        const weeklyData = []\r\n        for (let i = 6; i >= 0; i--) {\r\n            const date = subDays(new Date(), i)\r\n            const dayStart = startOfDay(date)\r\n            const dayEnd = endOfDay(date)\r\n\r\n            const dayTaskWhere: any = {\r\n                createdAt: {\r\n                    gte: dayStart,\r\n                    lte: dayEnd,\r\n                },\r\n            }\r\n\r\n            if (projectIds !== undefined) {\r\n                dayTaskWhere.projectId = { in: projectIds }\r\n            }\r\n\r\n            const [created, completed] = await Promise.all([\r\n                prisma.task.count({ where: dayTaskWhere }),\r\n                prisma.task.count({\r\n                    where: {\r\n                        ...dayTaskWhere,\r\n                        status: \"completed\",\r\n                    },\r\n                }),\r\n            ])\r\n\r\n            weeklyData.push({\r\n                date: date.toISOString().split(\"T\")[0],\r\n                created,\r\n                completed,\r\n            })\r\n        }\r\n\r\n        // Project status distribution\r\n        const projectStatusData = await prisma.project.groupBy({\r\n            by: [\"status\"],\r\n            where,\r\n            _count: {\r\n                id: true,\r\n            },\r\n        })\r\n\r\n        // Task status distribution\r\n        const taskStatusData = await prisma.task.groupBy({\r\n            by: [\"status\"],\r\n            where: taskWhere,\r\n            _count: {\r\n                id: true,\r\n            },\r\n        })\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                projects: {\r\n                    total: totalProjects,\r\n                    active: activeProjects,\r\n                    completed: completedProjects,\r\n                    onHold: onHoldProjects,\r\n                    statusDistribution: projectStatusData.map((item) => ({\r\n                        status: item.status,\r\n                        count: item._count.id,\r\n                    })),\r\n                },\r\n                tasks: {\r\n                    total: totalTasks,\r\n                    open: openTasks,\r\n                    completed: completedTasks,\r\n                    blocked: blockedTasks,\r\n                    overdue: overdueTasks,\r\n                    statusDistribution: taskStatusData.map((item) => ({\r\n                        status: item.status,\r\n                        count: item._count.id,\r\n                    })),\r\n                },\r\n                todaysTasks: {\r\n                    total: todaysTasksTotal,\r\n                    completed: todaysTasksCompleted,\r\n                    completionRate: todaysCompletionRate,\r\n                },\r\n                weeklyTrend: weeklyData,\r\n            },\r\n        }\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching overview reports:\", error)\r\n        return {\r\n            error: error.message || \"Failed to fetch overview reports\",\r\n        }\r\n    }\r\n}\r\n\r\n// Project Reports\r\nexport async function getProjectReports(params: {\r\n    projectId?: number\r\n    category?: string[]\r\n    status?: string[]\r\n    startDate?: Date\r\n    endDate?: Date\r\n    projectManagerId?: number\r\n}) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const { projectId, category, status, startDate, endDate, projectManagerId } = params\r\n\r\n    try {\r\n        const where: any = {}\r\n\r\n        if (projectId) {\r\n            where.id = projectId\r\n        }\r\n\r\n        if (category && category.length > 0) {\r\n            where.type = { in: category }\r\n        }\r\n\r\n        if (status && status.length > 0) {\r\n            where.status = { in: status }\r\n        }\r\n\r\n        if (startDate || endDate) {\r\n            where.createdAt = {}\r\n            if (startDate) where.createdAt.gte = startDate\r\n            if (endDate) where.createdAt.lte = endDate\r\n        }\r\n\r\n        if (projectManagerId) {\r\n            where.projectManagerId = projectManagerId\r\n        }\r\n\r\n        // Role-based filtering\r\n        if (session.user.role !== \"admin\") {\r\n            where.OR = [\r\n                { projectManagerId: parseInt(session.user.id) },\r\n                { createdById: parseInt(session.user.id) },\r\n            ]\r\n        }\r\n\r\n        const projects = await prisma.project.findMany({\r\n            where,\r\n            include: {\r\n                tasks: {\r\n                    select: {\r\n                        id: true,\r\n                        status: true,\r\n                        dueDate: true,\r\n                        dependencies: {\r\n                            select: {\r\n                                dependsOnTask: {\r\n                                    select: {\r\n                                        status: true,\r\n                                    },\r\n                                },\r\n                            },\r\n                        },\r\n                    },\r\n                },\r\n                projectManager: {\r\n                    select: {\r\n                        id: true,\r\n                        username: true,\r\n                    },\r\n                },\r\n            },\r\n        })\r\n\r\n        const reports = projects.map((project) => {\r\n            const tasks = project.tasks || []\r\n            const total = tasks.length\r\n            const completed = tasks.filter((t) => t.status === \"completed\").length\r\n            const progress = total > 0 ? Math.round((completed / total) * 100) : 0\r\n\r\n            // Blocked time calculation\r\n            const blockedTasks = tasks.filter((task) => {\r\n                if (task.status === \"waiting\") return true\r\n                return task.dependencies.some(\r\n                    (dep) => dep.dependsOnTask.status !== \"completed\"\r\n                )\r\n            })\r\n\r\n            // Overdue tasks\r\n            const overdue = tasks.filter(\r\n                (task) =>\r\n                    task.dueDate &&\r\n                    new Date(task.dueDate) < new Date() &&\r\n                    task.status !== \"completed\"\r\n            )\r\n\r\n            return {\r\n                id: project.id,\r\n                name: project.name,\r\n                status: project.status,\r\n                type: project.type,\r\n                progress,\r\n                totalTasks: total,\r\n                completedTasks: completed,\r\n                blockedTasks: blockedTasks.length,\r\n                overdueTasks: overdue.length,\r\n                projectManager: project.projectManager?.username || \"Unassigned\",\r\n                startDate: project.startDate,\r\n                endDate: project.endDate,\r\n            }\r\n        })\r\n\r\n        return {\r\n            success: true,\r\n            data: reports,\r\n        }\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching project reports:\", error)\r\n        return {\r\n            error: error.message || \"Failed to fetch project reports\",\r\n        }\r\n    }\r\n}\r\n\r\n// Task Reports\r\nexport async function getTaskReports(params: {\r\n    projectId?: number[]\r\n    assigneeId?: number\r\n    status?: string[]\r\n    priority?: string[]\r\n    dependencyState?: string\r\n    startDate?: Date\r\n    endDate?: Date\r\n}) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const {\r\n        projectId,\r\n        assigneeId,\r\n        status,\r\n        priority,\r\n        dependencyState,\r\n        startDate,\r\n        endDate,\r\n    } = params\r\n\r\n    try {\r\n        const where: any = {}\r\n\r\n        if (projectId && projectId.length > 0) {\r\n            where.projectId = { in: projectId }\r\n        }\r\n\r\n        if (assigneeId) {\r\n            where.assignees = { some: { id: assigneeId } }\r\n        }\r\n\r\n        if (status && status.length > 0) {\r\n            where.status = { in: status }\r\n        }\r\n\r\n        if (priority && priority.length > 0) {\r\n            where.priority = { in: priority }\r\n        }\r\n\r\n        if (dependencyState && dependencyState !== \"all\") {\r\n            if (dependencyState === \"blocked\") {\r\n                where.OR = [\r\n                    { status: \"waiting\" },\r\n                    {\r\n                        dependencies: {\r\n                            some: {\r\n                                dependsOnTask: {\r\n                                    status: { not: \"completed\" },\r\n                                },\r\n                            },\r\n                        },\r\n                    },\r\n                ]\r\n            } else if (dependencyState === \"free\") {\r\n                where.dependencies = { none: {} }\r\n                where.status = { not: \"waiting\" }\r\n            } else if (dependencyState === \"blocking\") {\r\n                where.dependents = { some: {} }\r\n            }\r\n        }\r\n\r\n        if (startDate || endDate) {\r\n            where.createdAt = {}\r\n            if (startDate) where.createdAt.gte = startDate\r\n            if (endDate) where.createdAt.lte = endDate\r\n        }\r\n\r\n        // Role-based filtering\r\n        if (session.user.role !== \"admin\") {\r\n            const userConditions = [\r\n                { assignees: { some: { id: parseInt(session.user.id) } } },\r\n                { createdById: parseInt(session.user.id) },\r\n            ]\r\n\r\n            if (where.OR) {\r\n                where.AND = [...(where.AND || []), { OR: [...where.OR, ...userConditions] }]\r\n                delete where.OR\r\n            } else {\r\n                where.OR = userConditions\r\n            }\r\n        }\r\n\r\n        const tasks = await prisma.task.findMany({\r\n            where,\r\n            include: {\r\n                project: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                    },\r\n                },\r\n                assignees: {\r\n                    select: {\r\n                        id: true,\r\n                        username: true,\r\n                    },\r\n                },\r\n                dependencies: {\r\n                    include: {\r\n                        dependsOnTask: {\r\n                            select: {\r\n                                status: true,\r\n                            },\r\n                        },\r\n                    },\r\n                },\r\n            },\r\n        })\r\n\r\n        // Analytics\r\n        const total = tasks.length\r\n        const byStatus = tasks.reduce((acc: any, task) => {\r\n            acc[task.status] = (acc[task.status] || 0) + 1\r\n            return acc\r\n        }, {})\r\n\r\n        const byPriority = tasks.reduce((acc: any, task) => {\r\n            acc[task.priority] = (acc[task.priority] || 0) + 1\r\n            return acc\r\n        }, {})\r\n\r\n        const completed = tasks.filter((t) => t.status === \"completed\").length\r\n        const overdue = tasks.filter(\r\n            (t) => t.dueDate && new Date(t.dueDate) < new Date() && t.status !== \"completed\"\r\n        ).length\r\n\r\n        // Average completion time (for completed tasks)\r\n        const completedTasks = tasks.filter((t) => t.status === \"completed\" && t.updatedAt)\r\n        const avgCompletionTime =\r\n            completedTasks.length > 0\r\n                ? completedTasks.reduce((sum, task) => {\r\n                      const created = new Date(task.createdAt).getTime()\r\n                      const updated = new Date(task.updatedAt).getTime()\r\n                      return sum + (updated - created)\r\n                  }, 0) / completedTasks.length\r\n                : 0\r\n\r\n        // Dependency impact\r\n        const blockedByDependencies = tasks.filter((task) => {\r\n            if (task.status === \"waiting\") return true\r\n            return task.dependencies.some(\r\n                (dep) => dep.dependsOnTask.status !== \"completed\"\r\n            )\r\n        }).length\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                total,\r\n                completed,\r\n                overdue,\r\n                blockedByDependencies,\r\n                averageCompletionTime: avgCompletionTime,\r\n                byStatus: Object.entries(byStatus).map(([status, count]) => ({\r\n                    status,\r\n                    count,\r\n                })),\r\n                byPriority: Object.entries(byPriority).map(([priority, count]) => ({\r\n                    priority,\r\n                    count,\r\n                })),\r\n                tasks: tasks.slice(0, 100), // Limit for performance\r\n            },\r\n        }\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching task reports:\", error)\r\n        return {\r\n            error: error.message || \"Failed to fetch task reports\",\r\n        }\r\n    }\r\n}\r\n\r\n// Today's Reports\r\nexport async function getTodaysReports(params: {\r\n    date?: Date\r\n    userId?: number\r\n    projectId?: number\r\n}) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    const { date = new Date(), userId, projectId } = params\r\n    const dayStart = startOfDay(date)\r\n    const dayEnd = endOfDay(date)\r\n\r\n    try {\r\n        const where: any = {\r\n            plannedDate: {\r\n                gte: dayStart,\r\n                lte: dayEnd,\r\n            },\r\n        }\r\n\r\n        if (userId) {\r\n            where.assignees = { some: { id: userId } }\r\n        } else if (session.user.role !== \"admin\") {\r\n            where.assignees = { some: { id: parseInt(session.user.id) } }\r\n        }\r\n\r\n        if (projectId) {\r\n            where.projectId = projectId\r\n        }\r\n\r\n        const tasks = await prisma.task.findMany({\r\n            where,\r\n            include: {\r\n                project: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                    },\r\n                },\r\n                assignees: {\r\n                    select: {\r\n                        id: true,\r\n                        username: true,\r\n                    },\r\n                },\r\n            },\r\n        })\r\n\r\n        const total = tasks.length\r\n        const completed = tasks.filter((t) => t.status === \"completed\").length\r\n        const incomplete = total - completed\r\n        const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0\r\n\r\n        // Group by user\r\n        const byUser = tasks.reduce((acc: any, task) => {\r\n            task.assignees.forEach((assignee) => {\r\n                if (!acc[assignee.id]) {\r\n                    acc[assignee.id] = {\r\n                        userId: assignee.id,\r\n                        username: assignee.username,\r\n                        total: 0,\r\n                        completed: 0,\r\n                    }\r\n                }\r\n                acc[assignee.id].total++\r\n                if (task.status === \"completed\") {\r\n                    acc[assignee.id].completed++\r\n                }\r\n            })\r\n            return acc\r\n        }, {})\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                date: date.toISOString().split(\"T\")[0],\r\n                total,\r\n                completed,\r\n                incomplete,\r\n                completionRate,\r\n                byUser: Object.values(byUser),\r\n                tasks: tasks.map((task) => ({\r\n                    id: task.id,\r\n                    title: task.title,\r\n                    status: task.status,\r\n                    priority: task.priority,\r\n                    project: task.project.name,\r\n                    assignees: task.assignees.map((a) => a.username),\r\n                })),\r\n            },\r\n        }\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching today's reports:\", error)\r\n        return {\r\n            error: error.message || \"Failed to fetch today's reports\",\r\n        }\r\n    }\r\n}\r\n\r\n// Team & User Reports\r\nexport async function getTeamUserReports(params: {\r\n    teamId?: number\r\n    userId?: number\r\n    projectId?: number\r\n    startDate?: Date\r\n    endDate?: Date\r\n}) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    if (session.user.role !== \"admin\") {\r\n        return { error: \"Unauthorized: Admin access required\" }\r\n    }\r\n\r\n    const { teamId, userId, projectId, startDate, endDate } = params\r\n\r\n    try {\r\n        const taskWhere: any = {}\r\n\r\n        if (projectId) {\r\n            taskWhere.projectId = projectId\r\n        }\r\n\r\n        if (startDate || endDate) {\r\n            taskWhere.createdAt = {}\r\n            if (startDate) taskWhere.createdAt.gte = startDate\r\n            if (endDate) taskWhere.createdAt.lte = endDate\r\n        }\r\n\r\n        if (userId) {\r\n            taskWhere.assignees = { some: { id: userId } }\r\n        } else if (teamId) {\r\n            taskWhere.teamId = teamId\r\n        }\r\n\r\n        const tasks = await prisma.task.findMany({\r\n            where: taskWhere,\r\n            include: {\r\n                assignees: {\r\n                    select: {\r\n                        id: true,\r\n                        username: true,\r\n                    },\r\n                },\r\n                project: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                    },\r\n                },\r\n            },\r\n        })\r\n\r\n        // Group by user\r\n        const userStats: Record<\r\n            number,\r\n            {\r\n                userId: number\r\n                username: string\r\n                total: number\r\n                completed: number\r\n                overdue: number\r\n                blocked: number\r\n            }\r\n        > = {}\r\n\r\n        tasks.forEach((task) => {\r\n            task.assignees.forEach((assignee) => {\r\n                if (!userStats[assignee.id]) {\r\n                    userStats[assignee.id] = {\r\n                        userId: assignee.id,\r\n                        username: assignee.username,\r\n                        total: 0,\r\n                        completed: 0,\r\n                        overdue: 0,\r\n                        blocked: 0,\r\n                    }\r\n                }\r\n\r\n                userStats[assignee.id].total++\r\n                if (task.status === \"completed\") {\r\n                    userStats[assignee.id].completed++\r\n                }\r\n                if (\r\n                    task.dueDate &&\r\n                    new Date(task.dueDate) < new Date() &&\r\n                    task.status !== \"completed\"\r\n                ) {\r\n                    userStats[assignee.id].overdue++\r\n                }\r\n                if (task.status === \"waiting\") {\r\n                    userStats[assignee.id].blocked++\r\n                }\r\n            })\r\n        })\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                users: Object.values(userStats).map((user) => ({\r\n                    ...user,\r\n                    completionRate:\r\n                        user.total > 0 ? Math.round((user.completed / user.total) * 100) : 0,\r\n                    overdueRate:\r\n                        user.total > 0 ? Math.round((user.overdue / user.total) * 100) : 0,\r\n                })),\r\n            },\r\n        }\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching team/user reports:\", error)\r\n        return {\r\n            error: error.message || \"Failed to fetch team/user reports\",\r\n        }\r\n    }\r\n}\r\n\r\n// Activity Reports\r\nexport async function getActivityReports(params: {\r\n    userId?: number\r\n    actionType?: string\r\n    entityType?: string\r\n    startDate?: Date\r\n    endDate?: Date\r\n    page?: number\r\n    limit?: number\r\n}) {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session) return { error: \"Unauthorized\" }\r\n\r\n    if (session.user.role !== \"admin\") {\r\n        return { error: \"Unauthorized: Admin access required\" }\r\n    }\r\n\r\n    const {\r\n        userId,\r\n        actionType,\r\n        entityType,\r\n        startDate,\r\n        endDate,\r\n        page = 1,\r\n        limit = 50,\r\n    } = params\r\n\r\n    try {\r\n        const where: any = {}\r\n\r\n        if (userId) {\r\n            where.performedById = userId\r\n        }\r\n\r\n        if (actionType) {\r\n            where.actionType = actionType\r\n        }\r\n\r\n        if (entityType) {\r\n            where.entityType = entityType\r\n        }\r\n\r\n        if (startDate || endDate) {\r\n            where.createdAt = {}\r\n            if (startDate) where.createdAt.gte = startDate\r\n            if (endDate) where.createdAt.lte = endDate\r\n        }\r\n\r\n        const skip = (page - 1) * limit\r\n\r\n        const [logs, total] = await Promise.all([\r\n            prisma.activityLog.findMany({\r\n                where,\r\n                skip,\r\n                take: limit,\r\n                orderBy: { createdAt: \"desc\" },\r\n                include: {\r\n                    performedBy: {\r\n                        select: {\r\n                            id: true,\r\n                            username: true,\r\n                            email: true,\r\n                        },\r\n                    },\r\n                },\r\n            }),\r\n            prisma.activityLog.count({ where }),\r\n        ])\r\n\r\n        // Group by action type\r\n        const byActionType = await prisma.activityLog.groupBy({\r\n            by: [\"actionType\"],\r\n            where,\r\n            _count: {\r\n                id: true,\r\n            },\r\n        })\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                logs,\r\n                total,\r\n                page,\r\n                limit,\r\n                byActionType: byActionType.map((item) => ({\r\n                    actionType: item.actionType,\r\n                    count: item._count.id,\r\n                })),\r\n            },\r\n        }\r\n    } catch (error: any) {\r\n        console.error(\"Error fetching activity reports:\", error)\r\n        return {\r\n            error: error.message || \"Failed to fetch activity reports\",\r\n        }\r\n    }\r\n}\r\n\r\n","import { toDate } from \"./toDate.js\";\n\n/**\n * The {@link startOfMonth} function options.\n */\n\n/**\n * @name startOfMonth\n * @category Month Helpers\n * @summary Return the start of a month for the given date.\n *\n * @description\n * Return the start of a month for the given date. The result will be in the local timezone.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments.\n * Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed,\n * or inferred from the arguments.\n *\n * @param date - The original date\n * @param options - An object with options\n *\n * @returns The start of a month\n *\n * @example\n * // The start of a month for 2 September 2014 11:55:00:\n * const result = startOfMonth(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Mon Sep 01 2014 00:00:00\n */\nexport function startOfMonth(date, options) {\n  const _date = toDate(date, options?.in);\n  _date.setDate(1);\n  _date.setHours(0, 0, 0, 0);\n  return _date;\n}\n\n// Fallback for modularized imports:\nexport default startOfMonth;\n"],"names":[],"mappings":"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","ignoreList":[0,1,2,4,5,6,7,8,9,10,11,13,16]}