(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,478717,e=>{"use strict";var s=e.i(696009),t=e.i(181340),a=e.i(142113),r=e.i(813606),n=e.i(956569),i=e.i(588813),l=e.i(776574),d=e.i(364850),c=e.i(745999);let o=(0,c.createServerReference)("4092279ff8e6ca25b90aeb832f385d51d9d7c60d48",c.callServer,void 0,c.findSourceMapURL,"createSubtask"),u=(0,c.createServerReference)("600329ba0ba9cc97651d7734bbf3d4a35a31ef80d5",c.callServer,void 0,c.findSourceMapURL,"updateSubtask"),m=(0,c.createServerReference)("403f8a5c068c0438ff16759bb9ee34241fe1078c6f",c.callServer,void 0,c.findSourceMapURL,"deleteSubtask");var x=e.i(362987),h=e.i(479093),p=e.i(91622);function g({subtasks:e,parentTaskId:c}){let[g,f]=(0,t.useState)(""),[j,v]=(0,t.useState)(!1),[b,N]=(0,t.useState)(null),[y,S]=(0,t.useState)(""),k=(0,t.useRef)(null),w=(0,t.useRef)(null),{toast:C}=(0,x.useToast)(),T=(0,h.useRouter)(),D=e.filter(e=>"completed"===e.status).length,L=e.length,R=L>0?Math.round(D/L*100):0;(0,t.useEffect)(()=>{null!==b&&w.current&&(w.current.focus(),w.current.select())},[b]);let A=async()=>{if(!g.trim())return;v(!0);let e=await o({parentTaskId:c,title:g.trim(),priority:"normal"});v(!1),e.error?C({title:"Error",description:e.error,variant:"destructive"}):(f(""),T.refresh())},B=async(e,s)=>{await u(e,{status:"completed"===s?"pending":"completed"}),T.refresh()},F=async(e,s)=>{if(!window.confirm(`Delete "${s}"?`))return;let t=await m(e);t.error?C({title:"Error",description:t.error,variant:"destructive"}):T.refresh()},I=async e=>{y.trim()?(await u(e,{title:y.trim()}),N(null),T.refresh()):N(null)};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold",children:"Checklist"}),L>0&&(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:[D," of ",L," completed"]})]})}),e.length>0&&(0,s.jsx)("div",{className:"space-y-1.5",children:e.map(e=>{let t="completed"===e.status,n=b===e.id;return(0,s.jsxs)("div",{className:(0,p.cn)("group flex items-center gap-3 p-2 rounded-md transition-colors","hover:bg-muted/50",t&&"opacity-75"),children:[(0,s.jsx)(a.Checkbox,{checked:t,onCheckedChange:()=>B(e.id,e.status),className:"mt-0.5"}),n?(0,s.jsx)("div",{className:"flex-1 flex items-center gap-2",children:(0,s.jsx)(r.Input,{ref:w,value:y,onChange:e=>S(e.target.value),onKeyDown:s=>{"Enter"===s.key?I(e.id):"Escape"===s.key&&(N(null),S(""))},onBlur:()=>I(e.id),className:"h-8 text-sm"})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:(0,p.cn)("flex-1 text-sm cursor-pointer select-none",t&&"line-through text-muted-foreground"),onDoubleClick:()=>{N(e.id),S(e.title)},children:e.title}),(0,s.jsx)("button",{className:"opacity-0 group-hover:opacity-100 h-6 w-6 text-muted-foreground hover:text-destructive flex items-center justify-center transition-all rounded-sm hover:bg-destructive/10",onClick:()=>F(e.id,e.title),title:"Delete subtask",children:(0,s.jsx)(d.X,{className:"h-3.5 w-3.5"})})]})]},e.id)})}),(0,s.jsxs)("div",{className:"flex gap-2 items-center pt-2 border-t",children:[(0,s.jsx)(r.Input,{ref:k,placeholder:"Add a checklist item...",className:"h-9 text-sm",value:g,onChange:e=>f(e.target.value),onKeyDown:e=>{"Enter"!==e.key||j||A()}}),(0,s.jsx)(n.Button,{size:"sm",onClick:A,disabled:j||!g.trim(),className:"h-9",children:j?(0,s.jsx)(l.Loader2,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(i.Plus,{className:"h-4 w-4"})})]}),L>0&&(0,s.jsx)("div",{className:"pt-2",children:(0,s.jsx)("div",{className:"h-1.5 bg-muted rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${R}%`}})})})]})}e.s(["SubtaskList",()=>g],478717)},286461,e=>{"use strict";var s=e.i(696009),t=e.i(35490),a=e.i(956569),r=e.i(304077),n=e.i(782199),i=e.i(799038),l=e.i(117807),d=e.i(364850),c=e.i(134676),c=c,o=e.i(846420),u=e.i(267237),u=u,m=e.i(745999);let x=(0,m.createServerReference)("604f3a4a12d21d9ff500f2582d8b0d2c84fbc7c29b",m.callServer,void 0,m.findSourceMapURL,"removeTaskDependency");var h=e.i(479093),p=e.i(181340),g=e.i(91622);function f({dependencies:e,taskId:m,projectId:f,canEdit:j=!0}){let v=(0,h.useRouter)(),[b,N]=(0,p.useState)(null),y=async e=>{if(confirm("Are you sure you want to remove this dependency?")){N(e);try{let s=await x(m,e);s.error?alert(s.error):(v.refresh(),window.location.reload())}catch(e){console.error("Removal error:",e),alert("Failed to remove dependency")}finally{N(null)}}};return 0===e.length?(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"No dependencies. This task can be started immediately."}):(0,s.jsx)("div",{className:"space-y-3",children:e.map(e=>{var m;let x="completed"===e.dependsOnTask.status,h=!x;return(0,s.jsxs)(r.Card,{className:(0,g.cn)("transition-colors",h&&"border-orange-500/50 bg-orange-500/5"),children:[(0,s.jsx)(r.CardHeader,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[h?(0,s.jsx)(n.AlertCircle,{className:"w-4 h-4 text-orange-500"}):(0,s.jsx)(i.CheckCircle2,{className:"w-4 h-4 text-green-500"}),(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium",children:e.dependsOnTask.title})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(m=e.dependsOnTask.status,x?(0,s.jsxs)(t.Badge,{variant:"outline",className:"bg-green-500/10 text-green-500 border-green-500/20",children:[(0,s.jsx)(i.CheckCircle2,{className:"w-3 h-3 mr-1"}),"Completed"]}):(0,s.jsx)(t.Badge,{variant:"outline",className:(0,g.cn)("capitalize",{pending:"bg-yellow-500/10 text-yellow-500 border-yellow-500/20",in_progress:"bg-blue-500/10 text-blue-500 border-blue-500/20",waiting:"bg-orange-500/10 text-orange-500 border-orange-500/20",review:"bg-purple-500/10 text-purple-500 border-purple-500/20",completed:"bg-green-500/10 text-green-500 border-green-500/20"}[m]||"bg-gray-500/10 text-gray-500"),children:m.replace("_"," ")})),h&&(0,s.jsxs)(t.Badge,{variant:"outline",className:"bg-orange-500/10 text-orange-500 border-orange-500/20",children:[(0,s.jsx)(l.Clock,{className:"w-3 h-3 mr-1"}),"Blocking"]})]})]}),j&&(0,s.jsx)(a.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>y(e.dependsOnTask.id),disabled:b===e.dependsOnTask.id,children:(0,s.jsx)(d.X,{className:"w-4 h-4"})})]})}),(0,s.jsx)(r.CardContent,{className:"pt-0",children:(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[e.dependsOnTask.assignees&&e.dependsOnTask.assignees.length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(o.Users,{className:"w-4 h-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"Assigned to:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e.dependsOnTask.assignees.map(e=>(0,s.jsxs)(t.Badge,{variant:"secondary",className:"text-xs",children:[e.username,e.team&&(0,s.jsxs)("span",{className:"ml-1 text-muted-foreground",children:["(",e.team.name,")"]})]},e.id))})]}),e.dependsOnTask.team&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(u.default,{className:"w-4 h-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"Team:"}),(0,s.jsx)(t.Badge,{variant:"outline",className:"text-xs",children:e.dependsOnTask.team.name})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(c.default,{className:"w-4 h-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"Type:"}),(0,s.jsx)("span",{className:"text-xs",children:"finish_to_start"===e.dependencyType?"Finish-to-Start":e.dependencyType})]})]})})]},e.dependsOnTask.id)})})}e.s(["DependencyList",()=>f],286461)},532981,e=>{"use strict";var s=e.i(696009),t=e.i(181340),a=e.i(956569),r=e.i(690905),n=e.i(678892),i=e.i(594652),l=e.i(588813),d=e.i(776574),c=e.i(604208),o=e.i(171482),o=o,u=e.i(662637),m=e.i(620770),x=e.i(745999);let h=(0,x.createServerReference)("40b408831ea3954e375d99f8ba4ff27359527e7e4b",x.callServer,void 0,x.findSourceMapURL,"createTaskDependency"),p=(0,x.createServerReference)("40dd61ff2058f534f42f49da426a52f160b4b04ec1",x.callServer,void 0,x.findSourceMapURL,"getAvailableDependencyTasks");var g=e.i(479093),f=e.i(35490),j=e.i(91622);function v({taskId:e,projectId:x,existingDependencyIds:v=[]}){let[b,N]=(0,t.useState)(!1),[y,S]=(0,t.useState)(!1),[k,w]=(0,t.useState)(!1),[C,T]=(0,t.useState)([]),[D,L]=(0,t.useState)([]),[R,A]=(0,t.useState)(""),[B,F]=(0,t.useState)(!1),[I,O]=(0,t.useState)("");(0,g.useRouter)(),(0,t.useEffect)(()=>{b?U():(O(""),T([]),L([]),A(""))},[b,e,v]),(0,t.useEffect)(()=>{if(R.trim()){let e=R.toLowerCase();L(C.filter(s=>{let t=s.title.toLowerCase(),a=s.status.toLowerCase(),r=s.assignees&&s.assignees.length>0?s.assignees.map(e=>e.username.toLowerCase()).join(" "):s.team?s.team.name.toLowerCase():"";return t.includes(e)||a.includes(e)||r.includes(e)||s.id.toString().includes(e)}))}else L(C)},[R,C]);let U=async()=>{F(!0);try{let s=(await p(e)).filter(e=>!v.includes(e.id));console.log("Available tasks for dependency:",s.length,s),T(s),L(s)}catch(e){console.error("Failed to load available tasks:",e),alert("Failed to load tasks. Please try again."),T([])}finally{F(!1)}},$=async()=>{if(!I)return void alert("Please select a task");w(!0);try{let s=new FormData;s.append("taskId",e.toString()),s.append("dependsOnTaskId",I),s.append("dependencyType","finish_to_start");let t=await h(s);if(t.error)if(!t.error.includes("already exists"))return void alert(t.error+(t.details?`: ${t.details}`:""));else{N(!1),O(""),window.location.reload();return}N(!1),O(""),window.location.href=`/dashboard/projects/${x}/tasks/${e}`}catch(e){alert("Failed to create dependency")}finally{w(!1)}},E=C.find(e=>e.id.toString()===I);return(0,s.jsxs)(r.Dialog,{open:b,onOpenChange:N,children:[(0,s.jsx)(r.DialogTrigger,{asChild:!0,children:(0,s.jsxs)(a.Button,{variant:"outline",size:"sm",children:[(0,s.jsx)(l.Plus,{className:"w-4 h-4 mr-2"}),"Add Dependency"]})}),(0,s.jsxs)(r.DialogContent,{className:"sm:max-w-[500px]",children:[(0,s.jsxs)(r.DialogHeader,{children:[(0,s.jsx)(r.DialogTitle,{children:"Add Task Dependency"}),(0,s.jsx)(r.DialogDescription,{children:"Search and select a task that must be completed before this task can proceed."})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2 flex flex-col",children:[(0,s.jsx)(i.Label,{children:"Prerequisite Task"}),B?(0,s.jsxs)("div",{className:"flex items-center justify-center py-4 border rounded-md",children:[(0,s.jsx)(d.Loader2,{className:"w-4 h-4 animate-spin mr-2"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading available tasks..."})]}):0===C.length?(0,s.jsx)("div",{className:"flex items-center justify-center py-4 border rounded-md bg-muted/50",children:(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:v.length>0?"All project tasks are already linked.":"No other tasks available in this project."})}):(0,s.jsxs)(n.Popover,{open:y,onOpenChange:S,children:[(0,s.jsx)(n.PopoverTrigger,{asChild:!0,children:(0,s.jsxs)(a.Button,{variant:"outline",role:"combobox","aria-expanded":y,className:"w-full justify-between",children:[I?C.find(e=>e.id.toString()===I)?.title:"Select task...",(0,s.jsx)(o.default,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,s.jsx)(n.PopoverContent,{className:"w-[450px] p-0",align:"start",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center border-b px-3",children:[(0,s.jsx)(m.Search,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,s.jsx)("input",{type:"text",placeholder:"Search tasks...",value:R,onChange:e=>A(e.target.value),className:"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground"})]}),(0,s.jsx)("div",{className:"max-h-[300px] overflow-y-auto overflow-x-hidden p-1",children:0===D.length?(0,s.jsx)("div",{className:"py-6 text-center text-sm text-muted-foreground",children:"No task found."}):(0,s.jsx)("div",{className:"space-y-1",children:D.map(e=>{let t="completed"===e.status,a=e.assignees&&e.assignees.length>0?e.assignees.map(e=>e.username).join(", "):e.team?`Team: ${e.team.name}`:"Unassigned",r=I===e.id.toString();return(0,s.jsxs)("div",{onClick:()=>{let s=e.id.toString();O(s===I?"":s),S(!1)},className:(0,j.cn)("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors","hover:bg-accent hover:text-accent-foreground",r&&"bg-accent text-accent-foreground"),children:[(0,s.jsx)(c.Check,{className:(0,j.cn)("mr-2 h-4 w-4",r?"opacity-100":"opacity-0")}),(0,s.jsxs)("div",{className:"flex flex-col flex-1 gap-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium",children:e.title}),t&&(0,s.jsx)(f.Badge,{variant:"outline",className:"text-[10px] px-1 py-0 h-4 bg-green-500/10 text-green-500 border-green-500/20",children:"Done"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,s.jsx)("span",{className:"capitalize",children:e.status.replace("_"," ")}),(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{children:a})]})]})]},e.id)})})})]})})]})]}),E&&(0,s.jsxs)("div",{className:"p-3 bg-muted/50 rounded-md border space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium",children:[(0,s.jsx)(u.Info,{className:"w-4 h-4 text-blue-500"}),"Selected Prerequisite"]}),(0,s.jsxs)("div",{className:"text-sm pl-6",children:[(0,s.jsx)("p",{className:"font-medium",children:E.title}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"This task must be completed before the current task can start."})]})]}),(0,s.jsxs)("div",{className:"space-y-2 pt-2",children:[(0,s.jsx)(i.Label,{children:"Dependency Type"}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center gap-2 p-2 border rounded-md",children:[(0,s.jsx)(f.Badge,{variant:"outline",children:"Finish-to-Start"}),(0,s.jsx)("span",{children:"Mandatory: Prerequisite must finish for dependent to start."})]})]})]}),(0,s.jsxs)(r.DialogFooter,{children:[(0,s.jsx)(a.Button,{type:"button",variant:"outline",onClick:()=>N(!1),disabled:k,children:"Cancel"}),(0,s.jsxs)(a.Button,{onClick:$,disabled:k||!I||B,children:[k&&(0,s.jsx)(d.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Add Dependency"]})]})]})]})}e.s(["DependencyDialog",()=>v],532981)},905189,e=>{"use strict";var s=e.i(696009),t=e.i(181340),a=e.i(479093),r=e.i(690831),n=e.i(956569),i=e.i(991064),l=e.i(745999);let d=(0,l.createServerReference)("40a65e7babeb7969d8364ec60bd423ee1c78b2ae4a",l.callServer,void 0,l.findSourceMapURL,"createComment");var c=e.i(438967),o=e.i(776574),u=e.i(165303),u=u,m=e.i(35490);function x({comments:e,taskId:l,projectId:x,users:h=[]}){let[p,g]=(0,t.useState)(!1),[f,j]=(0,t.useState)(""),[v,b]=(0,t.useState)(!1),[N,y]=(0,t.useState)(""),[S,k]=(0,t.useState)(0),w=(0,t.useRef)(null),C=(0,t.useRef)(null),T=(0,a.useRouter)(),D=h.filter(e=>e.username.toLowerCase().includes(N.toLowerCase())),L=e=>{if(!w.current)return;let s=w.current,t=s.selectionStart,a=f.substring(0,t).lastIndexOf("@");if(-1!==a){let r=f.substring(t);j(f.substring(0,a)+`@${e.username} `+r),b(!1),setTimeout(()=>{let t=a+e.username.length+2;s.focus(),s.setSelectionRange(t,t)},0)}};async function R(e){e.preventDefault(),g(!0);let s=new FormData(e.currentTarget);s.set("content",f),s.append("taskId",l.toString()),s.append("projectId",x.toString());let t=await d(s);g(!1),j(""),b(!1),t?.success&&T.refresh()}return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Comments"}),(0,s.jsxs)("form",{onSubmit:R,className:"space-y-3",children:[(0,s.jsxs)("div",{ref:C,className:"space-y-2",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(i.Textarea,{ref:w,name:"content",value:f,onChange:e=>{let s=e.target.value;j(s);let t=e.target.selectionStart,a=s.substring(0,t),r=a.lastIndexOf("@");if(-1!==r){let e=a.substring(r+1);if(!/[\s\n]/.test(e)){y(e),b(!0),k(0);return}}b(!1)},onKeyDown:e=>{v&&D.length>0&&("ArrowDown"===e.key?(e.preventDefault(),k(e=>e<D.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),k(e=>e>0?e-1:0)):"Enter"===e.key||"Tab"===e.key?(e.preventDefault(),L(D[S])):"Escape"===e.key&&b(!1))},placeholder:"Add Comment (type @ to mention someone)",required:!0,className:"min-h-[100px]"}),v&&D.length>0&&(0,s.jsx)("div",{className:"absolute z-50 top-full left-0 mt-1 w-[300px] rounded-md border bg-popover shadow-lg",children:(0,s.jsx)("div",{className:"max-h-[200px] overflow-y-auto p-1",children:D.map((e,t)=>(0,s.jsxs)("div",{onClick:s=>{s.preventDefault(),s.stopPropagation(),L(e)},onMouseEnter:()=>k(t),className:`
                                                flex items-center gap-2 px-2 py-1.5 rounded-sm cursor-pointer
                                                transition-colors select-none
                                                ${t===S?"bg-accent text-accent-foreground":"hover:bg-accent/50"}
                                            `,children:[(0,s.jsx)(r.Avatar,{className:"h-6 w-6",children:(0,s.jsx)(r.AvatarFallback,{className:"text-xs",children:e.username.substring(0,2).toUpperCase()})}),(0,s.jsx)("span",{className:"text-sm font-medium",children:e.username})]},e.id))})})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Tip: Type @ followed by a username to mention someone"})]}),(0,s.jsx)(n.Button,{type:"submit",disabled:p,className:"w-full",children:p?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.default,{className:"mr-2 h-4 w-4"}),"Add Comment"]})})]}),0===e.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No comments yet."}):(0,s.jsx)("div",{className:"space-y-4 pt-4 border-t",children:e.map(e=>(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)(r.Avatar,{className:"h-8 w-8",children:(0,s.jsx)(r.AvatarFallback,{className:"text-xs",children:e.author.username.substring(0,2).toUpperCase()})}),(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-semibold",children:e.author.username}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",suppressHydrationWarning:!0,children:(0,c.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})]}),(0,s.jsx)("div",{className:"text-sm text-foreground whitespace-pre-wrap break-words",children:function(e){let t,a=/@(\w+)/g,r=[],n=0;for(;null!==(t=a.exec(e));)t.index>n&&r.push(e.substring(n,t.index)),r.push((0,s.jsxs)(m.Badge,{variant:"secondary",className:"mx-0.5 bg-primary/10 text-primary hover:bg-primary/20",children:["@",t[1]]},t.index)),n=a.lastIndex;return n<e.length&&r.push(e.substring(n)),r.length>0?r:e}(e.content)})]})]},e.id))})]})}e.s(["CommentSection",()=>x],905189)},233151,e=>{"use strict";var s=e.i(696009),t=e.i(181340),a=e.i(956569),r=e.i(690905),n=e.i(936358),i=e.i(813606),l=e.i(594652),d=e.i(991064),c=e.i(745999);let o=(0,c.createServerReference)("6066449d29d31fc61eee331d63571737ef28220e06",c.callServer,void 0,c.findSourceMapURL,"updateTask");var u=e.i(776574),m=e.i(479093);function x({task:e,projectId:c,users:x=[],open:h,onOpenChange:p}){let[g,f]=(0,t.useState)(!1),[j,v]=(0,t.useState)([]),b=(0,m.useRouter)();async function N(s){s.preventDefault(),f(!0);let t=new FormData(s.currentTarget);t.set("assigneeIds",JSON.stringify(j));let a=await o(e.id,t);f(!1),a?.success?(p(!1),b.refresh()):alert(a?.error+(a?.details?`: ${a.details}`:""))}return(0,t.useEffect)(()=>{e.assignees&&v(e.assignees.map(e=>e.id))},[e]),(0,s.jsx)(r.Dialog,{open:h,onOpenChange:p,children:(0,s.jsxs)(r.DialogContent,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(r.DialogHeader,{children:[(0,s.jsx)(r.DialogTitle,{children:"Edit Task"}),(0,s.jsx)(r.DialogDescription,{children:"Update task details, assignees, and priority."})]}),(0,s.jsxs)("form",{onSubmit:N,children:[(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(l.Label,{htmlFor:"title",children:"Title *"}),(0,s.jsx)(i.Input,{id:"title",name:"title",defaultValue:e.title,placeholder:"Task title",required:!0})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(l.Label,{htmlFor:"description",children:"Description"}),(0,s.jsx)(d.Textarea,{id:"description",name:"description",defaultValue:e.description||"",placeholder:"Task description...",rows:4})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(l.Label,{htmlFor:"priority",children:"Priority"}),(0,s.jsxs)(n.Select,{name:"priority",defaultValue:e.priority,children:[(0,s.jsx)(n.SelectTrigger,{id:"priority",children:(0,s.jsx)(n.SelectValue,{placeholder:"Select priority"})}),(0,s.jsxs)(n.SelectContent,{children:[(0,s.jsx)(n.SelectItem,{value:"normal",children:"Normal"}),(0,s.jsx)(n.SelectItem,{value:"urgent",children:"Urgent"})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(l.Label,{htmlFor:"status",children:"Status"}),(0,s.jsxs)(n.Select,{name:"status",defaultValue:e.status,children:[(0,s.jsx)(n.SelectTrigger,{id:"status",children:(0,s.jsx)(n.SelectValue,{placeholder:"Select status"})}),(0,s.jsxs)(n.SelectContent,{children:[(0,s.jsx)(n.SelectItem,{value:"pending",children:"Pending"}),(0,s.jsx)(n.SelectItem,{value:"waiting",children:"Waiting"}),(0,s.jsx)(n.SelectItem,{value:"in_progress",children:"In Progress"}),(0,s.jsx)(n.SelectItem,{value:"review",children:"Review"}),(0,s.jsx)(n.SelectItem,{value:"completed",children:"Completed"})]})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(l.Label,{htmlFor:"dueDate",children:"Due Date"}),(0,s.jsx)(i.Input,{id:"dueDate",name:"dueDate",type:"date",defaultValue:(e=>{if(!e)return"";let s=new Date(e),t=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0");return`${t}-${a}-${r}`})(e.dueDate)})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(l.Label,{children:"Assignees"}),(0,s.jsx)("div",{className:"border rounded-md p-2 max-h-[150px] overflow-y-auto space-y-2",children:x.length>0?x.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",id:`assignee-${e.id}`,checked:j.includes(e.id),onChange:()=>{var s;return s=e.id,void v(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s])},className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),(0,s.jsx)(l.Label,{htmlFor:`assignee-${e.id}`,className:"text-sm font-normal cursor-pointer",children:e.username})]},e.id)):(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No users available"})})]})]}),(0,s.jsxs)(r.DialogFooter,{children:[(0,s.jsx)(a.Button,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),(0,s.jsxs)(a.Button,{type:"submit",disabled:g,children:[g&&(0,s.jsx)(u.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Task"]})]})]})]})})}let h=(0,c.createServerReference)("40db1cdcc45db655c6914f09995d8097bcc488bbce",c.callServer,void 0,c.findSourceMapURL,"deleteTask");var p=e.i(613205);function g({task:e,projectId:n,open:i,onOpenChange:l}){let[d,c]=(0,t.useState)(!1),o=(0,m.useRouter)();async function x(){c(!0);let s=await h(e.id);c(!1),s?.success?(l(!1),o.push(`/dashboard/projects/${n}`),o.refresh()):alert(s?.error+(s?.details?`

${s.details}`:""))}let g=(e.subtaskCount||0)>0||(e.commentCount||0)>0||(e.dependencyCount||0)>0;return(0,s.jsx)(r.Dialog,{open:i,onOpenChange:l,children:(0,s.jsxs)(r.DialogContent,{children:[(0,s.jsxs)(r.DialogHeader,{children:[(0,s.jsxs)(r.DialogTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(p.AlertTriangle,{className:"h-5 w-5 text-destructive"}),"Delete Task"]}),(0,s.jsxs)(r.DialogDescription,{children:["Are you sure you want to delete ",(0,s.jsx)("strong",{children:e.title}),"?"]})]}),(0,s.jsx)("div",{className:"py-4",children:(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["This action cannot be undone. This will permanently delete the task",g&&(0,s.jsxs)("span",{className:"block mt-2 text-destructive font-medium",children:["⚠️ Warning: This task has related data that will be permanently deleted:",e.subtaskCount&&e.subtaskCount>0&&(0,s.jsxs)("span",{className:"block",children:["• ",e.subtaskCount," subtask(s)"]}),e.commentCount&&e.commentCount>0&&(0,s.jsxs)("span",{className:"block",children:["• ",e.commentCount," comment(s)"]}),e.dependencyCount&&e.dependencyCount>0&&(0,s.jsxs)("span",{className:"block",children:["• ",e.dependencyCount," dependency relationship(s)"]})]})]})}),(0,s.jsxs)(r.DialogFooter,{children:[(0,s.jsx)(a.Button,{type:"button",variant:"outline",onClick:()=>l(!1),disabled:d,children:"Cancel"}),(0,s.jsxs)(a.Button,{type:"button",variant:"destructive",onClick:x,disabled:d,children:[d&&(0,s.jsx)(u.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete Task"]})]})]})})}var f=e.i(963904),j=e.i(237122);function v({task:e,projectId:r,users:n=[]}){let[i,l]=(0,t.useState)(!1),[d,c]=(0,t.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(a.Button,{variant:"outline",size:"sm",onClick:()=>l(!0),children:[(0,s.jsx)(f.Edit,{className:"mr-2 h-4 w-4"}),"Edit"]}),(0,s.jsxs)(a.Button,{variant:"outline",size:"sm",onClick:()=>c(!0),className:"text-destructive hover:text-destructive",children:[(0,s.jsx)(j.Trash2,{className:"mr-2 h-4 w-4"}),"Delete"]}),(0,s.jsx)(x,{task:{id:e.id,title:e.title,description:e.description??null,priority:e.priority||"normal",status:e.status||"pending",dueDate:e.dueDate??null,assignees:(e.assignees||[]).map(e=>({id:e.id,username:e.username}))},projectId:r,users:n,open:i,onOpenChange:l}),(0,s.jsx)(g,{task:{id:e.id,title:e.title,subtaskCount:e.subtasks?.length||0,commentCount:e.comments?.length||0,dependencyCount:(e.dependencies?.length||0)+(e.dependents?.length||0)},projectId:r,open:d,onOpenChange:c})]})}e.s(["TaskActions",()=>v],233151)},215531,e=>{"use strict";var s=e.i(696009),t=e.i(181340),a=e.i(936358),r=e.i(956569),n=e.i(344853),i=e.i(579099),l=e.i(479093),d=e.i(776574);function c({taskId:e,currentStatus:c,currentTaskStatusId:o,projectId:u}){let[m,x]=(0,t.useState)(o?.toString()||c),[h,p]=(0,t.useState)(!1),[g,f]=(0,t.useState)([]),[j,v]=(0,t.useState)(!0),b=(0,l.useRouter)();(0,t.useEffect)(()=>{!async function(){v(!0);let e=await (0,i.getTaskStatuses)(!1);if(v(!1),e.success&&(f(e.taskStatuses||[]),!o&&e.taskStatuses)){let s=e.taskStatuses.find(e=>e.name.toLowerCase()===c.toLowerCase());s&&x(s.id.toString())}}()},[c,o]);let N=async()=>{let s=o?.toString()||c;if(m!==s){p(!0);try{let t=g.find(e=>e.id.toString()===m)?parseInt(m):m,a=await (0,n.updateTaskStatus)(e,t,u);a.error?(alert(a.error+(a.details?`: ${a.details}`:"")),x(s)):b.refresh()}catch(e){alert("Failed to update status"),x(s)}finally{p(!1)}}},y=o?.toString()||c;return(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(a.Select,{value:m,onValueChange:x,disabled:h||j||0===g.length,children:[(0,s.jsx)(a.SelectTrigger,{className:"flex-1",children:(0,s.jsx)(a.SelectValue,{placeholder:j?"Loading statuses...":0===g.length?"No statuses available":"Select status"})}),g.length>0&&(0,s.jsx)(a.SelectContent,{children:g.map(e=>(0,s.jsx)(a.SelectItem,{value:e.id.toString(),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"h-3 w-3 rounded-full",style:{backgroundColor:e.color}}),(0,s.jsx)("span",{children:e.name})]})},e.id))})]}),(0,s.jsx)(r.Button,{onClick:N,disabled:h||m===y||j||0===g.length,size:"sm",children:h?(0,s.jsx)(d.Loader2,{className:"h-4 w-4 animate-spin"}):"Update"})]})}e.s(["TaskStatusUpdate",()=>c])}]);